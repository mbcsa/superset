{"version":3,"file":"a8e96ebddab4851b23f1.chunk.js","mappings":"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","sources":["webpack://superset/./src/addSlice/AddSliceContainer.tsx"],"sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { ReactNode } from 'react';\nimport rison from 'rison';\nimport querystring from 'query-string';\nimport { styled, t, SupersetClient, JsonResponse } from '@superset-ui/core';\nimport { getUrlParam } from 'src/utils/urlUtils';\nimport { URL_PARAMS } from 'src/constants';\nimport { isNullish } from 'src/utils/common';\nimport { withRouter, RouteComponentProps } from 'react-router-dom';\nimport Button from 'src/components/Button';\nimport { AsyncSelect, Steps } from 'src/components';\nimport { Tooltip } from 'src/components/Tooltip';\nimport withToasts from 'src/components/MessageToasts/withToasts';\n\nimport VizTypeGallery, {\n  MAX_ADVISABLE_VIZ_GALLERY_WIDTH,\n} from 'src/explore/components/controls/VizTypeControl/VizTypeGallery';\nimport _ from 'lodash';\nimport { findPermission } from 'src/utils/findPermission';\nimport { UserWithPermissionsAndRoles } from 'src/types/bootstrapTypes';\n\ntype Dataset = {\n  id: number;\n  table_name: string;\n  description: string;\n  datasource_type: string;\n};\n\nexport interface AddSliceContainerProps extends RouteComponentProps {\n  user: UserWithPermissionsAndRoles;\n  addSuccessToast: (arg: string) => void;\n}\n\nexport type AddSliceContainerState = {\n  datasource?: { label: string; value: string };\n  datasetName?: string | string[] | null;\n  vizType: string | null;\n  canCreateDataset: boolean;\n};\n\nconst ESTIMATED_NAV_HEIGHT = 56;\nconst ELEMENTS_EXCEPT_VIZ_GALLERY = ESTIMATED_NAV_HEIGHT + 250;\n\nconst StyledContainer = styled.div`\n  ${({ theme }) => `\n    flex: 1 1 auto;\n    display: flex;\n    flex-direction: column;\n    justify-content: space-between;\n    width: 100%;\n    max-width: ${MAX_ADVISABLE_VIZ_GALLERY_WIDTH}px;\n    max-height: calc(100vh - ${ESTIMATED_NAV_HEIGHT}px);\n    border-radius: ${theme.gridUnit}px;\n    background-color: ${theme.colors.grayscale.light5};\n    margin-left: auto;\n    margin-right: auto;\n    padding-left: ${theme.gridUnit * 4}px;\n    padding-right: ${theme.gridUnit * 4}px;\n    padding-bottom: ${theme.gridUnit * 4}px;\n\n    h3 {\n      padding-bottom: ${theme.gridUnit * 3}px;\n    }\n\n    & .dataset {\n      display: flex;\n      flex-direction: row;\n      align-items: center;\n\n      & > div {\n        min-width: 200px;\n        width: 300px;\n      }\n\n      & > span {\n        color: ${theme.colors.grayscale.light1};\n        margin-left: ${theme.gridUnit * 4}px;\n      }\n    }\n\n    & .viz-gallery {\n      border: 1px solid ${theme.colors.grayscale.light2};\n      border-radius: ${theme.gridUnit}px;\n      margin: ${theme.gridUnit}px 0px;\n      max-height: calc(100vh - ${ELEMENTS_EXCEPT_VIZ_GALLERY}px);\n      flex: 1;\n    }\n\n    & .footer {\n      flex: 1;\n      display: flex;\n      flex-direction: row;\n      justify-content: flex-end;\n      align-items: center;\n\n      & > span {\n        color: ${theme.colors.grayscale.light1};\n        margin-right: ${theme.gridUnit * 4}px;\n      }\n    }\n\n    /* The following extra ampersands (&&&&) are used to boost selector specificity */\n\n    &&&& .ant-steps-item-tail {\n      display: none;\n    }\n\n    &&&& .ant-steps-item-icon {\n      margin-right: ${theme.gridUnit * 2}px;\n      width: ${theme.gridUnit * 5}px;\n      height: ${theme.gridUnit * 5}px;\n      line-height: ${theme.gridUnit * 5}px;\n    }\n\n    &&&& .ant-steps-item-title {\n      line-height: ${theme.gridUnit * 5}px;\n    }\n\n    &&&& .ant-steps-item-content {\n      overflow: unset;\n\n      .ant-steps-item-description {\n        margin-top: ${theme.gridUnit}px;\n      }\n    }\n\n    &&&& .ant-tooltip-open {\n      display: inline;\n    }\n\n    &&&& .ant-select-selector {\n      padding: 0;\n    }\n\n    &&&& .ant-select-selection-placeholder {\n      padding-left: ${theme.gridUnit * 3}px;\n    }\n  `}\n`;\n\nconst TooltipContent = styled.div<{ hasDescription: boolean }>`\n  ${({ theme, hasDescription }) => `\n    .tooltip-header {\n      font-size: ${\n        hasDescription ? theme.typography.sizes.l : theme.typography.sizes.s\n      }px;\n      font-weight: ${\n        hasDescription\n          ? theme.typography.weights.bold\n          : theme.typography.weights.normal\n      };\n    }\n\n    .tooltip-description {\n      margin-top: ${theme.gridUnit * 2}px;\n      display: -webkit-box;\n      -webkit-line-clamp: 20;\n      -webkit-box-orient: vertical;\n      overflow: hidden;\n      text-overflow: ellipsis;\n    }\n  `}\n`;\n\nconst StyledLabel = styled.span`\n  ${({ theme }) => `\n    position: absolute;\n    left: ${theme.gridUnit * 3}px;\n    right: ${theme.gridUnit * 3}px;\n    overflow: hidden;\n    text-overflow: ellipsis;\n  `}\n`;\n\nconst StyledStepTitle = styled.span`\n  ${({\n    theme: {\n      typography: { sizes, weights },\n    },\n  }) => `\n      font-size: ${sizes.m}px;\n      font-weight: ${weights.bold};\n    `}\n`;\n\nconst StyledStepDescription = styled.div`\n  ${({ theme: { gridUnit } }) => `\n    margin-top: ${gridUnit * 4}px;\n    margin-bottom: ${gridUnit * 3}px;\n  `}\n`;\n\nexport class AddSliceContainer extends React.PureComponent<\n  AddSliceContainerProps,\n  AddSliceContainerState\n> {\n  constructor(props: AddSliceContainerProps) {\n    super(props);\n    this.state = {\n      vizType: null,\n      canCreateDataset: findPermission(\n        'can_write',\n        'Dataset',\n        props.user.roles,\n      ),\n    };\n\n    this.changeDatasource = this.changeDatasource.bind(this);\n    this.changeVizType = this.changeVizType.bind(this);\n    this.gotoSlice = this.gotoSlice.bind(this);\n    this.newLabel = this.newLabel.bind(this);\n    this.loadDatasources = this.loadDatasources.bind(this);\n    this.onVizTypeDoubleClick = this.onVizTypeDoubleClick.bind(this);\n  }\n\n  componentDidMount() {\n    const params = querystring.parse(window.location.search)?.dataset as string;\n    if (params) {\n      this.loadDatasources(params, 0, 1).then(r => {\n        const datasource = r.data[0];\n        // override here to force styling of option label\n        // which expects a reactnode instead of string\n        // @ts-expect-error\n        datasource.label = datasource.customLabel;\n        this.setState({ datasource });\n      });\n      this.props.addSuccessToast(t('The dataset has been saved'));\n    }\n  }\n\n  exploreUrl() {\n    const dashboardId = getUrlParam(URL_PARAMS.dashboardId);\n    let url = `/explore/?viz_type=${this.state.vizType}&datasource=${this.state.datasource?.value}`;\n    if (!isNullish(dashboardId)) {\n      url += `&dashboard_id=${dashboardId}`;\n    }\n    return url;\n  }\n\n  gotoSlice() {\n    this.props.history.push(this.exploreUrl());\n  }\n\n  changeDatasource(datasource: { label: string; value: string }) {\n    this.setState({ datasource });\n  }\n\n  changeVizType(vizType: string | null) {\n    this.setState({ vizType });\n  }\n\n  isBtnDisabled() {\n    return !(this.state.datasource?.value && this.state.vizType);\n  }\n\n  onVizTypeDoubleClick() {\n    if (!this.isBtnDisabled()) {\n      this.gotoSlice();\n    }\n  }\n\n  newLabel(item: Dataset) {\n    return (\n      <Tooltip\n        mouseEnterDelay={1}\n        placement=\"right\"\n        title={\n          <TooltipContent hasDescription={!!item.description}>\n            <div className=\"tooltip-header\">{item.table_name}</div>\n            {item.description && (\n              <div className=\"tooltip-description\">{item.description}</div>\n            )}\n          </TooltipContent>\n        }\n      >\n        <StyledLabel>{item.table_name}</StyledLabel>\n      </Tooltip>\n    );\n  }\n\n  loadDatasources(search: string, page: number, pageSize: number) {\n    const query = rison.encode({\n      columns: ['id', 'table_name', 'description', 'datasource_type'],\n      filters: [{ col: 'table_name', opr: 'ct', value: search }],\n      page,\n      page_size: pageSize,\n      order_column: 'table_name',\n      order_direction: 'asc',\n    });\n    return SupersetClient.get({\n      endpoint: `/api/v1/dataset/?q=${query}`,\n    }).then((response: JsonResponse) => {\n      const list: {\n        customLabel: ReactNode;\n        id: number;\n        label: string;\n        value: string;\n      }[] = response.json.result.map((item: Dataset) => ({\n        id: item.id,\n        value: `${item.id}__${item.datasource_type}`,\n        customLabel: this.newLabel(item),\n        label: item.table_name,\n      }));\n      return {\n        data: list,\n        totalCount: response.json.count,\n      };\n    });\n  }\n\n  render() {\n    const isButtonDisabled = this.isBtnDisabled();\n    const datasetHelpText = this.state.canCreateDataset ? (\n      <span data-test=\"dataset-write\">\n        <a\n          href=\"/tablemodelview/list/#create\"\n          rel=\"noopener noreferrer\"\n          target=\"_blank\"\n        >\n          {t('Add a dataset')}\n        </a>\n        {` ${t('or')} `}\n        <a\n          href=\"https://superset.apache.org/docs/creating-charts-dashboards/creating-your-first-dashboard/#registering-a-new-table\"\n          rel=\"noopener noreferrer\"\n          target=\"_blank\"\n        >\n          {`${t('view instructions')} `}\n          <i className=\"fa fa-external-link\" />\n        </a>\n        .\n      </span>\n    ) : (\n      <span data-test=\"no-dataset-write\">\n        <a\n          href=\"https://superset.apache.org/docs/creating-charts-dashboards/creating-your-first-dashboard/#registering-a-new-table\"\n          rel=\"noopener noreferrer\"\n          target=\"_blank\"\n        >\n          {`${t('View instructions')} `}\n          <i className=\"fa fa-external-link\" />\n        </a>\n        .\n      </span>\n    );\n\n    return (\n      <StyledContainer>\n        <h3>{t('Create a new chart')}</h3>\n        <Steps direction=\"vertical\" size=\"small\">\n          <Steps.Step\n            title={<StyledStepTitle>{t('Choose a dataset')}</StyledStepTitle>}\n            status={this.state.datasource?.value ? 'finish' : 'process'}\n            description={\n              <StyledStepDescription className=\"dataset\">\n                <AsyncSelect\n                  autoFocus\n                  ariaLabel={t('Dataset')}\n                  name=\"select-datasource\"\n                  onChange={this.changeDatasource}\n                  options={this.loadDatasources}\n                  optionFilterProps={['id', 'label']}\n                  placeholder={t('Choose a dataset')}\n                  showSearch\n                  value={this.state.datasource}\n                />\n                {datasetHelpText}\n              </StyledStepDescription>\n            }\n          />\n          <Steps.Step\n            title={<StyledStepTitle>{t('Choose chart type')}</StyledStepTitle>}\n            status={this.state.vizType ? 'finish' : 'process'}\n            description={\n              <StyledStepDescription>\n                <VizTypeGallery\n                  className=\"viz-gallery\"\n                  onChange={this.changeVizType}\n                  onDoubleClick={this.onVizTypeDoubleClick}\n                  selectedViz={this.state.vizType}\n                />\n              </StyledStepDescription>\n            }\n          />\n        </Steps>\n        <div className=\"footer\">\n          {isButtonDisabled && (\n            <span>\n              {t('Please select both a Dataset and a Chart type to proceed')}\n            </span>\n          )}\n          <Button\n            buttonStyle=\"primary\"\n            disabled={isButtonDisabled}\n            onClick={this.gotoSlice}\n          >\n            {t('Create new chart')}\n          </Button>\n        </div>\n      </StyledContainer>\n    );\n  }\n}\n\nexport default withRouter(withToasts(AddSliceContainer));\n"],"names":["StyledContainer","theme","gridUnit","colors","grayscale","light5","light1","light2","TooltipContent","hasDescription","typography","sizes","l","s","weights","bold","normal","StyledLabel","StyledStepTitle","m","StyledStepDescription","AddSliceContainer","constructor","props","super","this","state","vizType","canCreateDataset","user","roles","changeDatasource","bind","changeVizType","gotoSlice","newLabel","loadDatasources","onVizTypeDoubleClick","componentDidMount","params","window","location","search","dataset","then","r","datasource","data","label","customLabel","setState","addSuccessToast","t","exploreUrl","dashboardId","url","value","history","push","isBtnDisabled","item","mouseEnterDelay","placement","title","description","className","table_name","page","pageSize","query","columns","filters","col","opr","page_size","order_column","order_direction","endpoint","response","json","result","map","id","datasource_type","totalCount","count","render","isButtonDisabled","datasetHelpText","href","rel","target","direction","size","Step","status","autoFocus","ariaLabel","name","onChange","options","optionFilterProps","placeholder","showSearch","onDoubleClick","selectedViz","buttonStyle","disabled","onClick"],"sourceRoot":""}