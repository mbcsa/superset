/*! For license information please see 613fb00fb2b8e4760aa9.chunk.js.LICENSE.txt */
(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[452],{8177:(e,t,n)=>{e.exports={default:n(77084),__esModule:!0}},77084:(e,t,n)=>{n(75789);var i=n(94731).Object;e.exports=function(e,t){return i.getOwnPropertyDescriptor(e,t)}},75789:(e,t,n)=>{var i=n(64874),r=n(18437).f;n(44903)("getOwnPropertyDescriptor",(function(){return function(e,t){return r(i(e),t)}}))},50139:(e,t)=>{"use strict";t.__esModule=!0,t.default=void 0;var n=!("undefined"==typeof window||!window.document||!window.document.createElement);t.default=n,e.exports=t.default},44825:(e,t,n)=>{"use strict";var i=n(95318);t.__esModule=!0,t.default=function(e){if((!r&&0!==r||e)&&o.default){var t=document.createElement("div");t.style.position="absolute",t.style.top="-9999px",t.style.width="50px",t.style.height="50px",t.style.overflow="scroll",document.body.appendChild(t),r=t.offsetWidth-t.clientWidth,document.body.removeChild(t)}return r};var r,o=i(n(50139));e.exports=t.default},82689:(e,t,n)=>{var i=n(29932),r=n(97786),o=n(67206),a=n(69199),s=n(71131),l=n(7518),d=n(85022),c=n(6557),u=n(1469);e.exports=function(e,t,n){t=t.length?i(t,(function(e){return u(e)?function(t){return r(t,1===e.length?e[0]:e)}:e})):[c];var h=-1;t=i(t,l(o));var p=a(e,(function(e,n,r){return{criteria:i(t,(function(t){return t(e)})),index:++h,value:e}}));return s(p,(function(e,t){return d(e,t,n)}))}},71131:e=>{e.exports=function(e,t){var n=e.length;for(e.sort(t);n--;)e[n]=e[n].value;return e}},26393:(e,t,n)=>{var i=n(33448);e.exports=function(e,t){if(e!==t){var n=void 0!==e,r=null===e,o=e==e,a=i(e),s=void 0!==t,l=null===t,d=t==t,c=i(t);if(!l&&!c&&!a&&e>t||a&&s&&d&&!l&&!c||r&&s&&d||!n&&d||!o)return 1;if(!r&&!a&&!c&&e<t||c&&n&&o&&!r&&!a||l&&n&&o||!s&&o||!d)return-1}return 0}},85022:(e,t,n)=>{var i=n(26393);e.exports=function(e,t,n){for(var r=-1,o=e.criteria,a=t.criteria,s=o.length,l=n.length;++r<s;){var d=i(o[r],a[r]);if(d)return r>=l?d:d*("desc"==n[r]?-1:1)}return e.index-t.index}},94654:(e,t,n)=>{var i=n(21078),r=n(35161);e.exports=function(e,t){return i(r(e,t),1)}},10752:(e,t,n)=>{var i=n(21078),r=n(35161);e.exports=function(e,t){return i(r(e,t),1/0)}},8802:(e,t,n)=>{var i=n(90939);e.exports=function(e,t,n){var r=(n="function"==typeof n?n:void 0)?n(e,t):void 0;return void 0===r?i(e,t,void 0,n):!!r}},89734:(e,t,n)=>{var i=n(21078),r=n(82689),o=n(5976),a=n(16612),s=o((function(e,t){if(null==e)return[];var n=t.length;return n>1&&a(e,t[0],t[1])?t=[]:n>2&&a(t[0],t[1],t[2])&&(t=[t[0]]),r(e,i(t,1),[])}));e.exports=s},44908:(e,t,n)=>{var i=n(45652);e.exports=function(e){return e&&e.length?i(e):[]}},87185:(e,t,n)=>{var i=n(45652);e.exports=function(e,t){return t="function"==typeof t?t:void 0,e&&e.length?i(e,void 0,t):[]}},75:function(e,t,n){var i=n(34155);(function(){var t,n,r,o,a,s;"undefined"!=typeof performance&&null!==performance&&performance.now?e.exports=function(){return performance.now()}:null!=i&&i.hrtime?(e.exports=function(){return(t()-a)/1e6},n=i.hrtime,o=(t=function(){var e;return 1e9*(e=n())[0]+e[1]})(),s=1e9*i.uptime(),a=o-s):Date.now?(e.exports=function(){return Date.now()-r},r=Date.now()):(e.exports=function(){return(new Date).getTime()-r},r=(new Date).getTime())}).call(this)},54087:(e,t,n)=>{for(var i=n(75),r="undefined"==typeof window?n.g:window,o=["moz","webkit"],a="AnimationFrame",s=r["request"+a],l=r["cancel"+a]||r["cancelRequest"+a],d=0;!s&&d<o.length;d++)s=r[o[d]+"Request"+a],l=r[o[d]+"Cancel"+a]||r[o[d]+"CancelRequest"+a];if(!s||!l){var c=0,u=0,h=[];s=function(e){if(0===h.length){var t=i(),n=Math.max(0,16.666666666666668-(t-c));c=n+t,setTimeout((function(){var e=h.slice(0);h.length=0;for(var t=0;t<e.length;t++)if(!e[t].cancelled)try{e[t].callback(c)}catch(e){setTimeout((function(){throw e}),0)}}),Math.round(n))}return h.push({handle:++u,callback:e,cancelled:!1}),u},l=function(e){for(var t=0;t<h.length;t++)h[t].handle===e&&(h[t].cancelled=!0)}}e.exports=function(e){return s.call(r,e)},e.exports.cancel=function(){l.apply(r,arguments)},e.exports.polyfill=function(e){e||(e=r),e.requestAnimationFrame=s,e.cancelAnimationFrame=l}},28388:(e,t,n)=>{var i;window,e.exports=(i=n(67294),function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=27)}([function(e,t,n){e.exports=n(96)()},function(e,t){e.exports=i},function(e,t,n){var i=n(16),r="object"==typeof self&&self&&self.Object===Object&&self,o=i||r||Function("return this")();e.exports=o},function(e,t,n){var i=n(41),r=n(47);e.exports=function(e,t){var n=r(e,t);return i(n)?n:void 0}},function(e,t,n){var i=n(31),r=n(32),o=n(33),a=n(34),s=n(35);function l(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}l.prototype.clear=i,l.prototype.delete=r,l.prototype.get=o,l.prototype.has=a,l.prototype.set=s,e.exports=l},function(e,t,n){var i=n(14);e.exports=function(e,t){for(var n=e.length;n--;)if(i(e[n][0],t))return n;return-1}},function(e,t,n){var i=n(12),r=n(43),o=n(44),a=i?i.toStringTag:void 0;e.exports=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":a&&a in Object(e)?r(e):o(e)}},function(e,t,n){var i=n(3)(Object,"create");e.exports=i},function(e,t,n){var i=n(56);e.exports=function(e,t){var n=e.__data__;return i(t)?n["string"==typeof t?"string":"hash"]:n.map}},function(e,t){e.exports=function(e){return null!=e&&"object"==typeof e}},function(e,t,n){var i;!function(){"use strict";var n={}.hasOwnProperty;function r(){for(var e=[],t=0;t<arguments.length;t++){var i=arguments[t];if(i){var o=typeof i;if("string"===o||"number"===o)e.push(i);else if(Array.isArray(i)&&i.length){var a=r.apply(null,i);a&&e.push(a)}else if("object"===o)for(var s in i)n.call(i,s)&&i[s]&&e.push(s)}}return e.join(" ")}e.exports?(r.default=r,e.exports=r):void 0===(i=function(){return r}.apply(t,[]))||(e.exports=i)}()},function(e,t,n){var i=n(3)(n(2),"Map");e.exports=i},function(e,t,n){var i=n(2).Symbol;e.exports=i},function(e,t){var n=Array.isArray;e.exports=n},function(e,t){e.exports=function(e,t){return e===t||e!=e&&t!=t}},function(e,t,n){var i=n(6),r=n(17);e.exports=function(e){if(!r(e))return!1;var t=i(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t}},function(e,t,n){(function(t){var n="object"==typeof t&&t&&t.Object===Object&&t;e.exports=n}).call(this,n(42))},function(e,t){e.exports=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}},function(e,t){var n=Function.prototype.toString;e.exports=function(e){if(null!=e){try{return n.call(e)}catch(e){}try{return e+""}catch(e){}}return""}},function(e,t,n){var i=n(48),r=n(55),o=n(57),a=n(58),s=n(59);function l(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}l.prototype.clear=i,l.prototype.delete=r,l.prototype.get=o,l.prototype.has=a,l.prototype.set=s,e.exports=l},function(e,t,n){var i=n(60),r=n(63),o=n(64);e.exports=function(e,t,n,a,s,l){var d=1&n,c=e.length,u=t.length;if(c!=u&&!(d&&u>c))return!1;var h=l.get(e);if(h&&l.get(t))return h==t;var p=-1,f=!0,m=2&n?new i:void 0;for(l.set(e,t),l.set(t,e);++p<c;){var g=e[p],v=t[p];if(a)var b=d?a(v,g,p,t,e,l):a(g,v,p,e,t,l);if(void 0!==b){if(b)continue;f=!1;break}if(m){if(!r(t,(function(e,t){if(!o(m,t)&&(g===e||s(g,e,n,a,l)))return m.push(t)}))){f=!1;break}}else if(g!==v&&!s(g,v,n,a,l)){f=!1;break}}return l.delete(e),l.delete(t),f}},function(e,t,n){(function(e){var i=n(2),r=n(81),o=t&&!t.nodeType&&t,a=o&&"object"==typeof e&&e&&!e.nodeType&&e,s=a&&a.exports===o?i.Buffer:void 0,l=(s?s.isBuffer:void 0)||r;e.exports=l}).call(this,n(22)(e))},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,n){var i=n(83),r=n(84),o=n(85),a=o&&o.isTypedArray,s=a?r(a):i;e.exports=s},function(e,t){e.exports=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}},function(e,t,n){var i=n(28);e.exports=function(e,t){return i(e,t)}},function(e,t,n){var i=self.crypto||self.msCrypto;e.exports=function(e){e=e||21;for(var t="",n=i.getRandomValues(new Uint8Array(e));0<e--;)t+="Uint8ArdomValuesObj012345679BCDEFGHIJKLMNPQRSTWXYZ_cfghkpqvwxyz-"[63&n[e]];return t}},function(e,t,n){e.exports=n(98).default},function(e,t,n){var i=n(29),r=n(9);e.exports=function e(t,n,o,a,s){return t===n||(null==t||null==n||!r(t)&&!r(n)?t!=t&&n!=n:i(t,n,o,a,e,s))}},function(e,t,n){var i=n(30),r=n(20),o=n(65),a=n(69),s=n(91),l=n(13),d=n(21),c=n(23),u="[object Arguments]",h="[object Array]",p="[object Object]",f=Object.prototype.hasOwnProperty;e.exports=function(e,t,n,m,g,v){var b=l(e),y=l(t),C=b?h:s(e),S=y?h:s(t),x=(C=C==u?p:C)==p,w=(S=S==u?p:S)==p,k=C==S;if(k&&d(e)){if(!d(t))return!1;b=!0,x=!1}if(k&&!x)return v||(v=new i),b||c(e)?r(e,t,n,m,g,v):o(e,t,C,n,m,g,v);if(!(1&n)){var R=x&&f.call(e,"__wrapped__"),Z=w&&f.call(t,"__wrapped__");if(R||Z){var F=R?e.value():e,T=Z?t.value():t;return v||(v=new i),g(F,T,n,m,v)}}return!!k&&(v||(v=new i),a(e,t,n,m,g,v))}},function(e,t,n){var i=n(4),r=n(36),o=n(37),a=n(38),s=n(39),l=n(40);function d(e){var t=this.__data__=new i(e);this.size=t.size}d.prototype.clear=r,d.prototype.delete=o,d.prototype.get=a,d.prototype.has=s,d.prototype.set=l,e.exports=d},function(e,t){e.exports=function(){this.__data__=[],this.size=0}},function(e,t,n){var i=n(5),r=Array.prototype.splice;e.exports=function(e){var t=this.__data__,n=i(t,e);return!(n<0||(n==t.length-1?t.pop():r.call(t,n,1),--this.size,0))}},function(e,t,n){var i=n(5);e.exports=function(e){var t=this.__data__,n=i(t,e);return n<0?void 0:t[n][1]}},function(e,t,n){var i=n(5);e.exports=function(e){return i(this.__data__,e)>-1}},function(e,t,n){var i=n(5);e.exports=function(e,t){var n=this.__data__,r=i(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this}},function(e,t,n){var i=n(4);e.exports=function(){this.__data__=new i,this.size=0}},function(e,t){e.exports=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n}},function(e,t){e.exports=function(e){return this.__data__.get(e)}},function(e,t){e.exports=function(e){return this.__data__.has(e)}},function(e,t,n){var i=n(4),r=n(11),o=n(19);e.exports=function(e,t){var n=this.__data__;if(n instanceof i){var a=n.__data__;if(!r||a.length<199)return a.push([e,t]),this.size=++n.size,this;n=this.__data__=new o(a)}return n.set(e,t),this.size=n.size,this}},function(e,t,n){var i=n(15),r=n(45),o=n(17),a=n(18),s=/^\[object .+?Constructor\]$/,l=Function.prototype,d=Object.prototype,c=l.toString,u=d.hasOwnProperty,h=RegExp("^"+c.call(u).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");e.exports=function(e){return!(!o(e)||r(e))&&(i(e)?h:s).test(a(e))}},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){var i=n(12),r=Object.prototype,o=r.hasOwnProperty,a=r.toString,s=i?i.toStringTag:void 0;e.exports=function(e){var t=o.call(e,s),n=e[s];try{e[s]=void 0;var i=!0}catch(e){}var r=a.call(e);return i&&(t?e[s]=n:delete e[s]),r}},function(e,t){var n=Object.prototype.toString;e.exports=function(e){return n.call(e)}},function(e,t,n){var i,r=n(46),o=(i=/[^.]+$/.exec(r&&r.keys&&r.keys.IE_PROTO||""))?"Symbol(src)_1."+i:"";e.exports=function(e){return!!o&&o in e}},function(e,t,n){var i=n(2)["__core-js_shared__"];e.exports=i},function(e,t){e.exports=function(e,t){return null==e?void 0:e[t]}},function(e,t,n){var i=n(49),r=n(4),o=n(11);e.exports=function(){this.size=0,this.__data__={hash:new i,map:new(o||r),string:new i}}},function(e,t,n){var i=n(50),r=n(51),o=n(52),a=n(53),s=n(54);function l(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}l.prototype.clear=i,l.prototype.delete=r,l.prototype.get=o,l.prototype.has=a,l.prototype.set=s,e.exports=l},function(e,t,n){var i=n(7);e.exports=function(){this.__data__=i?i(null):{},this.size=0}},function(e,t){e.exports=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}},function(e,t,n){var i=n(7),r=Object.prototype.hasOwnProperty;e.exports=function(e){var t=this.__data__;if(i){var n=t[e];return"__lodash_hash_undefined__"===n?void 0:n}return r.call(t,e)?t[e]:void 0}},function(e,t,n){var i=n(7),r=Object.prototype.hasOwnProperty;e.exports=function(e){var t=this.__data__;return i?void 0!==t[e]:r.call(t,e)}},function(e,t,n){var i=n(7);e.exports=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=i&&void 0===t?"__lodash_hash_undefined__":t,this}},function(e,t,n){var i=n(8);e.exports=function(e){var t=i(this,e).delete(e);return this.size-=t?1:0,t}},function(e,t){e.exports=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}},function(e,t,n){var i=n(8);e.exports=function(e){return i(this,e).get(e)}},function(e,t,n){var i=n(8);e.exports=function(e){return i(this,e).has(e)}},function(e,t,n){var i=n(8);e.exports=function(e,t){var n=i(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this}},function(e,t,n){var i=n(19),r=n(61),o=n(62);function a(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new i;++t<n;)this.add(e[t])}a.prototype.add=a.prototype.push=r,a.prototype.has=o,e.exports=a},function(e,t){e.exports=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this}},function(e,t){e.exports=function(e){return this.__data__.has(e)}},function(e,t){e.exports=function(e,t){for(var n=-1,i=null==e?0:e.length;++n<i;)if(t(e[n],n,e))return!0;return!1}},function(e,t){e.exports=function(e,t){return e.has(t)}},function(e,t,n){var i=n(12),r=n(66),o=n(14),a=n(20),s=n(67),l=n(68),d=i?i.prototype:void 0,c=d?d.valueOf:void 0;e.exports=function(e,t,n,i,d,u,h){switch(n){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":return!(e.byteLength!=t.byteLength||!u(new r(e),new r(t)));case"[object Boolean]":case"[object Date]":case"[object Number]":return o(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case"[object Map]":var p=s;case"[object Set]":var f=1&i;if(p||(p=l),e.size!=t.size&&!f)return!1;var m=h.get(e);if(m)return m==t;i|=2,h.set(e,t);var g=a(p(e),p(t),i,d,u,h);return h.delete(e),g;case"[object Symbol]":if(c)return c.call(e)==c.call(t)}return!1}},function(e,t,n){var i=n(2).Uint8Array;e.exports=i},function(e,t){e.exports=function(e){var t=-1,n=Array(e.size);return e.forEach((function(e,i){n[++t]=[i,e]})),n}},function(e,t){e.exports=function(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=e})),n}},function(e,t,n){var i=n(70),r=Object.prototype.hasOwnProperty;e.exports=function(e,t,n,o,a,s){var l=1&n,d=i(e),c=d.length;if(c!=i(t).length&&!l)return!1;for(var u=c;u--;){var h=d[u];if(!(l?h in t:r.call(t,h)))return!1}var p=s.get(e);if(p&&s.get(t))return p==t;var f=!0;s.set(e,t),s.set(t,e);for(var m=l;++u<c;){var g=e[h=d[u]],v=t[h];if(o)var b=l?o(v,g,h,t,e,s):o(g,v,h,e,t,s);if(!(void 0===b?g===v||a(g,v,n,o,s):b)){f=!1;break}m||(m="constructor"==h)}if(f&&!m){var y=e.constructor,C=t.constructor;y!=C&&"constructor"in e&&"constructor"in t&&!("function"==typeof y&&y instanceof y&&"function"==typeof C&&C instanceof C)&&(f=!1)}return s.delete(e),s.delete(t),f}},function(e,t,n){var i=n(71),r=n(73),o=n(76);e.exports=function(e){return i(e,o,r)}},function(e,t,n){var i=n(72),r=n(13);e.exports=function(e,t,n){var o=t(e);return r(e)?o:i(o,n(e))}},function(e,t){e.exports=function(e,t){for(var n=-1,i=t.length,r=e.length;++n<i;)e[r+n]=t[n];return e}},function(e,t,n){var i=n(74),r=n(75),o=Object.prototype.propertyIsEnumerable,a=Object.getOwnPropertySymbols,s=a?function(e){return null==e?[]:(e=Object(e),i(a(e),(function(t){return o.call(e,t)})))}:r;e.exports=s},function(e,t){e.exports=function(e,t){for(var n=-1,i=null==e?0:e.length,r=0,o=[];++n<i;){var a=e[n];t(a,n,e)&&(o[r++]=a)}return o}},function(e,t){e.exports=function(){return[]}},function(e,t,n){var i=n(77),r=n(86),o=n(90);e.exports=function(e){return o(e)?i(e):r(e)}},function(e,t,n){var i=n(78),r=n(79),o=n(13),a=n(21),s=n(82),l=n(23),d=Object.prototype.hasOwnProperty;e.exports=function(e,t){var n=o(e),c=!n&&r(e),u=!n&&!c&&a(e),h=!n&&!c&&!u&&l(e),p=n||c||u||h,f=p?i(e.length,String):[],m=f.length;for(var g in e)!t&&!d.call(e,g)||p&&("length"==g||u&&("offset"==g||"parent"==g)||h&&("buffer"==g||"byteLength"==g||"byteOffset"==g)||s(g,m))||f.push(g);return f}},function(e,t){e.exports=function(e,t){for(var n=-1,i=Array(e);++n<e;)i[n]=t(n);return i}},function(e,t,n){var i=n(80),r=n(9),o=Object.prototype,a=o.hasOwnProperty,s=o.propertyIsEnumerable,l=i(function(){return arguments}())?i:function(e){return r(e)&&a.call(e,"callee")&&!s.call(e,"callee")};e.exports=l},function(e,t,n){var i=n(6),r=n(9);e.exports=function(e){return r(e)&&"[object Arguments]"==i(e)}},function(e,t){e.exports=function(){return!1}},function(e,t){var n=/^(?:0|[1-9]\d*)$/;e.exports=function(e,t){var i=typeof e;return!!(t=null==t?9007199254740991:t)&&("number"==i||"symbol"!=i&&n.test(e))&&e>-1&&e%1==0&&e<t}},function(e,t,n){var i=n(6),r=n(24),o=n(9),a={};a["[object Float32Array]"]=a["[object Float64Array]"]=a["[object Int8Array]"]=a["[object Int16Array]"]=a["[object Int32Array]"]=a["[object Uint8Array]"]=a["[object Uint8ClampedArray]"]=a["[object Uint16Array]"]=a["[object Uint32Array]"]=!0,a["[object Arguments]"]=a["[object Array]"]=a["[object ArrayBuffer]"]=a["[object Boolean]"]=a["[object DataView]"]=a["[object Date]"]=a["[object Error]"]=a["[object Function]"]=a["[object Map]"]=a["[object Number]"]=a["[object Object]"]=a["[object RegExp]"]=a["[object Set]"]=a["[object String]"]=a["[object WeakMap]"]=!1,e.exports=function(e){return o(e)&&r(e.length)&&!!a[i(e)]}},function(e,t){e.exports=function(e){return function(t){return e(t)}}},function(e,t,n){(function(e){var i=n(16),r=t&&!t.nodeType&&t,o=r&&"object"==typeof e&&e&&!e.nodeType&&e,a=o&&o.exports===r&&i.process,s=function(){try{return o&&o.require&&o.require("util").types||a&&a.binding&&a.binding("util")}catch(e){}}();e.exports=s}).call(this,n(22)(e))},function(e,t,n){var i=n(87),r=n(88),o=Object.prototype.hasOwnProperty;e.exports=function(e){if(!i(e))return r(e);var t=[];for(var n in Object(e))o.call(e,n)&&"constructor"!=n&&t.push(n);return t}},function(e,t){var n=Object.prototype;e.exports=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||n)}},function(e,t,n){var i=n(89)(Object.keys,Object);e.exports=i},function(e,t){e.exports=function(e,t){return function(n){return e(t(n))}}},function(e,t,n){var i=n(15),r=n(24);e.exports=function(e){return null!=e&&r(e.length)&&!i(e)}},function(e,t,n){var i=n(92),r=n(11),o=n(93),a=n(94),s=n(95),l=n(6),d=n(18),c=d(i),u=d(r),h=d(o),p=d(a),f=d(s),m=l;(i&&"[object DataView]"!=m(new i(new ArrayBuffer(1)))||r&&"[object Map]"!=m(new r)||o&&"[object Promise]"!=m(o.resolve())||a&&"[object Set]"!=m(new a)||s&&"[object WeakMap]"!=m(new s))&&(m=function(e){var t=l(e),n="[object Object]"==t?e.constructor:void 0,i=n?d(n):"";if(i)switch(i){case c:return"[object DataView]";case u:return"[object Map]";case h:return"[object Promise]";case p:return"[object Set]";case f:return"[object WeakMap]"}return t}),e.exports=m},function(e,t,n){var i=n(3)(n(2),"DataView");e.exports=i},function(e,t,n){var i=n(3)(n(2),"Promise");e.exports=i},function(e,t,n){var i=n(3)(n(2),"Set");e.exports=i},function(e,t,n){var i=n(3)(n(2),"WeakMap");e.exports=i},function(e,t,n){"use strict";var i=n(97);function r(){}e.exports=function(){function e(e,t,n,r,o,a){if(a!==i){var s=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw s.name="Invariant Violation",s}}function t(){return e}e.isRequired=e;var n={array:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t};return n.checkPropTypes=r,n.PropTypes=n,n}},function(e,t,n){"use strict";e.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},function(e,t,n){"use strict";n.r(t);var i=n(10),r=n.n(i),o=n(25),a=n.n(o),s=n(26),l=n.n(s),d=n(0),c=n.n(d),u=n(1),h=n.n(u);function p(e){return(p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function f(){return(f=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e}).apply(this,arguments)}function m(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function g(e,t){return!t||"object"!==p(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function v(e){return(v=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function b(e,t){return(b=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function y(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var C=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),g(this,v(t).apply(this,arguments))}var n,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&b(e,t)}(t,h.a.PureComponent),n=t,(i=[{key:"render",value:function(){var e=this.props,t=e.children,n=e.title,i=function(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}(e,["children","title"]);return h.a.createElement("button",f({"aria-label":n,title:n,type:"button"},i),t)}}])&&m(n.prototype,i),t}();y(C,"propTypes",{children:c.a.node.isRequired,title:c.a.string}),y(C,"defaultProps",{title:null});var S=C;function x(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function w(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var k=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.props=t,this.flatNodes=n}var t,n;return t=e,(n=[{key:"setProps",value:function(e){this.props=e}},{key:"clone",value:function(){var t=this,n={};return Object.keys(this.flatNodes).forEach((function(e){var i=t.flatNodes[e];n[e]=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),i.forEach((function(t){x(e,t,n[t])}))}return e}({},i)})),new e(this.props,n)}},{key:"getNode",value:function(e){return this.flatNodes[e]}},{key:"flattenNodes",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(Array.isArray(e)&&0!==e.length){var r=this.props,o=r.disabled,a=r.noCascade;e.forEach((function(e,r){var s=t.nodeHasChildren(e);t.flatNodes[e.value]={label:e.label,value:e.value,children:e.children,parent:n,isParent:s,isLeaf:!s,showCheckbox:void 0===e.showCheckbox||e.showCheckbox,disabled:t.getDisabledState(e,n,o,a),treeDepth:i,index:r},t.flattenNodes(e.children,e,i+1)}))}}},{key:"nodeHasChildren",value:function(e){return Array.isArray(e.children)&&e.children.length>0}},{key:"getDisabledState",value:function(e,t,n,i){return!!n||!(i||!t.disabled)||Boolean(e.disabled)}},{key:"deserializeLists",value:function(e){var t=this,n=["checked","expanded"];Object.keys(this.flatNodes).forEach((function(e){n.forEach((function(n){t.flatNodes[e][n]=!1}))})),n.forEach((function(n){e[n].forEach((function(e){void 0!==t.flatNodes[e]&&(t.flatNodes[e][n]=!0)}))}))}},{key:"serializeList",value:function(e){var t=this,n=[];return Object.keys(this.flatNodes).forEach((function(i){t.flatNodes[i][e]&&n.push(i)})),n}},{key:"expandAllNodes",value:function(e){var t=this;return Object.keys(this.flatNodes).forEach((function(n){t.flatNodes[n].isParent&&(t.flatNodes[n].expanded=e)})),this}},{key:"toggleChecked",value:function(e,t,n){var i=this,r=this.flatNodes[e.value];if(r.isLeaf||n){if(e.disabled)return this;this.toggleNode(e.value,"checked",t)}else r.children.forEach((function(e){i.toggleChecked(e,t,n)}));return this}},{key:"toggleNode",value:function(e,t,n){return this.flatNodes[e][t]=n,this}}])&&w(t.prototype,n),e}();function R(e){return(R="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Z(){return(Z=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e}).apply(this,arguments)}function F(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function T(e,t){return!t||"object"!==R(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function D(e){return(D=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _(e,t){return(_=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function I(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var M=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),T(this,D(t).apply(this,arguments))}var n,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_(e,t)}(t,h.a.PureComponent),n=t,(i=[{key:"componentDidMount",value:function(){this.updateDeterminateProperty()}},{key:"componentDidUpdate",value:function(){this.updateDeterminateProperty()}},{key:"updateDeterminateProperty",value:function(){var e=this.props.indeterminate;this.checkbox.indeterminate=e}},{key:"render",value:function(){var e=this,t=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),i.forEach((function(t){I(e,t,n[t])}))}return e}({},this.props);return delete t.indeterminate,h.a.createElement("input",Z({},t,{ref:function(t){e.checkbox=t},type:"checkbox"}))}}])&&F(n.prototype,i),t}();I(M,"propTypes",{indeterminate:c.a.bool}),I(M,"defaultProps",{indeterminate:!1});var E=M,O=c.a.shape({check:c.a.node,uncheck:c.a.node,halfCheck:c.a.node,expandClose:c.a.node,expandOpen:c.a.node,expandAll:c.a.node,collapseAll:c.a.node,parentClose:c.a.node,parentOpen:c.a.node,leaf:c.a.node}),P=c.a.shape({collapseAll:c.a.string.isRequired,expandAll:c.a.string.isRequired,toggle:c.a.string.isRequired});function N(e){return(N="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function j(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function q(e){return(q=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function z(e,t){return(z=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function A(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function $(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var U=function(e){function t(e){var n,i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this,(n=!(i=q(t).call(this,e))||"object"!==N(i)&&"function"!=typeof i?A(this):i).onCheck=n.onCheck.bind(A(A(n))),n.onClick=n.onClick.bind(A(A(n))),n.onExpand=n.onExpand.bind(A(A(n))),n}var n,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&z(e,t)}(t,h.a.Component),n=t,(i=[{key:"onCheck",value:function(){var e=this.props,t=e.value;(0,e.onCheck)({value:t,checked:this.getCheckState({toggle:!0})})}},{key:"onClick",value:function(){var e=this.props,t=e.expandOnClick,n=e.isParent,i=e.value,r=e.onClick;n&&t&&this.onExpand(),r({value:i,checked:this.getCheckState({toggle:!1})})}},{key:"onExpand",value:function(){var e=this.props,t=e.expanded,n=e.value;(0,e.onExpand)({value:n,expanded:!t})}},{key:"getCheckState",value:function(e){var t=e.toggle,n=this.props,i=n.checked,r=n.optimisticToggle;return!(0!==i||!t)||1===i&&!t||2===i&&r}},{key:"renderCollapseButton",value:function(){var e=this.props,t=e.expandDisabled,n=e.isLeaf,i=e.lang;return n?h.a.createElement("span",{className:"rct-collapse"},h.a.createElement("span",{className:"rct-icon"})):h.a.createElement(S,{className:"rct-collapse rct-collapse-btn",disabled:t,title:i.toggle,onClick:this.onExpand},this.renderCollapseIcon())}},{key:"renderCollapseIcon",value:function(){var e=this.props,t=e.expanded,n=e.icons,i=n.expandClose,r=n.expandOpen;return t?r:i}},{key:"renderCheckboxIcon",value:function(){var e=this.props,t=e.checked,n=e.icons,i=n.uncheck,r=n.check,o=n.halfCheck;return 0===t?i:1===t?r:o}},{key:"renderNodeIcon",value:function(){var e=this.props,t=e.expanded,n=e.icon,i=e.icons,r=i.leaf,o=i.parentClose,a=i.parentOpen,s=e.isLeaf;return null!==n?n:s?r:t?a:o}},{key:"renderBareLabel",value:function(e){var t=this.props,n=t.onClick,i=t.title,r=null!==n;return h.a.createElement("span",{className:"rct-bare-label",title:i},r?h.a.createElement("span",{className:"rct-node-clickable",onClick:this.onClick,onKeyPress:this.onClick,role:"button",tabIndex:0},e):e)}},{key:"renderCheckboxLabel",value:function(e){var t=this.props,n=t.checked,i=t.disabled,r=t.title,o=t.treeId,a=t.value,s=null!==t.onClick,l="".concat(o,"-").concat(String(a).split(" ").join("_")),d=[h.a.createElement("label",{key:0,htmlFor:l,title:r},h.a.createElement(E,{checked:1===n,disabled:i,id:l,indeterminate:2===n,onClick:this.onCheck,onChange:function(){}}),h.a.createElement("span",{className:"rct-checkbox"},this.renderCheckboxIcon()),s?null:e)];return s&&d.push(h.a.createElement("span",{key:1,className:"rct-node-clickable",onClick:this.onClick,onKeyPress:this.onClick,role:"link",tabIndex:0},e)),d}},{key:"renderLabel",value:function(){var e=this.props,t=e.label,n=e.showCheckbox,i=[e.showNodeIcon?h.a.createElement("span",{key:0,className:"rct-node-icon"},this.renderNodeIcon()):null,h.a.createElement("span",{key:1,className:"rct-title"},t)];return n?this.renderCheckboxLabel(i):this.renderBareLabel(i)}},{key:"renderChildren",value:function(){return this.props.expanded?this.props.children:null}},{key:"render",value:function(){var e=this.props,t=e.className,n=e.disabled,i=e.expanded,o=e.isLeaf,a=r()({"rct-node":!0,"rct-node-leaf":o,"rct-node-parent":!o,"rct-node-expanded":!o&&i,"rct-node-collapsed":!o&&!i,"rct-disabled":n},t);return h.a.createElement("li",{className:a},h.a.createElement("span",{className:"rct-text"},this.renderCollapseButton(),this.renderLabel()),this.renderChildren())}}])&&j(n.prototype,i),t}();$(U,"propTypes",{checked:c.a.number.isRequired,disabled:c.a.bool.isRequired,expandDisabled:c.a.bool.isRequired,expanded:c.a.bool.isRequired,icons:O.isRequired,isLeaf:c.a.bool.isRequired,isParent:c.a.bool.isRequired,label:c.a.node.isRequired,lang:P.isRequired,optimisticToggle:c.a.bool.isRequired,showNodeIcon:c.a.bool.isRequired,treeId:c.a.string.isRequired,value:c.a.oneOfType([c.a.string,c.a.number]).isRequired,onCheck:c.a.func.isRequired,onExpand:c.a.func.isRequired,children:c.a.node,className:c.a.string,expandOnClick:c.a.bool,icon:c.a.node,showCheckbox:c.a.bool,title:c.a.string,onClick:c.a.func}),$(U,"defaultProps",{children:null,className:null,expandOnClick:!1,icon:null,showCheckbox:!0,title:null,onClick:function(){}});var L=U,V=c.a.oneOfType([c.a.arrayOf(c.a.string),c.a.arrayOf(c.a.number)]);function K(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var B={label:c.a.node.isRequired,value:c.a.oneOfType([c.a.string,c.a.number]).isRequired,disabled:c.a.bool,icon:c.a.node,showCheckbox:c.a.bool,title:c.a.string},W=c.a.oneOfType([c.a.shape(B),c.a.shape(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),i.forEach((function(t){K(e,t,n[t])}))}return e}({},B,{children:c.a.arrayOf(B).isRequired}))]);function H(e){return(H="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function G(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),i.forEach((function(t){ee(e,t,n[t])}))}return e}function J(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Q(e){return(Q=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Y(e,t){return(Y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function X(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ee(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var te=function(e){function t(e){var n,i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=!(i=Q(t).call(this,e))||"object"!==H(i)&&"function"!=typeof i?X(this):i;var r=new k(e);return r.flattenNodes(e.nodes),r.deserializeLists({checked:e.checked,expanded:e.expanded}),n.state={id:e.id||"rct-".concat(l()(7)),model:r,prevProps:e},n.onCheck=n.onCheck.bind(X(X(n))),n.onExpand=n.onExpand.bind(X(X(n))),n.onNodeClick=n.onNodeClick.bind(X(X(n))),n.onExpandAll=n.onExpandAll.bind(X(X(n))),n.onCollapseAll=n.onCollapseAll.bind(X(X(n))),n}var n,i,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Y(e,t)}(t,h.a.Component),n=t,o=[{key:"getDerivedStateFromProps",value:function(e,t){var n=t.model,i=t.prevProps,r=e.disabled,o=e.id,s=e.nodes,l=G({},t,{prevProps:e});return n.setProps(e),a()(i.nodes,s)&&i.disabled===r||n.flattenNodes(s),null!==o&&(l=G({},l,{id:o})),n.deserializeLists({checked:e.checked,expanded:e.expanded}),l}}],(i=[{key:"onCheck",value:function(e){var t=this.props,n=t.noCascade,i=t.onCheck,r=this.state.model.clone(),o=r.getNode(e.value);r.toggleChecked(e,e.checked,n),i(r.serializeList("checked"),G({},o,e))}},{key:"onExpand",value:function(e){var t=this.props.onExpand,n=this.state.model.clone(),i=n.getNode(e.value);n.toggleNode(e.value,"expanded",e.expanded),t(n.serializeList("expanded"),G({},i,e))}},{key:"onNodeClick",value:function(e){(0,this.props.onClick)(G({},this.state.model.getNode(e.value),e))}},{key:"onExpandAll",value:function(){this.expandAllNodes()}},{key:"onCollapseAll",value:function(){this.expandAllNodes(!1)}},{key:"expandAllNodes",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];(0,this.props.onExpand)(this.state.model.clone().expandAllNodes(e).serializeList("expanded"))}},{key:"determineShallowCheckState",value:function(e,t){var n=this.state.model.getNode(e.value);return n.isLeaf||t?n.checked?1:0:this.isEveryChildChecked(e)?1:this.isSomeChildChecked(e)?2:0}},{key:"isEveryChildChecked",value:function(e){var t=this;return e.children.every((function(e){return 1===t.state.model.getNode(e.value).checkState}))}},{key:"isSomeChildChecked",value:function(e){var t=this;return e.children.some((function(e){return t.state.model.getNode(e.value).checkState>0}))}},{key:"renderTreeNodes",value:function(e){var n=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=this.props,o=r.expandDisabled,a=r.expandOnClick,s=r.icons,l=r.lang,d=r.noCascade,c=r.onClick,u=r.onlyLeafCheckboxes,p=r.optimisticToggle,f=r.showNodeTitle,m=r.showNodeIcon,g=this.state,v=g.id,b=g.model,y=t.defaultProps.icons,C=e.map((function(e){var t=e.value,r=b.getNode(e.value),g=r.isParent?n.renderTreeNodes(e.children,e):null;r.checkState=n.determineShallowCheckState(e,d);var C=u?r.isLeaf:r.showCheckbox;return!i.value||b.getNode(i.value).expanded?h.a.createElement(L,{key:t,checked:r.checkState,className:e.className,disabled:r.disabled,expandDisabled:o,expandOnClick:a,expanded:r.expanded,icon:e.icon,icons:G({},y,s),label:e.label,lang:l,optimisticToggle:p,isLeaf:r.isLeaf,isParent:r.isParent,showCheckbox:C,showNodeIcon:m,title:f?e.title||e.label:e.title,treeId:v,value:e.value,onCheck:n.onCheck,onClick:c&&n.onNodeClick,onExpand:n.onExpand},g):null}));return h.a.createElement("ol",null,C)}},{key:"renderExpandAll",value:function(){var e=this.props,t=e.icons,n=t.expandAll,i=t.collapseAll,r=e.lang;return e.showExpandAll?h.a.createElement("div",{className:"rct-options"},h.a.createElement(S,{className:"rct-option rct-option-expand-all",title:r.expandAll,onClick:this.onExpandAll},n),h.a.createElement(S,{className:"rct-option rct-option-collapse-all",title:r.collapseAll,onClick:this.onCollapseAll},i)):null}},{key:"renderHiddenInput",value:function(){var e=this.props,t=e.name,n=e.nameAsArray;return void 0===t?null:n?this.renderArrayHiddenInput():this.renderJoinedHiddenInput()}},{key:"renderArrayHiddenInput",value:function(){var e=this.props,t=e.checked,n=e.name;return t.map((function(e){var t="".concat(n,"[]");return h.a.createElement("input",{key:e,name:t,type:"hidden",value:e})}))}},{key:"renderJoinedHiddenInput",value:function(){var e=this.props,t=e.checked,n=e.name,i=t.join(",");return h.a.createElement("input",{name:n,type:"hidden",value:i})}},{key:"render",value:function(){var e=this.props,t=e.disabled,n=e.nodes,i=e.nativeCheckboxes,o=this.renderTreeNodes(n),a=r()({"react-checkbox-tree":!0,"rct-disabled":t,"rct-native-display":i});return h.a.createElement("div",{className:a},this.renderExpandAll(),this.renderHiddenInput(),o)}}])&&J(n.prototype,i),o&&J(n,o),t}();ee(te,"propTypes",{nodes:c.a.arrayOf(W).isRequired,checked:V,disabled:c.a.bool,expandDisabled:c.a.bool,expandOnClick:c.a.bool,expanded:V,icons:O,id:c.a.string,lang:P,name:c.a.string,nameAsArray:c.a.bool,nativeCheckboxes:c.a.bool,noCascade:c.a.bool,onlyLeafCheckboxes:c.a.bool,optimisticToggle:c.a.bool,showExpandAll:c.a.bool,showNodeIcon:c.a.bool,showNodeTitle:c.a.bool,onCheck:c.a.func,onClick:c.a.func,onExpand:c.a.func}),ee(te,"defaultProps",{checked:[],disabled:!1,expandDisabled:!1,expandOnClick:!1,expanded:[],icons:{check:h.a.createElement("span",{className:"rct-icon rct-icon-check"}),uncheck:h.a.createElement("span",{className:"rct-icon rct-icon-uncheck"}),halfCheck:h.a.createElement("span",{className:"rct-icon rct-icon-half-check"}),expandClose:h.a.createElement("span",{className:"rct-icon rct-icon-expand-close"}),expandOpen:h.a.createElement("span",{className:"rct-icon rct-icon-expand-open"}),expandAll:h.a.createElement("span",{className:"rct-icon rct-icon-expand-all"}),collapseAll:h.a.createElement("span",{className:"rct-icon rct-icon-collapse-all"}),parentClose:h.a.createElement("span",{className:"rct-icon rct-icon-parent-close"}),parentOpen:h.a.createElement("span",{className:"rct-icon rct-icon-parent-open"}),leaf:h.a.createElement("span",{className:"rct-icon rct-icon-leaf"})},id:null,lang:{collapseAll:"Collapse all",expandAll:"Expand all",toggle:"Toggle"},name:void 0,nameAsArray:!1,nativeCheckboxes:!1,noCascade:!1,onlyLeafCheckboxes:!1,optimisticToggle:!0,showExpandAll:!1,showNodeIcon:!0,showNodeTitle:!1,onCheck:function(){},onClick:null,onExpand:function(){}}),t.default=te}]))},9238:(e,t,n)=>{"use strict";n.d(t,{DragLayer:()=>te,DragSource:()=>q,DropTarget:()=>K});var i=n(28195);function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function o(e){return"function"==typeof e}function a(){}function s(e){if(!function(e){return"object"===r(e)&&null!==e}(e))return!1;if(null===Object.getPrototypeOf(e))return!0;for(var t=e;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}function l(e){var t=e.current;return null==t?null:t.decoratedRef?t.decoratedRef.current:t}function d(e){return(t=e)&&t.prototype&&"function"==typeof t.prototype.render||function(e){var t;return"Symbol(react.forward_ref)"===(null==e||null===(t=e.$$typeof)||void 0===t?void 0:t.toString())}(e);var t}var c=n(67294),u=n(15047),h=n(8679),p=n.n(h),f=n(82514);function m(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function g(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function v(e,t,n){return t&&g(e.prototype,t),n&&g(e,n),e}var b=function(){var e=function(){function e(t){m(this,e),this.isDisposed=!1,this.action=o(t)?t:a}return v(e,[{key:"dispose",value:function(){this.isDisposed||(this.action(),this.isDisposed=!0)}}],[{key:"isDisposable",value:function(e){return Boolean(e&&o(e.dispose))}},{key:"_fixup",value:function(t){return e.isDisposable(t)?t:e.empty}},{key:"create",value:function(t){return new e(t)}}]),e}();return e.empty={dispose:a},e}(),y=function(){function e(){m(this,e),this.isDisposed=!1;for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];this.disposables=n}return v(e,[{key:"add",value:function(e){this.isDisposed?e.dispose():this.disposables.push(e)}},{key:"remove",value:function(e){var t=!1;if(!this.isDisposed){var n=this.disposables.indexOf(e);-1!==n&&(t=!0,this.disposables.splice(n,1),e.dispose())}return t}},{key:"clear",value:function(){if(!this.isDisposed){for(var e=this.disposables.length,t=new Array(e),n=0;n<e;n++)t[n]=this.disposables[n];this.disposables=[];for(var i=0;i<e;i++)t[i].dispose()}}},{key:"dispose",value:function(){if(!this.isDisposed){this.isDisposed=!0;for(var e=this.disposables.length,t=new Array(e),n=0;n<e;n++)t[n]=this.disposables[n];this.disposables=[];for(var i=0;i<e;i++)t[i].dispose()}}}]),e}(),C=function(){function e(){m(this,e),this.isDisposed=!1}return v(e,[{key:"getDisposable",value:function(){return this.current}},{key:"setDisposable",value:function(e){var t=this.isDisposed;if(!t){var n=this.current;this.current=e,n&&n.dispose()}t&&e&&e.dispose()}},{key:"dispose",value:function(){if(!this.isDisposed){this.isDisposed=!0;var e=this.current;this.current=void 0,e&&e.dispose()}}}]),e}();function S(e){return S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},S(e)}function x(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function w(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function k(e,t){return k=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},k(e,t)}function R(e,t){return!t||"object"!==S(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Z(e){return Z=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Z(e)}function F(e){var t=e.DecoratedComponent,n=e.createHandler,r=e.createMonitor,o=e.createConnector,a=e.registerHandler,s=e.containerDisplayName,l=e.getType,h=e.collect,m=e.options.arePropsEqual,g=void 0===m?u.w:m,v=t,S=t.displayName||t.name||"Component",F=function(){var e=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&k(e,t)}(T,e);var t,s,p,m,F=(p=T,m=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Z(p);if(m){var n=Z(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return R(this,e)});function T(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,T),(t=F.call(this,e)).decoratedRef=c.createRef(),t.handleChange=function(){var e=t.getCurrentState();(0,u.w)(e,t.state)||t.setState(e)},t.disposable=new C,t.receiveProps(e),t.dispose(),t}return t=T,(s=[{key:"getHandlerId",value:function(){return this.handlerId}},{key:"getDecoratedComponentInstance",value:function(){return(0,i.k)(this.decoratedRef.current,"In order to access an instance of the decorated component, it must either be a class component or use React.forwardRef()"),this.decoratedRef.current}},{key:"shouldComponentUpdate",value:function(e,t){return!g(e,this.props)||!(0,u.w)(t,this.state)}},{key:"componentDidMount",value:function(){this.disposable=new C,this.currentType=void 0,this.receiveProps(this.props),this.handleChange()}},{key:"componentDidUpdate",value:function(e){g(this.props,e)||(this.receiveProps(this.props),this.handleChange())}},{key:"componentWillUnmount",value:function(){this.dispose()}},{key:"receiveProps",value:function(e){this.handler&&(this.handler.receiveProps(e),this.receiveType(l(e)))}},{key:"receiveType",value:function(e){if(this.handlerMonitor&&this.manager&&this.handlerConnector&&e!==this.currentType){this.currentType=e;var t=(o=a(e,this.handler,this.manager),s=2,function(e){if(Array.isArray(e))return e}(o)||function(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var n=[],i=!0,r=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(i=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);i=!0);}catch(e){r=!0,o=e}finally{try{i||null==s.return||s.return()}finally{if(r)throw o}}return n}}(o,s)||function(e,t){if(e){if("string"==typeof e)return x(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?x(e,t):void 0}}(o,s)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),n=t[0],i=t[1];this.handlerId=n,this.handlerMonitor.receiveHandlerId(n),this.handlerConnector.receiveHandlerId(n);var r=this.manager.getMonitor().subscribeToStateChange(this.handleChange,{handlerIds:[n]});this.disposable.setDisposable(new y(new b(r),new b(i)))}var o,s}},{key:"dispose",value:function(){this.disposable.dispose(),this.handlerConnector&&this.handlerConnector.receiveHandlerId(null)}},{key:"getCurrentState",value:function(){return this.handlerConnector?h(this.handlerConnector.hooks,this.handlerMonitor,this.props):{}}},{key:"render",value:function(){var e=this;return c.createElement(f.L.Consumer,null,(function(t){var n=t.dragDropManager;return e.receiveDragDropManager(n),"undefined"!=typeof requestAnimationFrame&&requestAnimationFrame((function(){var t;return null===(t=e.handlerConnector)||void 0===t?void 0:t.reconnect()})),c.createElement(v,Object.assign({},e.props,e.getCurrentState(),{ref:d(v)?e.decoratedRef:null}))}))}},{key:"receiveDragDropManager",value:function(e){void 0===this.manager&&((0,i.k)(void 0!==e,"Could not find the drag and drop manager in the context of %s. Make sure to render a DndProvider component in your top-level component. Read more: http://react-dnd.github.io/react-dnd/docs/troubleshooting#could-not-find-the-drag-and-drop-manager-in-the-context",S,S),void 0!==e&&(this.manager=e,this.handlerMonitor=r(e),this.handlerConnector=o(e.getBackend()),this.handler=n(this.handlerMonitor,this.decoratedRef)))}}])&&w(t.prototype,s),T}(c.Component);return e.DecoratedComponent=t,e.displayName="".concat(s,"(").concat(S,")"),e}();return p()(F,t)}var T=n(33273),D=n(60938),_=n(8556);function I(e){return I="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},I(e)}function M(e,t){return"string"==typeof e||"symbol"===I(e)||!!t&&Array.isArray(e)&&e.every((function(e){return M(e,!1)}))}function E(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var O=["canDrag","beginDrag","isDragging","endDrag"],P=["beginDrag"],N=function(){function e(t,n,i){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.props=null,this.beginDrag=function(){if(r.props)return r.spec.beginDrag(r.props,r.monitor,r.ref.current)},this.spec=t,this.monitor=n,this.ref=i}var t,n;return t=e,(n=[{key:"receiveProps",value:function(e){this.props=e}},{key:"canDrag",value:function(){return!!this.props&&(!this.spec.canDrag||this.spec.canDrag(this.props,this.monitor))}},{key:"isDragging",value:function(e,t){return!!this.props&&(this.spec.isDragging?this.spec.isDragging(this.props,this.monitor):t===e.getSourceId())}},{key:"endDrag",value:function(){this.props&&this.spec.endDrag&&this.spec.endDrag(this.props,this.monitor,l(this.ref))}}])&&E(t.prototype,n),e}();function j(e){return Object.keys(e).forEach((function(t){(0,i.k)(O.indexOf(t)>-1,'Expected the drag source specification to only have some of the following keys: %s. Instead received a specification with an unexpected "%s" key. Read more: http://react-dnd.github.io/react-dnd/docs/api/drag-source',O.join(", "),t),(0,i.k)("function"==typeof e[t],"Expected %s in the drag source specification to be a function. Instead received a specification with %s: %s. Read more: http://react-dnd.github.io/react-dnd/docs/api/drag-source",t,t,e[t])})),P.forEach((function(t){(0,i.k)("function"==typeof e[t],"Expected %s in the drag source specification to be a function. Instead received a specification with %s: %s. Read more: http://react-dnd.github.io/react-dnd/docs/api/drag-source",t,t,e[t])})),function(t,n){return new N(e,t,n)}}function q(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=e;"function"!=typeof e&&((0,i.k)(M(e),'Expected "type" provided as the first argument to DragSource to be a string, or a function that returns a string given the current props. Instead, received %s. Read more: http://react-dnd.github.io/react-dnd/docs/api/drag-source',e),o=function(){return e}),(0,i.k)(s(t),'Expected "spec" provided as the second argument to DragSource to be a plain object. Instead, received %s. Read more: http://react-dnd.github.io/react-dnd/docs/api/drag-source',t);var a=j(t);return(0,i.k)("function"==typeof n,'Expected "collect" provided as the third argument to DragSource to be a function that returns a plain object of props to inject. Instead, received %s. Read more: http://react-dnd.github.io/react-dnd/docs/api/drag-source',n),(0,i.k)(s(r),'Expected "options" provided as the fourth argument to DragSource to be a plain object when specified. Instead, received %s. Read more: http://react-dnd.github.io/react-dnd/docs/api/drag-source',n),function(e){return F({containerDisplayName:"DragSource",createHandler:a,registerHandler:T.w,createConnector:function(e){return new _.x(e)},createMonitor:function(e){return new D.p(e)},DecoratedComponent:e,getType:o,collect:n,options:r})}}var z=n(89026),A=n(56941);function $(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var U=["canDrop","hover","drop"],L=function(){function e(t,n,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.props=null,this.spec=t,this.monitor=n,this.ref=i}var t,n;return t=e,(n=[{key:"receiveProps",value:function(e){this.props=e}},{key:"receiveMonitor",value:function(e){this.monitor=e}},{key:"canDrop",value:function(){return!this.spec.canDrop||this.spec.canDrop(this.props,this.monitor)}},{key:"hover",value:function(){this.spec.hover&&this.props&&this.spec.hover(this.props,this.monitor,l(this.ref))}},{key:"drop",value:function(){if(this.spec.drop)return this.spec.drop(this.props,this.monitor,this.ref.current)}}])&&$(t.prototype,n),e}();function V(e){return Object.keys(e).forEach((function(t){(0,i.k)(U.indexOf(t)>-1,'Expected the drop target specification to only have some of the following keys: %s. Instead received a specification with an unexpected "%s" key. Read more: http://react-dnd.github.io/react-dnd/docs/api/drop-target',U.join(", "),t),(0,i.k)("function"==typeof e[t],"Expected %s in the drop target specification to be a function. Instead received a specification with %s: %s. Read more: http://react-dnd.github.io/react-dnd/docs/api/drop-target",t,t,e[t])})),function(t,n){return new L(e,t,n)}}function K(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=e;"function"!=typeof e&&((0,i.k)(M(e,!0),'Expected "type" provided as the first argument to DropTarget to be a string, an array of strings, or a function that returns either given the current props. Instead, received %s. Read more: http://react-dnd.github.io/react-dnd/docs/api/drop-target',e),o=function(){return e}),(0,i.k)(s(t),'Expected "spec" provided as the second argument to DropTarget to be a plain object. Instead, received %s. Read more: http://react-dnd.github.io/react-dnd/docs/api/drop-target',t);var a=V(t);return(0,i.k)("function"==typeof n,'Expected "collect" provided as the third argument to DropTarget to be a function that returns a plain object of props to inject. Instead, received %s. Read more: http://react-dnd.github.io/react-dnd/docs/api/drop-target',n),(0,i.k)(s(r),'Expected "options" provided as the fourth argument to DropTarget to be a plain object when specified. Instead, received %s. Read more: http://react-dnd.github.io/react-dnd/docs/api/drop-target',n),function(e){return F({containerDisplayName:"DropTarget",createHandler:a,registerHandler:T.n,createMonitor:function(e){return new A.H(e)},createConnector:function(e){return new z.Y(e)},DecoratedComponent:e,getType:o,collect:n,options:r})}}function B(e){return B="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},B(e)}function W(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function H(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function G(e,t,n){return t&&H(e.prototype,t),n&&H(e,n),e}function J(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Q(e,t)}function Q(e,t){return Q=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Q(e,t)}function Y(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=ee(e);if(t){var r=ee(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return X(this,n)}}function X(e,t){return!t||"object"!==B(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ee(e){return ee=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},ee(e)}function te(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,i.k)("function"==typeof e,'Expected "collect" provided as the first argument to DragLayer to be a function that collects props to inject into the component. ',"Instead, received %s. Read more: http://react-dnd.github.io/react-dnd/docs/api/drag-layer",e),(0,i.k)(s(t),'Expected "options" provided as the second argument to DragLayer to be a plain object when specified. Instead, received %s. Read more: http://react-dnd.github.io/react-dnd/docs/api/drag-layer',t),function(n){var r=n,o=t.arePropsEqual,a=void 0===o?u.w:o,s=r.displayName||r.name||"Component",l=function(){var t=function(t){J(o,t);var n=Y(o);function o(){var e;return W(this,o),(e=n.apply(this,arguments)).isCurrentlyMounted=!1,e.ref=c.createRef(),e.handleChange=function(){if(e.isCurrentlyMounted){var t=e.getCurrentState();(0,u.w)(t,e.state)||e.setState(t)}},e}return G(o,[{key:"getDecoratedComponentInstance",value:function(){return(0,i.k)(this.ref.current,"In order to access an instance of the decorated component, it must either be a class component or use React.forwardRef()"),this.ref.current}},{key:"shouldComponentUpdate",value:function(e,t){return!a(e,this.props)||!(0,u.w)(t,this.state)}},{key:"componentDidMount",value:function(){this.isCurrentlyMounted=!0,this.handleChange()}},{key:"componentWillUnmount",value:function(){this.isCurrentlyMounted=!1,this.unsubscribeFromOffsetChange&&(this.unsubscribeFromOffsetChange(),this.unsubscribeFromOffsetChange=void 0),this.unsubscribeFromStateChange&&(this.unsubscribeFromStateChange(),this.unsubscribeFromStateChange=void 0)}},{key:"render",value:function(){var e=this;return c.createElement(f.L.Consumer,null,(function(t){var n=t.dragDropManager;return void 0===n?null:(e.receiveDragDropManager(n),e.isCurrentlyMounted?c.createElement(r,Object.assign({},e.props,e.state,{ref:d(r)?e.ref:null})):null)}))}},{key:"receiveDragDropManager",value:function(e){if(void 0===this.manager){this.manager=e,(0,i.k)("object"===B(e),"Could not find the drag and drop manager in the context of %s. Make sure to render a DndProvider component in your top-level component. Read more: http://react-dnd.github.io/react-dnd/docs/troubleshooting#could-not-find-the-drag-and-drop-manager-in-the-context",s,s);var t=this.manager.getMonitor();this.unsubscribeFromOffsetChange=t.subscribeToOffsetChange(this.handleChange),this.unsubscribeFromStateChange=t.subscribeToStateChange(this.handleChange)}}},{key:"getCurrentState",value:function(){if(!this.manager)return{};var t=this.manager.getMonitor();return e(t,this.props)}}]),o}(c.Component);return t.displayName="DragLayer(".concat(s,")"),t.DecoratedComponent=n,t}();return p()(l,n)}}},84785:(e,t,n)=>{"use strict";n.d(t,{DragLayer:()=>r.DragLayer,DragSource:()=>r.DragSource,DropTarget:()=>r.DropTarget});var i=n(31388);n.o(i,"DragLayer")&&n.d(t,{DragLayer:function(){return i.DragLayer}}),n.o(i,"DragSource")&&n.d(t,{DragSource:function(){return i.DragSource}}),n.o(i,"DropTarget")&&n.d(t,{DropTarget:function(){return i.DropTarget}});var r=n(9238)},73897:()=>{},48058:()=>{},31388:(e,t,n)=>{"use strict";var i=n(75253);n.o(i,"DragLayer")&&n.d(t,{DragLayer:function(){return i.DragLayer}}),n.o(i,"DragSource")&&n.d(t,{DragSource:function(){return i.DragSource}}),n.o(i,"DropTarget")&&n.d(t,{DropTarget:function(){return i.DropTarget}});var r=n(48058);n.o(r,"DragLayer")&&n.d(t,{DragLayer:function(){return r.DragLayer}}),n.o(r,"DragSource")&&n.d(t,{DragSource:function(){return r.DragSource}}),n.o(r,"DropTarget")&&n.d(t,{DropTarget:function(){return r.DropTarget}});var o=n(72105);n.o(o,"DragLayer")&&n.d(t,{DragLayer:function(){return o.DragLayer}}),n.o(o,"DragSource")&&n.d(t,{DragSource:function(){return o.DragSource}}),n.o(o,"DropTarget")&&n.d(t,{DropTarget:function(){return o.DropTarget}});var a=n(73897);n.o(a,"DragLayer")&&n.d(t,{DragLayer:function(){return a.DragLayer}}),n.o(a,"DragSource")&&n.d(t,{DragSource:function(){return a.DragSource}}),n.o(a,"DropTarget")&&n.d(t,{DropTarget:function(){return a.DropTarget}})},75253:()=>{},72105:()=>{},46871:(e,t,n)=>{"use strict";function i(){var e=this.constructor.getDerivedStateFromProps(this.props,this.state);null!=e&&this.setState(e)}function r(e){this.setState(function(t){var n=this.constructor.getDerivedStateFromProps(e,t);return null!=n?n:null}.bind(this))}function o(e,t){try{var n=this.props,i=this.state;this.props=e,this.state=t,this.__reactInternalSnapshotFlag=!0,this.__reactInternalSnapshot=this.getSnapshotBeforeUpdate(n,i)}finally{this.props=n,this.state=i}}function a(e){var t=e.prototype;if(!t||!t.isReactComponent)throw new Error("Can only polyfill class components");if("function"!=typeof e.getDerivedStateFromProps&&"function"!=typeof t.getSnapshotBeforeUpdate)return e;var n=null,a=null,s=null;if("function"==typeof t.componentWillMount?n="componentWillMount":"function"==typeof t.UNSAFE_componentWillMount&&(n="UNSAFE_componentWillMount"),"function"==typeof t.componentWillReceiveProps?a="componentWillReceiveProps":"function"==typeof t.UNSAFE_componentWillReceiveProps&&(a="UNSAFE_componentWillReceiveProps"),"function"==typeof t.componentWillUpdate?s="componentWillUpdate":"function"==typeof t.UNSAFE_componentWillUpdate&&(s="UNSAFE_componentWillUpdate"),null!==n||null!==a||null!==s){var l=e.displayName||e.name,d="function"==typeof e.getDerivedStateFromProps?"getDerivedStateFromProps()":"getSnapshotBeforeUpdate()";throw Error("Unsafe legacy lifecycles will not be called for components using new component APIs.\n\n"+l+" uses "+d+" but also contains the following legacy lifecycles:"+(null!==n?"\n  "+n:"")+(null!==a?"\n  "+a:"")+(null!==s?"\n  "+s:"")+"\n\nThe above lifecycles should be removed. Learn more about this warning here:\nhttps://fb.me/react-async-component-lifecycle-hooks")}if("function"==typeof e.getDerivedStateFromProps&&(t.componentWillMount=i,t.componentWillReceiveProps=r),"function"==typeof t.getSnapshotBeforeUpdate){if("function"!=typeof t.componentDidUpdate)throw new Error("Cannot polyfill getSnapshotBeforeUpdate() for components that do not define componentDidUpdate() on the prototype");t.componentWillUpdate=o;var c=t.componentDidUpdate;t.componentDidUpdate=function(e,t,n){var i=this.__reactInternalSnapshotFlag?this.__reactInternalSnapshot:n;c.call(this,e,t,i)}}return e}n.r(t),n.d(t,{polyfill:()=>a}),i.__suppressDeprecationWarning=!0,r.__suppressDeprecationWarning=!0,o.__suppressDeprecationWarning=!0},24903:(e,t,n)=>{"use strict";t.cj=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=n(67294),o=l(r),a=l(n(45697)),s=n(76597);function l(e){return e&&e.__esModule?e:{default:e}}var d=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={searchTerm:n.props.value||""},n.updateSearch=n.updateSearch.bind(n),n.filter=n.filter.bind(n),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),i(t,[{key:"componentWillReceiveProps",value:function(e){if(void 0!==e.value&&e.value!==this.props.value){var t={target:{value:e.value}};this.updateSearch(t)}}},{key:"render",value:function(){var e=this.props,t=e.className,n=(e.onChange,e.caseSensitive,e.sortResults,e.throttle,e.filterKeys,e.value,e.fuzzy,e.inputClassName),i=function(e,t){var n={};for(var i in e)t.indexOf(i)>=0||Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i]);return n}(e,["className","onChange","caseSensitive","sortResults","throttle","filterKeys","value","fuzzy","inputClassName"]);return i.type=i.type||"search",i.value=this.state.searchTerm,i.onChange=this.updateSearch,i.className=n,i.placeholder=i.placeholder||"Search",o.default.createElement("div",{className:t},o.default.createElement("input",i))}},{key:"updateSearch",value:function(e){var t=this,n=e.target.value;this.setState({searchTerm:n},(function(){t._throttleTimeout&&clearTimeout(t._throttleTimeout),t._throttleTimeout=setTimeout((function(){return t.props.onChange(n)}),t.props.throttle)}))}},{key:"filter",value:function(e){var t=this.props,n=t.filterKeys,i=t.caseSensitive,r=t.fuzzy,o=t.sortResults;return(0,s.createFilter)(this.state.searchTerm,e||n,{caseSensitive:i,fuzzy:r,sortResults:o})}}]),t}(r.Component);d.defaultProps={className:"",onChange:function(){},caseSensitive:!1,fuzzy:!1,throttle:200},d.propTypes={className:a.default.string,inputClassName:a.default.string,onChange:a.default.func,caseSensitive:a.default.bool,sortResults:a.default.bool,fuzzy:a.default.bool,throttle:a.default.number,filterKeys:a.default.oneOf([a.default.string,a.default.arrayOf(a.default.string)]),value:a.default.string},t.cj=s.createFilter},76597:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getValuesForKey=a,t.searchStrings=s,t.createFilter=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return function(i){if(""===e)return!0;n.caseSensitive||(e=e.toLowerCase());var r=e.split(" ");return t?("string"==typeof t&&(t=[t]),r.every((function(e){var r=void 0;if(-1!==e.indexOf(":")){var o=e.split(":")[0];e=e.split(":")[1],r=t.filter((function(e){return e.toLowerCase().indexOf(o)>-1}))}else r=t;return r.some((function(t){return s(a(t,i),e,n)}))}))):r.every((function(e){return s([i],e,n)}))}};var i,r=(i=n(69021))&&i.__esModule?i:{default:i};function o(e){return e.reduce((function(e,t){return e.concat(Array.isArray(t)?o(t):t)}),[])}function a(e,t){var n=e.split("."),i=[t];return n.forEach((function(e){var t=[];i.forEach((function(n){if(n)if(n instanceof Array){var i=parseInt(e,10);if(!isNaN(i))return t.push(n[i]);n.forEach((function(n){t.push(n[e])}))}else n&&"function"==typeof n.get?t.push(n.get(e)):t.push(n[e])})),i=t})),(i=o(i=i.map((function(e){return e&&e.push&&e.toArray?e.toArray():e})))).filter((function(e){return"string"==typeof e||"number"==typeof e}))}function s(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=n.caseSensitive,o=n.fuzzy,a=n.sortResults,s=n.exactMatch;e=e.map((function(e){return e.toString()}));try{if(o){"function"==typeof e.toJS&&(e=e.toJS());var l=new r.default(e.map((function(e){return{id:e}})),{keys:["id"],id:"id",caseSensitive:i,shouldSort:a});return l.search(t).length}return e.some((function(e){try{return i||(e=e.toLowerCase()),s&&(t=new RegExp("^"+t+"$","i")),!(!e||-1===e.search(t))}catch(e){return!1}}))}catch(e){return!1}}},69021:function(e){e.exports=function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var o=n(1),a=n(7),s=a.get,l=(a.deepValue,a.isArray),d=function(){function e(t,n){var i=n.location,r=void 0===i?0:i,o=n.distance,a=void 0===o?100:o,l=n.threshold,d=void 0===l?.6:l,c=n.maxPatternLength,u=void 0===c?32:c,h=n.caseSensitive,p=void 0!==h&&h,f=n.tokenSeparator,m=void 0===f?/ +/g:f,g=n.findAllMatches,v=void 0!==g&&g,b=n.minMatchCharLength,y=void 0===b?1:b,C=n.id,S=void 0===C?null:C,x=n.keys,w=void 0===x?[]:x,k=n.shouldSort,R=void 0===k||k,Z=n.getFn,F=void 0===Z?s:Z,T=n.sortFn,D=void 0===T?function(e,t){return e.score-t.score}:T,_=n.tokenize,I=void 0!==_&&_,M=n.matchAllTokens,E=void 0!==M&&M,O=n.includeMatches,P=void 0!==O&&O,N=n.includeScore,j=void 0!==N&&N,q=n.verbose,z=void 0!==q&&q;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.options={location:r,distance:a,threshold:d,maxPatternLength:u,isCaseSensitive:p,tokenSeparator:m,findAllMatches:v,minMatchCharLength:y,id:S,keys:w,includeMatches:P,includeScore:j,shouldSort:R,getFn:F,sortFn:D,verbose:z,tokenize:I,matchAllTokens:E},this.setCollection(t),this._processKeys(w)}var t,n;return t=e,(n=[{key:"setCollection",value:function(e){return this.list=e,e}},{key:"_processKeys",value:function(e){if(this._keyWeights={},this._keyNames=[],e.length&&"string"==typeof e[0])for(var t=0,n=e.length;t<n;t+=1){var i=e[t];this._keyWeights[i]=1,this._keyNames.push(i)}else{for(var r=null,o=null,a=0,s=0,l=e.length;s<l;s+=1){var d=e[s];if(!d.hasOwnProperty("name"))throw new Error('Missing "name" property in key object');var c=d.name;if(this._keyNames.push(c),!d.hasOwnProperty("weight"))throw new Error('Missing "weight" property in key object');var u=d.weight;if(u<0||u>1)throw new Error('"weight" property in key must bein the range of [0, 1)');o=null==o?u:Math.max(o,u),r=null==r?u:Math.min(r,u),this._keyWeights[c]=u,a+=u}if(a>1)throw new Error("Total of weights cannot exceed 1")}}},{key:"search",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{limit:!1};this._log('---------\nSearch pattern: "'.concat(e,'"'));var n=this._prepareSearchers(e),i=n.tokenSearchers,r=n.fullSearcher,o=this._search(i,r);return this._computeScore(o),this.options.shouldSort&&this._sort(o),t.limit&&"number"==typeof t.limit&&(o=o.slice(0,t.limit)),this._format(o)}},{key:"_prepareSearchers",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=[];if(this.options.tokenize)for(var n=e.split(this.options.tokenSeparator),i=0,r=n.length;i<r;i+=1)t.push(new o(n[i],this.options));return{tokenSearchers:t,fullSearcher:new o(e,this.options)}}},{key:"_search",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0,n=this.list,i={},r=[];if("string"==typeof n[0]){for(var o=0,a=n.length;o<a;o+=1)this._analyze({key:"",value:n[o],record:o,index:o},{resultMap:i,results:r,tokenSearchers:e,fullSearcher:t});return r}for(var s=0,l=n.length;s<l;s+=1)for(var d=n[s],c=0,u=this._keyNames.length;c<u;c+=1){var h=this._keyNames[c];this._analyze({key:h,value:this.options.getFn(d,h),record:d,index:s},{resultMap:i,results:r,tokenSearchers:e,fullSearcher:t})}return r}},{key:"_analyze",value:function(e,t){var n=this,i=e.key,r=e.arrayIndex,o=void 0===r?-1:r,a=e.value,s=e.record,d=e.index,c=t.tokenSearchers,u=void 0===c?[]:c,h=t.fullSearcher,p=t.resultMap,f=void 0===p?{}:p,m=t.results,g=void 0===m?[]:m;!function e(t,r,o,a){if(null!=r)if("string"==typeof r){var s=!1,d=-1,c=0;n._log("\nKey: ".concat(""===i?"--":i));var p=h.search(r);if(n._log('Full text: "'.concat(r,'", score: ').concat(p.score)),n.options.tokenize){for(var m=r.split(n.options.tokenSeparator),v=m.length,b=[],y=0,C=u.length;y<C;y+=1){var S=u[y];n._log('\nPattern: "'.concat(S.pattern,'"'));for(var x=!1,w=0;w<v;w+=1){var k=m[w],R=S.search(k),Z={};R.isMatch?(Z[k]=R.score,s=!0,x=!0,b.push(R.score)):(Z[k]=1,n.options.matchAllTokens||b.push(1)),n._log('Token: "'.concat(k,'", score: ').concat(Z[k]))}x&&(c+=1)}d=b[0];for(var F=b.length,T=1;T<F;T+=1)d+=b[T];d/=F,n._log("Token score average:",d)}var D=p.score;d>-1&&(D=(D+d)/2),n._log("Score average:",D);var _=!n.options.tokenize||!n.options.matchAllTokens||c>=u.length;if(n._log("\nCheck Matches: ".concat(_)),(s||p.isMatch)&&_){var I={key:i,arrayIndex:t,value:r,score:D};n.options.includeMatches&&(I.matchedIndices=p.matchedIndices);var M=f[a];M?M.output.push(I):(f[a]={item:o,output:[I]},g.push(f[a]))}}else if(l(r))for(var E=0,O=r.length;E<O;E+=1)e(E,r[E],o,a)}(o,a,s,d)}},{key:"_computeScore",value:function(e){this._log("\n\nComputing score:\n");for(var t=this._keyWeights,n=!!Object.keys(t).length,i=0,r=e.length;i<r;i+=1){for(var o=e[i],a=o.output,s=a.length,l=1,d=0;d<s;d+=1){var c=a[d],u=c.key,h=n?t[u]:1,p=0===c.score&&t&&t[u]>0?Number.EPSILON:c.score;l*=Math.pow(p,h)}o.score=l,this._log(o)}}},{key:"_sort",value:function(e){this._log("\n\nSorting...."),e.sort(this.options.sortFn)}},{key:"_format",value:function(e){var t=[];if(this.options.verbose){var n=[];this._log("\n\nOutput:\n\n",JSON.stringify(e,(function(e,t){if("object"===i(t)&&null!==t){if(-1!==n.indexOf(t))return;n.push(t)}return t}),2)),n=null}var r=[];this.options.includeMatches&&r.push((function(e,t){var n=e.output;t.matches=[];for(var i=0,r=n.length;i<r;i+=1){var o=n[i];if(0!==o.matchedIndices.length){var a={indices:o.matchedIndices,value:o.value};o.key&&(a.key=o.key),o.hasOwnProperty("arrayIndex")&&o.arrayIndex>-1&&(a.arrayIndex=o.arrayIndex),t.matches.push(a)}}})),this.options.includeScore&&r.push((function(e,t){t.score=e.score}));for(var o=0,a=e.length;o<a;o+=1){var s=e[o];if(this.options.id&&(s.item=this.options.getFn(s.item,this.options.id)[0]),r.length){for(var l={item:s.item},d=0,c=r.length;d<c;d+=1)r[d](s,l);t.push(l)}else t.push(s.item)}return t}},{key:"_log",value:function(){var e;this.options.verbose&&(e=console).log.apply(e,arguments)}}])&&r(t.prototype,n),e}();e.exports=d},function(e,t,n){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var r=n(2),o=n(3),a=n(6),s=function(){function e(t,n){var i=n.location,r=void 0===i?0:i,o=n.distance,s=void 0===o?100:o,l=n.threshold,d=void 0===l?.6:l,c=n.maxPatternLength,u=void 0===c?32:c,h=n.isCaseSensitive,p=void 0!==h&&h,f=n.tokenSeparator,m=void 0===f?/ +/g:f,g=n.findAllMatches,v=void 0!==g&&g,b=n.minMatchCharLength,y=void 0===b?1:b,C=n.includeMatches,S=void 0!==C&&C;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.options={location:r,distance:s,threshold:d,maxPatternLength:u,isCaseSensitive:p,tokenSeparator:m,findAllMatches:v,includeMatches:S,minMatchCharLength:y},this.pattern=p?t:t.toLowerCase(),this.pattern.length<=u&&(this.patternAlphabet=a(this.pattern))}var t,n;return t=e,(n=[{key:"search",value:function(e){var t=this.options,n=t.isCaseSensitive,i=t.includeMatches;if(n||(e=e.toLowerCase()),this.pattern===e){var a={isMatch:!0,score:0};return i&&(a.matchedIndices=[[0,e.length-1]]),a}var s=this.options,l=s.maxPatternLength,d=s.tokenSeparator;if(this.pattern.length>l)return r(e,this.pattern,d);var c=this.options,u=c.location,h=c.distance,p=c.threshold,f=c.findAllMatches,m=c.minMatchCharLength;return o(e,this.pattern,this.patternAlphabet,{location:u,distance:h,threshold:p,findAllMatches:f,minMatchCharLength:m,includeMatches:i})}}])&&i(t.prototype,n),e}();e.exports=s},function(e,t){var n=/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g;e.exports=function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:/ +/g,r=new RegExp(t.replace(n,"\\$&").replace(i,"|")),o=e.match(r),a=!!o,s=[];if(a)for(var l=0,d=o.length;l<d;l+=1){var c=o[l];s.push([e.indexOf(c),c.length-1])}return{score:a?.5:1,isMatch:a,matchedIndices:s}}},function(e,t,n){var i=n(4),r=n(5);e.exports=function(e,t,n,o){for(var a=o.location,s=void 0===a?0:a,l=o.distance,d=void 0===l?100:l,c=o.threshold,u=void 0===c?.6:c,h=o.findAllMatches,p=void 0!==h&&h,f=o.minMatchCharLength,m=void 0===f?1:f,g=o.includeMatches,v=void 0!==g&&g,b=s,y=e.length,C=u,S=e.indexOf(t,b),x=t.length,w=[],k=0;k<y;k+=1)w[k]=0;if(-1!==S){var R=i(t,{errors:0,currentLocation:S,expectedLocation:b,distance:d});if(C=Math.min(R,C),-1!==(S=e.lastIndexOf(t,b+x))){var Z=i(t,{errors:0,currentLocation:S,expectedLocation:b,distance:d});C=Math.min(Z,C)}}S=-1;for(var F=[],T=1,D=x+y,_=1<<(x<=31?x-1:30),I=0;I<x;I+=1){for(var M=0,E=D;M<E;)i(t,{errors:I,currentLocation:b+E,expectedLocation:b,distance:d})<=C?M=E:D=E,E=Math.floor((D-M)/2+M);D=E;var O=Math.max(1,b-E+1),P=p?y:Math.min(b+E,y)+x,N=Array(P+2);N[P+1]=(1<<I)-1;for(var j=P;j>=O;j-=1){var q=j-1,z=n[e.charAt(q)];if(z&&(w[q]=1),N[j]=(N[j+1]<<1|1)&z,0!==I&&(N[j]|=(F[j+1]|F[j])<<1|1|F[j+1]),N[j]&_&&(T=i(t,{errors:I,currentLocation:q,expectedLocation:b,distance:d}))<=C){if(C=T,(S=q)<=b)break;O=Math.max(1,2*b-S)}}if(i(t,{errors:I+1,currentLocation:b,expectedLocation:b,distance:d})>C)break;F=N}var A={isMatch:S>=0,score:0===T?.001:T};return v&&(A.matchedIndices=r(w,m)),A}},function(e,t){e.exports=function(e,t){var n=t.errors,i=void 0===n?0:n,r=t.currentLocation,o=void 0===r?0:r,a=t.expectedLocation,s=void 0===a?0:a,l=t.distance,d=void 0===l?100:l,c=i/e.length,u=Math.abs(s-o);return d?c+u/d:u?1:c}},function(e,t){e.exports=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=[],i=-1,r=-1,o=0,a=e.length;o<a;o+=1){var s=e[o];s&&-1===i?i=o:s||-1===i||((r=o-1)-i+1>=t&&n.push([i,r]),i=-1)}return e[o-1]&&o-i>=t&&n.push([i,o-1]),n}},function(e,t){e.exports=function(e){for(var t={},n=e.length,i=0;i<n;i+=1)t[e.charAt(i)]=0;for(var r=0;r<n;r+=1)t[e.charAt(r)]|=1<<n-r-1;return t}},function(e,t){var n=function(e){return Array.isArray?Array.isArray(e):"[object Array]"===Object.prototype.toString.call(e)},i=function(e){return null==e?"":function(e){if("string"==typeof e)return e;var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}(e)},r=function(e){return"string"==typeof e},o=function(e){return"number"==typeof e};e.exports={get:function(e,t){var a=[];return function e(t,s){if(s){var l=s.indexOf("."),d=s,c=null;-1!==l&&(d=s.slice(0,l),c=s.slice(l+1));var u=t[d];if(null!=u)if(c||!r(u)&&!o(u))if(n(u))for(var h=0,p=u.length;h<p;h+=1)e(u[h],c);else c&&e(u,c);else a.push(i(u))}else a.push(t)}(e,t),a},isArray:n,isString:r,isNum:o,toString:i}}])},18474:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=n(67294),a=d(o),s=d(n(45697)),l=d(n(54087));function d(e){return e&&e.__esModule?e:{default:e}}function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var h=function(e){function t(){var e,n,i;c(this,t);for(var r=arguments.length,o=Array(r),a=0;a<r;a++)o[a]=arguments[a];return n=i=u(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(o))),i.events=["resize","scroll","touchstart","touchmove","touchend","pageshow","load"],i.subscribers=[],i.rafHandle=null,i.subscribe=function(e){i.subscribers=i.subscribers.concat(e)},i.unsubscribe=function(e){i.subscribers=i.subscribers.filter((function(t){return t!==e}))},i.notifySubscribers=function(e){if(!i.framePending){var t=e.currentTarget;i.rafHandle=(0,l.default)((function(){i.framePending=!1;var e=i.node.getBoundingClientRect(),n=e.top,r=e.bottom;i.subscribers.forEach((function(e){return e({distanceFromTop:n,distanceFromBottom:r,eventSource:t===window?document.body:i.node})}))})),i.framePending=!0}},i.getParent=function(){return i.node},u(i,n)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"getChildContext",value:function(){return{subscribe:this.subscribe,unsubscribe:this.unsubscribe,getParent:this.getParent}}},{key:"componentDidMount",value:function(){var e=this;this.events.forEach((function(t){return window.addEventListener(t,e.notifySubscribers)}))}},{key:"componentWillUnmount",value:function(){var e=this;this.rafHandle&&(l.default.cancel(this.rafHandle),this.rafHandle=null),this.events.forEach((function(t){return window.removeEventListener(t,e.notifySubscribers)}))}},{key:"render",value:function(){var e=this;return a.default.createElement("div",i({},this.props,{ref:function(t){return e.node=t},onScroll:this.notifySubscribers,onTouchStart:this.notifySubscribers,onTouchMove:this.notifySubscribers,onTouchEnd:this.notifySubscribers}))}}]),t}(o.PureComponent);h.childContextTypes={subscribe:s.default.func,unsubscribe:s.default.func,getParent:s.default.func},t.default=h},78579:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=n(67294),o=l(r),a=l(n(73935)),s=l(n(45697));function l(e){return e&&e.__esModule?e:{default:e}}function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var u=function(e){function t(){var e,n,i;d(this,t);for(var r=arguments.length,o=Array(r),a=0;a<r;a++)o[a]=arguments[a];return n=i=c(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(o))),i.state={isSticky:!1,wasSticky:!1,style:{}},i.handleContainerEvent=function(e){var t=e.distanceFromTop,n=e.distanceFromBottom,r=e.eventSource,o=i.context.getParent(),a=!1;i.props.relative&&(a=r!==o,t=-(r.scrollTop+r.offsetTop)+i.placeholder.offsetTop);var s=i.placeholder.getBoundingClientRect(),l=i.content.getBoundingClientRect().height,d=n-i.props.bottomOffset-l,c=!!i.state.isSticky,u=a?c:t<=-i.props.topOffset&&n>-i.props.bottomOffset;n=(i.props.relative?o.scrollHeight-o.scrollTop:n)-l;var h=u?{position:"fixed",top:d>0?i.props.relative?o.offsetTop-o.offsetParent.scrollTop:0:d,left:s.left,width:s.width}:{};i.props.disableHardwareAcceleration||(h.transform="translateZ(0)"),i.setState({isSticky:u,wasSticky:c,distanceFromTop:t,distanceFromBottom:n,calculatedHeight:l,style:h})},c(i,n)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),i(t,[{key:"componentWillMount",value:function(){if(!this.context.subscribe)throw new TypeError("Expected Sticky to be mounted within StickyContainer");this.context.subscribe(this.handleContainerEvent)}},{key:"componentWillUnmount",value:function(){this.context.unsubscribe(this.handleContainerEvent)}},{key:"componentDidUpdate",value:function(){this.placeholder.style.paddingBottom=this.props.disableCompensation?0:(this.state.isSticky?this.state.calculatedHeight:0)+"px"}},{key:"render",value:function(){var e=this,t=o.default.cloneElement(this.props.children({isSticky:this.state.isSticky,wasSticky:this.state.wasSticky,distanceFromTop:this.state.distanceFromTop,distanceFromBottom:this.state.distanceFromBottom,calculatedHeight:this.state.calculatedHeight,style:this.state.style}),{ref:function(t){e.content=a.default.findDOMNode(t)}});return o.default.createElement("div",null,o.default.createElement("div",{ref:function(t){return e.placeholder=t}}),t)}}]),t}(r.Component);u.propTypes={topOffset:s.default.number,bottomOffset:s.default.number,relative:s.default.bool,children:s.default.func.isRequired},u.defaultProps={relative:!1,topOffset:0,bottomOffset:0,disableCompensation:!1,disableHardwareAcceleration:!1},u.contextTypes={subscribe:s.default.func,unsubscribe:s.default.func,getParent:s.default.func},t.default=u},58439:(e,t,n)=>{"use strict";t.L9=t.Le=void 0;var i=o(n(78579)),r=o(n(18474));function o(e){return e&&e.__esModule?e:{default:e}}t.Le=i.default,t.L9=r.default,i.default},49997:(e,t,n)=>{"use strict";n.d(t,{Z:()=>b});var i=n(67294),r=n(51995),o=n(61988),a=n(91877),s=n(93185),l=n(74069),d=n(33626),c=n(97381),u=n(60193),h=n(11965);function p({extensions:e,placeholder:t,id:n}){return(0,h.tZ)(u.ZP,{id:n,placeholder:t,extensions:e,autoComplete:"off",autoFocus:!0})}var f=n(3741),m=n(31069);const g=async e=>{var t;let n;try{n=await m.Z.get({endpoint:`/dashboardasync/api/read?_oc_DashboardModelViewAsync=changed_on&_od_DashboardModelViewAsync=desc&_flt_2_dashboard_title=${e}`})}catch(e){return[{title:(0,o.t)("An error occurred while fetching dashboards")}]}return null==(t=n)?void 0:t.json.result.map((e=>({title:e.dashboard_title,...e})))},v=(0,r.iK)(l.Z)`
  margin-top: 20%;

  .ant-modal-body {
    padding: 0;
    overflow: visible;
  }
`;function b(){const e=(0,i.useRef)(),t=(0,i.useRef)(null),[n,r]=(0,i.useState)(!1),l=e=>(0,c.logEvent)(f.tB,{show_omni:e}),u=()=>{e.current=!1,r(!1),l(!1)};return(0,d.J)((()=>{function n(t){if(!(0,a.cr)(s.T.OMNIBAR))return;const n=t.ctrlKey||t.metaKey,i=["KeyK"].includes(t.code);"Escape"===t.key&&e.current?u():n&&i&&(e.current=!e.current,r(e.current),l(!!e.current))}function i(e){t.current&&!t.current.contains(e.target)&&u()}return e.current=!1,document.addEventListener("mousedown",i),document.addEventListener("keydown",n),()=>{document.removeEventListener("keydown",n),document.removeEventListener("mousedown",i)}})),(0,h.tZ)(v,{title:"",show:n,hideFooter:!0,closable:!1,onHide:()=>{},destroyOnClose:!0},(0,h.tZ)("div",{ref:t},(0,h.tZ)(p,{id:"InputOmnibar",placeholder:(0,o.t)("Search all dashboards"),extensions:[g]})))}},55224:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>iu});var i={};n.r(i);var r=n(14890),o=n(37703),a=n(67294),s=n(45697),l=n.n(s),d=n(61988),c=n(93185),u=n(14278),h=n(38703),p=n(81255);function f(e){return Object.values(e).reduce(((e,t)=>(t&&t.type===p.dW&&t.meta&&t.meta.chartId&&e.push(t.meta.chartId),e)),[])}var m=n(94184),g=n.n(m),v=n(51995),b=n(11965),y=n(57902),C=n(40637),S=n(58439),x=n(23279),w=n.n(x),k=n(91033);function R(){return R=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},R.apply(this,arguments)}function Z(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function F(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var T=function(e){var t,n;function i(t){var n;return F(Z(n=e.call(this,t)||this),"animationFrameID",void 0),F(Z(n),"resizeObserver",void 0),F(Z(n),"target",null),F(Z(n),"resize",(function(e){var t=e.width,i=e.height,r=e.top,o=e.left;n.setState((function(){return{width:t,height:i,top:r,left:o}}))})),F(Z(n),"setTarget",(function(e){n.target=e})),n.state={width:0,height:0,top:0,left:0},n.resize=w()(n.resize,t.debounceTime),n.animationFrameID=null,n}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var r=i.prototype;return r.componentDidMount=function(){var e=this;this.resizeObserver=new k.Z((function(t){void 0===t&&(t=[]),t.forEach((function(t){var n=t.contentRect,i=n.left,r=n.top,o=n.width,a=n.height;e.animationFrameID=window.requestAnimationFrame((function(){e.resize({width:o,height:a,top:r,left:i})}))}))})),this.target&&this.resizeObserver.observe(this.target)},r.componentWillUnmount=function(){this.animationFrameID&&window.cancelAnimationFrame(this.animationFrameID),this.resizeObserver&&this.resizeObserver.disconnect()},r.render=function(){var e=this.props,t=e.className,n=e.children,i=(e.debounceTime,e.parentSizeStyles),r=function(e,t){if(null==e)return{};var n,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,["className","children","debounceTime","parentSizeStyles"]);return a.createElement("div",R({style:i,ref:this.setTarget,className:t},r),n(R({},this.state,{ref:this.target,resize:this.resize})))},i}(a.Component);F(T,"propTypes",{className:l().string,debounceTime:l().number,children:l().func.isRequired}),F(T,"defaultProps",{debounceTime:300,parentSizeStyles:{width:"100%",height:"100%"}});var D,_=n(80621),I=n(84785),M=n(2275),E=n(23493),O=n.n(E);const P=_.Mu+1,N=_.Mu+3,j=_.Mu+4,q=_.Mu+5,z={[p.U0]:{[p.yR]:_.Mu,[p.BG]:_.Mu},[p.BG]:{[p.dW]:P,[p.xh]:P,[p.BA]:P,[p.hE]:P,[p.Nc]:P,[p.Os]:P,[p.yR]:P},[p.Os]:{[p.dW]:j,[p.xh]:j,[p.BA]:j},[p.yR]:{[p.gn]:N},[p.gn]:{[p.dW]:q,[p.xh]:q,[p.BA]:N,[p.hE]:q,[p.Nc]:q,[p.Os]:N,[p.yR]:N},[p.BA]:{[p.dW]:q,[p.Nc]:q,[p.xh]:q,[p.Os]:N,[p.hE]:N,[p.yR]:N},[p.dW]:{},[p.hE]:{},[p.Nc]:{},[p.xh]:{}};function A(e){const{parentType:t,childType:n,parentDepth:i}=e;if(!t||!n||"number"!=typeof i)return!1;const r=(z[t]||{})[n];return"number"==typeof r&&i<=r}const $="DROP_TOP",U="DROP_RIGHT",L="DROP_BOTTOM",V="DROP_LEFT";let K,B={};function W(e,t){const{depth:n,parentComponent:i,component:r,orientation:o,isDraggingOverShallow:a}=t.props,s=e.getItem();if(!s||s.id===r.id)return null;if(s.type===p.yR&&r.type===p.gn&&2===n)return null;const l=A({parentType:r.type,parentDepth:n,childType:s.type}),d=i&&i.type,c=A({parentType:d,parentDepth:n+(d===p.gn||d===p.yR?0:-1),childType:s.type});if(!l&&!c)return null;const u=(r.children||[]).length>0,h="row"===o?"vertical":"horizontal",f="row"===o?"horizontal":"vertical";if(a&&l&&!c)return"vertical"===h?u?U:V:u?L:$;const m=t.ref.getBoundingClientRect(),g=e.getClientOffset()||B[r.id];if(!g||!m)return null;B[r.id]=g;const v=Math.abs(g.y-m.top),b=Math.abs(g.y-m.bottom),y=Math.abs(g.x-m.left),C=Math.abs(g.x-m.right);if(!a&&[v,b,y,C].every((e=>e>20)))return null;if(c&&!l){if("vertical"===f){const e=m.left+(m.right-m.left)/2;return g.x<e?V:U}const e=m.top+(m.bottom-m.top)/2;return g.y<e?$:L}if(c&&l){if("vertical"===f){if(y<20)return V;if(C<20)return U}else{if(v<20)return $;if(b<20)return L}return"vertical"===h?u?U:V:u?L:$}return null}const H=O()((function(e,t,n){var i,r;if(!n.mounted)return;const o=W(t,n);!function(e){const t="SCROLL_TOP"===e&&!K&&0!==document.documentElement.scrollTop,n=K&&("SCROLL_TOP"!==e||0===document.documentElement.scrollTop);t?K=setInterval((()=>{if(0===document.documentElement.scrollTop)return clearInterval(K),void(K=null);let e=document.documentElement.scrollTop-120;e<0&&(e=0),window.scroll({top:e,behavior:"smooth"})}),50):n&&(clearInterval(K),K=null)}((null==n||null==(i=n.props)||null==(r=i.component)?void 0:r.type)===p.U0?"SCROLL_TOP":null),o?n.setState((()=>({dropIndicator:o}))):n.setState((()=>({dropIndicator:null})))}),100);const G="DRAG_DROPPABLE",J=[G,{canDrag:e=>!e.disableDragDrop,beginDrag(e){const{component:t,index:n,parentComponent:i={}}=e;return{type:t.type,id:t.id,meta:t.meta,index:n,parentId:i.id,parentType:i.type}}},function(e,t){return{dragSourceRef:e.dragSource(),dragPreviewRef:e.dragPreview(),isDragging:t.isDragging()}}],Q=[G,{canDrop:e=>!e.disableDragDrop,hover(e,t,n){n&&n.mounted&&H(e,t,n)},drop(e,t,n){const i=t.getDropResult();if((!i||!i.destination)&&n.mounted)return function(e,t,n){if(!n.mounted)return;n.setState((()=>({dropIndicator:null})));const i=W(t,n);if(!i)return;const{parentComponent:r,component:o,index:a,onDrop:s,orientation:l}=n.props,d=t.getItem(),c="row"===l&&(i===$||i===L)||"column"===l&&(i===V||i===U)?"sibling":"child",u={source:{id:d.parentId,type:d.parentType,index:d.index},dragging:{id:d.id,type:d.type,meta:d.meta}};if("child"===c)u.destination={id:o.id,type:o.type,index:o.children.length};else{let e=r&&d.parentId===r.id&&d.index<a?a-1:a;i!==L&&i!==U||(e+=1),u.destination={id:r.id,type:r.type,index:e}}return s(u),B={},u}(0,t,n)}},function(e,t){return{droppableRef:e.dropTarget(),isDraggingOver:t.isOver(),isDraggingOverShallow:t.isOver({shallow:!0})}}],Y={children:l().func,className:l().string,component:M.cP.isRequired,parentComponent:M.cP,depth:l().number.isRequired,disableDragDrop:l().bool,orientation:l().oneOf(["row","column"]),index:l().number.isRequired,style:l().object,onDrop:l().func,editMode:l().bool.isRequired,useEmptyDragPreview:l().bool,isDragging:l().bool.isRequired,isDraggingOver:l().bool.isRequired,isDraggingOverShallow:l().bool.isRequired,droppableRef:l().func.isRequired,dragSourceRef:l().func.isRequired,dragPreviewRef:l().func.isRequired},X={className:null,style:null,parentComponent:null,disableDragDrop:!1,children(){},onDrop(){},orientation:"row",useEmptyDragPreview:!1};class ee extends a.PureComponent{constructor(e){super(e),this.state={dropIndicator:null},this.setRef=this.setRef.bind(this)}componentDidMount(){this.mounted=!0}componentWillUnmount(){this.mounted=!1}setRef(e){this.ref=e,this.props.useEmptyDragPreview?this.props.dragPreviewRef((D||((D=new Image).src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="),D),{captureDraggingState:!0}):this.props.dragPreviewRef(e),this.props.droppableRef(e)}render(){const{children:e,className:t,orientation:n,dragSourceRef:i,disableDragDrop:r,isDragging:o,isDraggingOver:a,style:s,editMode:l}=this.props,{dropIndicator:d}=this.state,c=a&&d&&!r?{className:g()("drop-indicator",d===$&&"drop-indicator--top",d===L&&"drop-indicator--bottom",d===V&&"drop-indicator--left",d===U&&"drop-indicator--right")}:null,u=l?{dragSourceRef:i,dropIndicatorProps:c}:{};return(0,b.tZ)("div",{style:s,ref:this.setRef,className:g()("dragdroppable","row"===n&&"dragdroppable-row","column"===n&&"dragdroppable-column",o&&"dragdroppable--dragging",t)},e(u))}}ee.propTypes=Y,ee.defaultProps=X;const te=(0,I.DragSource)(...J)((0,I.DropTarget)(...Q)(ee)),ne={id:l().string.isRequired,type:l().string.isRequired,label:l().string.isRequired,className:l().string};class ie extends a.PureComponent{render(){const{label:e,id:t,type:n,className:i}=this.props;return(0,b.tZ)(te,{component:{type:n,id:t},parentComponent:{id:_.D0,type:p.F0},index:0,depth:0,editMode:!0},(({dragSourceRef:t})=>(0,b.tZ)("div",{ref:t,className:"new-component"},(0,b.tZ)("div",{className:g()("new-component-placeholder",i)}),e)))}}function re(){return(0,b.tZ)(ie,{id:_.Nb,type:p.BA,label:(0,d.t)("Column"),className:"fa fa-long-arrow-down"})}function oe(){return(0,b.tZ)(ie,{id:_.ES,type:p.hE,label:(0,d.t)("Divider"),className:"divider-placeholder"})}function ae(){return(0,b.tZ)(ie,{id:_.Z1,type:p.Nc,label:(0,d.t)("Header"),className:"fa fa-header"})}function se(){return(0,b.tZ)(ie,{id:_.vD,type:p.Os,label:(0,d.t)("Row"),className:"fa fa-long-arrow-right"})}function le(){return(0,b.tZ)(ie,{id:_.NN,type:p.yR,label:(0,d.t)("Tabs"),className:"fa fa-window-restore"})}function de(){return(0,b.tZ)(ie,{id:_.C3,type:p.xh,label:"Markdown",className:"fa fa-code"})}ie.propTypes=ne,ie.defaultProps={className:null};var ce=n(68969),ue=n(88239),he=n(8177),pe=n.n(he),fe=n(85105),me=n.n(fe),ge=n(99663),ve=n(46058),be=n(49135),ye=n(93196),Ce=n(75621),Se=n(94396),xe=function(e){function t(){var e,n,i,r;(0,ge.default)(this,t);for(var o=arguments.length,a=Array(o),s=0;s<o;s++)a[s]=arguments[s];return n=i=(0,be.default)(this,(e=t.__proto__||me()(t)).call.apply(e,[this].concat(a))),i._cellRenderer=function(e){var t=e.parent,n=e.rowIndex,r=e.style,o=e.isScrolling,a=e.isVisible,s=e.key,l=i.props.rowRenderer;return pe()(r,"width").writable&&(r.width="100%"),l({index:n,style:r,isScrolling:o,isVisible:a,key:s,parent:t})},i._setRef=function(e){i.Grid=e},i._onScroll=function(e){var t=e.clientHeight,n=e.scrollHeight,r=e.scrollTop;(0,i.props.onScroll)({clientHeight:t,scrollHeight:n,scrollTop:r})},i._onSectionRendered=function(e){var t=e.rowOverscanStartIndex,n=e.rowOverscanStopIndex,r=e.rowStartIndex,o=e.rowStopIndex;(0,i.props.onRowsRendered)({overscanStartIndex:t,overscanStopIndex:n,startIndex:r,stopIndex:o})},r=n,(0,be.default)(i,r)}return(0,ye.default)(t,e),(0,ve.default)(t,[{key:"forceUpdateGrid",value:function(){this.Grid&&this.Grid.forceUpdate()}},{key:"getOffsetForRow",value:function(e){var t=e.alignment,n=e.index;return this.Grid?this.Grid.getOffsetForCell({alignment:t,rowIndex:n,columnIndex:0}).scrollTop:0}},{key:"invalidateCellSizeAfterRender",value:function(e){var t=e.columnIndex,n=e.rowIndex;this.Grid&&this.Grid.invalidateCellSizeAfterRender({rowIndex:n,columnIndex:t})}},{key:"measureAllRows",value:function(){this.Grid&&this.Grid.measureAllCells()}},{key:"recomputeGridSize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.columnIndex,n=void 0===t?0:t,i=e.rowIndex,r=void 0===i?0:i;this.Grid&&this.Grid.recomputeGridSize({rowIndex:r,columnIndex:n})}},{key:"recomputeRowHeights",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.Grid&&this.Grid.recomputeGridSize({rowIndex:e,columnIndex:0})}},{key:"scrollToPosition",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.Grid&&this.Grid.scrollToPosition({scrollTop:e})}},{key:"scrollToRow",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.Grid&&this.Grid.scrollToCell({columnIndex:0,rowIndex:e})}},{key:"render",value:function(){var e=this.props,t=e.className,n=e.noRowsRenderer,i=e.scrollToIndex,r=e.width,o=g()("ReactVirtualized__List",t);return a.createElement(Ce.Z,(0,ue.default)({},this.props,{autoContainerWidth:!0,cellRenderer:this._cellRenderer,className:o,columnWidth:r,columnCount:1,noContentRenderer:n,onScroll:this._onScroll,onSectionRendered:this._onSectionRendered,ref:this._setRef,scrollToRow:i}))}}]),t}(a.PureComponent);xe.defaultProps={autoHeight:!1,estimatedRowSize:30,onScroll:function(){},noRowsRenderer:function(){return null},onRowsRendered:function(){},overscanIndicesGetter:Se.ZP,overscanRowCount:10,scrollToAlignment:"auto",scrollToIndex:-1,style:{}},xe.propTypes=null;const we=xe;var ke=n(24903),Re=n(82191),Ze=n(4715),Fe=n(69856);const Te={datasourceUrl:l().string,datasourceName:l().string,innerRef:l().func,isSelected:l().bool,lastModified:l().string,sliceName:l().string.isRequired,style:l().object,visType:l().string.isRequired},De=v.iK.div`
  ${({theme:e})=>`\n    .chart-card {\n      border: 1px solid ${e.colors.grayscale.light2};\n      border-radius: ${e.gridUnit}px;\n      background: ${e.colors.grayscale.light5};\n      font-weight: ${e.typography.weights.light};\n      padding: ${2*e.gridUnit}px;\n      margin: 0 ${3*e.gridUnit}px\n        ${3*e.gridUnit}px\n        ${3*e.gridUnit}px;\n      position: relative;\n      cursor: move;\n      white-space: nowrap;\n      overflow: hidden;\n\n      &:hover {\n        background: ${e.colors.grayscale.light4};\n      }\n    }\n\n    .chart-card.is-selected {\n      cursor: not-allowed;\n      opacity: 0.4;\n    }\n\n    .card-title {\n      margin-right: 60px;\n      margin-bottom: ${2*e.gridUnit}px;\n      font-weight: ${e.typography.weights.bold};\n    }\n\n    .card-body {\n      display: flex;\n      flex-direction: column;\n\n      .item {\n        span {\n          word-break: break-all;\n\n          &:first-child {\n            font-weight: ${e.typography.weights.normal};\n          }\n        }\n      }\n    }\n\n    .is-added-label {\n      background: ${e.colors.grayscale.base};\n      border-radius: ${e.gridUnit}px;\n      color: ${e.colors.grayscale.light5};\n      font-size: ${e.typography.sizes.s}px;\n      text-transform: uppercase;\n      position: absolute;\n      padding: ${e.gridUnit}px\n        ${2*e.gridUnit}px;\n      top: ${8*e.gridUnit}px;\n      right: ${8*e.gridUnit}px;\n      pointer-events: none;\n    }\n  `}
`;function _e({datasourceUrl:e,datasourceName:t,innerRef:n,isSelected:i,lastModified:r,sliceName:o,style:a,visType:s}){return(0,b.tZ)(De,{ref:n,style:a},(0,b.tZ)("div",{className:g()("chart-card",i&&"is-selected")},(0,b.tZ)("div",{className:"card-title"},o),(0,b.tZ)("div",{className:"card-body"},(0,b.tZ)("div",{className:"item"},(0,b.tZ)("span",null,(0,d.t)("Modified")," "),(0,b.tZ)("span",null,r)),(0,b.tZ)("div",{className:"item"},(0,b.tZ)("span",null,(0,d.t)("Visualization")," "),(0,b.tZ)("span",null,s)),(0,b.tZ)("div",{className:"item"},(0,b.tZ)("span",null,(0,d.t)("Data source")," "),(0,b.tZ)("a",{href:e},t)))),i&&(0,b.tZ)("div",{className:"is-added-label"},(0,d.t)("Added")))}_e.propTypes=Te,_e.defaultProps={datasourceUrl:null,datasourceName:"-",innerRef:null,isSelected:!1,style:null,lastModified:null};const Ie=_e,Me={position:"fixed",pointerEvents:"none",top:0,left:0,zIndex:101,width:344},Ee={dragItem:l().shape({index:l().number.isRequired}),slices:l().arrayOf(M.Rw),isDragging:l().bool.isRequired,currentOffset:l().shape({x:l().number.isRequired,y:l().number.isRequired})};function Oe({dragItem:e,slices:t,isDragging:n,currentOffset:i}){if(!(n&&i&&e&&t))return null;const r=t[e.index];return r&&e.parentType===p.F0&&e.type===p.dW?(0,b.tZ)(Ie,{style:{...Me,transform:`translate(${i.x}px, ${i.y}px)`},sliceName:r.slice_name,lastModified:r.changed_on_humanized,visType:r.viz_type,datasourceUrl:r.datasource_url,datasourceName:r.datasource_name}):null}Oe.propTypes=Ee,Oe.defaultProps={currentOffset:null,dragItem:null,slices:null};const Pe=(0,I.DragLayer)((e=>({dragItem:e.getItem(),currentOffset:e.getSourceClientOffset(),isDragging:e.isDragging()})))(Oe),Ne={fetchAllSlices:l().func.isRequired,isLoading:l().bool.isRequired,slices:l().objectOf(M.Rw).isRequired,lastUpdated:l().number.isRequired,errorMessage:l().string,userId:l().string.isRequired,selectedSliceIds:l().arrayOf(l().number),editMode:l().bool,height:l().number,filterboxMigrationState:Fe.Qi},je={selectedSliceIds:[],editMode:!1,errorMessage:"",height:window.innerHeight,filterboxMigrationState:Fe.Qi.NOOP},qe=["slice_name","viz_type","datasource_name"],ze={slice_name:"name",viz_type:"viz type",datasource_name:"dataset",changed_on:"recent"},Ae=v.iK.div`
  display: flex;
  flex-direction: row;
  padding: ${({theme:e})=>3*e.gridUnit}px;
`,$e=(0,v.iK)(Ze.P)`
  margin-left: ${({theme:e})=>2*e.gridUnit}px;
  min-width: 150px;
`;class Ue extends a.Component{static sortByComparator(e){const t="changed_on"===e?-1:1;return(n,i)=>n[e]<i[e]?-1*t:n[e]>i[e]?1*t:0}constructor(e){super(e),this.state={filteredSlices:[],searchTerm:"",sortBy:"changed_on",selectedSliceIdsSet:new Set(e.selectedSliceIds)},this.rowRenderer=this.rowRenderer.bind(this),this.searchUpdated=this.searchUpdated.bind(this),this.handleKeyPress=this.handleKeyPress.bind(this),this.handleChange=this.handleChange.bind(this),this.handleSelect=this.handleSelect.bind(this)}componentDidMount(){const{userId:e,filterboxMigrationState:t}=this.props;this.slicesRequest=this.props.fetchAllSlices(e,(0,c.c)(c.T.ENABLE_FILTER_BOX_MIGRATION)&&t!==Fe.Qi.SNOOZED)}UNSAFE_componentWillReceiveProps(e){const t={};e.lastUpdated!==this.props.lastUpdated&&(t.filteredSlices=Object.values(e.slices).filter((0,ke.cj)(this.state.searchTerm,qe)).sort(Ue.sortByComparator(this.state.sortBy))),e.selectedSliceIds!==this.props.selectedSliceIds&&(t.selectedSliceIdsSet=new Set(e.selectedSliceIds)),Object.keys(t).length&&this.setState(t)}componentWillUnmount(){this.slicesRequest&&this.slicesRequest.abort&&this.slicesRequest.abort()}getFilteredSortedSlices(e,t){return Object.values(this.props.slices).filter((0,ke.cj)(e,qe)).sort(Ue.sortByComparator(t))}handleKeyPress(e){"Enter"===e.key&&(e.preventDefault(),this.searchUpdated(e.target.value))}handleChange(e){this.searchUpdated(e.target.value)}searchUpdated(e){this.setState((t=>({searchTerm:e,filteredSlices:this.getFilteredSortedSlices(e,t.sortBy)})))}handleSelect(e){this.setState((t=>({sortBy:e,filteredSlices:this.getFilteredSortedSlices(t.searchTerm,e)})))}rowRenderer({key:e,index:t,style:n}){const{filteredSlices:i,selectedSliceIdsSet:r}=this.state,o=i[t],a=r.has(o.slice_id),s=p.dW,l=_.Jd,d={chartId:o.slice_id,sliceName:o.slice_name};return(0,b.tZ)(te,{key:e,component:{type:s,id:l,meta:d},parentComponent:{id:_.D0,type:p.F0},index:t,depth:0,disableDragDrop:a,editMode:this.props.editMode,useEmptyDragPreview:!0,style:{}},(({dragSourceRef:e})=>(0,b.tZ)(Ie,{innerRef:e,style:n,sliceName:o.slice_name,lastModified:o.changed_on_humanized,visType:o.viz_type,datasourceUrl:o.datasource_url,datasourceName:o.datasource_name,isSelected:a})))}render(){const e=this.props.height-30-64-16;return(0,b.tZ)("div",{className:"slice-adder-container"},(0,b.tZ)(Ae,null,(0,b.tZ)(Re.II,{placeholder:(0,d.t)("Filter your charts"),className:"search-input",onChange:this.handleChange,onKeyPress:this.handleKeyPress}),(0,b.tZ)($e,{id:"slice-adder-sortby",value:this.state.sortBy,onChange:this.handleSelect,options:Object.entries(ze).map((([e,t])=>({label:(0,d.t)("Sort by %s",t),value:e}))),placeholder:(0,d.t)("Sort by")})),this.props.isLoading&&(0,b.tZ)(h.Z,null),!this.props.isLoading&&this.state.filteredSlices.length>0&&(0,b.tZ)(we,{width:376,height:e,rowCount:this.state.filteredSlices.length,rowHeight:112,rowRenderer:this.rowRenderer,searchTerm:this.state.searchTerm,sortBy:this.state.sortBy,selectedSliceIds:this.props.selectedSliceIds}),this.props.errorMessage&&(0,b.tZ)("div",{className:"error-message"},this.props.errorMessage),(0,b.tZ)(Pe,{slices:this.state.filteredSlices}))}}Ue.propTypes=Ne,Ue.defaultProps=je;const Le=Ue,Ve=(0,o.$j)((function({sliceEntities:e,dashboardInfo:t,dashboardState:n},i){return{height:i.height,userId:t.userId,selectedSliceIds:n.sliceIds,slices:e.slices,isLoading:e.isLoading,errorMessage:e.errorMessage,lastUpdated:e.lastUpdated,editMode:n.editMode,filterboxMigrationState:n.filterboxMigrationState}}),(function(e){return(0,r.DE)({fetchAllSlices:ce.To},e)}))(Le),Ke=(0,v.iK)(C.ZP)`
  line-height: inherit;
  margin-top: ${({theme:e})=>2*e.gridUnit}px;
`,Be=v.iK.div`
  height: 100%;
  position: fixed;
  right: 0;
  top: 0;

  .ReactVirtualized__List {
    padding-bottom: ${({topOffset:e})=>`${124+e}px`};
  }
`,We=({isStandalone:e,topOffset:t=0})=>(0,b.tZ)(Be,{topOffset:t,className:"dashboard-builder-sidepane"},(0,b.tZ)(T,null,(({height:n})=>(0,b.tZ)(S.L9,null,(0,b.tZ)(S.Le,{topOffset:-t,bottomOffset:1/0},(({style:i,isSticky:r})=>{const{pageYOffset:o}=window,a=o<59&&!e,s=t+(59-o-4);return(0,b.tZ)("div",{className:"viewport",style:{...i,top:a?s:t}},(0,b.tZ)(Ke,{id:"tabs",className:"tabs-components"},(0,b.tZ)(C.ZP.TabPane,{key:1,tab:(0,d.t)("Components")},(0,b.tZ)(le,null),(0,b.tZ)(se,null),(0,b.tZ)(re,null),(0,b.tZ)(ae,null),(0,b.tZ)(de,null),(0,b.tZ)(oe,null)),(0,b.tZ)(C.ZP.TabPane,{key:2,tab:(0,d.t)("Charts"),className:"tab-charts"},(0,b.tZ)(Ve,{height:n+(r?59:0)}))))}))))));var He=n(74599),Ge=n(39969),Je=n.n(Ge),Qe=n(30381),Ye=n.n(Qe),Xe=n(37488),et=n(3741),tt=n(91877),nt=n(38097),it=n(35932),rt=n(38270),ot=n(36674),at=n(9679),st=(n(15306),n(31069)),lt=n(27600),dt=n(5872),ct=n.n(dt),ut=n(70326),ht=n(10222),pt=n(23525),ft=n(81788);const mt=e=>{const{url:t,copyMenuItemTitle:n,emailMenuItemTitle:i,emailSubject:r,emailBody:o,addDangerToast:s,addSuccessToast:l,dashboardId:c,...u}=e,h=(0,ut.n)(t);async function p(){if("object"==typeof(0,pt.e)(lt.KD.nativeFilters)||!c)return null;const e=await(0,ft.B8)(c,(0,pt.e)(lt.KD.nativeFiltersKey)),n=await(0,ft.u7)(c,JSON.stringify(e)),i=new(Je())(`${window.location.origin}${t}`);return i.searchParams.set(lt.KD.nativeFilters.name,n),`${i.pathname}${i.search}`}return(0,b.tZ)(a.Fragment,null,(0,b.tZ)(Re.v2.Item,ct()({key:"copy-url"},u),(0,b.tZ)("div",{onClick:async function(){try{const e=await p(),t=await h(e);await(0,ht.Z)(t),l((0,d.t)("Copied to clipboard!"))}catch(e){s((0,d.t)("Sorry, your browser does not support copying."))}},role:"button",tabIndex:0},n)),(0,b.tZ)(Re.v2.Item,ct()({key:"share-by-email"},u),(0,b.tZ)("div",{onClick:async function(){try{const e=await p(),t=await h(e),n=`${o}${t}`;window.location.href=`mailto:?Subject=${r}%20&Body=${n}`}catch(e){s((0,d.t)("Sorry, something went wrong. Try again later."))}},role:"button",tabIndex:0},i)))};var gt=n(68073),vt=n(94670);const bt=v.iK.div`
  ${({theme:e})=>`\n    .css-editor-header {\n      display: flex;\n      flex-direction: row;\n      justify-content: space-between;\n      margin-bottom: ${2*e.gridUnit}px;\n\n      h5 {\n        margin-top: ${e.gridUnit}px;\n      }\n    }\n    .css-editor {\n      border: 1px solid ${e.colors.grayscale.light1};\n    }\n  `}
`,yt={initialCss:l().string,triggerNode:l().node.isRequired,onChange:l().func,templates:l().array};class Ct extends a.PureComponent{constructor(e){super(e),this.state={css:e.initialCss},this.changeCss=this.changeCss.bind(this),this.changeCssTemplate=this.changeCssTemplate.bind(this)}componentDidMount(){vt.ry.preload()}changeCss(e){this.setState({css:e},(()=>{this.props.onChange(e)}))}changeCssTemplate({key:e}){this.changeCss(e)}renderTemplateSelector(){if(this.props.templates){const e=(0,b.tZ)(Re.v2,{onClick:this.changeCssTemplate},this.props.templates.map((e=>(0,b.tZ)(Re.v2.Item,{key:e.css},e.label))));return(0,b.tZ)(Re.Lt,{overlay:e,placement:"bottomRight"},(0,b.tZ)(it.Z,null,(0,d.t)("Load a CSS template")))}return null}render(){return(0,b.tZ)(gt.Z,{triggerNode:this.props.triggerNode,modalTitle:(0,d.t)("CSS"),modalBody:(0,b.tZ)(bt,null,(0,b.tZ)("div",{className:"css-editor-header"},(0,b.tZ)("h5",null,(0,d.t)("Live CSS editor")),this.renderTemplateSelector()),(0,b.tZ)(vt.ry,{className:"css-editor",minLines:12,maxLines:30,onChange:this.changeCss,height:"200px",width:"100%",editorProps:{$blockScrolling:!0},enableLiveAutocompletion:!0,value:this.state.css||""}))})}}Ct.propTypes=yt,Ct.defaultProps={initialCss:"",onChange:()=>{}};const St=Ct;var xt=n(81315),wt=n(29487),kt=n(49238);const Rt=[[0,(0,d.t)("Don't refresh")],[10,(0,d.t)("10 seconds")],[30,(0,d.t)("30 seconds")],[60,(0,d.t)("1 minute")],[300,(0,d.t)("5 minutes")],[1800,(0,d.t)("30 minutes")],[3600,(0,d.t)("1 hour")],[21600,(0,d.t)("6 hours")],[43200,(0,d.t)("12 hours")],[86400,(0,d.t)("24 hours")]].map((e=>({value:e[0],label:e[1]}))),Zt=(0,v.iK)(gt.Z)`
  .ant-modal-body {
    overflow: visible;
  }
`,Ft=v.iK.div`
  margin-top: ${({theme:e})=>6*e.gridUnit}px;
`;class Tt extends a.PureComponent{constructor(e){super(e),this.modalRef=void 0,this.modalRef=a.createRef(),this.state={refreshFrequency:e.refreshFrequency},this.handleFrequencyChange=this.handleFrequencyChange.bind(this),this.onSave=this.onSave.bind(this),this.onCancel=this.onCancel.bind(this)}onSave(){var e;this.props.onChange(this.state.refreshFrequency,this.props.editMode),null==(e=this.modalRef.current)||e.close(),this.props.addSuccessToast((0,d.t)("Refresh interval saved"))}onCancel(){var e;this.setState({refreshFrequency:this.props.refreshFrequency}),null==(e=this.modalRef.current)||e.close()}handleFrequencyChange(e){this.setState({refreshFrequency:e||Rt[0].value})}render(){const{refreshLimit:e=0,refreshWarning:t,editMode:n}=this.props,{refreshFrequency:i=0}=this.state,r=!!i&&!!t&&i<e;return(0,b.tZ)(Zt,{ref:this.modalRef,triggerNode:this.props.triggerNode,modalTitle:(0,d.t)("Refresh interval"),modalBody:(0,b.tZ)("div",null,(0,b.tZ)(kt.lX,null,(0,d.t)("Refresh frequency")),(0,b.tZ)(xt.Z,{ariaLabel:(0,d.t)("Refresh interval"),options:Rt,value:i,onChange:this.handleFrequencyChange,sortComparator:(0,xt.m)("value")}),r&&(0,b.tZ)(Ft,null,(0,b.tZ)(wt.Z,{type:"warning",message:(0,b.tZ)(a.Fragment,null,(0,b.tZ)("div",null,t),(0,b.tZ)("br",null),(0,b.tZ)("strong",null,(0,d.t)("Are you sure you want to proceed?")))}))),modalFooter:(0,b.tZ)(a.Fragment,null,(0,b.tZ)(it.Z,{buttonStyle:"primary",buttonSize:"small",onClick:this.onSave},n?(0,d.t)("Save"):(0,d.t)("Save for this session")),(0,b.tZ)(it.Z,{onClick:this.onCancel,buttonSize:"small"},(0,d.t)("Cancel")))})}}Tt.defaultProps={refreshLimit:0,refreshWarning:null};const Dt=Tt;var _t=n(87183),It=n(87253);const Mt={saveType:_.TN,colorNamespace:void 0,colorScheme:void 0,shouldPersistRefreshFrequency:!1};class Et extends a.PureComponent{constructor(e){super(e),this.modal=void 0,this.onSave=void 0,this.state={saveType:e.saveType,newDashName:`${e.dashboardTitle} [copy]`,duplicateSlices:!1},this.modal=null,this.handleSaveTypeChange=this.handleSaveTypeChange.bind(this),this.handleNameChange=this.handleNameChange.bind(this),this.saveDashboard=this.saveDashboard.bind(this),this.setModalRef=this.setModalRef.bind(this),this.toggleDuplicateSlices=this.toggleDuplicateSlices.bind(this),this.onSave=this.props.onSave.bind(this)}setModalRef(e){this.modal=e}toggleDuplicateSlices(){this.setState((e=>({duplicateSlices:!e.duplicateSlices})))}handleSaveTypeChange(e){this.setState({saveType:e.target.value})}handleNameChange(e){this.setState({newDashName:e,saveType:_.kS})}saveDashboard(){var e;const{saveType:t,newDashName:n}=this.state,{dashboardTitle:i,dashboardInfo:r,layout:o,customCss:a,dashboardId:s,refreshFrequency:l,shouldPersistRefreshFrequency:c,lastModifiedTime:u}=this.props,h=c?l:null==(e=r.metadata)?void 0:e.refresh_frequency,p={certified_by:r.certified_by,certification_details:r.certification_details,css:a,dashboard_title:t===_.kS?n:i,duplicate_slices:this.state.duplicateSlices,last_modified_time:u,owners:r.owners,roles:r.roles,metadata:{...null==r?void 0:r.metadata,positions:o,refresh_frequency:h}};var f;t!==_.kS||n?(this.onSave(p,s,t).then((e=>{t===_.kS&&e&&e.json&&e.json.id&&(window.location.href=`/superset/dashboard/${e.json.id}/`)})),null==(f=this.modal)||f.close()):this.props.addDangerToast((0,d.t)("You must pick a name for the new dashboard"))}render(){return(0,b.tZ)(gt.Z,{ref:this.setModalRef,triggerNode:this.props.triggerNode,modalTitle:(0,d.t)("Save dashboard"),modalBody:(0,b.tZ)("div",null,(0,b.tZ)(_t.Y,{value:_.TN,onChange:this.handleSaveTypeChange,checked:this.state.saveType===_.TN,disabled:!this.props.canOverwrite},(0,d.t)("Overwrite Dashboard [%s]",this.props.dashboardTitle)),(0,b.tZ)("hr",null),(0,b.tZ)(_t.Y,{value:_.kS,onChange:this.handleSaveTypeChange,checked:this.state.saveType===_.kS},(0,d.t)("Save as:")),(0,b.tZ)(Re.II,{type:"text",placeholder:(0,d.t)("[dashboard name]"),value:this.state.newDashName,onFocus:e=>this.handleNameChange(e.target.value),onChange:e=>this.handleNameChange(e.target.value)}),(0,b.tZ)("div",{className:"m-l-25 m-t-5"},(0,b.tZ)(It.ZP,{checked:this.state.duplicateSlices,onChange:()=>this.toggleDuplicateSlices()}),(0,b.tZ)("span",{className:"m-l-5"},(0,d.t)("also copy (duplicate) charts")))),modalFooter:(0,b.tZ)("div",null,(0,b.tZ)(it.Z,{buttonStyle:"primary",onClick:this.saveDashboard},(0,d.t)("Save")))})}}Et.defaultProps=Mt;const Ot=Et;var Pt=n(14505),Nt=n(81395),jt=n(31758),qt=n(41609),zt=n.n(qt);const At=[p.gn,p.U0];function $t({currentNode:e={},components:t={},filterFields:n=[],selectedChartId:i}){if(!e)return null;const{type:r}=e;if(p.dW===r&&e&&e.meta&&e.meta.chartId){const t={value:e.meta.chartId,label:e.meta.sliceName||`${r} ${e.meta.chartId}`,type:r,showCheckbox:i!==e.meta.chartId};return{...t,children:n.map((n=>({value:`${e.meta.chartId}:${n}`,label:`${t.label}`,type:"filter_box",showCheckbox:!1})))}}let o=[];if(e.children&&e.children.length&&e.children.forEach((e=>{const r=$t({currentNode:t[e],components:t,filterFields:n,selectedChartId:i}),a=t[e].type;At.includes(a)?o.push(r):o=o.concat(r)})),At.includes(r)){let t=null;return t=r===p.U0?(0,d.t)("All charts"):e.meta&&e.meta.text?e.meta.text:`${r} ${e.id}`,{value:e.id,label:t,type:r,children:o}}return o}function Ut({components:e={},filterFields:t=[],selectedChartId:n}){return zt()(e)?[]:[{...$t({currentNode:e[_._4],components:e,filterFields:t,selectedChartId:n})}]}function Lt(e=[],t=-1){const n=[],i=(e,r)=>{e&&e.children&&(-1===t||r<t)&&(n.push(e.value),e.children.forEach((e=>i(e,r+1))))};return e.length>0&&e.forEach((e=>{i(e,0)})),n}function Vt({activeFilterField:e,checkedFilterFields:t}){return(0,at.o)(e?[e]:t)}var Kt=n(20194);function Bt({activeFilterField:e,checkedFilterFields:t}){if(e)return(0,Kt._)(e).chartId;if(t.length){const{chartId:e}=(0,Kt._)(t[0]);return t.some((t=>(0,Kt._)(t).chartId!==e))?null:e}return null}function Wt({checkedFilterFields:e=[],activeFilterField:t,filterScopeMap:n={},layout:i={}}){const r=Vt({checkedFilterFields:e,activeFilterField:t}),o=t?[t]:e,a=Ut({components:i,filterFields:o,selectedChartId:Bt({checkedFilterFields:e,activeFilterField:t})}),s=new Set;o.forEach((e=>{(n[e].checked||[]).forEach((t=>{s.add(`${t}:${e}`)}))}));const l=[...s],d=n[r]?n[r].expanded:Lt(a,1);return{[r]:{nodes:a,nodesFiltered:[...a],checked:l,expanded:d}}}var Ht=n(94654),Gt=n.n(Ht),Jt=n(83927),Qt=n.n(Jt),Yt=n(58809),Xt=n.n(Yt),en=n(8816),tn=n.n(en);function nn({tabScopes:e,parentNodeValue:t,forceAggregate:n=!1,hasChartSiblings:i=!1,tabChildren:r=[],immuneChartSiblings:o=[]}){if(n||!i&&Object.entries(e).every((([e,{scope:t}])=>t&&t.length&&e===t[0]))){const n=function({tabs:e=[],tabsInScope:t=[]}){const n=[];return e.forEach((({value:e,children:i})=>{i&&!t.includes(e)&&i.forEach((({value:e,children:i})=>{i&&!t.includes(e)&&n.push(...i.filter((({type:e})=>e===p.dW)))}))})),n.map((({value:e})=>e))}({tabs:r,tabsInScope:Gt()(e,(({scope:e})=>e))}),i=Gt()(Object.values(e),(({immune:e})=>e));return{scope:[t],immune:[...new Set([...n,...i])]}}const a=Object.values(e).filter((({scope:e})=>e&&e.length));return{scope:Gt()(a,(({scope:e})=>e)),immune:a.length?Gt()(a,(({immune:e})=>e)):Gt()(Object.values(e),(({immune:e})=>e)).concat(o)}}function rn({currentNode:e={},filterId:t,checkedChartIds:n=[]}){if(!e)return{};const{value:i,children:r}=e,o=r.filter((({type:e})=>e===p.dW)),a=r.filter((({type:e})=>e===p.gn)),s=o.filter((({value:e})=>t!==e&&!n.includes(e))).map((({value:e})=>e)),l=tn()(Xt()((e=>e.value)),Qt()((e=>rn({currentNode:e,filterId:t,checkedChartIds:n}))))(a);if(!zt()(o)&&o.some((({value:e})=>n.includes(e)))){if(zt()(a))return{scope:[i],immune:s};const{scope:e,immune:t}=nn({tabScopes:l,parentNodeValue:i,forceAggregate:!0,tabChildren:a});return{scope:e,immune:s.concat(t)}}return a.length?nn({tabScopes:l,parentNodeValue:i,hasChartSiblings:!zt()(o),tabChildren:a,immuneChartSiblings:s}):{scope:[],immune:s}}function on({filterKey:e,nodes:t=[],checkedChartIds:n=[]}){if(t.length){const{chartId:i}=(0,Kt._)(e);return rn({currentNode:t[0],filterId:i,checkedChartIds:n})}return{}}var an=n(43399),sn=n(28388),ln=n.n(sn);const dn=(0,v.iK)(nt.Z.BarChartOutlined)`
  ${({theme:e})=>`\n    position: relative;\n    top: ${e.gridUnit-1}px;\n    color: ${e.colors.primary.base};\n    margin-right: ${2*e.gridUnit}px;\n  `}
`;function cn({currentNode:e={},selectedChartId:t}){if(!e)return null;const{label:n,value:i,type:r,children:o}=e;if(o&&o.length){const a=o.map((e=>cn({currentNode:e,selectedChartId:t})));return{...e,label:(0,b.tZ)("span",{className:g()(`filter-scope-type ${r.toLowerCase()}`,{"selected-filter":t===i})},r===p.dW&&(0,b.tZ)(dn,null),n),children:a}}return{...e,label:(0,b.tZ)("span",{className:g()(`filter-scope-type ${r.toLowerCase()}`,{"selected-filter":t===i})},n)}}function un({nodes:e,selectedChartId:t}){return e?e.map((e=>cn({currentNode:e,selectedChartId:t}))):[]}var hn=n(13842);const pn={check:(0,b.tZ)(hn.lU,null),uncheck:(0,b.tZ)(hn.zq,null),halfCheck:(0,b.tZ)(hn.dc,null),expandClose:(0,b.tZ)("span",{className:"rct-icon rct-icon-expand-close"}),expandOpen:(0,b.tZ)("span",{className:"rct-icon rct-icon-expand-open"}),expandAll:(0,b.tZ)("span",{className:"rct-icon rct-icon-expand-all"},(0,d.t)("Expand all")),collapseAll:(0,b.tZ)("span",{className:"rct-icon rct-icon-collapse-all"},(0,d.t)("Collapse all")),parentClose:(0,b.tZ)("span",{className:"rct-icon rct-icon-parent-close"}),parentOpen:(0,b.tZ)("span",{className:"rct-icon rct-icon-parent-open"}),leaf:(0,b.tZ)("span",{className:"rct-icon rct-icon-leaf"})},fn={nodes:l().arrayOf(M.ck).isRequired,checked:l().arrayOf(l().oneOfType([l().number,l().string])).isRequired,expanded:l().arrayOf(l().oneOfType([l().number,l().string])).isRequired,onCheck:l().func.isRequired,onExpand:l().func.isRequired,selectedChartId:l().number},mn=()=>{};function gn({nodes:e=[],checked:t=[],expanded:n=[],onCheck:i,onExpand:r,selectedChartId:o}){return(0,b.tZ)(ln(),{showExpandAll:!0,expandOnClick:!0,showNodeIcon:!1,nodes:un({nodes:e,selectedChartId:o}),checked:t,expanded:n,onCheck:i,onExpand:r,onClick:mn,icons:pn})}gn.propTypes=fn,gn.defaultProps={selectedChartId:null};const vn={label:l().string.isRequired,isSelected:l().bool.isRequired};function bn({label:e,isSelected:t}){return(0,b.tZ)("span",{className:g()("filter-field-item filter-container",{"is-selected":t})},(0,b.tZ)(kt.lX,{htmlFor:e},e))}function yn({nodes:e,activeKey:t}){if(!e)return[];const n=e[0],i=n.children.map((e=>({...e,children:e.children.map((e=>{const{label:n,value:i}=e;return{...e,label:(0,b.tZ)(bn,{isSelected:i===t,label:n})}}))})));return[{...n,label:(0,b.tZ)("span",{className:"root"},n.label),children:i}]}bn.propTypes=vn;const Cn={activeKey:l().string,nodes:l().arrayOf(M.ck).isRequired,checked:l().arrayOf(l().oneOfType([l().number,l().string])).isRequired,expanded:l().arrayOf(l().oneOfType([l().number,l().string])).isRequired,onCheck:l().func.isRequired,onExpand:l().func.isRequired,onClick:l().func.isRequired};function Sn({activeKey:e,nodes:t=[],checked:n=[],expanded:i=[],onClick:r,onCheck:o,onExpand:a}){return(0,b.tZ)(ln(),{showExpandAll:!0,showNodeIcon:!1,expandOnClick:!0,nodes:yn({nodes:t,activeKey:e}),checked:n,expanded:i,onClick:r,onCheck:o,onExpand:a,icons:pn})}Sn.propTypes=Cn,Sn.defaultProps={activeKey:null};const xn={dashboardFilters:l().objectOf(M.Er).isRequired,layout:l().object.isRequired,updateDashboardFiltersScope:l().func.isRequired,setUnsavedChanges:l().func.isRequired,onCloseModal:l().func.isRequired},wn=v.iK.div`
  height: ${({theme:e})=>16*e.gridUnit}px;

  // TODO: replace hardcoded color with theme variable after refactoring filter-scope-selector.less to Emotion
  border-top: ${({theme:e})=>e.gridUnit/4}px solid #cfd8dc;
  padding: ${({theme:e})=>6*e.gridUnit}px;
  margin: 0 0 0 ${({theme:e})=>6*-e.gridUnit}px;
  text-align: right;

  .btn {
    margin-right: ${({theme:e})=>4*e.gridUnit}px;

    &:last-child {
      margin-right: 0;
    }
  }
`;class kn extends a.PureComponent{constructor(e){super(e);const{dashboardFilters:t,layout:n}=e;if(Object.keys(t).length>0){const e=function({dashboardFilters:e={}}){const t=Object.values(e).map((e=>{const{chartId:t,filterName:n,columns:i,labels:r}=e,o=Object.keys(i).map((e=>({value:(0,Kt.w)({chartId:t,column:e}),label:r[e]||e})));return{value:t,label:n,children:o,showCheckbox:!0}}));return[{value:_.dU,type:p.U0,label:(0,d.t)("All filters"),children:t}]}({dashboardFilters:t}),i=e[0].children;this.allfilterFields=[],i.forEach((({children:e})=>{e.forEach((e=>{this.allfilterFields.push(e.value)}))})),this.defaultFilterKey=i[0].children[0].value;const r=Object.values(t).reduce(((e,{chartId:i,columns:r})=>({...e,...Object.keys(r).reduce(((e,r)=>{const o=(0,Kt.w)({chartId:i,column:r}),a=Ut({components:n,filterFields:[o],selectedChartId:i}),s=Lt(a,1),l=((0,an.Q1)({filterScope:t[i].scopes[r]})||[]).filter((e=>e!==i));return{...e,[o]:{nodes:a,nodesFiltered:[...a],checked:l,expanded:s}}}),{})})),{}),{chartId:o}=(0,Kt._)(this.defaultFilterKey),a=[],s=this.defaultFilterKey,l=[_.dU].concat(o),c=Wt({checkedFilterFields:a,activeFilterField:s,filterScopeMap:r,layout:n});this.state={showSelector:!0,activeFilterField:s,searchText:"",filterScopeMap:{...r,...c},filterFieldNodes:e,checkedFilterFields:a,expandedFilterIds:l}}else this.state={showSelector:!1};this.filterNodes=this.filterNodes.bind(this),this.onChangeFilterField=this.onChangeFilterField.bind(this),this.onCheckFilterScope=this.onCheckFilterScope.bind(this),this.onExpandFilterScope=this.onExpandFilterScope.bind(this),this.onSearchInputChange=this.onSearchInputChange.bind(this),this.onCheckFilterField=this.onCheckFilterField.bind(this),this.onExpandFilterField=this.onExpandFilterField.bind(this),this.onClose=this.onClose.bind(this),this.onSave=this.onSave.bind(this)}onCheckFilterScope(e=[]){const{activeFilterField:t,filterScopeMap:n,checkedFilterFields:i}=this.state,r=Vt({activeFilterField:t,checkedFilterFields:i}),o=t?[t]:i,a={...n[r],checked:e},s=function({checked:e=[],filterFields:t=[],filterScopeMap:n={}}){const i=e.reduce(((e,t)=>{const[n,i]=t.split(":");return{...e,[i]:(e[i]||[]).concat(parseInt(n,10))}}),{});return t.reduce(((e,t)=>{const{chartId:r}=(0,Kt._)(t),o=(i[t]||[]).filter((e=>e!==r));return{...e,[t]:{...n[t],checked:o}}}),{})}({checked:e,filterFields:o,filterScopeMap:n});this.setState((()=>({filterScopeMap:{...n,...s,[r]:a}})))}onExpandFilterScope(e=[]){const{activeFilterField:t,checkedFilterFields:n,filterScopeMap:i}=this.state,r=Vt({activeFilterField:t,checkedFilterFields:n}),o={...i[r],expanded:e};this.setState((()=>({filterScopeMap:{...i,[r]:o}})))}onCheckFilterField(e=[]){const{layout:t}=this.props,{filterScopeMap:n}=this.state,i=Wt({checkedFilterFields:e,activeFilterField:null,filterScopeMap:n,layout:t});this.setState((()=>({activeFilterField:null,checkedFilterFields:e,filterScopeMap:{...n,...i}})))}onExpandFilterField(e=[]){this.setState((()=>({expandedFilterIds:e})))}onChangeFilterField(e={}){const{layout:t}=this.props,n=e.value,{activeFilterField:i,checkedFilterFields:r,filterScopeMap:o}=this.state;if(n===i){const e=Wt({checkedFilterFields:r,activeFilterField:null,filterScopeMap:o,layout:t});this.setState({activeFilterField:null,filterScopeMap:{...o,...e}})}else if(this.allfilterFields.includes(n)){const e=Wt({checkedFilterFields:r,activeFilterField:n,filterScopeMap:o,layout:t});this.setState({activeFilterField:n,filterScopeMap:{...o,...e}})}}onSearchInputChange(e){this.setState({searchText:e.target.value},this.filterTree)}onClose(){this.props.onCloseModal()}onSave(){const{filterScopeMap:e}=this.state,t=this.allfilterFields.reduce(((t,n)=>{const{nodes:i}=e[n];return{...t,[n]:on({filterKey:n,nodes:i,checkedChartIds:e[n].checked})}}),{});this.props.updateDashboardFiltersScope(t),this.props.setUnsavedChanges(!0),this.props.onCloseModal()}filterTree(){if(this.state.searchText){const e=e=>{const{activeFilterField:t,checkedFilterFields:n,filterScopeMap:i}=e,r=Vt({activeFilterField:t,checkedFilterFields:n}),o=i[r].nodes.reduce(this.filterNodes,[]),a=Lt([...o]),s={...i[r],nodesFiltered:o,expanded:a};return{filterScopeMap:{...i,[r]:s}}};this.setState(e)}else this.setState((e=>{const{activeFilterField:t,checkedFilterFields:n,filterScopeMap:i}=e,r=Vt({activeFilterField:t,checkedFilterFields:n}),o={...i[r],nodesFiltered:i[r].nodes};return{filterScopeMap:{...i,[r]:o}}}))}filterNodes(e=[],t={}){const{searchText:n}=this.state,i=(t.children||[]).reduce(this.filterNodes,[]);return(t.label.toLocaleLowerCase().indexOf(n.toLocaleLowerCase())>-1||i.length)&&e.push({...t,children:i}),e}renderFilterFieldList(){const{activeFilterField:e,filterFieldNodes:t,checkedFilterFields:n,expandedFilterIds:i}=this.state;return(0,b.tZ)(Sn,{activeKey:e,nodes:t,checked:n,expanded:i,onClick:this.onChangeFilterField,onCheck:this.onCheckFilterField,onExpand:this.onExpandFilterField})}renderFilterScopeTree(){const{filterScopeMap:e,activeFilterField:t,checkedFilterFields:n,searchText:i}=this.state,r=Vt({activeFilterField:t,checkedFilterFields:n}),o=Bt({activeFilterField:t,checkedFilterFields:n});return(0,b.tZ)(a.Fragment,null,(0,b.tZ)("input",{className:"filter-text scope-search multi-edit-mode",placeholder:(0,d.t)("Search..."),type:"text",value:i,onChange:this.onSearchInputChange}),(0,b.tZ)(gn,{nodes:e[r].nodesFiltered,checked:e[r].checked,expanded:e[r].expanded,onCheck:this.onCheckFilterScope,onExpand:this.onExpandFilterScope,selectedChartId:o}))}renderEditingFiltersName(){const{dashboardFilters:e}=this.props,{activeFilterField:t,checkedFilterFields:n}=this.state,i=[].concat(t||n).map((t=>{const{chartId:n,column:i}=(0,Kt._)(t);return e[n].labels[i]||i}));return(0,b.tZ)("div",{className:"selected-fields multi-edit-mode"},0===i.length&&(0,d.t)("No filter is selected."),1===i.length&&(0,d.t)("Editing 1 filter:"),i.length>1&&(0,d.t)("Batch editing %d filters:",i.length),(0,b.tZ)("span",{className:"selected-scopes"},i.join(", ")))}render(){const{showSelector:e}=this.state;return(0,b.tZ)("div",{className:"filter-scope-container"},(0,b.tZ)("div",{className:"filter-scope-header"},(0,b.tZ)("h4",null,(0,d.t)("Configure filter scopes")),e&&this.renderEditingFiltersName()),(0,b.tZ)("div",{className:"filter-scope-body"},e?(0,b.tZ)("div",{className:"filters-scope-selector"},(0,b.tZ)("div",{className:g()("filter-field-pane multi-edit-mode")},this.renderFilterFieldList()),(0,b.tZ)("div",{className:"filter-scope-pane multi-edit-mode"},this.renderFilterScopeTree())):(0,b.tZ)("div",{className:"warning-message"},(0,d.t)("There are no filters in this dashboard."))),(0,b.tZ)(wn,null,(0,b.tZ)(it.Z,{buttonSize:"small",onClick:this.onClose},(0,d.t)("Close")),e&&(0,b.tZ)(it.Z,{buttonSize:"small",buttonStyle:"primary",onClick:this.onSave},(0,d.t)("Save"))))}}kn.propTypes=xn;const Rn=(0,o.$j)((function({dashboardLayout:e,dashboardFilters:t}){return{dashboardFilters:t,layout:e.present}}),(function(e){return(0,r.DE)({updateDashboardFiltersScope:Nt.l6,setUnsavedChanges:jt.if},e)}))(kn),Zn=v.iK.div((({theme:{gridUnit:e}})=>({padding:2*e,paddingBottom:3*e})));class Fn extends a.PureComponent{constructor(e){super(e),this.modal=void 0,this.modal=a.createRef(),this.handleCloseModal=this.handleCloseModal.bind(this)}handleCloseModal(){this.modal.current&&this.modal.current.close()}render(){const e={onCloseModal:this.handleCloseModal};return(0,b.tZ)(gt.Z,{ref:this.modal,triggerNode:this.props.triggerNode,modalBody:(0,b.tZ)(Zn,null,(0,b.tZ)(Rn,e)),width:"80%"})}}var Tn=n(56727),Dn=n(94435),_n=n.n(Dn),In=n(11370);function Mn({pathname:e,filters:t={},hash:n="",standalone:i}){const r=new(_n());r.set(lt.KD.preselectFilters.name,JSON.stringify((0,In.Z)(t))),i&&r.set(lt.KD.standalone.name,i.toString());const o=(0,pt.e)(lt.KD.nativeFiltersKey);o&&r.set(lt.KD.nativeFiltersKey.name,o);const a=n?`#${n}`:"";return`${e}?${r.toString()}${a}`}const En={addSuccessToast:l().func.isRequired,addDangerToast:l().func.isRequired,dashboardInfo:l().object.isRequired,dashboardId:l().number.isRequired,dashboardTitle:l().string.isRequired,dataMask:l().object.isRequired,customCss:l().string.isRequired,colorNamespace:l().string,colorScheme:l().string,onChange:l().func.isRequired,updateCss:l().func.isRequired,forceRefreshAllCharts:l().func.isRequired,refreshFrequency:l().number.isRequired,shouldPersistRefreshFrequency:l().bool.isRequired,setRefreshFrequency:l().func.isRequired,startPeriodicRender:l().func.isRequired,editMode:l().bool.isRequired,userCanEdit:l().bool.isRequired,userCanShare:l().bool.isRequired,userCanSave:l().bool.isRequired,isLoading:l().bool.isRequired,layout:l().object.isRequired,expandedSlices:l().object.isRequired,onSave:l().func.isRequired,showPropertiesModal:l().func.isRequired,refreshLimit:l().number,refreshWarning:l().string,lastModifiedTime:l().number.isRequired,filterboxMigrationState:Fe.Qi},On={colorNamespace:void 0,colorScheme:void 0,refreshLimit:0,refreshWarning:null,filterboxMigrationState:Fe.Qi.NOOP},Pn="refresh-dashboard",Nn="edit-properties",jn="download-as-image",qn="toggle-fullscreen",zn=v.iK.div`
  margin-left: ${({theme:e})=>2.5*e.gridUnit}px;
  span {
    color: ${({theme:e})=>e.colors.grayscale.base};
  }
`;class An extends a.PureComponent{static discardChanges(){window.location.reload()}constructor(e){super(e),this.state={css:e.customCss,cssTemplates:[]},this.changeCss=this.changeCss.bind(this),this.changeRefreshInterval=this.changeRefreshInterval.bind(this),this.handleMenuClick=this.handleMenuClick.bind(this)}UNSAFE_componentWillMount(){(0,Pt.Z)(this.state.css),st.Z.get({endpoint:"/csstemplateasyncmodelview/api/read"}).then((({json:e})=>{const t=e.result.map((e=>({value:e.template_name,css:e.css,label:e.template_name})));this.setState({cssTemplates:t})})).catch((()=>{this.props.addDangerToast((0,d.t)("An error occurred while fetching available CSS templates"))}))}changeCss(e){this.setState({css:e},(()=>{(0,Pt.Z)(e)})),this.props.onChange(),this.props.updateCss(e)}changeRefreshInterval(e,t){this.props.setRefreshFrequency(e,t),this.props.startPeriodicRender(1e3*e)}handleMenuClick({key:e,domEvent:t}){switch(e){case Pn:this.props.forceRefreshAllCharts(),this.props.addSuccessToast((0,d.t)("Data refreshed"));break;case Nn:this.props.showPropertiesModal();break;case jn:{const e=document.querySelector(".ant-dropdown:not(.ant-dropdown-hidden)");e.style.visibility="hidden",(0,Tn.Z)(".dashboard",this.props.dashboardTitle,{},!0)(t).then((()=>{e.style.visibility="visible"}));break}case qn:{const e=Mn({pathname:window.location.pathname,filters:(0,an.De)(),hash:window.location.hash,standalone:!(0,pt.e)(lt.KD.standalone)});window.location.replace(e);break}}}render(){const{dashboardTitle:e,dashboardId:t,dashboardInfo:n,refreshFrequency:i,shouldPersistRefreshFrequency:r,editMode:o,customCss:a,colorNamespace:s,colorScheme:l,layout:c,expandedSlices:u,onSave:h,userCanEdit:p,userCanShare:f,userCanSave:m,isLoading:g,refreshLimit:v,refreshWarning:y,lastModifiedTime:C,addSuccessToast:S,addDangerToast:x,filterboxMigrationState:w}=this.props,k=`${(0,d.t)("Superset dashboard")} ${e}`,R=(0,d.t)("Check out this dashboard: "),Z=Mn({pathname:window.location.pathname,filters:(0,an.De)(),hash:window.location.hash}),F=(0,b.tZ)(Re.v2,{onClick:this.handleMenuClick,selectable:!1},m&&(0,b.tZ)(Re.v2.Item,{key:"save-modal"},(0,b.tZ)(Ot,{addSuccessToast:this.props.addSuccessToast,addDangerToast:this.props.addDangerToast,dashboardId:t,dashboardTitle:e,dashboardInfo:n,saveType:_.kS,layout:c,expandedSlices:u,refreshFrequency:i,shouldPersistRefreshFrequency:r,lastModifiedTime:C,customCss:a,colorNamespace:s,colorScheme:l,onSave:h,triggerNode:(0,b.tZ)("span",null,(0,d.t)("Save as")),canOverwrite:p})),f&&(0,b.tZ)(mt,{url:Z,copyMenuItemTitle:(0,d.t)("Copy dashboard URL"),emailMenuItemTitle:(0,d.t)("Share dashboard by email"),emailSubject:k,emailBody:R,addSuccessToast:S,addDangerToast:x,dashboardId:t}),(0,b.tZ)(Re.v2.Item,{key:Pn,disabled:g},(0,d.t)("Refresh dashboard")),(0,b.tZ)(Re.v2.Divider,null),(0,b.tZ)(Re.v2.Item,{key:"autorefresh-modal"},(0,b.tZ)(Dt,{addSuccessToast:this.props.addSuccessToast,refreshFrequency:i,refreshLimit:v,refreshWarning:y,onChange:this.changeRefreshInterval,editMode:o,triggerNode:(0,b.tZ)("span",null,(0,d.t)("Set auto-refresh interval"))})),o&&w!==Fe.Qi.CONVERTED&&(0,b.tZ)(Re.v2.Item,{key:"set-filter-mapping"},(0,b.tZ)(Fn,{className:"m-r-5",triggerNode:(0,d.t)("Set filter mapping")})),o&&(0,b.tZ)(Re.v2.Item,{key:Nn},(0,d.t)("Edit dashboard properties")),o&&(0,b.tZ)(Re.v2.Item,{key:"edit-css"},(0,b.tZ)(St,{triggerNode:(0,b.tZ)("span",null,(0,d.t)("Edit CSS")),initialCss:this.state.css,templates:this.state.cssTemplates,onChange:this.changeCss})),!o&&(0,b.tZ)(Re.v2.Item,{key:jn},(0,d.t)("Download as image")),!o&&(0,b.tZ)(Re.v2.Item,{key:qn},(0,pt.e)(lt.KD.standalone)?(0,d.t)("Exit fullscreen"):(0,d.t)("Enter fullscreen")));return(0,b.tZ)(Re.$i,{overlay:F,trigger:["click"],getPopupContainer:e=>e.closest(".dashboard-header")},(0,b.tZ)(zn,{id:"save-dash-split-button",role:"button"},(0,b.tZ)(nt.Z.MoreHoriz,null)))}}An.propTypes=En,An.defaultProps=On;const $n=An;var Un=n(48600),Ln=n(58593),Vn=n(37921);const Kn={dashboardId:l().number.isRequired,isPublished:l().bool.isRequired,savePublished:l().func.isRequired,canEdit:l().bool.isRequired,canSave:l().bool.isRequired},Bn=(0,d.t)("This dashboard is not published, it will not show up in the list of dashboards. Click here to publish this dashboard."),Wn=(0,d.t)("This dashboard is not published which means it will not show up in the list of dashboards. Favorite it to see it there or access it by using the URL directly."),Hn=(0,d.t)("This dashboard is published. Click to make it a draft.");class Gn extends a.Component{componentDidMount(){this.togglePublished=this.togglePublished.bind(this)}togglePublished(){this.props.savePublished(this.props.dashboardId,!this.props.isPublished)}render(){return this.props.isPublished?this.props.canEdit&&this.props.canSave?(0,b.tZ)(Ln.u,{id:"published-dashboard-tooltip",placement:"bottom",title:Hn},(0,b.tZ)(Vn.Z,{onClick:()=>{this.togglePublished()}},(0,d.t)("Published"))):null:this.props.canEdit&&this.props.canSave?(0,b.tZ)(Ln.u,{id:"unpublished-dashboard-tooltip",placement:"bottom",title:Bn},(0,b.tZ)(Vn.Z,{onClick:()=>{this.togglePublished()}},(0,d.t)("Draft"))):(0,b.tZ)(Ln.u,{id:"unpublished-dashboard-tooltip",placement:"bottom",title:Wn},(0,b.tZ)(Vn.Z,null,(0,d.t)("Draft")))}}Gn.propTypes=Kn;const Jn={onUndo:l().func.isRequired,onRedo:l().func.isRequired};class Qn extends a.PureComponent{constructor(e){super(e),this.handleKeydown=this.handleKeydown.bind(this)}componentDidMount(){document.addEventListener("keydown",this.handleKeydown)}componentWillUnmount(){document.removeEventListener("keydown",this.handleKeydown)}handleKeydown(e){if(e.ctrlKey||e.metaKey){const t="z"===e.key||90===e.keyCode,n="y"===e.key||89===e.keyCode,i=document&&document.querySelector(".dashboard-markdown--editing"),r=document&&document.querySelector(".editable-title--editing");i||r||!t&&!n||(e.preventDefault(),(t?this.props.onUndo:this.props.onRedo)())}}render(){return null}}Qn.propTypes=Jn;const Yn=Qn;var Xn=n(20818),ei=n(97860);const ti=e=>{e&&clearInterval(e)},ni={addSuccessToast:l().func.isRequired,addDangerToast:l().func.isRequired,addWarningToast:l().func.isRequired,user:i.UserWithPermissionsAndRoles,dashboardInfo:l().object.isRequired,dashboardTitle:l().string.isRequired,dataMask:l().object.isRequired,charts:l().objectOf(M.$6).isRequired,layout:l().object.isRequired,expandedSlices:l().object.isRequired,customCss:l().string.isRequired,colorNamespace:l().string,colorScheme:l().string,setColorSchemeAndUnsavedChanges:l().func.isRequired,isStarred:l().bool.isRequired,isPublished:l().bool.isRequired,isLoading:l().bool.isRequired,onSave:l().func.isRequired,onChange:l().func.isRequired,fetchFaveStar:l().func.isRequired,fetchCharts:l().func.isRequired,fetchUISpecificReport:l().func.isRequired,saveFaveStar:l().func.isRequired,savePublished:l().func.isRequired,updateDashboardTitle:l().func.isRequired,editMode:l().bool.isRequired,setEditMode:l().func.isRequired,showBuilderPane:l().func.isRequired,updateCss:l().func.isRequired,logEvent:l().func.isRequired,hasUnsavedChanges:l().bool.isRequired,maxUndoHistoryExceeded:l().bool.isRequired,lastModifiedTime:l().number.isRequired,onRefresh:l().func.isRequired,onUndo:l().func.isRequired,onRedo:l().func.isRequired,undoLength:l().number.isRequired,redoLength:l().number.isRequired,setMaxUndoHistoryExceeded:l().func.isRequired,maxUndoHistoryToast:l().func.isRequired,refreshFrequency:l().number.isRequired,shouldPersistRefreshFrequency:l().bool.isRequired,setRefreshFrequency:l().func.isRequired,dashboardInfoChanged:l().func.isRequired,dashboardTitleChanged:l().func.isRequired},ii=v.iK.div`
  background: ${({theme:e})=>e.colors.grayscale.light5};
  display: flex;
  flex-direction: row;
  align-items: center;
  justify-content: space-between;
  padding: 0 ${({theme:e})=>6*e.gridUnit}px;
  border-bottom: 1px solid ${({theme:e})=>e.colors.grayscale.light2};

  .action-button > span {
    color: ${({theme:e})=>e.colors.grayscale.base};
  }
  button,
  .fave-unfave-icon {
    margin-left: ${({theme:e})=>2*e.gridUnit}px;
  }
  .button-container {
    display: flex;
    flex-direction: row;
    flex-wrap: nowrap;
    .action-button {
      font-size: ${({theme:e})=>e.typography.sizes.xl}px;
      margin-left: ${({theme:e})=>2.5*e.gridUnit}px;
    }
  }
`;class ri extends a.PureComponent{static discardChanges(){const e=new(Je())(window.location.href);e.searchParams.delete("edit"),window.location.assign(e)}constructor(e){super(e),this.state={didNotifyMaxUndoHistoryToast:!1,emphasizeUndo:!1,showingPropertiesModal:!1,showingReportModal:!1},this.handleChangeText=this.handleChangeText.bind(this),this.handleCtrlZ=this.handleCtrlZ.bind(this),this.handleCtrlY=this.handleCtrlY.bind(this),this.toggleEditMode=this.toggleEditMode.bind(this),this.forceRefresh=this.forceRefresh.bind(this),this.startPeriodicRender=this.startPeriodicRender.bind(this),this.overwriteDashboard=this.overwriteDashboard.bind(this),this.showPropertiesModal=this.showPropertiesModal.bind(this),this.hidePropertiesModal=this.hidePropertiesModal.bind(this),this.showReportModal=this.showReportModal.bind(this),this.hideReportModal=this.hideReportModal.bind(this),this.renderReportModal=this.renderReportModal.bind(this)}componentDidMount(){const{refreshFrequency:e,user:t,dashboardInfo:n}=this.props;this.startPeriodicRender(1e3*e),this.canAddReports()&&Object.entries(n).length&&this.props.fetchUISpecificReport(t.userId,"dashboard_id","dashboards",n.id,t.email)}componentDidUpdate(e){if(this.props.refreshFrequency!==e.refreshFrequency){const{refreshFrequency:e}=this.props;this.startPeriodicRender(1e3*e)}}UNSAFE_componentWillReceiveProps(e){const{user:t}=this.props;var n;_.Q9-e.undoLength<=0&&!this.state.didNotifyMaxUndoHistoryToast&&(this.setState((()=>({didNotifyMaxUndoHistoryToast:!0}))),this.props.maxUndoHistoryToast()),e.undoLength>_.Q9&&!this.props.maxUndoHistoryExceeded&&this.props.setMaxUndoHistoryExceeded(),this.canAddReports()&&e.dashboardInfo.id!==this.props.dashboardInfo.id&&this.props.fetchUISpecificReport(null==t?void 0:t.userId,"dashboard_id","dashboards",null==e||null==(n=e.dashboardInfo)?void 0:n.id,null==t?void 0:t.email)}componentWillUnmount(){ti(this.refreshTimer),this.props.setRefreshFrequency(0),clearTimeout(this.ctrlYTimeout),clearTimeout(this.ctrlZTimeout)}handleChangeText(e){const{updateDashboardTitle:t,onChange:n}=this.props;e&&this.props.dashboardTitle!==e&&(t(e),n())}handleCtrlY(){this.props.onRedo(),this.setState({emphasizeRedo:!0},(()=>{this.ctrlYTimeout&&clearTimeout(this.ctrlYTimeout),this.ctrlYTimeout=setTimeout((()=>{this.setState({emphasizeRedo:!1})}),100)}))}handleCtrlZ(){this.props.onUndo(),this.setState({emphasizeUndo:!0},(()=>{this.ctrlZTimeout&&clearTimeout(this.ctrlZTimeout),this.ctrlZTimeout=setTimeout((()=>{this.setState({emphasizeUndo:!1})}),100)}))}forceRefresh(){if(!this.props.isLoading){const e=Object.keys(this.props.charts);return this.props.logEvent(et.H3,{force:!0,interval:0,chartCount:e.length}),this.props.onRefresh(e,!0,0,this.props.dashboardInfo.id)}return!1}startPeriodicRender(e){let t;if(e){const n=Rt.find((t=>t.value===e/1e3));t=n?n.label:Ye().duration(e,"millisecond").humanize()}this.refreshTimer=function({interval:e=0,periodicRender:t,refreshTimer:n}){return ti(n),e>0?setInterval(t,e):0}({interval:e,periodicRender:()=>{const{fetchCharts:n,logEvent:i,charts:r,dashboardInfo:o}=this.props,{metadata:a}=o,s=a.timed_refresh_immune_slices||[],l=Object.values(r).filter((e=>-1===s.indexOf(e.id))).map((e=>e.id));return i(et.S,{interval:e,chartCount:l.length}),this.props.addWarningToast((0,d.t)("This dashboard is currently auto refreshing; the next auto refresh will be in %s.",t)),"fetch"===o.common.conf.DASHBOARD_AUTO_REFRESH_MODE?n(l,!1,.2*e,o.id):n(l,!0,.2*e,o.id)},refreshTimer:this.refreshTimer})}toggleEditMode(){this.props.logEvent(et.vH,{edit_mode:!this.props.editMode}),this.props.setEditMode(!this.props.editMode)}overwriteDashboard(){var e,t,n;const{dashboardTitle:i,layout:r,colorScheme:o,colorNamespace:a,customCss:s,dashboardInfo:l,refreshFrequency:c,shouldPersistRefreshFrequency:u,lastModifiedTime:h,slug:p}=this.props,f=u?c:null==(e=l.metadata)?void 0:e.refresh_frequency,m={certified_by:l.certified_by,certification_details:l.certification_details,css:s,dashboard_title:i,last_modified_time:h,owners:l.owners,roles:l.roles,slug:p,metadata:{...null==l?void 0:l.metadata,color_namespace:(null==l||null==(t=l.metadata)?void 0:t.color_namespace)||a,color_scheme:(null==l||null==(n=l.metadata)?void 0:n.color_scheme)||o,positions:r,refresh_frequency:f}},g=(0,at.o)(r).length,v=l.common.conf.SUPERSET_DASHBOARD_POSITION_DATA_LIMIT||_.Bu;g>=v?this.props.addDangerToast((0,d.t)("Your dashboard is too large. Please reduce its size before saving it.")):(g>=.9*v&&this.props.addWarningToast("Your dashboard is near the size limit."),this.props.onSave(m,l.id,_.TN))}showPropertiesModal(){this.setState({showingPropertiesModal:!0})}hidePropertiesModal(){this.setState({showingPropertiesModal:!1})}showReportModal(){this.setState({showingReportModal:!0})}hideReportModal(){this.setState({showingReportModal:!1})}renderReportModal(){return Object.keys(this.props.reports).length?(0,b.tZ)(Un.Z,{showReportModal:this.showReportModal,toggleActive:this.props.toggleActive,deleteActiveReport:this.props.deleteActiveReport}):(0,b.tZ)(a.Fragment,null,(0,b.tZ)("span",{role:"button",title:(0,d.t)("Schedule email report"),tabIndex:0,className:"action-button",onClick:this.showReportModal},(0,b.tZ)(nt.Z.Calendar,null)))}canAddReports(){if(!(0,tt.cr)(c.T.ALERT_REPORTS))return!1;const{user:e}=this.props;return!(null==e||!e.userId)&&Object.keys(e.roles||[]).map((t=>e.roles[t].filter((e=>"menu_access"===e[0]&&"Manage"===e[1]))))[0].length>0}render(){var e,t,n,i;const{dashboardTitle:r,layout:o,expandedSlices:s,customCss:l,colorNamespace:c,dataMask:u,setColorSchemeAndUnsavedChanges:h,colorScheme:p,onUndo:f,onRedo:m,undoLength:g,redoLength:v,onChange:y,onSave:C,updateCss:S,editMode:x,isPublished:w,user:k,dashboardInfo:R,hasUnsavedChanges:Z,isLoading:F,refreshFrequency:T,shouldPersistRefreshFrequency:D,setRefreshFrequency:_,lastModifiedTime:I,filterboxMigrationState:M}=this.props,E=R.dash_edit_perm&&M!==Fe.Qi.REVIEWING,O=R.dash_share_perm,P=R.dash_save_perm&&M!==Fe.Qi.REVIEWING,N=!x&&this.canAddReports(),j=null==(e=R.common)||null==(t=e.conf)?void 0:t.SUPERSET_DASHBOARD_PERIODICAL_REFRESH_LIMIT,q=null==(n=R.common)||null==(i=n.conf)?void 0:i.SUPERSET_DASHBOARD_PERIODICAL_REFRESH_WARNING_MESSAGE;return(0,b.tZ)(ii,{className:"dashboard-header","data-test-id":`${R.id}`},(0,b.tZ)("div",{className:"dashboard-component-header header-large"},(0,b.tZ)(rt.Z,{title:r,canEdit:E&&x,onSaveTitle:this.handleChangeText,showTooltip:!1,certifiedBy:R.certified_by,certificationDetails:R.certification_details}),(0,b.tZ)(Gn,{dashboardId:R.id,isPublished:w,savePublished:this.props.savePublished,canEdit:E,canSave:P}),(null==k?void 0:k.userId)&&(null==R?void 0:R.id)&&(0,b.tZ)(ot.Z,{itemId:R.id,fetchFaveStar:this.props.fetchFaveStar,saveFaveStar:this.props.saveFaveStar,isStarred:this.props.isStarred,showTooltip:!0})),(0,b.tZ)("div",{className:"button-container"},P&&(0,b.tZ)("div",{className:"button-container"},x&&(0,b.tZ)(a.Fragment,null,(0,b.tZ)(Xe.Z,{className:"m-r-5"},(0,b.tZ)(it.Z,{buttonSize:"small",onClick:f,disabled:g<1,buttonStyle:this.state.emphasizeUndo?"primary":void 0,showMarginRight:!1},(0,b.tZ)("i",{title:"Undo",className:"undo-action fa fa-reply"})," "),(0,b.tZ)(it.Z,{buttonSize:"small",onClick:m,disabled:v<1,buttonStyle:this.state.emphasizeRedo?"primary":void 0,showMarginRight:!1}," ",(0,b.tZ)("i",{title:"Redo",className:"redo-action fa fa-share"}))),(0,b.tZ)(it.Z,{buttonSize:"small",className:"m-r-5",onClick:this.constructor.discardChanges,buttonStyle:"default"},(0,d.t)("Discard changes")),(0,b.tZ)(it.Z,{buttonSize:"small",disabled:!Z,buttonStyle:"primary",onClick:this.overwriteDashboard},(0,d.t)("Save")))),x&&(0,b.tZ)(Yn,{onUndo:this.handleCtrlZ,onRedo:this.handleCtrlY}),!x&&E&&(0,b.tZ)(a.Fragment,null,(0,b.tZ)("span",{role:"button",title:(0,d.t)("Edit dashboard"),tabIndex:0,className:"action-button",onClick:this.toggleEditMode},(0,b.tZ)(nt.Z.EditAlt,null))),N&&this.renderReportModal(),(0,b.tZ)(Xn.Z,{dashboardId:R.id,dashboardInfo:R,dashboardTitle:r,show:this.state.showingPropertiesModal,onHide:this.hidePropertiesModal,colorScheme:this.props.colorScheme,onSubmit:e=>{const{dashboardInfoChanged:t,dashboardTitleChanged:n}=this.props;t({slug:e.slug,metadata:JSON.parse(e.jsonMetadata||"{}"),certified_by:e.certifiedBy,certification_details:e.certificationDetails,owners:e.owners,roles:e.roles}),h(e.colorScheme),n(e.title)},onlyApply:!0}),this.state.showingReportModal&&(0,b.tZ)(ei.Z,{show:this.state.showingReportModal,onHide:this.hideReportModal,props:{userId:k.userId,userEmail:k.email,dashboardId:R.id,creationMethod:"dashboards"}}),(0,b.tZ)($n,{addSuccessToast:this.props.addSuccessToast,addDangerToast:this.props.addDangerToast,dashboardId:R.id,dashboardTitle:r,dashboardInfo:R,dataMask:u,layout:o,expandedSlices:s,customCss:l,colorNamespace:c,colorScheme:p,onSave:C,onChange:y,forceRefreshAllCharts:this.forceRefresh,startPeriodicRender:this.startPeriodicRender,refreshFrequency:T,shouldPersistRefreshFrequency:D,setRefreshFrequency:_,updateCss:S,editMode:x,hasUnsavedChanges:Z,userCanEdit:E,userCanShare:O,userCanSave:P,isLoading:F,showPropertiesModal:this.showPropertiesModal,refreshLimit:j,refreshWarning:q,lastModifiedTime:I,filterboxMigrationState:M})))}}ri.propTypes=ni,ri.defaultProps={colorNamespace:void 0,colorScheme:void 0};const oi=ri;function ai(e){return Object.values(e).some((e=>e.chartUpdateStartTime>(e.chartUpdateEndTime||0)))}var si=n(41295),li=n(40701),di=n(72570),ci=n(97381),ui=n(61358);const hi=(0,o.$j)((function({dashboardLayout:e,dashboardState:t,reports:n,dashboardInfo:i,charts:r,dataMask:o,user:a}){return{dashboardInfo:i,undoLength:e.past.length,redoLength:e.future.length,layout:e.present,dashboardTitle:((e.present[_.M2]||{}).meta||{}).text,expandedSlices:t.expandedSlices,refreshFrequency:t.refreshFrequency,shouldPersistRefreshFrequency:!!t.shouldPersistRefreshFrequency,customCss:t.css,colorNamespace:t.colorNamespace,colorScheme:t.colorScheme,charts:r,dataMask:o,user:a,isStarred:!!t.isStarred,isPublished:!!t.isPublished,isLoading:ai(r),hasUnsavedChanges:!!t.hasUnsavedChanges,maxUndoHistoryExceeded:!!t.maxUndoHistoryExceeded,lastModifiedTime:Math.max(t.lastModifiedTime,i.last_modified_time),editMode:!!t.editMode,slug:i.slug,metadata:i.metadata,reports:n,filterboxMigrationState:t.filterboxMigrationState}}),(function(e){return(0,r.DE)({addSuccessToast:di.ws,addDangerToast:di.Gb,addWarningToast:di.Dz,onUndo:li.Ou,onRedo:li.az,setEditMode:jt.Mb,showBuilderPane:jt.O8,setColorSchemeAndUnsavedChanges:jt.ps,fetchFaveStar:jt.Lb,saveFaveStar:jt.TN,savePublished:jt.dr,fetchCharts:jt.Mn,updateDashboardTitle:li.A7,updateCss:jt.Sn,onChange:jt.z2,onSave:jt.M8,setMaxUndoHistoryExceeded:jt.uN,maxUndoHistoryToast:jt.Qt,logEvent:ci.logEvent,setRefreshFrequency:jt.sL,onRefresh:jt.Yy,dashboardInfoChanged:si.a8,dashboardTitleChanged:li.Ww,updateDataMask:He.eG,fetchUISpecificReport:ui.Aw,toggleActive:ui.M,deleteActiveReport:ui.MZ},e)}))(oi),pi=v.iK.div`
  display: flex;
  align-items: center;
  color: ${({theme:e})=>e.colors.grayscale.base};
  &:hover {
    color: ${({theme:e})=>e.colors.primary.base};
  }
`,fi=v.iK.span`
  margin-left: ${({theme:e})=>2*e.gridUnit}px;
`,mi=({icon:e,label:t,onClick:n})=>(0,b.tZ)(pi,{tabIndex:0,role:"button",onClick:e=>{e.preventDefault(),n(e)}},e,t&&(0,b.tZ)(fi,null,t));var gi=n(22428),vi=n(1510),bi=n(99543);function yi(e){return Object.entries(e).map((([e,t])=>({col:e,op:Array.isArray(t)?"IN":"==",val:t}))).filter((e=>null!==e.val))}const Ci=({child:e,layout:t,scope:n,activeFilters:i,filterId:r,extraFormData:o})=>{var a,s;const l=null==(a=t[e])||null==(s=a.meta)?void 0:s.chartId;if(t[e].type===p.dW){if(n.excluded.includes(l))return;return i[r]||(i[r]={scope:[],values:o}),void i[r].scope.push(l)}t[e].children.forEach((e=>Ci({child:e,layout:t,scope:n,activeFilters:i,filterId:r,extraFormData:o})))},Si=(e,t)=>Object.values(e).filter((e=>e[t])).reduce(((e,n)=>({...e,[n.id]:t?n[t]:n})),{}),xi=({chartConfiguration:e,nativeFilters:t,dataMask:n,layout:i})=>{const r={};return Object.values(n).forEach((({id:n,extraFormData:o})=>{var a,s,l,d,c;const u=null!=(a=null!=(s=null==t||null==(l=t[n])?void 0:l.scope)?s:null==e||null==(d=e[n])||null==(c=d.crossFilters)?void 0:c.scope)?a:{rootPath:[_._4],excluded:[n]};u.rootPath.forEach((e=>{var t,a;null==(t=i[e])||null==(a=t.children)||a.forEach((e=>{Ci({child:e,layout:i,scope:u,activeFilters:r,filterId:n,extraFormData:o})}))}))})),r},wi={},ki={};var Ri,Zi=n(18446),Fi=n.n(Zi),Ti=n(12515),Di=n(5144),_i=n(29147),Ii=n(11064),Mi=n(16355),Ei=n(74069),Oi=n(65013);!function(e){e[e.all=0]="all",e[e.specific=1]="specific"}(Ri||(Ri={}));const Pi=({type:e,meta:t},n)=>{var i,r;return!(e!==p.gn&&e!==p.dW&&e!==p.U0||n&&"filter_box"===(null==(i=n[null==t?void 0:t.chartId])||null==(r=i.formData)?void 0:r.viz_type))},Ni=(e,t,n,i,r,o,a)=>{let s=t;if(Pi(e,i)&&e.type!==p.U0&&r.includes(e.id)){var l;const n=a(e.meta.sliceNameOverride||e.meta.sliceName||e.meta.text||e.meta.defaultText||e.id.toString(),o.includes(null==(l=e.meta)?void 0:l.chartId),(0,d.t)("This chart might be incompatible with the filter (datasets don't match)")),i={key:e.id,title:n,children:[]};t.children.push(i),s=i}e.children.forEach((e=>Ni(n[e],s,n,i,r,o,a)))},ji=(e,t,n,i)=>{n.forEach((n=>{var r,o;ji(e,t,((e,t)=>{var n;return[...(null==(n=e[t])?void 0:n.children)||[],...Object.values(e).filter((n=>n.parents&&n.parents[n.parents.length-1]===t&&!Pi(e[n.parents[n.parents.length-1]]))).map((({id:e})=>e))]})(t,n),i),(null==(r=t[n])?void 0:r.type)!==p.dW||i.includes(null==(o=t[n])?void 0:o.meta.chartId)||e.push(n)}))},qi=(e,t)=>{const n=[];return ji(n,t,[...e.rootPath],[...e.excluded]),[...new Set(n)]},zi=(e,t=[])=>({rootPath:[_._4],excluded:e?[e,...t]:t}),Ai=(e,t)=>!e||e.rootPath[0]===_._4&&!e.excluded.filter((e=>e!==t)).length,$i=(e,t,n)=>{let i=(0,b.tZ)("span",null,e);return t&&(i=(0,b.tZ)(a.Fragment,null,i," ",(0,b.tZ)(Ln.u,{title:n},(0,b.tZ)(nt.Z.Info,{iconSize:"m"})))),i},Ui=({formScope:e,initialScope:t,forceUpdate:n,updateFormValues:i,chartId:r,initiallyExcludedCharts:s=[]})=>{const[l,c]=(0,a.useState)([_._4]),{treeData:u,layout:h}=function(e,t=[],n=(e=>e)){const i=(0,o.v9)((({dashboardLayout:{present:e}})=>e)),r=(0,o.v9)((({charts:e})=>e)),s={children:[],key:_._4,type:p.U0,title:(0,d.t)("All panels")},l=(0,a.useMemo)((()=>Object.values(i).reduce(((t,n)=>{const{id:i,parents:r=[],type:o,meta:a}=n;return o===p.dW&&e!==(null==a?void 0:a.chartId)?[...new Set([...t,...r,i])]:t}),[])),[i,e]);return(0,a.useMemo)((()=>{Ni(i[_._4],s,i,r,l,t,n)}),[i,s,r,t,n]),{treeData:[s],layout:i}}(r,s,$i),[f,m]=(0,a.useState)(!0),g=(0,a.useMemo)((()=>qi({...e||t},h)),[e,t,h]);return(0,b.tZ)(Re.mp,{checkable:!0,selectable:!1,onExpand:e=>{c(e),m(!1)},expandedKeys:l,autoExpandParent:f,onCheck:e=>{n();const t=((e,t)=>{if(!e.length)return{rootPath:[],excluded:[]};const n=e.filter((e=>{var n;return(null==(n=t[e])?void 0:n.type)===p.dW})).map((e=>{var n;return[_._4,...(null==(n=t[e])?void 0:n.parents)||[]].filter((e=>Pi(t[e])))}));n.sort(((e,t)=>e.length-t.length));const i=n.map((e=>e[n[0].length-1])),r=[];return Object.entries(t).forEach((([t,n])=>{var o;const a=n.parents||[];n.type===p.dW&&null!=(o=[_._4,...a])&&o.find((n=>((t,n)=>i.includes(t)&&!e.includes(n))(n,t)))&&r.push(n.meta.chartId)})),{rootPath:[...new Set(i)],excluded:r}})(e,h);void 0!==r&&(t.excluded=[...new Set([...t.excluded,r])]),i({scope:t})},checkedKeys:g,treeData:u})},Li=v.iK.div`
  display: flex;
  flex-direction: column;
  & > * {
    margin-bottom: ${({theme:e})=>e.gridUnit}px;
  }
  padding: 0px ${({theme:e})=>4*e.gridUnit}px;
`,Vi=(0,v.iK)(Re.l0.Item)`
  margin-bottom: 0;
`,Ki=({pathToFormValue:e=[],formScopingType:t,formFilterScope:n,forceUpdate:i,filterScope:r,updateFormValues:o,chartId:s,initiallyExcludedCharts:l})=>{const[c]=(0,a.useState)(r||zi(s,l)),[u]=(0,a.useState)(Ai(c,s)?Ri.all:Ri.specific),[h,p]=(0,a.useState)(!!r),f=(0,a.useCallback)((e=>{o(e),p(!0)}),[o]),m=(0,a.useCallback)((()=>{if(r||h)return;const e=zi(s,l);o({scope:e,scoping:Ai(e,s)?Ri.all:Ri.specific})}),[s,r,h,l,o]);return(0,Oi.d)(m),(0,b.tZ)(Li,null,(0,b.tZ)(Vi,{name:[...e,"scoping"],initialValue:u},(0,b.tZ)(_t.Y.Group,{onChange:({target:{value:e}})=>{if(e===Ri.all){const e=zi(s);o({scope:e})}p(!0),i()}},(0,b.tZ)(_t.Y,{value:Ri.all},(0,d.t)("Apply to all panels")),(0,b.tZ)(_t.Y,{value:Ri.specific},(0,d.t)("Apply to specific panels")))),(0,b.tZ)(Re.ZT.Text,{type:"secondary"},(null!=t?t:u)===Ri.specific?(0,d.t)("Only selected panels will be affected by this filter"):(0,d.t)("All panels with this column will be affected by this filter")),(null!=t?t:u)===Ri.specific&&(0,b.tZ)(Ui,{updateFormValues:f,initialScope:c,formScope:n,forceUpdate:i,chartId:s,initiallyExcludedCharts:l}),(0,b.tZ)(Vi,{name:[...e,"scope"],hidden:!0,initialValue:c}))};var Bi=n(10752),Wi=n.n(Bi),Hi=n(88889),Gi=n(55786);const Ji="filters",Qi={filter_time:[Hi.Z.TEMPORAL],filter_timegrain:[Hi.Z.TEMPORAL],filter_timecolumn:[Hi.Z.TEMPORAL],filter_select:[Hi.Z.BOOLEAN,Hi.Z.STRING,Hi.Z.NUMERIC,Hi.Z.TEMPORAL],filter_range:[Hi.Z.NUMERIC]},Yi=()=>{const[,e]=a.useState({});return a.useCallback((()=>e({})),[])},Xi=(e,t,n)=>{const i=e.getFieldValue(Ji)||{};e.setFields([{name:Ji,value:{...i,[t]:{...i[t],...n}}}])},er=e=>({value:e.id,label:e.table_name}),tr=e=>{const t=(0,Gi.Z)(null==e?void 0:e.column_types);return 0===t.length||t.includes(Hi.Z.TEMPORAL)},nr=(e,t)=>{var n;return!t.type_generic||!(e in Qi)||(null==(n=Qi[e])?void 0:n.includes(t.type_generic))},ir=({form:e,scope:t,chartId:n})=>{const i=Yi(),r=e.getFieldValue("scope"),o=e.getFieldValue("scoping");return(0,b.tZ)(Ki,{updateFormValues:t=>{((e,t)=>{e.setFieldsValue({...t})})(e,{...t})},filterScope:t,chartId:n,formFilterScope:r,forceUpdate:i,formScopingType:o})};var rr=n(89734),or=n.n(rr),ar=n(44908),sr=n.n(ar),lr=n(68122),dr=n(53350),cr=n(53931);const ur=[];function hr(){return(0,o.v9)((e=>{var t,n;return(null==(t=e.dashboardInfo)||null==(n=t.metadata)?void 0:n.native_filter_configuration)||ur}))}function pr(){return(0,o.v9)((e=>{var t;return null==(t=e.dashboardLayout)?void 0:t.present}))}function fr(){const e=pr();return(0,a.useMemo)((()=>Object.values(e).some((e=>e.type===p.gn))),[e])}var mr=n(27034),gr=n(22068);const vr="FILTER",br=v.iK.div`
  ${({isDragging:e,theme:t})=>`\n    opacity: ${e?.3:1};\n    cursor: ${e?"grabbing":"pointer"};\n    width: 100%;\n    display: flex;\n    padding:  ${t.gridUnit}px\n  `}
`,yr=(0,v.iK)(nt.Z.Drag,{shouldForwardProp:e=>"isDragging"!==e})`
  ${({isDragging:e,theme:t})=>`\n    font-size: ${t.typography.sizes.m}px;\n    margin-top: 15px;\n    cursor: ${e?"grabbing":"grab"};\n    padding-left: ${t.gridUnit}px;\n  `}
`;var Cr={name:"aco78w",styles:"flex-grow:4"};const Sr=({index:e,onRearrage:t,filterIds:n,children:i})=>{const r=(0,a.useRef)(null),[{isDragging:o},s]=(0,mr.c)({item:{filterIds:n,type:vr,index:e},collect:e=>({isDragging:e.isDragging()})}),[,l]=(0,gr.L)({accept:vr,hover:(n,i)=>{var o;if(!r.current)return;const a=n.index,s=e;if(a===s)return;const l=null==(o=r.current)?void 0:o.getBoundingClientRect(),d=(l.bottom-l.top)/2,c=i.getClientOffset().y-l.top;a<s&&c<d||a>s&&c>d||(t(a,s),n.index=s)}});return s(l(r)),(0,b.tZ)(br,{ref:r,isDragging:o},(0,b.tZ)(yr,{isDragging:o,alt:"Move icon",className:"dragIcon"}),(0,b.tZ)("div",{css:Cr},i))},xr=v.iK.div`
  ${({theme:e})=>`\n      display: flex;\n      padding: ${2*e.gridUnit}px;\n      width: 100%;\n      border-radius: ${e.borderRadius}px;\n      &.active {\n        color: ${e.colors.grayscale.dark1};\n        border-radius: ${e.borderRadius}px;\n        background-color: ${e.colors.secondary.light4};\n        span, .anticon {\n          color: ${e.colors.grayscale.dark1};\n        }\n      }\n      &:hover {\n        color: ${e.colors.primary.light1};\n        span, .anticon {\n          color: ${e.colors.primary.light1};\n        }\n      }\n      &.errored div, &.errored .warning {\n        color: ${e.colors.error.base};\n      }\n  `}
`,wr=(0,v.iK)(nt.Z.Trash)`
  color: ${({theme:e})=>e.colors.grayscale.light3};
`,kr=(0,v.iK)(nt.Z.Warning)`
  color: ${({theme:e})=>e.colors.error.base};
  &.anticon {
    margin-left: auto;
  }
`,Rr=v.iK.div`
  height: 100%;
  overflow-y: auto;
`;var Zr={name:"7whenc",styles:"display:flex;width:100%"},Fr={name:"1vr7vmn",styles:"align-items:center;display:flex"},Tr={name:"1je5tt7",styles:"align-self:flex-end;margin-left:auto"},Dr={name:"1je5tt7",styles:"align-self:flex-end;margin-left:auto"};const _r=({getFilterTitle:e,onChange:t,onRemove:n,restoreFilter:i,onRearrage:r,currentFilterId:o,removedFilters:a,filterGroups:s,erroredFilters:l=[]})=>(0,b.tZ)(Rr,null,(()=>{const c=[];return s.forEach(((s,u)=>{c.push((0,b.tZ)(Sr,{key:u,onRearrage:r,index:u,filterIds:s},s.map((r=>(r=>{const s=!!a[r],c=l.includes(r),u=o===r,h=[];return c&&h.push("errored"),u&&h.push("active"),(0,b.tZ)(xr,{role:"tab",key:`filter-title-tab-${r}`,onClick:()=>t(r),className:h.join(" ")},(0,b.tZ)("div",{css:Zr},(0,b.tZ)("div",{css:Fr},s?(0,d.t)("(Removed)"):e(r)),!a[r]&&c&&(0,b.tZ)(kr,{className:"warning"}),s&&(0,b.tZ)("span",{css:Tr,role:"button",tabIndex:0,onClick:e=>{e.preventDefault(),i(r)}},(0,d.t)("Undo?"))),(0,b.tZ)("div",{css:Dr},s?null:(0,b.tZ)(wr,{onClick:e=>{e.stopPropagation(),n(r)},alt:"RemoveFilter"})))})(r)))))})),c})()),Ir=v.iK.div`
  color: ${({theme:e})=>e.colors.primary.dark1};
`,Mr=v.iK.div`
  ${({theme:e})=>`\n    color: ${e.colors.grayscale.dark1};\n    font-size: ${e.typography.sizes.l}px;\n    padding-top: ${4*e.gridUnit}px;\n    padding-right: ${4*e.gridUnit}px;\n    padding-left: ${4*e.gridUnit}px;\n    padding-bottom: ${2*e.gridUnit}px;\n  `}
`,Er=v.iK.div`
  ${({theme:e})=>`\n  cursor: pointer;\n  margin: ${4*e.gridUnit}px;\n  &:hover {\n    color: ${e.colors.primary.base};\n  }\n`}
`,Or=v.iK.div`
  height: 100%;
  display: flex;
  flex-direction: column;
`,Pr=({getFilterTitle:e,onChange:t,onAdd:n,onRemove:i,onRearrage:r,restoreFilter:o,currentFilterId:a,filterGroups:s,removedFilters:l,erroredFilters:c})=>{const u=(0,v.Fg)(),h=[{label:"Filter",type:cr.B.NATIVE_FILTER},{label:"Divider",type:cr.B.DIVIDER}],p=(0,b.tZ)(Re.$t,{mode:"horizontal"},h.map((e=>(0,b.tZ)(Re.$t.Item,{onClick:()=>{return t=e.type,n(t),void setTimeout((()=>{const e=document.getElementById("native-filters-tabs");if(e){const t=e.getElementsByClassName("ant-tabs-nav-list")[0];t.scrollTop=t.scrollHeight}}),0);var t}},e.label))));return(0,b.tZ)(Or,null,(0,b.tZ)(Mr,null,"Filters"),(0,b.tZ)("div",{css:(0,b.iv)({height:"100%",overflowY:"auto",marginLeft:3*u.gridUnit},"","")},(0,b.tZ)(_r,{filterGroups:s,currentFilterId:a,removedFilters:l,getFilterTitle:e,erroredFilters:c,onChange:t,onRemove:i,onRearrage:r,restoreFilter:o})),(0,b.tZ)(Re.Lt,{overlay:p,arrow:!0,placement:"topLeft",trigger:["hover"]},(0,b.tZ)(Er,null,(0,b.tZ)(Ir,{className:"fa fa-plus"})," ",(0,b.tZ)("span",null,(0,d.t)("Add")))))},Nr=v.iK.div`
  display: flex;
  height: 100%;
`,jr=v.iK.div`
  flex-grow: 3;
  margin-left: ${({theme:e})=>-1*e.gridUnit-1};
`,qr=v.iK.div`
  width: 270px;
  border-right: 1px solid ${({theme:e})=>e.colors.grayscale.light2};
`,zr=({getFilterTitle:e,onChange:t,onRemove:n,onRearrange:i,restoreFilter:r,onAdd:o,erroredFilters:a,children:s,currentFilterId:l,filterGroups:d,removedFilters:c})=>{const u=d.flat().filter((e=>e===l))[0];return(0,b.tZ)(Nr,null,(0,b.tZ)(qr,null,(0,b.tZ)(Pr,{currentFilterId:l,filterGroups:d,removedFilters:c,erroredFilters:a,getFilterTitle:e,onChange:t,onAdd:e=>o(e),onRearrage:i,onRemove:e=>n(e),restoreFilter:r})),(0,b.tZ)(jr,null,d.flat().map((e=>(0,b.tZ)("div",{key:e,style:{height:"100%",overflowY:"auto",display:e===u?"":"none"}},s(e))))))};var Ar=n(9882),$r=n(43700);const Ur=v.iK.div`
  display: flex;
  flex-direction: row;
  background-color: ${({level:e,theme:t})=>t.colors[e].light2};
  border-radius: ${({theme:e})=>e.borderRadius}px;
  border: 1px solid ${({level:e,theme:t})=>t.colors[e].base};
  color: ${({level:e,theme:t})=>t.colors[e].dark2};
  padding: ${({theme:e})=>2*e.gridUnit}px;
  margin-bottom: ${({theme:e})=>e.gridUnit}px;
  width: 100%;
`,Lr=v.iK.div`
  display: flex;
  flex-direction: column;
  margin-left: ${({theme:e})=>2*e.gridUnit}px;
`,Vr=v.iK.span`
  font-weight: ${({theme:e})=>e.typography.weights.bold};
`;function Kr({body:e,level:t="error",title:n}){const i=(0,v.Fg)().colors[t].base;return(0,b.tZ)(Ur,{level:t,role:"alert"},"error"===t?(0,b.tZ)(nt.Z.ErrorSolid,{iconColor:i}):(0,b.tZ)(nt.Z.WarningSolid,{iconColor:i}),(0,b.tZ)(Lr,null,(0,b.tZ)(Vr,null,n),(0,b.tZ)("p",null,e)))}var Br=n(73375),Wr=n(46566),Hr=n(77997);const Gr=(e,t,n=((...e)=>JSON.stringify([...e])))=>(...i)=>{const r=n(...i);if(t.has(r))return t.get(r);const o=e(...i);return t.set(r,o),o};var Jr=n(78676);const Qr=v.iK.div`
  width: 100%;
  display: flex;
  flex-direction: column;
  align-items: flex-start;
  min-height: ${({theme:e})=>10*e.gridUnit}px;
  padding-top: ${({theme:e})=>2*e.gridUnit+2}px;

  .checkbox {
    margin-bottom: ${({theme:e,checked:t})=>t?e.gridUnit:0}px;
  }

  & > div {
    margin-bottom: ${({theme:e})=>2*e.gridUnit}px;
  }
`,Yr=e=>{const{checked:t,disabled:n,title:i,tooltip:r,children:o,onChange:s=(()=>{}),initialValue:l=!1}=e,[d,c]=(0,a.useState)(l);return(0,a.useEffect)((()=>{void 0!==t&&c(t)}),[t]),(0,b.tZ)(Qr,{checked:d},(0,b.tZ)(Re.XZ,{className:"checkbox",checked:d,disabled:n,onChange:e=>{const n=e.target.checked;void 0===t&&c(n),s(n)}},(0,b.tZ)(a.Fragment,null,i," ",r&&(0,b.tZ)(Ar.V,{placement:"top",tooltip:r}))),d&&o)};var Xr=n(60812),eo=n(14114),to=n(98286);const no=new Map,io=Gr(st.Z.get,no,(({endpoint:e})=>e||""));function ro({allowClear:e=!1,filterValues:t=(()=>!0),form:n,formField:i="column",filterId:r,datasetId:o,value:s,onChange:l,mode:c}){var u;const[h,p]=(0,a.useState)(),{addDangerToast:f}=(0,eo.e)(),m=(0,a.useCallback)((()=>{n.setFields([{name:["filters",r,i],touched:!1,value:null}])}),[n,r,i]),g=(0,a.useMemo)((()=>(0,Gi.Z)(h).filter(t).map((e=>e.column_name)).map((e=>({label:e,value:e})))),[h,t]),v=null==(u=n.getFieldValue("filters"))?void 0:u[r].filterType,y=(0,a.useMemo)((()=>null==h?void 0:h.find((e=>e.column_name===s))),[h,s]);return(0,a.useEffect)((()=>{y&&!nr(v,y)&&m()}),[y,v,m]),function(e,t){const n=(0,Xr.D)(e);(0,a.useEffect)((()=>{e!==n&&t(n)}),[e,n,t])}(o,(e=>{null!=e&&m(),null!=o&&io({endpoint:`/api/v1/dataset/${o}`}).then((({json:{result:e}})=>{const t=Array.isArray(s)?s:[s];e.columns.some((e=>null==t?void 0:t.includes(e.column_name)))||m(),p(e.columns)}),(async e=>{const{error:t,message:n}=await(0,to.O)(e);let i=n||t||(0,d.t)("An error has occurred");"Forbidden"===n&&(i=(0,d.t)("You do not have permission to edit this dashboard")),f(i)}))})),(0,b.tZ)(Ze.P,{mode:c,value:"multiple"===c?s||[]:s,ariaLabel:(0,d.t)("Column select"),onChange:l,options:g,placeholder:(0,d.t)("Select a column"),notFoundContent:(0,d.t)("No compatible columns found"),showSearch:!0,allowClear:e})}var oo=n(15926),ao=n.n(oo);const so=new Map,lo=Gr(st.Z.get,so,(({endpoint:e})=>e||"")),co=({onChange:e,value:t})=>{const n=(0,a.useCallback)((({error:e,message:t})=>{let n=t||e||(0,d.t)("An error has occurred");return"Forbidden"===t&&(n=(0,d.t)("You do not have permission to edit this dashboard")),n}),[]);return(0,b.tZ)(Ze.P,{ariaLabel:(0,d.t)("Dataset"),value:t,options:async(e,t,i)=>{const r="table_name",o=ao().encode({filters:[{col:r,opr:"ct",value:e}],page:t,page_size:i,order_column:r,order_direction:"asc"});return lo({endpoint:`/api/v1/dataset/?q=${o}`}).then((e=>({data:e.json.result.map(er),totalCount:e.json.count}))).catch((async e=>{const t=n(await(0,to.O)(e));throw new Error(t)}))},onChange:e})},uo=e=>(0,a.useMemo)((()=>(0,b.tZ)(co,e)),[]);var ho=n(88274);const po=({hasDefaultValue:e,filterId:t,hasDataset:n,form:i,setDataMask:r,formData:o,enableNoResults:a})=>{var s,l,c;const u=(i.getFieldValue("filters")||{})[t],p=null==u?void 0:u.defaultValueQueriesData,f=n&&null===p,m=null==(s=u.defaultDataMask)||null==(l=s.filterState)?void 0:l.value,g=e&&null==m;return f?(0,b.tZ)(h.Z,{position:"inline-centered"}):(0,b.tZ)(ho.Z,{height:32,width:"filter_time"===(null==u?void 0:u.filterType)?350:250,appSection:Mi.Tr.FILTER_CONFIG_MODAL,behaviors:[Mi.cg.NATIVE_FILTER],formData:o,queriesData:n?null==u?void 0:u.defaultValueQueriesData:[{data:[{}]}],chartType:null==u?void 0:u.filterType,hooks:{setDataMask:r},enableNoResults:a,filterState:{...null==(c=u.defaultDataMask)?void 0:c.filterState,validateMessage:g&&(0,d.t)("Value is required"),validateStatus:g&&"error"}})};var fo=n(37687);const mo=(0,v.iK)(kt.xJ)`
  margin-bottom: 0;
`;const go=v.iK.div`
  display: flex;
  flex-direction: column;
  height: 400px; // arbitrary
  text-align: center;
  justify-content: center;
  align-items: center;
  color: ${({theme:e})=>e.colors.grayscale.base};
`,vo=({onClick:e})=>(0,b.tZ)(go,null,(0,b.tZ)("p",null,(0,d.t)("You have removed this filter.")),(0,b.tZ)("div",null,(0,b.tZ)(it.Z,{buttonStyle:"primary",onClick:e},(0,d.t)("Restore Filter")))),bo=(0,v.iK)(C.ZP.TabPane)`
  padding: ${({theme:e})=>4*e.gridUnit}px 0px;
`,yo=v.iK.div`
  ${({theme:e})=>`\n    display: flex;\n    flex-direction: row-reverse;\n    justify-content: space-between;\n    padding: 0px ${4*e.gridUnit}px;\n  `}
`,Co=v.iK.div`
  display: flex;
  flex-direction: row;
  justify-content: space-between;
  width: 100%;
  padding: 0px ${({theme:e})=>4*e.gridUnit}px;
`,So=(0,v.iK)(kt.xJ)`
  width: 49%;
  margin-bottom: ${({theme:e})=>4*e.gridUnit}px;

  & .ant-form-item-label {
    padding-bottom: 0;
  }

  & .ant-form-item-control-input {
    min-height: ${({theme:e})=>10*e.gridUnit}px;
  }
`,xo=(0,v.iK)(kt.xJ)`
  margin-bottom: 0;
  padding-bottom: 0;
  min-width: 50%;

  & .ant-form-item-label {
    padding-bottom: 0;
  }

  .ant-form-item-control-input-content > div > div {
    height: auto;
  }

  & .ant-form-item-control-input {
    min-height: ${({theme:e})=>10*e.gridUnit}px;
  }
`,wo=(0,v.iK)(kt.xJ)`
  min-width: 50%;

  & .ant-form-item-label {
    padding-bottom: 0;
  }

  .ant-form-item {
    margin-bottom: 0;
  }

  .ant-form-item-control-input-content > div > div {
    height: auto;
  }

  .ant-form-item-extra {
    display: none;
  }

  & .ant-form-item-control-input {
    height: auto;
  }
`,ko=v.iK.span`
  color: ${({theme:e})=>e.colors.grayscale.base};
  font-size: ${({theme:e})=>e.typography.sizes.s}px;
  text-transform: uppercase;
`,Ro=(0,v.iK)(kt.xJ)`
  margin-bottom: 0;
`,Zo=v.iK.div`
  display: flex;
  flex-direction: row;
  align-items: center;
`,Fo=(0,v.iK)(nt.Z.Refresh)`
  margin-left: ${({theme:e})=>2*e.gridUnit}px;
  color: ${({theme:e})=>e.colors.primary.base};
`,To=(0,v.iK)($r.Z)`
  border-left: 0;
  border-top: 1px solid ${({theme:e})=>e.colors.grayscale.light2};
  border-radius: 0;

  .ant-collapse-header {
    border-bottom: 1px solid ${({theme:e})=>e.colors.grayscale.light2};
    border-top: 1px solid ${({theme:e})=>e.colors.grayscale.light2};
    margin-top: -1px;
    border-radius: 0;
  }

  .ant-collapse-content {
    border: 0;
  }

  .ant-collapse-content-box {
    padding-top: ${({theme:e})=>2*e.gridUnit}px;
  }

  &.ant-collapse > .ant-collapse-item {
    border: 0;
    border-radius: 0;
  }
`,Do=(0,v.iK)(C.ZP)`
  .ant-tabs-nav {
    position: sticky;
    top: 0;
    background: white;
    z-index: 1;
  }

  .ant-tabs-nav-list {
    padding: 0;
  }

  .ant-form-item-label {
    padding-bottom: 0;
  }
`,_o=v.iK.span`
  color: ${({theme:e})=>e.colors.error.base};
  font-size: ${({theme:e})=>e.typography.sizes.s}px;
  margin-left: ${({theme:e})=>e.gridUnit-1}px;
  &:before {
    content: '*';
  }
`,Io={configuration:{key:"configuration",name:(0,d.t)("Configuration")},scoping:{key:"scoping",name:(0,d.t)("Scoping")}},Mo={basic:{key:"basic",name:(0,d.t)("Basic")},advanced:{key:"advanced",name:(0,d.t)("Advanced")}},Eo=["filter_select","filter_range"],Oo=["enableEmptyFilter","multiSelect"],Po={[(0,d.t)("Select filter")]:(0,d.t)("Value"),[(0,d.t)("Range filter")]:(0,d.t)("Numerical range"),[(0,d.t)("Time filter")]:(0,d.t)("Time range"),[(0,d.t)("Time column")]:(0,d.t)("Time column"),[(0,d.t)("Time grain")]:(0,d.t)("Time grain"),[(0,d.t)("Group By")]:(0,d.t)("Group by")},No=new Map,jo=Gr(st.Z.get,No,(({endpoint:e})=>e||"")),qo=({filterId:e,filterToEdit:t,removedFilters:n,form:i,parentFilters:r,activeFilterPanelKeys:s,isActive:l,restoreFilter:u,onFilterHierarchyChange:p,handleActiveFilterPanelChange:f,setErroredFilters:m},g)=>{var v,y,C,S,x,w,k,R,Z,F,T,D,_,I,M,E,O,P,N,j,q,z,A,$,U,L,V;const K=!!n[e],[B,W]=(0,a.useState)(""),[H,G]=(0,a.useState)([]),[J,Q]=(0,a.useState)(Io.configuration.key),[Y,X]=(0,a.useState)(null),ee=Yi(),[te,ne]=(0,a.useState)(),ie=(0,a.useMemo)((()=>({})),[]),re=null==(v=i.getFieldValue("filters"))?void 0:v[e],oe=re||Y||ie,ae=(0,a.useMemo)((()=>r.map((e=>({value:e.id,label:e.title})))),[r]),se=(null==oe||null==(y=oe.parentFilter)?void 0:y.value)||(null==t||null==(C=t.cascadeParentIds)?void 0:C[0]),le=ae.find((({value:e})=>e===se)),de=!!le,ce=(0,Ii.Z)().items,ue=Object.entries(ce).filter((([,{value:e}])=>{var t;return null==(t=e.behaviors)?void 0:t.includes(Mi.cg.NATIVE_FILTER)})).map((([e])=>e)),he=(0,o.v9)((({datasources:e})=>e)),pe=(0,o.v9)((({charts:e})=>e)),fe=(0,a.useMemo)((()=>Object.values(he).some((e=>tr(e)))),[he]),me=(0,a.useMemo)((()=>{const e=Object.values(he).find((e=>{var t;return e.id===(null==oe||null==(t=oe.dataset)?void 0:t.value)}));return!e||tr(e)}),[null==oe||null==(S=oe.dataset)?void 0:S.value,he]),ge=!(null==(x=ce[null==oe?void 0:oe.filterType])||null==(w=x.value)||!w.datasourceCount),ve=null!=(k=null!=(R=null==oe||null==(Z=oe.dataset)?void 0:Z.value)?R:null==t||null==(F=t.targets[0])?void 0:F.datasetId)?k:((e,t)=>{var n;const i=new Map;let r="",o=0;return Object.values(t).forEach((e=>{const{formData:t}=e;if(t){const{datasource:e}=t,n=(i.get(e)||0)+1;i.set(e,n),n>o&&(o=n,r=e)}})),null==(n=e[r])?void 0:n.id})(he,pe),{controlItems:be={},mainControlItems:ye={}}=oe?function({datasetId:e,disabled:t,forceUpdate:n,form:i,filterId:r,filterType:o,filterToEdit:s,formFilter:l,removed:c}){var u;const h=null!=(u=((e={})=>{var t,n;return null!=(t=null==(n=Wi()(e.controlPanelSections))?void 0:n.reduce(((e,{controlSetRows:t=[]})=>[...e,...Wi()(t)]),[]))?t:[]})((0,fo.Z)().get(o)))?u:[],p={},f={};return h.filter((e=>"groupby"===(null==e?void 0:e.name))).forEach((t=>{var o,u,h,p,m,g,v,y,C;const S=null!=(o=null==s||null==(u=s.controlValues)?void 0:u[t.name])?o:null==t||null==(h=t.config)?void 0:h.default,x=null==s||null==(p=s.targets[0])||null==(m=p.column)?void 0:m.name,w=(0,b.tZ)(a.Fragment,null,(0,b.tZ)(mo,{name:["filters",r,"requiredFirst",t.name],hidden:!0,initialValue:(null==t||null==(g=t.config)?void 0:g.requiredFirst)&&(null==s?void 0:s.requiredFirst)}),(0,b.tZ)(So,{name:["filters",r,"column"],initialValue:x,label:(0,b.tZ)(ko,null,(null==(v=t.config)?void 0:v.label)||(0,d.t)("Column")),rules:[{required:(null==(y=t.config)?void 0:y.required)&&!c,message:(0,d.t)("Column is required")}]},(0,b.tZ)(ro,{mode:(null==(C=t.config)?void 0:C.multiple)&&"multiple",form:i,filterId:r,datasetId:e,filterValues:e=>nr((null==l?void 0:l.filterType)||"",e),onChange:()=>{Xi(i,r,{defaultDataMask:null}),n()}})));f[t.name]={element:w,checked:S}})),h.filter((e=>{var t;return(null==e||null==(t=e.config)?void 0:t.renderTrigger)&&"sortAscending"!==e.name&&"enableSingleValue"!==e.name})).forEach((e=>{var o,c,u,h;const f=null!=(o=null==s||null==(c=s.controlValues)?void 0:c[e.name])?o:null==e||null==(u=e.config)?void 0:u.default,m=(0,b.tZ)(a.Fragment,null,(0,b.tZ)(mo,{name:["filters",r,"requiredFirst",e.name],hidden:!0,initialValue:(null==e||null==(h=e.config)?void 0:h.requiredFirst)&&(null==s?void 0:s.requiredFirst)}),(0,b.tZ)(Ln.u,{key:e.name,placement:"left",title:e.config.affectsDataMask&&t&&(0,d.t)('Populate "Default value" to enable this control')},(0,b.tZ)(xo,{key:e.name,name:["filters",r,"controlValues",e.name],initialValue:f,valuePropName:"checked",colon:!1},(0,b.tZ)(Re.XZ,{disabled:e.config.affectsDataMask&&t,onChange:({target:{checked:t}})=>{e.config.requiredFirst&&Xi(i,r,{requiredFirst:{...null==l?void 0:l.requiredFirst,[e.name]:t}}),e.config.resetConfig&&Xi(i,r,{defaultDataMask:null}),n()}},e.config.label," ",e.config.description&&(0,b.tZ)(Ar.V,{placement:"top",label:e.config.name,tooltip:e.config.description})))));p[e.name]={element:m,checked:f}})),{controlItems:p,mainControlItems:f}}({datasetId:ve,disabled:!1,forceUpdate:ee,form:i,filterId:e,filterType:null==oe?void 0:oe.filterType,filterToEdit:t,formFilter:oe,removed:K}):{},Ce=!!ye.groupby,Se=!(null==(D=(null!=(T=ce[null==oe?void 0:oe.filterType])?T:{}).value)||!D.enableNoResults),xe=Ce&&!!H.length,we=!ge||ve&&((null==oe?void 0:oe.column)||!Ce),ke=Eo.includes(null==oe?void 0:oe.filterType),Fe=Qo.includes(null==oe?void 0:oe.filterType),Te=null==(_=null==oe?void 0:oe.isDataDirty)||_,De=t=>{Xi(i,e,t),W(""),ee()},_e=(0,a.useCallback)(((t=!1)=>{var n,r;if(!ge||null==oe||null==(n=oe.dataset)||!n.value)return void ee();const o=(0,vi.zi)({datasetId:null==oe||null==(r=oe.dataset)?void 0:r.value,groupby:null==oe?void 0:oe.column,...oe});De({defaultValueQueriesData:null,isDataDirty:!1}),(0,gi.getChartDataRequest)({formData:o,force:t,requestParams:{dashboardId:0}}).then((({response:e,json:t})=>{if((0,tt.cr)(c.T.GLOBAL_ASYNC_QUERIES)){const n="result"in t?t.result[0]:t;if(200===e.status)De({defaultValueQueriesData:[n]});else{if(202!==e.status)throw new Error(`Received unexpected response status (${e.status}) while fetching chart data`);(0,Hr.YJ)(n).then((e=>{De({defaultValueQueriesData:e})})).catch((e=>{W(e.message||e.error||(0,d.t)("Check configuration"))}))}}else De({defaultValueQueriesData:t.result})})).catch((t=>{t.json().then((n=>{(t=>{Xi(i,e,{defaultValueQueriesData:null}),W(t),ee()})(n.message||t.statusText||(0,d.t)("Check configuration"))}))}))}),[e,ee,i,oe,ge]),Ie=(0,vi.zi)({datasetId:ve,groupby:Ce?null==oe?void 0:oe.column:void 0,...oe}),[Me,Ee,Oe,Pe]=((e,t)=>{var n,i;const r=!(null==e||null==(n=e.controlValues)||!n.enableEmptyFilter),o=!(null==e||null==(i=e.controlValues)||!i.defaultToFirstItem),[s,l]=(0,a.useState)(!1),[c,u]=(0,a.useState)(r),[h,p]=(0,a.useState)(""),f=(e=!1)=>{const t=r&&!o;u(t),l(!!t||e)};return(0,a.useEffect)((()=>{var t,n;f(!o&&!(null==e||null==(t=e.defaultDataMask)||null==(n=t.filterState)||!n.value))}),[o,r]),(0,a.useEffect)((()=>{var e,n;f(!o&&!(null==t||null==(e=t.defaultDataMask)||null==(n=e.filterState)||!n.value))}),[]),(0,a.useEffect)((()=>{let e="";o?e=(0,d.t)('Default value set automatically when "Default to first item" is checked'):c?e=(0,d.t)('Default value must be set when "Required" is checked'):s&&(e=(0,d.t)('Default value must be set when "Filter has default value" is checked')),p(e)}),[s,c,o]),[s,c,h,f]})(oe,t),Ne=!ve||te||(null==oe||null==(I=oe.dataset)?void 0:I.label),je=(0,a.useCallback)((()=>{i.setFields([{name:"changed",value:!0}])}),[i]),qe=(0,a.useCallback)((t=>{Xi(i,e,t),je()}),[e,i,je]),ze=!!(null!=oe&&oe.adhoc_filters||null!=oe&&oe.time_range||null!=t&&null!=(M=t.adhoc_filters)&&M.length||null!=t&&t.time_range),Ae=void 0!==(null==oe||null==(E=oe.controlValues)?void 0:E.enableSingleValue)||void 0!==(null==t||null==(O=t.controlValues)?void 0:O.enableSingleValue);let $e=null==t||null==(P=t.controlValues)?void 0:P.enableSingleValue;void 0!==(null==oe||null==(N=oe.controlValues)?void 0:N.enableSingleMaxValue)&&({enableSingleValue:$e}=oe.controlValues);const Ue="boolean"==typeof(null==oe||null==(j=oe.controlValues)?void 0:j.sortAscending)||"boolean"==typeof(null==t||null==(q=t.controlValues)?void 0:q.sortAscending);let Le=null==t||null==(z=t.controlValues)?void 0:z.sortAscending;"boolean"==typeof(null==oe||null==(A=oe.controlValues)?void 0:A.sortAscending)&&(Le=oe.controlValues.sortAscending);const Ve=!ge||!Te&&we||!ye.groupby,Ke=t=>{var n;const r=null==(n=i.getFieldValue("filters"))?void 0:n[e].controlValues;Xi(i,e,{controlValues:{...r,sortAscending:t}}),ee()},Be=t=>{var n;const r=null==(n=i.getFieldValue("filters"))?void 0:n[e].controlValues;Xi(i,e,{controlValues:{...r,enableSingleValue:t}}),ee()},We=()=>setTimeout((()=>i.validateFields([["filters",e,"adhoc_filters"],["filters",e,"time_range"]])),0),He=(null==oe?void 0:oe.time_range)&&"No filter"!==oe.time_range,Ge=(null==oe||null==($=oe.adhoc_filters)?void 0:$.length)>0,Je=null==oe||null==(U=oe.controlValues)?void 0:U.defaultToFirstItem,Qe="filter_select"===(null==oe?void 0:oe.filterType)||"filter_range"===(null==oe?void 0:oe.filterType),Ye=(null==oe?void 0:oe.filterType)===(null==t?void 0:t.filterType)?null==t?void 0:t.defaultDataMask:null,Xe=()=>He||Ge?Promise.resolve():Promise.reject(new Error((0,d.t)("Pre-filter is required")));(0,a.useEffect)((()=>{ve&&jo({endpoint:`/api/v1/dataset/${ve}`}).then((e=>{var t,n,i;G(null==(t=e.json)||null==(n=t.result)?void 0:n.metrics);const r=null==(i=e.json)?void 0:i.result;r.type=r.datasource_type,r.filter_select=!0,ne(r)})).catch((e=>{(0,di.Gb)(e.message)}))}),[ve]),(0,a.useImperativeHandle)(g,(()=>({changeTab(e){Q(e)}}))),((e,t)=>{var n;const i=Yi(),r=(e.getFieldValue("filters")||{})[t];(0,a.useEffect)((()=>{Xi(e,t,{isDataDirty:!0,defaultValueQueriesData:null}),i()}),[e,null==r?void 0:r.filterType,null==r?void 0:r.column,null==r||null==(n=r.dataset)?void 0:n.value,JSON.stringify(null==r?void 0:r.adhoc_filters),null==r?void 0:r.time_range,i,t])})(i,e),(0,a.useEffect)((()=>{ge&&we&&Me&&Te&&_e()}),[ge,we,Me,Te,_e,Ne]),(0,a.useEffect)((()=>{if(l){const t=de||ze||Ue||Ae||Object.keys(be).filter((e=>!Oo.includes(e))).some((e=>be[e].checked));f(t?[`${e}-${Mo.basic.key}`,`${e}-${Mo.advanced.key}`]:`${e}-${Mo.basic.key}`)}}),[l]);const et=(0,a.useMemo)((()=>{var e;const t=[];return void 0===(null==oe||null==(e=oe.dataset)?void 0:e.value)?[]:(Object.values(pe).forEach((e=>{var n,i,r;const o=null==(n=e.formData)?void 0:n.datasource;void 0!==o&&(null==(i=he[o])?void 0:i.id)!==(null==oe||null==(r=oe.dataset)?void 0:r.value)&&t.push(e.id)})),t)}),[JSON.stringify(pe),null==oe||null==(L=oe.dataset)?void 0:L.value,JSON.stringify(he)]);return(0,a.useEffect)((()=>{K&&X(re)}),[K]),(0,a.useEffect)((()=>{Y&&!K&&(Xi(i,e,Y),X(null))}),[re,e,i,K,Y]),K?(0,b.tZ)(vo,{onClick:()=>u(e)}):(0,b.tZ)(Do,{activeKey:J,onChange:e=>Q(e),centered:!0},(0,b.tZ)(bo,{tab:Io.configuration.name,key:Io.configuration.key,forceRender:!0},(0,b.tZ)(yo,null,(0,b.tZ)(So,{name:["filters",e,"type"],hidden:!0,initialValue:cr.B.NATIVE_FILTER},(0,b.tZ)(Re.II,null)),(0,b.tZ)(So,{name:["filters",e,"name"],label:(0,b.tZ)(ko,null,(0,d.t)("Filter name")),initialValue:null==t?void 0:t.name,rules:[{required:!K,message:(0,d.t)("Name is required")}]},(0,b.tZ)(Re.II,Jo("name-input"))),(0,b.tZ)(So,ct()({name:["filters",e,"filterType"],rules:[{required:!K,message:(0,d.t)("Name is required")}],initialValue:(null==t?void 0:t.filterType)||"filter_select",label:(0,b.tZ)(ko,null,(0,d.t)("Filter Type"))},Jo("filter-type")),(0,b.tZ)(Ze.P,{ariaLabel:(0,d.t)("Filter type"),options:ue.map((e=>{var t,n,i;const r=null==(t=ce[e])?void 0:t.value.name,o=r?Po[r]:void 0,a=1===(null==(n=Qi[e])?void 0:n.length)&&(null==(i=Qi[e])?void 0:i.includes(Hi.Z.TEMPORAL))&&!fe;return{value:e,label:o||r,customLabel:a?(0,b.tZ)(Ln.u,{title:(0,d.t)("Datasets do not contain a temporal column")},o||r):void 0,disabled:a}})),onChange:t=>{Xi(i,e,{filterType:t,defaultDataMask:null,column:null}),ee()}}))),ge&&(0,b.tZ)(Co,null,Ne?(0,b.tZ)(So,ct()({name:["filters",e,"dataset"],label:(0,b.tZ)(ko,null,(0,d.t)("Dataset")),initialValue:te?{label:te.table_name,value:te.id}:void 0,rules:[{required:!K,message:(0,d.t)("Dataset is required")}]},Jo("datasource-input")),(0,b.tZ)(uo,{onChange:t=>{t.value!==ve&&Xi(i,e,{dataset:t,defaultDataMask:null,column:null}),ee()}})):(0,b.tZ)(So,{label:(0,b.tZ)(ko,null,(0,d.t)("Dataset"))},(0,b.tZ)(h.Z,{position:"inline-centered"})),ge&&Object.keys(ye).map((e=>ye[e].element))),(0,b.tZ)(To,{activeKey:s,onChange:e=>{f(e)},expandIconPosition:"right",key:`native-filter-config-${e}`},(0,b.tZ)($r.Z.Panel,{forceRender:!0,header:Mo.basic.name,key:`${e}-${Mo.basic.key}`},(0,b.tZ)(Ro,{name:["filters",e,"defaultValueQueriesData"],hidden:!0,initialValue:null}),(0,b.tZ)(Ro,{name:["filters",e,"defaultValue"]},(0,b.tZ)(Yr,{checked:Me,disabled:Ee||Je,initialValue:Me,title:(0,d.t)("Filter has default value"),tooltip:Oe,onChange:e=>{Pe(e),je()}},!K&&(0,b.tZ)(wo,{name:["filters",e,"defaultDataMask"],initialValue:Ye,label:(0,b.tZ)(ko,null,(0,d.t)("Default Value")),required:Me,rules:[{validator:()=>{var t,n;if(null!=oe&&null!=(t=oe.defaultDataMask)&&null!=(n=t.filterState)&&n.value){const e=i.getFieldsError();return m((t=>t.length&&!e.find((e=>e.errors.length>0))?[]:t)),Promise.resolve()}return m((t=>t.includes(e)?t:[...t,e])),Promise.reject(new Error((0,d.t)("Default value is required")))}}]},B?(0,b.tZ)(Kr,{title:(0,d.t)("Cannot load filter"),body:B,level:"error"}):Ve?(0,b.tZ)(Zo,null,(0,b.tZ)(po,{setDataMask:t=>{var n,r;Fi()(null==Ye||null==(n=Ye.filterState)?void 0:n.value,null==t||null==(r=t.filterState)?void 0:r.value)||je(),Xi(i,e,{defaultDataMask:t}),i.validateFields([["filters",e,"defaultDataMask"]]),ee()},hasDefaultValue:Me,filterId:e,hasDataset:ge,form:i,formData:Ie,enableNoResults:Se}),ge&&ve&&(0,b.tZ)(Ln.u,{title:(0,d.t)("Refresh the default values")},(0,b.tZ)(Fo,{onClick:()=>_e(!0)}))):(0,d.t)('Fill all required fields to enable "Default Value"')))),Object.keys(be).filter((e=>Oo.includes(e))).map((e=>be[e].element)),(0,b.tZ)(So,{name:["filters",e,"description"],initialValue:null==t?void 0:t.description,label:(0,b.tZ)(ko,null,(0,d.t)("Description"))},(0,b.tZ)(Re.Kx,null))),Qe&&(0,b.tZ)($r.Z.Panel,{forceRender:!0,header:Mo.advanced.name,key:`${e}-${Mo.advanced.key}`},Fe&&(0,b.tZ)(Ro,{name:["filters",e,"hierarchicalFilter"]},(0,b.tZ)(Yr,{title:(0,d.t)("Filter is hierarchical"),initialValue:de,onChange:t=>{je(),setTimeout((()=>{t?i.validateFields([["filters",e,"parentFilter"]]):Xi(i,e,{parentFilter:void 0}),p(e,t?i.getFieldValue("filters")[e].parentFilter:void 0)}),0)}},(0,b.tZ)(wo,{name:["filters",e,"parentFilter"],label:(0,b.tZ)(ko,null,(0,d.t)("Parent filter")),initialValue:le,normalize:e=>e?{value:e}:void 0,required:!0,rules:[{required:!0,message:(0,d.t)("Parent filter is required")}]},(0,b.tZ)((({value:e,...t})=>{const i=null==e?void 0:e.value,r=i&&n[i];let o=ae;return r&&(o=[{label:(0,d.t)("(deleted)"),value:i},...ae]),(0,b.tZ)(Ze.P,ct()({ariaLabel:(0,d.t)("Parent filter"),placeholder:(0,d.t)("None"),options:o,allowClear:!0,value:i},t))}),null)))),Object.keys(be).filter((e=>!Oo.includes(e))).map((e=>be[e].element)),ge&&ke&&(0,b.tZ)(Ro,{name:["filters",e,"preFilter"]},(0,b.tZ)(Yr,{initialValue:ze,title:(0,d.t)("Pre-filter available values"),onChange:e=>{je(),e&&We()}},(0,b.tZ)(wo,{name:["filters",e,"adhoc_filters"],initialValue:null==t?void 0:t.adhoc_filters,required:!0,rules:[{validator:Xe}]},(0,b.tZ)(Wr.Z,{columns:(null==te||null==(V=te.columns)?void 0:V.filter((e=>e.filterable)))||[],savedMetrics:(null==te?void 0:te.metrics)||[],datasource:te,onChange:t=>{Xi(i,e,{adhoc_filters:t}),ee(),We()},label:(0,b.tZ)("span",null,(0,b.tZ)(ko,null,(0,d.t)("Pre-filter")),!He&&(0,b.tZ)(_o,null))})),me&&(0,b.tZ)(xo,{name:["filters",e,"time_range"],label:(0,b.tZ)(ko,null,(0,d.t)("Time range")),initialValue:(null==t?void 0:t.time_range)||"No filter",required:!Ge,rules:[{validator:Xe}]},(0,b.tZ)(Br.Z,{name:"time_range",endpoints:["inclusive","exclusive"],onChange:t=>{Xi(i,e,{time_range:t}),ee(),We()}})),He&&(0,b.tZ)(xo,{name:["filters",e,"granularity_sqla"],label:(0,b.tZ)(a.Fragment,null,(0,b.tZ)(ko,null,(0,d.t)("Time column"))," ",(0,b.tZ)(Ar.V,{placement:"top",tooltip:(0,d.t)("Optional time column if time range should apply to another column than the default time column")})),initialValue:null==t?void 0:t.granularity_sqla},(0,b.tZ)(ro,{allowClear:!0,form:i,formField:"granularity_sqla",filterId:e,filterValues:e=>!!e.is_dttm,datasetId:ve,onChange:t=>{Xi(i,e,{granularity_sqla:t}),ee()}})))),"filter_range"!==(null==oe?void 0:oe.filterType)?(0,b.tZ)(Ro,{name:["filters",e,"sortFilter"]},(0,b.tZ)(Yr,{initialValue:Ue,title:(0,d.t)("Sort filter values"),onChange:e=>{Ke(e||void 0),je()}},(0,b.tZ)(xo,{name:["filters",e,"controlValues","sortAscending"],initialValue:Le,label:(0,b.tZ)(ko,null,(0,d.t)("Sort type"))},(0,b.tZ)(_t.Y.Group,{onChange:e=>{Ke(e.target.value)}},(0,b.tZ)(_t.Y,{value:!0},(0,d.t)("Sort ascending")),(0,b.tZ)(_t.Y,{value:!1},(0,d.t)("Sort descending")))),xe&&(0,b.tZ)(wo,{name:["filters",e,"sortMetric"],initialValue:null==t?void 0:t.sortMetric,label:(0,b.tZ)(a.Fragment,null,(0,b.tZ)(ko,null,(0,d.t)("Sort Metric"))," ",(0,b.tZ)(Ar.V,{placement:"top",tooltip:(0,d.t)("If a metric is specified, sorting will be done based on the metric value")}))},(0,b.tZ)(Ze.P,{allowClear:!0,ariaLabel:(0,d.t)("Sort metric"),name:"sortMetric",options:H.map((e=>{var t;return{value:e.metric_name,label:null!=(t=e.verbose_name)?t:e.metric_name}})),onChange:t=>{void 0!==t&&(Xi(i,e,{sortMetric:t}),ee())}})))):(0,b.tZ)(Ro,{name:["filters",e,"rangeFilter"]},(0,b.tZ)(Yr,{initialValue:Ae,title:(0,d.t)("Single Value"),onChange:e=>{Be(e?Jr.c.Exact:void 0),je()}},(0,b.tZ)(xo,{name:["filters",e,"controlValues","enableSingleValue"],initialValue:$e,label:(0,b.tZ)(ko,null,(0,d.t)("Single value type"))},(0,b.tZ)(_t.Y.Group,{onChange:e=>Be(e.target.value)},(0,b.tZ)(_t.Y,{value:Jr.c.Minimum},(0,d.t)("Minimum")),(0,b.tZ)(_t.Y,{value:Jr.c.Exact},(0,d.t)("Exact")),(0,b.tZ)(_t.Y,{value:Jr.c.Maximum},(0,d.t)("Maximum"))))))))),(0,b.tZ)(bo,{tab:Io.scoping.name,key:Io.scoping.key,forceRender:!0},(0,b.tZ)(Ki,{updateFormValues:qe,pathToFormValue:["filters",e],forceUpdate:ee,filterScope:null==t?void 0:t.scope,formFilterScope:null==oe?void 0:oe.scope,formScopingType:null==oe?void 0:oe.scoping,initiallyExcludedCharts:et})))},zo=(0,a.forwardRef)(qo);var Ao={name:"ihui0v",styles:"text-align:left;& .ant-alert-action{align-self:center;}"},$o={name:"zjik7",styles:"display:flex"};function Uo({title:e,onConfirm:t,onDismiss:n,children:i}){return(0,b.tZ)(wt.Z,{closable:!1,type:"warning",key:"alert",message:e,css:Ao,description:i,action:(0,b.tZ)("div",{css:$o},(0,b.tZ)(it.Z,{key:"cancel",buttonSize:"small",buttonStyle:"secondary",onClick:n},(0,d.t)("Keep editing")),(0,b.tZ)(it.Z,{key:"submit",buttonSize:"small",buttonStyle:"primary",onClick:t},(0,d.t)("Yes, cancel")))})}const Lo=({canSave:e=!0,onCancel:t,handleSave:n,onDismiss:i,onConfirmCancel:r,saveAlertVisible:o})=>o?(0,b.tZ)(Uo,{key:"cancel-confirm",title:(0,d.t)("There are unsaved changes."),onConfirm:r,onDismiss:i},(0,d.t)("Are you sure you want to cancel?")):(0,b.tZ)(a.Fragment,null,(0,b.tZ)(it.Z,{key:"cancel",buttonStyle:"secondary",onClick:t},(0,d.t)("Cancel")),(0,b.tZ)(it.Z,{disabled:!e,key:"submit",buttonStyle:"primary",onClick:n},(0,d.t)("Save")));var Vo=n(92242);const Ko=v.iK.div`
  ${({theme:e})=>`\n    padding: ${4*e.gridUnit}px;\n  `}
`,Bo=({componentId:e,divider:t})=>(0,b.tZ)(Ko,null,(0,b.tZ)(kt.xJ,{initialValue:t?t.title:"",label:(0,d.t)("Title"),name:["filters",e,"title"],rules:[{required:!0,message:(0,d.t)("Title is required"),whitespace:!0}]},(0,b.tZ)(Re.II,null)),(0,b.tZ)(kt.xJ,{initialValue:t?t.description:"",label:(0,d.t)("Description"),name:["filters",e,"description"]},(0,b.tZ)(Re.Kx,{rows:4})),(0,b.tZ)(kt.xJ,{hidden:!0,name:["filters",e,"type"],initialValue:cr.B.DIVIDER})),Wo=(0,v.iK)(Ei.o)`
  min-width: 700px;
  .ant-modal-body {
    padding: 0px;
  }
`,Ho=v.iK.div`
  display: flex;
  height: 700px;
  flex-direction: row;
  .filters-list {
    width: ${({theme:e})=>50*e.gridUnit}px;
    overflow: auto;
  }
`,Go=(0,v.iK)(Re.l0)`
  width: 100%;
`,Jo=(0,dr.Q)("filters-config-modal"),Qo=["filter_select"];function Yo({isOpen:e,initialFilterId:t,createNewOnOpen:n,onSave:i,onCancel:r}){const[o]=Re.l0.useForm(),s=(0,a.useRef)(),l=hr(),c=function(){const e=hr();return(0,a.useMemo)((()=>e.reduce(((e,t)=>(e[t.id]=t,e)),{})),[e])}(),[u,h]=(0,a.useState)([]),[p,f]=(0,a.useState)({}),[m,g]=(0,a.useState)(!1),v=(0,a.useMemo)((()=>sr()([...(0,Vo.QN)(l),...u]).filter((e=>{var t;return!p[e]||(null==(t=p[e])?void 0:t.isPending)}))),[l,u,p]),C=null!=t?t:v[0],[S,x]=(0,a.useState)(C),[k,R]=(0,a.useState)([]),[Z,F]=(0,a.useState)({filters:{}}),T=u.filter((e=>!p[e])),D=e=>{const t=p[e];null!=t&&t.isPending&&clearTimeout(t.timerId),f((t=>({...t,[e]:null})))},_=()=>l.map((e=>({id:e.id,parentId:e.type===cr.B.NATIVE_FILTER&&e.cascadeParentIds[0]||null}))),[I,M]=(0,a.useState)((()=>_())),[E,O]=(0,a.useState)((()=>(0,Vo.Zh)(I))),[P,N]=(0,a.useState)(`${C}-${Mo.basic.key}`),j=(0,a.useCallback)((e=>{const t=(0,Vo.W6)(e);h([...u,t]),x(t),g(!1),M((e=>[...e,{id:t,parentId:null}])),O([...E,[t]]),N(`${t}-${Mo.basic.key}`)}),[u,E,x,M,O,h]);((e,t,n)=>{const i=(0,Xr.D)(e);(0,a.useEffect)((()=>{n&&e&&!i&&t(cr.B.NATIVE_FILTER)}),[n,e,i,t])})(e,j,n),((e,t,n,i)=>{(0,a.useEffect)((()=>{const r=e[t];if(r&&!r.isPending){const r=n.flat().find((n=>!e[n]&&n!==t));r&&i(r)}}),[t,e,n,i])})(p,S,E,x);const q=(0,Vo.EJ)(f,g,O,M,I),z=(e=!1)=>{if(h([]),x(C),f({}),g(!1),F({filters:{}}),R([]),!e){const e=_();M(e),O((0,Vo.Zh)(e)),o.resetFields(["filters"])}o.setFieldsValue({changed:!1})},A=e=>{const t=Z.filters[e],n=c[e];return t&&"name"in t&&t.name||t&&"title"in t&&t.title||n&&"name"in n&&n.name||n&&"title"in n&&n.title||"[untitled]"},$=e=>v.filter((t=>t!==e&&!p[t])).filter((e=>{const t=Z.filters[e]||c[e];return t&&"filterType"in t&&Qo.includes(t.filterType)})).map((e=>({id:e,title:A(e)}))),U=(0,a.useCallback)((()=>{const e=o.getFieldsError(),t=[];e.forEach((e=>{const n=e.name[1];e.errors.length>0&&!t.includes(n)&&t.push(n)})),!t.length&&k.length>0?R([]):t.length>0&&!Fi()(or()(k),or()(t))&&R(t)}),[o,k]),L=async()=>{const e=await(0,Vo.G$)(o,S,c,v,p,x);U(),e?((e=>{Object.keys(c).forEach((e=>{var t;const n=c[e];if(!("cascadeParentIds"in n))return;const i=null==(t=n.cascadeParentIds)?void 0:t[0];i&&p[i]&&(n.cascadeParentIds=[])}));const t=null==e?void 0:e.filters;t&&Object.keys(t).forEach((e=>{var n;const i=t[e];if(!("parentFilter"in i))return;const r=null==(n=i.parentFilter)?void 0:n.value;r&&p[r]&&(i.parentFilter=void 0)}))})(e),(0,Vo.GA)(c,E.flat(),p,i,e)(),z(!0)):s.current.changeTab("configuration")},V=()=>{z(),r()},K=()=>{const e=o.getFieldValue("changed"),t=(0,Vo.Zh)(_()).flat(),n=E.flat().length!==t.length||E.flat().some(((e,n)=>e!==t[n]));T.length>0||o.isFieldsTouched()||e||n?g(!0):V()},B=(0,a.useCallback)(((e,t)=>{const n=I.findIndex((t=>t.id===e)),i=[...I];i.splice(n,1,{id:e,parentId:t?t.value:null}),M(i),O((0,Vo.Zh)(i))}),[M,O,I]),W=(0,a.useMemo)((()=>w()(((e,t)=>{const n=e.filters&&Object.values(e.filters).some((e=>e.name&&null!==e.name)),i=e.filters&&Object.values(e.filters).some((e=>e.title&&null!==e.title));(n||i)&&F(t);const r=Object.keys(e.filters).filter((t=>e.filters[t].parentFilter)).map((t=>({id:t,parentFilter:e.filters[t].parentFilter})));if(r.length>0){const e=r[0];B(e.id,e.parentFilter)}g(!1),U()}),lr.M)),[B,U]);return(0,a.useEffect)((()=>{R((e=>e.filter((e=>!p[e]))))}),[p]),(0,b.tZ)(Wo,{visible:e,maskClosable:!1,title:(0,d.t)("Filters configuration and scoping"),width:"50%",destroyOnClose:!0,onCancel:K,onOk:L,centered:!0,footer:(0,b.tZ)(Lo,{onDismiss:()=>g(!1),onCancel:K,handleSave:L,canSave:!k.length,saveAlertVisible:m,onConfirmCancel:V})},(0,b.tZ)(y.Z,null,(0,b.tZ)(Ho,null,(0,b.tZ)(Go,{form:o,onValuesChange:W,layout:"vertical"},(0,b.tZ)(zr,{erroredFilters:k,onRemove:q,onAdd:j,onChange:e=>{x(e),N(`${e}-${Mo.basic.key}`)},getFilterTitle:A,currentFilterId:S,removedFilters:p,restoreFilter:D,onRearrange:(e,t)=>{const n=E.map((e=>[...e])),i=n.splice(e,1)[0];n.splice(t,0,i),O(n)},filterGroups:E},(e=>(e=>e.startsWith(Vo.Ky)?(0,b.tZ)(Bo,{componentId:e,divider:c[e]}):(0,b.tZ)(zo,{ref:s,form:o,filterId:e,filterToEdit:c[e],removedFilters:p,restoreFilter:D,parentFilters:$(e),onFilterHierarchyChange:B,key:e,activeFilterPanelKeys:P,handleActiveFilterPanelChange:e=>N(e),isActive:S===e,setErroredFilters:R}))(e)))))))}const Xo=({isOpen:e,chartId:t,onClose:n})=>{var i,r;const s=(0,o.I0)(),[l]=Re.l0.useForm(),c=(0,o.v9)((({dashboardInfo:e})=>{var t;return null==e||null==(t=e.metadata)?void 0:t.chart_configuration})),u=null==c||null==(i=c[t])||null==(r=i.crossFilters)?void 0:r.scope,h=()=>{s((0,si.Aw)({...c,[t]:{id:t,crossFilters:{scope:l.getFieldValue("scope")}}})),n()};return(0,b.tZ)(Ei.o,{visible:e,maskClosable:!1,title:(0,d.t)("Cross Filter Scoping"),width:"55%",destroyOnClose:!0,onCancel:n,onOk:h,centered:!0,footer:(0,b.tZ)(a.Fragment,null,(0,b.tZ)(it.Z,{key:"cancel",buttonStyle:"secondary",onClick:n},(0,d.t)("Cancel")),(0,b.tZ)(it.Z,{key:"submit",buttonStyle:"primary",onClick:h},(0,d.t)("Save")))},(0,b.tZ)(Go,{preserve:!1,form:l,layout:"vertical"},(0,b.tZ)(ir,{form:l,scope:u,chartId:t})))};var ea=n(15423);const ta="cross_filter_scoping",na="download_as_image",ia="explore_chart",ra="export_csv",oa="export_full_csv",aa="force_refresh",sa="resize_label",la="toggle_chart_description",da=v.iK.div`
  padding: ${({theme:e})=>e.gridUnit/4}px
    ${({theme:e})=>1.5*e.gridUnit}px;

  .dot {
    display: block;
  }

  &:hover {
    cursor: pointer;
  }
`,ca=v.iK.div`
  height: auto;
  margin: ${({theme:e})=>e.gridUnit}px 0;
  color: ${({theme:e})=>e.colors.grayscale.base};
  line-height: ${({theme:e})=>1.5*e.typography.sizes.m}px;
  display: flex;
  flex-direction: column;
  align-items: flex-start;
  justify-content: flex-start;
`,ua=".dashboard-component-chart-holder",ha=()=>(0,b.tZ)(da,null,(0,b.tZ)("span",{className:"dot"}),(0,b.tZ)("span",{className:"dot"}),(0,b.tZ)("span",{className:"dot"}));class pa extends a.PureComponent{constructor(e){super(e),this.toggleControls=this.toggleControls.bind(this),this.refreshChart=this.refreshChart.bind(this),this.handleMenuClick=this.handleMenuClick.bind(this),this.state={showControls:!1,showCrossFilterScopingModal:!1}}refreshChart(){this.props.updatedDttm&&this.props.forceRefresh(this.props.slice.slice_id,this.props.dashboardId)}toggleControls(){this.setState((e=>({showControls:!e.showControls})))}handleMenuClick({key:e,domEvent:t}){switch(e){case aa:this.refreshChart(),this.props.addSuccessToast((0,d.t)("Data refreshed"));break;case ta:this.setState({showCrossFilterScopingModal:!0});break;case la:this.props.toggleExpandSlice&&this.props.toggleExpandSlice(this.props.slice.slice_id);break;case ia:this.props.logExploreChart&&this.props.logExploreChart(this.props.slice.slice_id);break;case ra:this.props.exportCSV&&this.props.exportCSV(this.props.slice.slice_id);break;case sa:this.props.handleToggleFullSize();break;case oa:this.props.exportFullCSV&&this.props.exportFullCSV(this.props.slice.slice_id);break;case na:{const e=document.querySelector(".ant-dropdown:not(.ant-dropdown-hidden)");e.style.visibility="hidden",(0,Tn.Z)(ua,this.props.slice.slice_name)(t).then((()=>{e.style.visibility="visible"}));break}}}render(){var e;const{slice:t,isFullSize:n,componentId:i,cachedDttm:r=[],updatedDttm:o=null,addSuccessToast:s=(()=>{}),addDangerToast:l=(()=>{}),supersetCanShare:u=!1,isCached:h=[]}=this.props,p=(0,Ii.Z)().items,f="table"===t.viz_type,m=Object.entries(p).filter((([,{value:e}])=>{var t;return null==(t=e.behaviors)?void 0:t.includes(Mi.cg.INTERACTIVE_CHART)})).find((([e])=>e===t.viz_type)),g=null==(e=t.form_data)?void 0:e.emit_filter,v=(r||[]).map((e=>Ye().utc(e).fromNow())),y=o?Ye().utc(o).fromNow():"",C=[...new Set(h.map((e=>e?(0,d.t)("Cached %s",v):y?(0,d.t)("Fetched %s",y):""))||"")],S=C.map(((e,t)=>(0,b.tZ)("div",{key:`tooltip-${t}`},C.length>1?(0,d.t)("Query %s: %s",t+1,e):e))),x=n?(0,d.t)("Minimize chart"):(0,d.t)("Maximize chart"),w=(0,b.tZ)(Re.v2,{onClick:this.handleMenuClick,selectable:!1},(0,b.tZ)(Re.v2.Item,{key:aa,disabled:"loading"===this.props.chartStatus,style:{height:"auto",lineHeight:"initial"}},(0,d.t)("Force refresh"),(0,b.tZ)(ca,null,S)),(0,b.tZ)(Re.v2.Divider,null),t.description&&(0,b.tZ)(Re.v2.Item,{key:la},(0,d.t)("Toggle chart description")),this.props.supersetCanExplore&&(0,b.tZ)(Re.v2.Item,{key:ia},(0,b.tZ)("a",{href:this.props.exploreUrl,rel:"noopener noreferrer"},(0,d.t)("View chart in Explore"))),this.props.supersetCanExplore&&(0,b.tZ)(Re.v2.Item,{key:"view_query"},(0,b.tZ)(gt.Z,{triggerNode:(0,b.tZ)("span",null,(0,d.t)("View query")),modalTitle:(0,d.t)("View query"),modalBody:(0,b.tZ)(ea.Z,{latestQueryFormData:this.props.formData}),draggable:!0,resizable:!0,responsive:!0})),u&&(0,b.tZ)(mt,{url:Mn({pathname:window.location.pathname,filters:(0,an.De)(),hash:i}),copyMenuItemTitle:(0,d.t)("Copy chart URL"),emailMenuItemTitle:(0,d.t)("Share chart by email"),emailSubject:(0,d.t)("Superset chart"),emailBody:(0,d.t)("Check out this chart: "),addSuccessToast:s,addDangerToast:l}),(0,b.tZ)(Re.v2.Item,{key:sa},x),(0,b.tZ)(Re.v2.Item,{key:na},(0,d.t)("Download as image")),"filter_box"!==this.props.slice.viz_type&&this.props.supersetCanCSV&&(0,b.tZ)(Re.v2.Item,{key:ra},(0,d.t)("Export CSV")),"filter_box"!==this.props.slice.viz_type&&(0,tt.cr)(c.T.ALLOW_FULL_CSV_EXPORT)&&this.props.supersetCanCSV&&f&&(0,b.tZ)(Re.v2.Item,{key:oa},(0,d.t)("Export full CSV")),(0,tt.cr)(c.T.DASHBOARD_CROSS_FILTERS)&&m&&g&&(0,b.tZ)(Re.v2.Item,{key:ta},(0,d.t)("Cross-filter scoping")));return(0,b.tZ)(a.Fragment,null,(0,b.tZ)(Xo,{chartId:t.slice_id,isOpen:this.state.showCrossFilterScopingModal,onClose:()=>this.setState({showCrossFilterScopingModal:!1})}),n&&(0,b.tZ)(nt.Z.FullscreenExitOutlined,{style:{fontSize:22},onClick:()=>{this.props.handleToggleFullSize()}}),(0,b.tZ)(Re.$i,{overlay:w,trigger:["click"],placement:"bottomRight",getPopupContainer:e=>e.closest(ua)},(0,b.tZ)("span",{id:`slice_${t.slice_id}-controls`,role:"button","aria-label":"More Options"},(0,b.tZ)(ha,null))))}}const fa=pa;var ma=n(87185),ga=n.n(ma);const va={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm193.5 301.7l-210.6 292a31.8 31.8 0 01-51.7 0L318.5 484.9c-3.8-5.3 0-12.7 6.5-12.7h46.9c10.2 0 19.9 4.9 25.9 13.3l71.2 98.8 157.2-218c6-8.3 15.6-13.3 25.9-13.3H699c6.5 0 10.3 7.4 6.5 12.7z"}}]},name:"check-circle",theme:"filled"};var ba=n(27029),ya=function(e,t){return a.createElement(ba.Z,Object.assign({},e,{ref:t,icon:va}))};ya.displayName="CheckCircleFilled";const Ca=a.forwardRef(ya),Sa={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm-32 232c0-4.4 3.6-8 8-8h48c4.4 0 8 3.6 8 8v272c0 4.4-3.6 8-8 8h-48c-4.4 0-8-3.6-8-8V296zm32 440a48.01 48.01 0 010-96 48.01 48.01 0 010 96z"}}]},name:"exclamation-circle",theme:"filled"};var xa=function(e,t){return a.createElement(ba.Z,Object.assign({},e,{ref:t,icon:Sa}))};xa.displayName="ExclamationCircleFilled";const wa=a.forwardRef(xa),ka={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm192 472c0 4.4-3.6 8-8 8H328c-4.4 0-8-3.6-8-8v-48c0-4.4 3.6-8 8-8h368c4.4 0 8 3.6 8 8v48z"}}]},name:"minus-circle",theme:"filled"};var Ra=function(e,t){return a.createElement(ba.Z,Object.assign({},e,{ref:t,icon:ka}))};Ra.displayName="MinusCircleFilled";const Za=a.forwardRef(Ra);var Fa=n(76697);const Ta=v.iK.div`
  display: inline-block;
  color: ${({theme:e})=>e.colors.grayscale.light5};
  background: ${({theme:e})=>e.colors.grayscale.base};
  border-radius: 1em;
  vertical-align: text-top;
  padding: ${({theme:e})=>`${e.gridUnit}px ${2*e.gridUnit}px`};
  font-size: ${({theme:e})=>e.typography.sizes.m}px;
  font-weight: bold;
  min-width: 1em;
  min-height: 1em;
  line-height: 1em;
  vertical-align: middle;
  white-space: nowrap;

  svg {
    position: relative;
    top: -2px;
    color: ${({theme:e})=>e.colors.grayscale.light5};
    width: 1em;
    height: 1em;
    display: inline-block;
    vertical-align: middle;
  }

  &:hover {
    cursor: pointer;
    background: ${({theme:e})=>e.colors.grayscale.dark1};
  }

  &.has-cross-filters {
    background: ${({theme:e})=>e.colors.primary.base};
    &:hover {
      background: ${({theme:e})=>e.colors.primary.dark1};
    }
  }

  &.has-incompatible-filters {
    color: ${({theme:e})=>e.colors.grayscale.dark2};
    background: ${({theme:e})=>e.colors.alert.base};
    &:hover {
      background: ${({theme:e})=>e.colors.alert.dark1};
    }
    svg {
      color: ${({theme:e})=>e.colors.grayscale.dark2};
    }
  }

  &.filters-inactive {
    color: ${({theme:e})=>e.colors.grayscale.light5};
    background: ${({theme:e})=>e.colors.grayscale.light1};
    padding: ${({theme:e})=>e.gridUnit}px;
    text-align: center;
    height: 22px;
    width: 22px;

    &:hover {
      background: ${({theme:e})=>e.colors.grayscale.base};
    }
  }
`,Da=v.iK.span`
  position: relative;
  margin-right: ${({theme:e})=>e.gridUnit}px;
  font-weight: ${({bold:e,theme:t})=>e?t.typography.weights.bold:"auto"};
  color: ${({color:e,theme:t})=>e||t.colors.grayscale.light5};
  display: flex;
  align-items: center;
  & > * {
    margin-right: ${({theme:e})=>e.gridUnit}px;
  }
`,_a=v.iK.i`
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  left: -${({theme:e})=>5*e.gridUnit}px;
`,Ia=v.iK.button`
  cursor: pointer;
  display: flex;
  flex-wrap: wrap;
  text-align: left;
  padding: 0;
  border: none;
  background: none;
  outline: none;
  width: 100%;

  &::-moz-focus-inner {
    border: 0;
  }

  & i svg {
    color: transparent;
    margin-right: ${({theme:e})=>e.gridUnit}px;
  }

  &:hover i svg {
    color: inherit;
  }
`,Ma=v.iK.div`
  margin: 0 -${({theme:e})=>4*e.gridUnit}px;
`,Ea=v.iK.div`
  padding-left: ${({theme:e})=>6*e.gridUnit}px;
  margin: -${({theme:e})=>3*e.gridUnit}px 0;
`,Oa=v.iK.div`
  min-width: 200px;
  max-width: 300px;
  overflow-x: hidden;
`,Pa=v.iK.div`
  max-width: 100%;
  flex-grow: 1;
  overflow: auto;
  color: ${({theme:e})=>e.colors.grayscale.light5};
`,Na=v.iK.div`
  ${({theme:e})=>`\n  padding-top: ${3*e.gridUnit}px;\n  max-width: 100%;\n  flex-grow: 1;\n  overflow: auto;\n  color: ${e.colors.grayscale.light5};\n  `}
`;var ja=n(76570);n(14670);const qa=(0,d.t)("Please apply filter changes"),za=e=>null==e?"":"string"==typeof e||"number"==typeof e?`${e}`:Array.isArray(e)?e.join(", "):"object"==typeof e?JSON.stringify(e):(0,d.t)("Unknown value"),Aa=({filterSetFilterValues:e,dataMaskSelected:t})=>e.find((({dataMask:e={}})=>{const n=Object.entries(t);return n.every((([t,i])=>{var r;const o=(0,bi.JB)(i.filterState,null==e||null==(r=e[t])?void 0:r.filterState,{ignoreUndefined:!0,ignoreNull:!0}),a=n.length===Object.keys(null!=e?e:{}).length;return o&&a}))})),$a=({indicator:{column:e,name:t,value:n,path:i=[]},onClick:r=(()=>{}),text:o})=>{const s=za(n);return(0,b.tZ)(a.Fragment,null,(0,b.tZ)(Ia,{onClick:()=>r([...i,`LABEL-${e}`])},(0,b.tZ)(Da,{bold:!0},(0,b.tZ)(_a,null,(0,b.tZ)(ja.Z,null)),t,s?": ":""),(0,b.tZ)(Pa,null,s)),o&&(0,b.tZ)(Na,null,o))},Ua=({appliedCrossFilterIndicators:e=[],appliedIndicators:t=[],incompatibleIndicators:n=[],unsetIndicators:i=[],onHighlightFilterSource:r,children:s})=>{const[l,c]=(0,a.useState)(!1),u=(0,v.Fg)(),h=(0,o.v9)((e=>{var t;return null==(t=e.dashboardState)?void 0:t.activeTabs}));(0,a.useEffect)((()=>{l&&window.addEventListener("resize",(()=>c(!1)),{once:!0})}),[l]),(0,a.useEffect)((()=>{c(!1)}),[h]);const p=()=>{const i=[];return e.length&&i.push("appliedCrossFilters"),t.length&&i.push("applied"),n.length&&i.push("incompatible"),i.length?i:["unset"]},[f,m]=(0,a.useState)((()=>[...p()])),g=e=>`${e.column} - ${e.name}`,y=(0,b.tZ)(Oa,null,(0,b.tZ)(b.xB,{styles:(0,b.iv)(".filterStatusPopover{.ant-popover-inner{background-color:",u.colors.grayscale.dark2,"cc;.ant-popover-inner-content{padding-top:0;padding-bottom:0;}}&.ant-popover-placement-bottom,&.ant-popover-placement-bottomLeft,&.ant-popover-placement-bottomRight{&>.ant-popover-content>.ant-popover-arrow{border-top-color:",u.colors.grayscale.dark2,"cc;border-left-color:",u.colors.grayscale.dark2,"cc;}}&.ant-popover-placement-top,&.ant-popover-placement-topLeft,&.ant-popover-placement-topRight{&>.ant-popover-content>.ant-popover-arrow{border-bottom-color:",u.colors.grayscale.dark2,"cc;border-right-color:",u.colors.grayscale.dark2,"cc;}}&.ant-popover-placement-left,&.ant-popover-placement-leftTop,&.ant-popover-placement-leftBottom{&>.ant-popover-content>.ant-popover-arrow{border-top-color:",u.colors.grayscale.dark2,"cc;border-right-color:",u.colors.grayscale.dark2,"cc;}}&.ant-popover-placement-right,&.ant-popover-placement-rightTop,&.ant-popover-placement-rightBottom{&>.ant-popover-content>.ant-popover-arrow{border-bottom-color:",u.colors.grayscale.dark2,"cc;border-left-color:",u.colors.grayscale.dark2,"cc;}}&.ant-popover{color:",u.colors.grayscale.light4,";z-index:99;}}","")}),(0,b.tZ)(Ma,null,(0,b.tZ)($r.Z,{ghost:!0,light:!0,activeKey:f,onChange:function(e){m("string"==typeof e?[e]:e)}},e.length?(0,b.tZ)($r.Z.Panel,{key:"appliedCrossFilters",header:(0,b.tZ)(Da,{bold:!0,color:u.colors.primary.light1},(0,b.tZ)(nt.Z.CursorTarget,{css:(0,b.iv)({fill:u.colors.primary.light1},"",""),iconSize:"xl"}),(0,d.t)("Applied Cross Filters (%d)",e.length))},(0,b.tZ)(Ea,{css:(0,b.iv)({paddingBottom:3*u.gridUnit},"","")},e.map((e=>(0,b.tZ)($a,{key:g(e),indicator:e,onClick:r}))))):null,t.length?(0,b.tZ)($r.Z.Panel,{key:"applied",header:(0,b.tZ)(Da,{bold:!0,color:u.colors.success.base},(0,b.tZ)(Ca,null)," ",(0,d.t)("Applied Filters (%d)",t.length))},(0,b.tZ)(Ea,{css:(0,b.iv)({paddingBottom:3*u.gridUnit},"","")},t.map((e=>(0,b.tZ)($a,{key:g(e),indicator:e,onClick:r}))))):null,n.length?(0,b.tZ)($r.Z.Panel,{key:"incompatible",header:(0,b.tZ)(Da,{bold:!0,color:u.colors.alert.base},(0,b.tZ)(wa,null)," ",(0,d.t)("Incompatible Filters (%d)",n.length))},(0,b.tZ)(Ea,{css:(0,b.iv)({paddingBottom:3*u.gridUnit},"","")},n.map((e=>(0,b.tZ)($a,{key:g(e),indicator:e,onClick:r}))))):null,i.length?(0,b.tZ)($r.Z.Panel,{key:"unset",header:(0,b.tZ)(Da,{bold:!0,color:u.colors.grayscale.light1},(0,b.tZ)(Za,null)," ",(0,d.t)("Unset Filters (%d)",i.length)),disabled:!i.length},(0,b.tZ)(Ea,{css:(0,b.iv)({paddingBottom:3*u.gridUnit},"","")},i.map((e=>(0,b.tZ)($a,{key:g(e),indicator:e,onClick:r}))))):null)));return(0,b.tZ)(Fa.Z,{overlayClassName:"filterStatusPopover",content:y,visible:l,onVisibleChange:function(e){c(e),e&&m(p())},placement:"bottom",trigger:"click"},s)};var La,Va;!function(e){e.NativeFilters="nativeFilters",e.CrossFilters="crossFilters"}(La||(La={})),function(e){e.Unset="UNSET",e.Applied="APPLIED",e.Incompatible="INCOMPATIBLE",e.CrossFilterApplied="CROSS_FILTER_APPLIED"}(Va||(Va={}));const Ka=new Set(Object.values(Fe.i2)),Ba=e=>null!=e&&e.label?e.label:null!=e&&e.value?(0,Gi.Z)(null==e?void 0:e.value).join(", "):null,Wa=(e,t,n)=>{const i=t.columns[e],r=Array.isArray(i)?i:[i];if(null==i||t.isDateFilter&&i===Fe.vM||0===r.length)return[];if(t.isDateFilter&&Ka.has(e)){const t=((e===Fe.i2.time_grain_sqla?n.time_grain_sqla:n.granularity)||[]).reduce(((e,[t,n])=>({...e,[t]:n})),{});return r.map((e=>t[e]||e))}return r},Ha=e=>{var t,n;return new Set(((null==e||null==(t=e.queriesResponse)||null==(n=t[0])?void 0:n.applied_filters)||[]).map((e=>e.column)))},Ga=e=>{var t,n;return new Set(((null==e||null==(t=e.queriesResponse)||null==(n=t[0])?void 0:n.rejected_filters)||[]).map((e=>e.column)))},Ja={},Qa={},Ya={},Xa={},es={},ts=[],ns=({chartId:e})=>{var t,n;const i=(0,o.I0)(),r=(0,o.v9)((e=>e.datasources)),s=(0,o.v9)((e=>e.dashboardFilters)),l=(0,o.v9)((e=>{var t;return null==(t=e.nativeFilters)?void 0:t.filters})),d=(0,o.v9)((e=>e.dashboardInfo)),u=(0,o.v9)((e=>e.charts)),h=(0,o.v9)((e=>e.dashboardLayout.present)),p=(0,o.v9)((e=>e.dataMask)),[f,m]=(0,a.useState)(ts),[v,y]=(0,a.useState)(ts),C=(0,a.useCallback)((e=>{i((0,jt.E2)(e))}),[i]),S=u[e],x=(0,Xr.D)(S),w=null==x?void 0:x.chartStatus,k=(0,Xr.D)(s),R=(0,Xr.D)(r),Z=(null==S?void 0:S.chartStatus)&&["rendered","success"].includes(S.chartStatus);(0,a.useEffect)((()=>{if(!Z&&v.length>0)y(ts);else if("success"!==w){var t,n,i,o,a,l,d,c;(null==S||null==(t=S.queriesResponse)||null==(n=t[0])?void 0:n.rejected_filters)===(null==x||null==(i=x.queriesResponse)||null==(o=i[0])?void 0:o.rejected_filters)&&(null==S||null==(a=S.queriesResponse)||null==(l=a[0])?void 0:l.applied_filters)===(null==x||null==(d=x.queriesResponse)||null==(c=d[0])?void 0:c.applied_filters)&&s===k&&r===R||y(((e,t,n,i)=>{const r=Ha(i),o=Ga(i),a=Object.values(t).filter((t=>t.chartId!==e)),s=Object.entries(n).filter((([e])=>a.find((t=>t.datasourceId===e)))).map((([,e])=>e)),l=Qa[e];if(Ja[e]&&(0,bi.JB)(null==l?void 0:l.appliedColumns,r)&&(0,bi.JB)(null==l?void 0:l.rejectedColumns,o)&&(0,bi.JB)(null==l?void 0:l.matchingFilters,a)&&(0,bi.JB)(null==l?void 0:l.matchingDatasources,s))return Ja[e];const d=a.reduce(((t,i)=>t.concat(((e,t,n,i,r)=>{const o=(e,t)=>i.has(e)&&t.columns[e]?Va.Applied:r.has(e)?Va.Incompatible:Va.Unset;return Object.keys(t.columns).filter((n=>(0,an.Q1)({filterScope:t.scopes[n]}).includes(e))).map((e=>({column:e,name:t.labels[e]||e,value:Wa(e,t,n),status:o(e,t),path:t.directPathToFilter})))})(e,i,n[i.datasourceId]||{},r,o))),[]);return d.sort(((e,t)=>e.name.localeCompare(t.name))),Ja[e]=d,Qa[e]={appliedColumns:r,rejectedColumns:o,matchingFilters:a,matchingDatasources:s},d})(e,s,r,S))}}),[S,e,s,v.length,r,null==x?void 0:x.queriesResponse,w,k,R,Z]);const F=(0,Xr.D)(l),T=(0,Xr.D)(h),D=(0,Xr.D)(p),_=(0,Xr.D)(null==(t=d.metadata)?void 0:t.chart_configuration);(0,a.useEffect)((()=>{if(!Z&&f.length>0)m(ts);else if("success"!==w){var t,n,i,r,o,a,s,u,g,v;(null==S||null==(t=S.queriesResponse)||null==(n=t[0])?void 0:n.rejected_filters)===(null==x||null==(i=x.queriesResponse)||null==(r=i[0])?void 0:r.rejected_filters)&&(null==S||null==(o=S.queriesResponse)||null==(a=o[0])?void 0:a.applied_filters)===(null==x||null==(s=x.queriesResponse)||null==(u=s[0])?void 0:u.applied_filters)&&l===F&&h===T&&p===D&&_===(null==(g=d.metadata)?void 0:g.chart_configuration)||m(((e,t,n,i,r,o=es)=>{const a=Ha(i),s=Ga(i),l=Xa[n];if(Ya[n]&&(0,bi.JB)(null==l?void 0:l.appliedColumns,a)&&(0,bi.JB)(null==l?void 0:l.rejectedColumns,s)&&(null==l?void 0:l.nativeFilters)===e&&(null==l?void 0:l.dashboardLayout)===r&&(null==l?void 0:l.chartConfiguration)===o&&(null==l?void 0:l.dataMask)===t)return Ya[n];const d=({label:e,column:t,type:n=La.NativeFilters})=>{const i=null!==e;return n===La.CrossFilters&&i?Va.CrossFilterApplied:!t&&i?Va.Applied:t&&s.has(t)?Va.Incompatible:t&&a.has(t)&&i?Va.Applied:Va.Unset};let u=[];(0,c.c)(c.T.DASHBOARD_NATIVE_FILTERS)&&(u=e&&Object.values(e).filter((e=>e.type===cr.B.NATIVE_FILTER&&qi(e.scope,r).some((e=>{var t,i;return(null==(t=r[e])||null==(i=t.meta)?void 0:i.chartId)===n})))).map((e=>{var n,i,r;const o=null==(n=e.targets[0])||null==(i=n.column)?void 0:i.name,a=null==(r=t[e.id])?void 0:r.filterState,s=Ba(a);return{column:o,name:e.name,path:[e.id],status:d({label:s,column:o}),value:s}})));let h=[];(0,c.c)(c.T.DASHBOARD_CROSS_FILTERS)&&(h=Object.values(o).filter((e=>{var t;return qi(null==e||null==(t=e.crossFilters)?void 0:t.scope,r).some((e=>{var t,i;return(null==(t=r[e])||null==(i=t.meta)?void 0:i.chartId)===n}))})).map((e=>{var n,i,o;const a=null==(n=t[e.id])?void 0:n.filterState,s=Ba(a),l=null==a?void 0:a.filters,c=l&&Object.keys(l)[0],u=Object.values(r).find((t=>{var n;return(null==t||null==(n=t.meta)?void 0:n.chartId)===e.id}));return{column:c,name:null==u||null==(i=u.meta)?void 0:i.sliceName,path:[...null!=(o=null==u?void 0:u.parents)?o:[],null==u?void 0:u.id],status:d({label:s,type:La.CrossFilters}),value:s}})).filter((e=>e.status===Va.CrossFilterApplied)));const p=h.concat(u);return Ya[n]=p,Xa[n]={nativeFilters:e,dashboardLayout:r,chartConfiguration:o,dataMask:t,appliedColumns:a,rejectedColumns:s},p})(l,p,e,S,h,null==(v=d.metadata)?void 0:v.chart_configuration))}}),[S,e,null==(n=d.metadata)?void 0:n.chart_configuration,p,l,f.length,h,null==x?void 0:x.queriesResponse,_,w,T,D,F,Z]);const I=(0,a.useMemo)((()=>ga()((e=>{const t=[Va.Applied,Va.Unset,Va.Incompatible];return e.sort(((e,n)=>t.indexOf(e.status)-t.indexOf(n.status)))})([...v,...f]),((e,t)=>e.column===t.column&&e.name===t.name&&(e.status!==Va.Applied||t.status!==Va.Applied)))),[v,f]),M=(0,a.useMemo)((()=>I.filter((e=>e.status===Va.CrossFilterApplied))),[I]),E=(0,a.useMemo)((()=>I.filter((e=>e.status===Va.Applied))),[I]),O=(0,a.useMemo)((()=>I.filter((e=>e.status===Va.Unset))),[I]),P=(0,a.useMemo)((()=>I.filter((e=>e.status===Va.Incompatible))),[I]);if(!(M.length||E.length||P.length||O.length))return null;const N=!M.length&&!E.length&&!P.length;return(0,b.tZ)(Ua,{appliedCrossFilterIndicators:M,appliedIndicators:E,unsetIndicators:O,incompatibleIndicators:P,onHighlightFilterSource:C},(0,b.tZ)(Ta,{className:g()("filter-counts",!!P.length&&"has-incompatible-filters",!!M.length&&"has-cross-filters",N&&"filters-inactive")},(0,b.tZ)(nt.Z.Filter,{iconSize:"m"}),!N&&(0,b.tZ)("span",null,E.length+M.length),P.length?(0,b.tZ)(a.Fragment,null," ",(0,b.tZ)(nt.Z.AlertSolid,null),(0,b.tZ)("span",null,P.length)):null))},is=a.memo(ns),rs=(0,d.t)("Annotation layers are still loading."),os=(0,d.t)("One ore more annotation layers failed loading."),as=(0,v.iK)(nt.Z.CursorTarget)`
  cursor: pointer;
  color: ${({theme:e})=>e.colors.primary.base};
  height: 22px;
  width: 22px;
`,ss=({innerRef:e=null,forceRefresh:t=(()=>({})),updateSliceName:n=(()=>({})),toggleExpandSlice:i=(()=>({})),logExploreChart:r=(()=>({})),exploreUrl:s="#",exportCSV:l=(()=>({})),editMode:c=!1,annotationQuery:u={},annotationError:h={},cachedDttm:p=null,updatedDttm:f=null,isCached:m=[],isExpanded:g=!1,sliceName:v="",supersetCanExplore:y=!1,supersetCanShare:C=!1,supersetCanCSV:S=!1,sliceCanEdit:x=!1,exportFullCSV:w,slice:k,componentId:R,dashboardId:Z,addSuccessToast:F,addDangerToast:T,handleToggleFullSize:D,isFullSize:_,chartStatus:I,formData:M})=>{const E=(0,o.I0)(),O=(0,_i.fG)(),P=(0,o.v9)((e=>{var t,n;return null==(t=e.dataMask[null==k?void 0:k.slice_id])||null==(n=t.filterState)?void 0:n.value})),N=(0,a.useMemo)((()=>({value:P,name:(0,d.t)("Emitted values")})),[P]);return(0,b.tZ)("div",{className:"chart-header",ref:e},(0,b.tZ)("div",{className:"header-title"},(0,b.tZ)(rt.Z,{title:v||(c?"---":""),canEdit:c,emptyText:"",onSaveTitle:n,showTooltip:!1}),!!Object.values(u).length&&(0,b.tZ)(Ln.u,{id:"annotations-loading-tooltip",placement:"top",title:rs},(0,b.tZ)("i",{role:"img","aria-label":rs,className:"fa fa-refresh warning"})),!!Object.values(h).length&&(0,b.tZ)(Ln.u,{id:"annoation-errors-tooltip",placement:"top",title:os},(0,b.tZ)("i",{role:"img","aria-label":os,className:"fa fa-exclamation-circle danger"}))),(0,b.tZ)("div",{className:"header-controls"},!c&&(0,b.tZ)(a.Fragment,null,P&&(0,b.tZ)(Ln.u,{placement:"top",title:(0,b.tZ)($a,{indicator:N,text:(0,d.t)("Click to clear emitted filters")})},(0,b.tZ)(as,{onClick:()=>E((0,He.ze)(null==k?void 0:k.slice_id))})),!O.hideChartControls&&(0,b.tZ)(is,{chartId:k.slice_id}),!O.hideChartControls&&(0,b.tZ)(fa,{slice:k,isCached:m,isExpanded:g,cachedDttm:p,updatedDttm:f,toggleExpandSlice:i,forceRefresh:t,logExploreChart:r,exploreUrl:s,exportCSV:l,exportFullCSV:w,supersetCanExplore:y,supersetCanShare:C,supersetCanCSV:S,sliceCanEdit:x,componentId:R,dashboardId:Z,addSuccessToast:F,addDangerToast:T,handleToggleFullSize:D,isFullSize:_,chartStatus:I,formData:M}))))},ls={height:l().number.isRequired};function ds({height:e}){return(0,b.tZ)("div",{className:"missing-chart-container",style:{height:e+20}},(0,b.tZ)("div",{className:"missing-chart-body"},(0,d.t)("There is no chart definition associated with this component, could it have been deleted?"),(0,b.tZ)("br",null),(0,b.tZ)("br",null),(0,d.t)("Delete this container and save to remove this message.")))}ds.propTypes=ls;const cs={id:l().number.isRequired,componentId:l().string.isRequired,dashboardId:l().number.isRequired,width:l().number.isRequired,height:l().number.isRequired,updateSliceName:l().func.isRequired,isComponentVisible:l().bool,handleToggleFullSize:l().func.isRequired,chart:M.$6.isRequired,formData:l().object.isRequired,labelColors:l().object,datasource:l().object,slice:M.Rw.isRequired,sliceName:l().string.isRequired,timeout:l().number.isRequired,maxRows:l().number.isRequired,filterboxMigrationState:Fe.Qi,filters:l().object.isRequired,refreshChart:l().func.isRequired,logEvent:l().func.isRequired,toggleExpandSlice:l().func.isRequired,changeFilter:l().func.isRequired,setFocusedFilterField:l().func.isRequired,unsetFocusedFilterField:l().func.isRequired,editMode:l().bool.isRequired,isExpanded:l().bool.isRequired,isCached:l().bool,supersetCanExplore:l().bool.isRequired,supersetCanShare:l().bool.isRequired,supersetCanCSV:l().bool.isRequired,sliceCanEdit:l().bool.isRequired,addSuccessToast:l().func.isRequired,addDangerToast:l().func.isRequired,ownState:l().object,filterState:l().object},us=Object.keys(cs).filter((e=>"width"!==e&&"height"!==e&&"isComponentVisible"!==e)),hs=new Set(["filter_box"]),ps=v.iK.div`
  position: absolute;
  top: 0;
  left: 0;
  z-index: 5;

  &.is-deactivated {
    opacity: 0.5;
    background-color: ${({theme:e})=>e.colors.grayscale.light1};
  }
`;class fs extends a.Component{constructor(e){super(e),this.logExploreChart=()=>{this.props.logEvent(et.oK,{slice_id:this.props.slice.slice_id,is_cached:this.props.isCached})},this.getChartUrl=()=>(0,Ti.Cl)(this.props.formData),this.state={width:e.width,height:e.height,descriptionHeight:0},this.changeFilter=this.changeFilter.bind(this),this.handleFilterMenuOpen=this.handleFilterMenuOpen.bind(this),this.handleFilterMenuClose=this.handleFilterMenuClose.bind(this),this.exportCSV=this.exportCSV.bind(this),this.exportFullCSV=this.exportFullCSV.bind(this),this.forceRefresh=this.forceRefresh.bind(this),this.resize=this.resize.bind(this),this.setDescriptionRef=this.setDescriptionRef.bind(this),this.setHeaderRef=this.setHeaderRef.bind(this)}shouldComponentUpdate(e,t){if(t.width!==this.state.width||t.height!==this.state.height||t.descriptionHeight!==this.state.descriptionHeight||!Fi()(e.datasource,this.props.datasource))return!0;if(e.isComponentVisible){if(e.chart.triggerQuery)return!0;if(e.isFullSize!==this.props.isFullSize)return clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout(this.resize,350),!1;e.width===this.props.width&&e.height===this.props.height||(clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout(this.resize,350));for(let t=0;t<us.length;t+=1){const n=us[t];if(!(0,bi.JB)(e[n],this.props[n]))return!0}}return this.props.cacheBusterProp!==e.cacheBusterProp}componentWillUnmount(){clearTimeout(this.resizeTimeout)}componentDidUpdate(e){if(this.props.isExpanded!==e.isExpanded){const e=this.props.isExpanded&&this.descriptionRef?this.descriptionRef.offsetHeight:0;this.setState({descriptionHeight:e})}}getChartHeight(){const e=this.getHeaderHeight();return this.state.height-e-this.state.descriptionHeight}getHeaderHeight(){return this.headerRef&&this.headerRef.offsetHeight||22}setDescriptionRef(e){this.descriptionRef=e}setHeaderRef(e){this.headerRef=e}resize(){const{width:e,height:t}=this.props;this.setState((()=>({width:e,height:t})))}changeFilter(e={}){this.props.logEvent(et.Qg,{id:this.props.chart.id,columns:Object.keys(e)}),this.props.changeFilter(this.props.chart.id,e)}handleFilterMenuOpen(e,t){this.props.setFocusedFilterField(e,t)}handleFilterMenuClose(e,t){this.props.unsetFocusedFilterField(e,t)}exportCSV(e=!1){this.props.logEvent(et.PC,{slice_id:this.props.slice.slice_id,is_cached:this.props.isCached}),(0,Ti.pe)({formData:e?{...this.props.formData,row_limit:this.props.maxRows}:this.props.formData,resultType:"full",resultFormat:"csv"})}exportFullCSV(){this.exportCSV(!0)}forceRefresh(){return this.props.logEvent(et.TD,{slice_id:this.props.slice.slice_id,is_cached:this.props.isCached}),this.props.refreshChart(this.props.chart.id,!0,this.props.dashboardId)}render(){const{id:e,componentId:t,dashboardId:n,chart:i,slice:r,datasource:o,isExpanded:a,editMode:s,filters:l,formData:d,labelColors:c,updateSliceName:u,sliceName:h,toggleExpandSlice:p,timeout:f,supersetCanExplore:m,supersetCanShare:v,supersetCanCSV:y,sliceCanEdit:C,addSuccessToast:S,addDangerToast:x,ownState:w,filterState:k,handleToggleFullSize:R,isFullSize:Z,filterboxMigrationState:F}=this.props,{width:T}=this.state;if(!i||!r)return(0,b.tZ)(ds,{height:this.getChartHeight()});const{queriesResponse:D,chartUpdateEndTime:_,chartStatus:I}=i,M="loading"===I,E="filter_box"===r.viz_type&&[Fe.Qi.REVIEWING,Fe.Qi.CONVERTED].includes(F),O=(null==D?void 0:D.map((({is_cached:e})=>e)))||[],P=(null==D?void 0:D.map((({cached_dttm:e})=>e)))||[],N=hs.has(r.viz_type),j=(0,an.Z3)(e)?function({activeFilters:e={},filterId:t}){return Object.entries(e).reduce(((e,n)=>{const[i,{values:r}]=n,{chartId:o,column:a}=(0,Kt._)(i);return o===t?{...e,[a]:r}:e}),{})}({activeFilters:l,filterId:e}):{};return(0,b.tZ)("div",{className:"chart-slice","data-test-chart-id":e,"data-test-viz-type":r.viz_type,"data-test-chart-name":r.slice_name},(0,b.tZ)(ss,{innerRef:this.setHeaderRef,slice:r,isExpanded:!!a,isCached:O,cachedDttm:P,updatedDttm:_,toggleExpandSlice:p,forceRefresh:this.forceRefresh,editMode:s,annotationQuery:i.annotationQuery,logExploreChart:this.logExploreChart,exploreUrl:this.getChartUrl(),exportCSV:this.exportCSV,exportFullCSV:this.exportFullCSV,updateSliceName:u,sliceName:h,supersetCanExplore:m,supersetCanShare:v,supersetCanCSV:y,sliceCanEdit:C,componentId:t,dashboardId:n,filters:l,addSuccessToast:S,addDangerToast:x,handleToggleFullSize:R,isFullSize:Z,chartStatus:i.chartStatus,formData:d}),a&&r.description_markeddown&&(0,b.tZ)("div",{className:"slice_description bs-callout bs-callout-default",ref:this.setDescriptionRef,dangerouslySetInnerHTML:{__html:r.description_markeddown}}),(0,b.tZ)("div",{className:g()("dashboard-chart",N&&"dashboard-chart--overflowable")},(M||E)&&(0,b.tZ)(ps,{className:g()(E&&"is-deactivated"),style:{width:T,height:this.getChartHeight()}}),(0,b.tZ)(Di.Z,{width:T,height:this.getChartHeight(),addFilter:this.changeFilter,onFilterMenuOpen:this.handleFilterMenuOpen,onFilterMenuClose:this.handleFilterMenuClose,annotationData:i.annotationData,chartAlert:i.chartAlert,chartId:e,chartStatus:I,datasource:o,dashboardId:n,initialValues:j,formData:d,labelColors:c,ownState:w,filterState:k,queriesResponse:i.queriesResponse,timeout:f,triggerQuery:i.triggerQuery,vizType:r.viz_type,isDeactivatedViz:E,filterboxMigrationState:F})))}}fs.propTypes=cs,fs.defaultProps={isCached:!1,isComponentVisible:!0};var ms=n(9531);const gs={},vs=(0,o.$j)((function({charts:e,dashboardInfo:t,dashboardState:n,dashboardLayout:i,dataMask:r,datasources:o,sliceEntities:a,nativeFilters:s,common:l},d){var c,u,h,p;const{id:f}=d,m=e[f]||gs,g=m&&m.form_data&&o[m.form_data.datasource]||ms.t,{colorScheme:v,colorNamespace:b}=n,y=(null==t||null==(c=t.metadata)?void 0:c.label_colors)||{},C=function({chart:e,charts:t,filters:n,nativeFilters:i,chartConfiguration:r,colorScheme:o,colorNamespace:a,sliceId:s,layout:l,dataMask:d,labelColors:c}){const u=ki[s];if(wi[s]===n&&(0,bi.JB)(null==u?void 0:u.color_scheme,o,{ignoreUndefined:!0})&&(0,bi.JB)(null==u?void 0:u.color_namespace,a,{ignoreUndefined:!0})&&(0,bi.JB)(null==u?void 0:u.label_colors,c,{ignoreUndefined:!0})&&u&&(0,bi.JB)(null==u?void 0:u.dataMask,d,{ignoreUndefined:!0}))return u;let h={};const p=xi({chartConfiguration:r,dataMask:d,layout:l,nativeFilters:i.filters}),f=Object.entries(p).filter((([,{scope:t}])=>t.includes(e.id))).map((([e])=>e));f.length&&(h={extra_form_data:(0,vi.vk)(d,t,f)});const m={...e.formData,label_colors:c,...o&&{color_scheme:o},extra_filters:yi(n),...h};return wi[s]=n,ki[s]={...m,dataMask:d},m}({layout:i.present,chart:m,chartConfiguration:null==(u=t.metadata)?void 0:u.chart_configuration,charts:e,filters:(0,an._f)(f),colorScheme:v,colorNamespace:b,sliceId:f,nativeFilters:s,dataMask:r,labelColors:y});return C.dashboardId=t.id,{chart:m,datasource:g,labelColors:y,slice:a.slices[f],timeout:t.common.conf.SUPERSET_WEBSERVER_TIMEOUT,filters:(0,an.De)()||gs,formData:C,editMode:n.editMode,isExpanded:!!n.expandedSlices[f],supersetCanExplore:!!t.superset_can_explore,supersetCanShare:!!t.superset_can_share,supersetCanCSV:!!t.superset_can_csv,sliceCanEdit:!!t.slice_can_edit,ownState:null==(h=r[f])?void 0:h.ownState,filterState:null==(p=r[f])?void 0:p.filterState,maxRows:l.conf.SQL_MAX_ROW,filterboxMigrationState:n.filterboxMigrationState}}),(function(e){return(0,r.DE)({updateComponents:li.WZ,addSuccessToast:di.ws,addDangerToast:di.Gb,toggleExpandSlice:jt.WL,changeFilter:Nt.M6,setFocusedFilterField:jt.GH,unsetFocusedFilterField:jt.oY,refreshChart:gi.refreshChart,logEvent:ci.logEvent},e)}))(fs);var bs=n(13433);const ys={url:l().string,emailSubject:l().string,emailContent:l().string,addDangerToast:l().func.isRequired,placement:l().oneOf(["right","left","top","bottom"])};class Cs extends a.Component{constructor(e){super(e),this.state={shortUrl:""},this.onShortUrlSuccess=this.onShortUrlSuccess.bind(this),this.getCopyUrl=this.getCopyUrl.bind(this)}onShortUrlSuccess(e){this.setState((()=>({shortUrl:e})))}getCopyUrl(e){e.stopPropagation(),(0,pt.O)(this.props.url).then(this.onShortUrlSuccess).catch(this.props.addDangerToast)}renderPopover(){const e=(0,d.t)("%s%s",this.props.emailContent,this.state.shortUrl);return(0,b.tZ)("div",{id:"shorturl-popover"},(0,b.tZ)(bs.Z,{text:this.state.shortUrl,copyNode:(0,b.tZ)("i",{className:"fa fa-clipboard",title:(0,d.t)("Copy to clipboard")})}),"  ",(0,b.tZ)("a",{href:`mailto:?Subject=${this.props.emailSubject}%20&Body=${e}`},(0,b.tZ)("i",{className:"fa fa-envelope"})))}render(){return(0,b.tZ)(Fa.Z,{trigger:"click",placement:this.props.placement,onClick:this.getCopyUrl,content:this.renderPopover()},(0,b.tZ)("span",{className:"short-link-trigger btn btn-default btn-sm",role:"button"},(0,b.tZ)("i",{className:"short-link-trigger fa fa-link"})," "))}}Cs.defaultProps={url:window.location.href.substring(window.location.origin.length),placement:"left",emailSubject:"",emailContent:""},Cs.propTypes=ys;const Ss=(0,eo.Z)(Cs);var xs=n(56967);const ws={anchorLinkId:l().string.isRequired,filters:l().object,showShortLinkButton:l().bool,inFocus:l().bool,placement:l().oneOf(["right","left","top","bottom"])};class ks extends a.PureComponent{componentDidMount(){const e=(0,xs.Z)(),{anchorLinkId:t}=this.props;e&&t===e&&this.scrollToView()}UNSAFE_componentWillReceiveProps(e){const{inFocus:t=!1}=e;t&&this.scrollToView()}scrollToView(e=0){const{anchorLinkId:t}=this.props,n=document.getElementById(t);n&&setTimeout((()=>{n.scrollIntoView({block:"center",behavior:"smooth"})}),e)}render(){const{anchorLinkId:e,filters:t,showShortLinkButton:n,placement:i}=this.props;return(0,b.tZ)("span",{className:"anchor-link-container",id:e},n&&(0,b.tZ)(Ss,{url:Mn({pathname:window.location.pathname,filters:t,hash:e}),emailSubject:(0,d.t)("Superset chart"),emailContent:(0,d.t)("Check out this chart in dashboard:"),placement:i}))}}ks.propTypes=ws,ks.defaultProps={inFocus:!1,showShortLinkButton:!1,placement:"right",filters:{}};const Rs=ks,Zs={onDelete:l().func.isRequired};class Fs extends a.PureComponent{render(){const{onDelete:e}=this.props;return(0,b.tZ)(mi,{onClick:e,icon:(0,b.tZ)(nt.Z.Trash,{iconSize:"xl"})})}}Fs.propTypes=Zs,Fs.defaultProps={};const Ts=v.iK.div`
  .hover-menu {
    opacity: 0;
    position: absolute;
    z-index: 10;
    font-size: ${({theme:e})=>e.typography.sizes.m};
  }

  .hover-menu--left {
    width: ${({theme:e})=>6*e.gridUnit}px;
    top: 50%;
    transform: translate(0, -50%);
    left: ${({theme:e})=>-7*e.gridUnit}px;
    padding: ${({theme:e})=>2*e.gridUnit}px 0;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
  }

  .hover-menu--left > :nth-child(n):not(:only-child):not(:last-child) {
    margin-bottom: ${({theme:e})=>3*e.gridUnit}px;
  }

  .hover-menu--top {
    height: ${({theme:e})=>6*e.gridUnit}px;
    top: ${({theme:e})=>-6*e.gridUnit}px;
    left: 50%;
    transform: translate(-50%);
    padding: 0 ${({theme:e})=>2*e.gridUnit}px;
    display: flex;
    flex-direction: row;
    justify-content: center;
    align-items: center;
  }
`;class Ds extends a.PureComponent{render(){const{innerRef:e,position:t,children:n}=this.props;return(0,b.tZ)(Ts,{className:"hover-menu-container"},(0,b.tZ)("div",{ref:e,className:g()("hover-menu","left"===t&&"hover-menu--left","top"===t&&"hover-menu--top")},n))}}Ds.defaultProps={position:"left",innerRef:null,children:null};var _s=n(29119);const Is={right:function(){return(0,b.tZ)("div",{className:"resize-handle resize-handle--right"})},bottom:function(){return(0,b.tZ)("div",{className:"resize-handle resize-handle--bottom"})},bottomRight:function(){return(0,b.tZ)("div",{className:"resize-handle resize-handle--bottom-right"})}},Ms={top:!1,right:!0,bottom:!0,left:!1,topRight:!1,bottomRight:!0,bottomLeft:!1,topLeft:!1},Es={widthAndHeight:Ms,widthOnly:{...Ms,bottomRight:!1,bottom:!1},heightOnly:{...Ms,bottomRight:!1,right:!1},notAdjustable:{...Ms,bottomRight:!1,bottom:!1,right:!1}},Os=Number.MAX_VALUE,Ps={id:l().string.isRequired,children:l().node,adjustableWidth:l().bool,adjustableHeight:l().bool,gutterWidth:l().number,widthStep:l().number,heightStep:l().number,widthMultiple:l().number,heightMultiple:l().number,minWidthMultiple:l().number,maxWidthMultiple:l().number,minHeightMultiple:l().number,maxHeightMultiple:l().number,staticHeight:l().number,staticHeightMultiple:l().number,staticWidth:l().number,staticWidthMultiple:l().number,onResizeStop:l().func,onResize:l().func,onResizeStart:l().func,editMode:l().bool.isRequired},Ns={children:null,adjustableWidth:!0,adjustableHeight:!0,gutterWidth:_.es,widthStep:_.cd,heightStep:_.cd,widthMultiple:null,heightMultiple:null,minWidthMultiple:1,maxWidthMultiple:Os,minHeightMultiple:1,maxHeightMultiple:Os,staticHeight:null,staticHeightMultiple:null,staticWidth:null,staticWidthMultiple:null,onResizeStop:null,onResize:null,onResizeStart:null},js=[_.cd,_.cd],qs={right:"resizable-container-handle--right",bottom:"resizable-container-handle--bottom"};class zs extends a.PureComponent{constructor(e){super(e),this.state={isResizing:!1},this.handleResizeStart=this.handleResizeStart.bind(this),this.handleResize=this.handleResize.bind(this),this.handleResizeStop=this.handleResizeStop.bind(this)}handleResizeStart(e,t,n){const{id:i,onResizeStart:r}=this.props;r&&r({id:i,direction:t,ref:n}),this.setState((()=>({isResizing:!0})))}handleResize(e,t,n){const{onResize:i,id:r}=this.props;i&&i({id:r,direction:t,ref:n})}handleResizeStop(e,t,n,i){const{id:r,onResizeStop:o,widthStep:a,heightStep:s,widthMultiple:l,heightMultiple:d,adjustableHeight:c,adjustableWidth:u,gutterWidth:h}=this.props;if(o){const e=l+Math.round(i.width/(a+h)),t=d+Math.round(i.height/s);o({id:r,widthMultiple:u?e:null,heightMultiple:c?t:null}),this.setState((()=>({isResizing:!1})))}}render(){const{children:e,adjustableWidth:t,adjustableHeight:n,widthStep:i,heightStep:r,widthMultiple:o,heightMultiple:a,staticHeight:s,staticHeightMultiple:l,staticWidth:d,staticWidthMultiple:c,minWidthMultiple:u,maxWidthMultiple:h,minHeightMultiple:p,maxHeightMultiple:f,gutterWidth:m,editMode:v}=this.props,y={width:t?(i+m)*o-m:c&&c*i||d||void 0,height:n?r*a:l&&l*r||s||void 0};let C=Es.notAdjustable;v&&t&&n?C=Es.widthAndHeight:v&&t?C=Es.widthOnly:v&&n&&(C=Es.heightOnly);const{isResizing:S}=this.state;return(0,b.tZ)(_s.e,{enable:C,grid:js,minWidth:t?u*(i+m)-m:void 0,minHeight:n?p*r:void 0,maxWidth:t?Math.max(y.width,Math.min(Os,h*(i+m)-m)):void 0,maxHeight:n?Math.max(y.height,Math.min(Os,f*r)):void 0,size:y,onResizeStart:this.handleResizeStart,onResize:this.handleResize,onResizeStop:this.handleResizeStop,handleComponent:Is,className:g()("resizable-container",S&&"resizable-container--resizing"),handleClasses:qs},e)}}zs.propTypes=Ps,zs.defaultProps=Ns;const As=zs,$s={id:l().string.isRequired,parentId:l().string.isRequired,dashboardId:l().number.isRequired,component:M.cP.isRequired,parentComponent:M.cP.isRequired,getComponentById:l().func.isRequired,index:l().number.isRequired,depth:l().number.isRequired,editMode:l().bool.isRequired,directPathToChild:l().arrayOf(l().string),directPathLastUpdated:l().number,focusedFilterScope:l().object,fullSizeChartId:l().oneOf([l().number,null]),availableColumnCount:l().number.isRequired,columnWidth:l().number.isRequired,onResizeStart:l().func.isRequired,onResize:l().func.isRequired,onResizeStop:l().func.isRequired,deleteComponent:l().func.isRequired,updateComponents:l().func.isRequired,handleComponentDrop:l().func.isRequired,setFullSizeChartId:l().func.isRequired},Us=a.forwardRef((({chartId:e,...t},n)=>{const i=(0,v.Fg)(),r=(0,o.v9)((e=>e.nativeFilters)),a=function(e,t){if(!e.focusedFilterField)return null;const{chartId:n,column:i}=e.focusedFilterField;return{chartId:n,scope:t[n].scopes[i]}}((0,o.v9)((e=>e.dashboardState)),(0,o.v9)((e=>e.dashboardFilters))),s=r.focusedFilterId;if(!a&&!s)return(0,b.tZ)("div",ct()({ref:n},t));const l={borderColor:i.colors.primary.light2,opacity:1,boxShadow:`0px 0px ${2*i.gridUnit}px ${i.colors.primary.base}`,pointerEvents:"auto"};var d,c;if(s){if(null!=(d=r.filters[s])&&null!=(c=d.chartsInScope)&&c.includes(e))return(0,b.tZ)("div",ct()({ref:n,style:l},t))}else if(e===a.chartId||(0,an.Q1)({filterScope:a.scope}).includes(e))return(0,b.tZ)("div",ct()({ref:n,style:l},t));return(0,b.tZ)("div",ct()({ref:n,style:{opacity:.3,pointerEvents:"none"}},t))}));class Ls extends a.Component{static renderInFocusCSS(e){return(0,b.tZ)("style",null,`label[for=${e}] + .Select .Select__control {\n                    border-color: #00736a;\n                    transition: border-color 1s ease-in-out;\n           }`)}static getDerivedStateFromProps(e,t){const{component:n,directPathToChild:i,directPathLastUpdated:r}=e,{label:o,chart:a}=function(e){const t={};if(e.length>0){const n=e.slice();for(;n.length;){const e=n.pop(),i=e.split("-")[0];if(t[i.toLowerCase()]=e,!_.Ep.includes(i))break}}return t}(i);return r!==t.directPathLastUpdated&&n.id===a?{outlinedComponentId:n.id,outlinedColumnName:o,directPathLastUpdated:r}:null}constructor(e){super(e),this.state={isFocused:!1,outlinedComponentId:null,outlinedColumnName:null,directPathLastUpdated:0},this.handleChangeFocus=this.handleChangeFocus.bind(this),this.handleDeleteComponent=this.handleDeleteComponent.bind(this),this.handleUpdateSliceName=this.handleUpdateSliceName.bind(this),this.handleToggleFullSize=this.handleToggleFullSize.bind(this)}componentDidMount(){this.hideOutline({},this.state)}componentDidUpdate(e,t){this.hideOutline(t,this.state)}hideOutline(e,t){const{outlinedComponentId:n}=t,{outlinedComponentId:i}=e;n&&!i&&setTimeout((()=>{this.setState((()=>({outlinedComponentId:null,outlinedColumnName:null})))}),2e3)}handleChangeFocus(e){this.setState((()=>({isFocused:e})))}handleDeleteComponent(){const{deleteComponent:e,id:t,parentId:n}=this.props;e(t,n)}handleUpdateSliceName(e){const{component:t,updateComponents:n}=this.props;n({[t.id]:{...t,meta:{...t.meta,sliceNameOverride:e}}})}handleToggleFullSize(){const{component:e,fullSizeChartId:t,setFullSizeChartId:n}=this.props,{chartId:i}=e.meta;n(t===i?null:i)}render(){var e,t,n;const{isFocused:i}=this.state,{component:r,parentComponent:o,index:a,depth:s,availableColumnCount:l,columnWidth:d,onResizeStart:c,onResize:u,onResizeStop:h,handleComponentDrop:f,editMode:m,isComponentVisible:v,dashboardId:y,fullSizeChartId:C,getComponentById:S=(()=>{})}=this.props,{chartId:x}=r.meta,w=C===x,k=null==(e=S(null==(n=o.parents)?void 0:n.find((e=>e.startsWith(p.BA)))))||null==(t=e.meta)?void 0:t.width;let R=r.meta.width||_.cx;o.type===p.BA?R=o.meta.width||_.cx:k&&R>k&&(R=k);let Z=0,F=0;return w?(Z=window.innerWidth-32,F=window.innerHeight-32):(Z=Math.floor(R*d+(R-1)*_.es-32),F=Math.floor(r.meta.height*_.cd-32)),(0,b.tZ)(te,{component:r,parentComponent:o,orientation:o.type===p.Os?"column":"row",index:a,depth:s,onDrop:f,disableDragDrop:i,editMode:m},(({dropIndicatorProps:e,dragSourceRef:t})=>(0,b.tZ)(As,{id:r.id,adjustableWidth:o.type===p.Os,adjustableHeight:!0,widthStep:d,widthMultiple:R,heightStep:_.cd,heightMultiple:r.meta.height,minWidthMultiple:_.cx,minHeightMultiple:_.AA,maxWidthMultiple:l+R,onResizeStart:c,onResize:u,onResizeStop:h,editMode:m},(0,b.tZ)(Us,{chartId:x,ref:t,className:g()("dashboard-component","dashboard-component-chart-holder",this.state.outlinedComponentId?"fade-in":"fade-out",w&&"full-size")},!m&&(0,b.tZ)(Rs,{anchorLinkId:r.id,inFocus:!!this.state.outlinedComponentId}),!!this.state.outlinedComponentId&&Ls.renderInFocusCSS(this.state.outlinedColumnName),(0,b.tZ)(vs,{componentId:r.id,id:r.meta.chartId,dashboardId:y,width:Z,height:F,sliceName:r.meta.sliceNameOverride||r.meta.sliceName||"",updateSliceName:this.handleUpdateSliceName,isComponentVisible:v,handleToggleFullSize:this.handleToggleFullSize,isFullSize:w}),m&&(0,b.tZ)(Ds,{position:"top"},(0,b.tZ)("div",null,(0,b.tZ)(Fs,{onDelete:this.handleDeleteComponent})))),e&&(0,b.tZ)("div",e))))}}Ls.propTypes=$s,Ls.defaultProps={directPathToChild:[],directPathLastUpdated:0};const Vs=(0,o.$j)((function(e){return{directPathToChild:e.dashboardState.directPathToChild,directPathLastUpdated:e.dashboardState.directPathLastUpdated}}))(Ls);var Ks=n(78186);const Bs=(0,v.iK)(Re.v2.Item)`
  &.ant-menu-item {
    height: auto;
    line-height: 1.4;

    padding-top: ${({theme:e})=>e.gridUnit}px;
    padding-bottom: ${({theme:e})=>e.gridUnit}px;

    margin-top: 0;
    margin-bottom: 0;

    &:not(:last-child) {
      margin-bottom: 0;
    }

    &:hover {
      background: ${({theme:e})=>e.colors.grayscale.light3};
    }

    &.active {
      font-weight: ${({theme:e})=>e.typography.weights.bold};
      background: ${({theme:e})=>e.colors.grayscale.light2};
    }
  }

  &.ant-menu-item-selected {
    color: unset;
  }
`;var Ws={name:"s5xdrg",styles:"display:flex;align-items:center"};const Hs=e=>{const{value:t,options:n,onChange:i,renderButton:r=(e=>e.label),renderOption:o=(e=>(0,b.tZ)("div",{className:e.className},e.label))}=e,a=(0,v.Fg)(),s=n.find((e=>e.value===t));return(0,b.tZ)(Re.Lt,{trigger:["click"],overlayStyle:{zIndex:a.zIndex.max},overlay:(0,b.tZ)(Re.v2,{onClick:({key:e})=>i(e)},n.map((e=>(0,b.tZ)(Bs,{id:"menu-item",key:e.value,className:g()("dropdown-item",{active:e.value===t})},o(e)))))},(0,b.tZ)("div",{role:"button",css:Ws},s&&r(s),(0,b.tZ)(nt.Z.CaretDown,{iconColor:a.colors.grayscale.base,css:(0,b.iv)({marginTop:.5*a.gridUnit},"","")})))},Gs=[{value:"edit",label:(0,d.t)("Edit")},{value:"preview",label:(0,d.t)("Preview")}];class Js extends a.PureComponent{render(){const{id:e,value:t,onChange:n}=this.props;return(0,b.tZ)(Hs,{id:e,options:Gs,value:t,onChange:n})}}class Qs extends a.PureComponent{constructor(e){super(e),this.container=void 0,this.state={isFocused:e.isFocused},this.setRef=this.setRef.bind(this),this.handleClick=this.handleClick.bind(this)}UNSAFE_componentWillReceiveProps(e){e.editMode&&e.isFocused&&!this.state.isFocused?(document.addEventListener("click",this.handleClick),document.addEventListener("drag",this.handleClick),this.setState({isFocused:!0})):this.state.isFocused&&!e.editMode&&(document.removeEventListener("click",this.handleClick),document.removeEventListener("drag",this.handleClick),this.setState({isFocused:!1}))}componentWillUnmount(){document.removeEventListener("click",this.handleClick),document.removeEventListener("drag",this.handleClick)}setRef(e){this.container=e}handleClick(e){if(!this.props.editMode)return;const{onChangeFocus:t,shouldFocus:n,disableClick:i}=this.props,r=n(e,this.container);i||!r||this.state.isFocused?!r&&this.state.isFocused&&(document.removeEventListener("click",this.handleClick),document.removeEventListener("drag",this.handleClick),this.setState((()=>({isFocused:!1}))),t&&t(!1)):(document.addEventListener("click",this.handleClick),document.addEventListener("drag",this.handleClick),this.setState((()=>({isFocused:!0}))),t&&t(!0))}render(){var e;const{children:t,menuItems:n,editMode:i,style:r}=this.props,{isFocused:o}=this.state;return(0,b.tZ)("div",{ref:this.setRef,onClick:this.handleClick,role:"none",className:g()("with-popover-menu",i&&o&&"with-popover-menu--focused"),style:r},t,i&&o&&(null!=(e=null==n?void 0:n.length)?e:0)>0&&(0,b.tZ)("div",{className:"popover-menu"},n.map(((e,t)=>(0,b.tZ)("div",{className:"menu-item",key:`menu-item-${t}`},e)))))}}Qs.defaultProps={children:null,disableClick:!1,onChangeFocus:null,menuItems:[],isFocused:!1,shouldFocus:(e,t)=>{var n;return(null==t?void 0:t.contains(e.target))||"menu-item"===e.target.id||"menu-item"===(null==(n=e.target.parentNode)?void 0:n.id)},style:null};const Ys={id:l().string.isRequired,parentId:l().string.isRequired,component:M.cP.isRequired,parentComponent:M.cP.isRequired,index:l().number.isRequired,depth:l().number.isRequired,editMode:l().bool.isRequired,logEvent:l().func.isRequired,addDangerToast:l().func.isRequired,undoLength:l().number.isRequired,redoLength:l().number.isRequired,availableColumnCount:l().number.isRequired,columnWidth:l().number.isRequired,onResizeStart:l().func.isRequired,onResize:l().func.isRequired,onResizeStop:l().func.isRequired,deleteComponent:l().func.isRequired,handleComponentDrop:l().func.isRequired,updateComponents:l().func.isRequired},Xs="# ✨Markdown\n## ✨Markdown\n### ✨Markdown\n\n<br />\n\nClick here to edit [markdown](https://bit.ly/1dQOfRK)",el=(0,d.t)("This markdown component has an error.");class tl extends a.PureComponent{constructor(e){super(e),this.state={isFocused:!1,markdownSource:e.component.meta.code,editor:null,editorMode:"preview",undoLength:e.undoLength,redoLength:e.redoLength},this.renderStartTime=et.Yd.getTimestamp(),this.handleChangeFocus=this.handleChangeFocus.bind(this),this.handleChangeEditorMode=this.handleChangeEditorMode.bind(this),this.handleMarkdownChange=this.handleMarkdownChange.bind(this),this.handleDeleteComponent=this.handleDeleteComponent.bind(this),this.handleResizeStart=this.handleResizeStart.bind(this),this.setEditor=this.setEditor.bind(this)}componentDidMount(){this.props.logEvent(et.aD,{viz_type:"markdown",start_offset:this.renderStartTime,ts:(new Date).getTime(),duration:et.Yd.getTimestamp()-this.renderStartTime})}static getDerivedStateFromProps(e,t){const{hasError:n,editorMode:i,markdownSource:r,undoLength:o,redoLength:a}=t,{component:s,undoLength:l,redoLength:d}=e;return l!==o||d!==a?{...t,undoLength:l,redoLength:d,markdownSource:s.meta.code,hasError:!1}:n||"preview"!==i||s.meta.code===r?t:{...t,markdownSource:s.meta.code}}static getDerivedStateFromError(){return{hasError:!0}}componentDidUpdate(e){!this.state.editor||e.component.meta.width===this.props.component.meta.width&&e.columnWidth===this.props.columnWidth||this.state.editor.resize(!0),this.props.editMode&&vt.cE.preload()}componentDidCatch(){this.state.editor&&"preview"===this.state.editorMode&&this.props.addDangerToast((0,d.t)("This markdown component has an error. Please revert your recent changes."))}setEditor(e){e.getSession().setUseWrapMode(!0),this.setState({editor:e})}handleChangeFocus(e){const t=!!e,n=t?"edit":"preview";this.setState((()=>({isFocused:t}))),this.handleChangeEditorMode(n)}handleChangeEditorMode(e){const t={...this.state,editorMode:e};"preview"===e&&(this.updateMarkdownContent(),t.hasError=!1),this.setState(t)}updateMarkdownContent(){const{updateComponents:e,component:t}=this.props;t.meta.code!==this.state.markdownSource&&e({[t.id]:{...t,meta:{...t.meta,code:this.state.markdownSource}}})}handleMarkdownChange(e){this.setState({markdownSource:e})}handleDeleteComponent(){const{deleteComponent:e,id:t,parentId:n}=this.props;e(t,n)}handleResizeStart(e){const{editorMode:t}=this.state,{editMode:n,onResizeStart:i}=this.props,r="edit"===t;i(e),n&&r&&this.updateMarkdownContent()}renderEditMode(){return(0,b.tZ)(vt.cE,{onChange:this.handleMarkdownChange,width:"100%",height:"100%",showGutter:!1,editorProps:{$blockScrolling:!0},value:"string"==typeof this.state.markdownSource?this.state.markdownSource:Xs,readOnly:!1,onLoad:this.setEditor})}renderPreviewMode(){const{hasError:e}=this.state;return(0,b.tZ)(Ks.Z,{source:e?el:this.state.markdownSource||Xs})}render(){const{isFocused:e,editorMode:t}=this.state,{component:n,parentComponent:i,index:r,depth:o,availableColumnCount:a,columnWidth:s,onResize:l,onResizeStop:d,handleComponentDrop:c,editMode:u}=this.props,h=i.type===p.BA?i.meta.width||_.cx:n.meta.width||_.cx,f="edit"===t;return(0,b.tZ)(te,{component:n,parentComponent:i,orientation:i.type===p.Os?"column":"row",index:r,depth:o,onDrop:c,disableDragDrop:e,editMode:u},(({dropIndicatorProps:t,dragSourceRef:r})=>(0,b.tZ)(Qs,{onChangeFocus:this.handleChangeFocus,menuItems:[(0,b.tZ)(Js,{id:`${n.id}-mode`,value:this.state.editorMode,onChange:this.handleChangeEditorMode})],editMode:u},(0,b.tZ)("div",{className:g()("dashboard-markdown",f&&"dashboard-markdown--editing"),id:n.id},(0,b.tZ)(As,{id:n.id,adjustableWidth:i.type===p.Os,adjustableHeight:!0,widthStep:s,widthMultiple:h,heightStep:_.cd,heightMultiple:n.meta.height,minWidthMultiple:_.cx,minHeightMultiple:_.AA,maxWidthMultiple:a+h,onResizeStart:this.handleResizeStart,onResize:l,onResizeStop:d,editMode:!e&&u},(0,b.tZ)("div",{ref:r,className:"dashboard-component dashboard-component-chart-holder"},u&&(0,b.tZ)(Ds,{position:"top"},(0,b.tZ)(Fs,{onDelete:this.handleDeleteComponent})),u&&f?this.renderEditMode():this.renderPreviewMode()))),t&&(0,b.tZ)("div",t))))}}tl.propTypes=Ys,tl.defaultProps={};const nl=(0,o.$j)((function(e){return{undoLength:e.dashboardLayout.past.length,redoLength:e.dashboardLayout.future.length}}))(tl);function il({position:e="left",innerRef:t=null,dotCount:n=8}){return(0,b.tZ)("div",{ref:t,className:g()("drag-handle","left"===e&&"drag-handle--left","top"===e&&"drag-handle--top")},Array(n).fill(null).map(((e,t)=>(0,b.tZ)("div",{key:`handle-dot-${t}`,className:"drag-handle-dot"}))))}var rl=n(713);function ol(e){return(0,b.tZ)("div",{className:g()("background-style-option",e.className)},`${e.label} background`)}function al(e){return(0,b.tZ)("div",{className:g()("background-style-option",e.className)},e.label)}class sl extends a.PureComponent{render(){const{id:e,value:t,onChange:n}=this.props;return(0,b.tZ)(Hs,{id:e,options:rl.Z,value:t,onChange:n,renderButton:ol,renderOption:al})}}const ll={id:l().string.isRequired,parentId:l().string.isRequired,component:M.cP.isRequired,parentComponent:M.cP.isRequired,index:l().number.isRequired,depth:l().number.isRequired,editMode:l().bool.isRequired,availableColumnCount:l().number.isRequired,columnWidth:l().number.isRequired,minColumnWidth:l().number.isRequired,onResizeStart:l().func.isRequired,onResize:l().func.isRequired,onResizeStop:l().func.isRequired,deleteComponent:l().func.isRequired,handleComponentDrop:l().func.isRequired,updateComponents:l().func.isRequired};class dl extends a.PureComponent{constructor(e){super(e),this.state={isFocused:!1},this.handleChangeBackground=this.handleUpdateMeta.bind(this,"background"),this.handleChangeFocus=this.handleChangeFocus.bind(this),this.handleDeleteComponent=this.handleDeleteComponent.bind(this)}handleDeleteComponent(){const{deleteComponent:e,id:t,parentId:n}=this.props;e(t,n)}handleChangeFocus(e){this.setState((()=>({isFocused:Boolean(e)})))}handleUpdateMeta(e,t){const{updateComponents:n,component:i}=this.props;t&&i.meta[e]!==t&&n({[i.id]:{...i,meta:{...i.meta,[e]:t}}})}render(){const{component:e,parentComponent:t,index:n,availableColumnCount:i,columnWidth:r,minColumnWidth:o,depth:a,onResizeStart:s,onResize:l,onResizeStop:d,handleComponentDrop:c,editMode:u,onChangeTab:h,isComponentVisible:p}=this.props,f=e.children||[],m=rl.Z.find((t=>t.value===(e.meta.background||_.HE)));return(0,b.tZ)(te,{component:e,parentComponent:t,orientation:"column",index:n,depth:a,onDrop:c,editMode:u},(({dropIndicatorProps:t,dragSourceRef:n})=>(0,b.tZ)(As,{id:e.id,adjustableWidth:!0,adjustableHeight:!1,widthStep:r,widthMultiple:e.meta.width,minWidthMultiple:o,maxWidthMultiple:i+(e.meta.width||0),onResizeStart:s,onResize:l,onResizeStop:d,editMode:u},(0,b.tZ)(Qs,{isFocused:this.state.isFocused,onChangeFocus:this.handleChangeFocus,disableClick:!0,menuItems:[(0,b.tZ)(sl,{id:`${e.id}-background`,value:e.meta.background,onChange:this.handleChangeBackground})],editMode:u},u&&(0,b.tZ)(Ds,{innerRef:n,position:"top"},(0,b.tZ)(il,{position:"top"}),(0,b.tZ)(Fs,{onDelete:this.handleDeleteComponent}),(0,b.tZ)(mi,{onClick:this.handleChangeFocus,icon:(0,b.tZ)(nt.Z.Cog,{iconSize:"xl"})})),(0,b.tZ)("div",{className:g()("grid-column",0===f.length&&"grid-column--empty",m.className)},f.map(((t,n)=>(0,b.tZ)($l,{key:t,id:t,parentId:e.id,depth:a+1,index:n,availableColumnCount:e.meta.width,columnWidth:r,onResizeStart:s,onResize:l,onResizeStop:d,isComponentVisible:p,onChangeTab:h}))),t&&(0,b.tZ)("div",t))))))}}dl.propTypes=ll,dl.defaultProps={};const cl=dl,ul={id:l().string.isRequired,parentId:l().string.isRequired,component:M.cP.isRequired,depth:l().number.isRequired,parentComponent:M.cP.isRequired,index:l().number.isRequired,editMode:l().bool.isRequired,handleComponentDrop:l().func.isRequired,deleteComponent:l().func.isRequired};class hl extends a.PureComponent{constructor(e){super(e),this.handleDeleteComponent=this.handleDeleteComponent.bind(this)}handleDeleteComponent(){const{deleteComponent:e,id:t,parentId:n}=this.props;e(t,n)}render(){const{component:e,depth:t,parentComponent:n,index:i,handleComponentDrop:r,editMode:o}=this.props;return(0,b.tZ)(te,{component:e,parentComponent:n,orientation:"row",index:i,depth:t,onDrop:r,editMode:o},(({dropIndicatorProps:e,dragSourceRef:t})=>(0,b.tZ)("div",{ref:t},o&&(0,b.tZ)(Ds,{position:"left"},(0,b.tZ)(Fs,{onDelete:this.handleDeleteComponent})),(0,b.tZ)("div",{className:"dashboard-component dashboard-component-divider"}),e&&(0,b.tZ)("div",e))))}}hl.propTypes=ul;const pl=hl;var fl=n(79271);const ml={id:l().string.isRequired,parentId:l().string.isRequired,component:M.cP.isRequired,depth:l().number.isRequired,parentComponent:M.cP.isRequired,index:l().number.isRequired,editMode:l().bool.isRequired,filters:l().object.isRequired,handleComponentDrop:l().func.isRequired,deleteComponent:l().func.isRequired,updateComponents:l().func.isRequired};class gl extends a.PureComponent{constructor(e){super(e),this.state={isFocused:!1},this.handleDeleteComponent=this.handleDeleteComponent.bind(this),this.handleChangeFocus=this.handleChangeFocus.bind(this),this.handleUpdateMeta=this.handleUpdateMeta.bind(this),this.handleChangeSize=this.handleUpdateMeta.bind(this,"headerSize"),this.handleChangeBackground=this.handleUpdateMeta.bind(this,"background"),this.handleChangeText=this.handleUpdateMeta.bind(this,"text")}handleChangeFocus(e){this.setState((()=>({isFocused:e})))}handleUpdateMeta(e,t){const{updateComponents:n,component:i}=this.props;t&&i.meta[e]!==t&&n({[i.id]:{...i,meta:{...i.meta,[e]:t}}})}handleDeleteComponent(){const{deleteComponent:e,id:t,parentId:n}=this.props;e(t,n)}render(){const{isFocused:e}=this.state,{component:t,depth:n,parentComponent:i,index:r,handleComponentDrop:o,editMode:a,filters:s}=this.props,l=fl.Z.find((e=>e.value===(t.meta.headerSize||_.u_))),d=rl.Z.find((e=>e.value===(t.meta.background||_.HE)));return(0,b.tZ)(te,{component:t,parentComponent:i,orientation:"row",index:r,depth:n,onDrop:o,disableDragDrop:e,editMode:a},(({dropIndicatorProps:e,dragSourceRef:i})=>(0,b.tZ)("div",{ref:i},a&&n<=2&&(0,b.tZ)(Ds,{position:"left"},(0,b.tZ)(il,{position:"left"})),(0,b.tZ)(Qs,{onChangeFocus:this.handleChangeFocus,menuItems:[(0,b.tZ)(Hs,{id:`${t.id}-header-style`,options:fl.Z,value:t.meta.headerSize,onChange:this.handleChangeSize}),(0,b.tZ)(sl,{id:`${t.id}-background`,value:t.meta.background,onChange:this.handleChangeBackground})],editMode:a},(0,b.tZ)("div",{className:g()("dashboard-component","dashboard-component-header",l.className,d.className)},a&&(0,b.tZ)(Ds,{position:"top"},(0,b.tZ)(Fs,{onDelete:this.handleDeleteComponent})),(0,b.tZ)(rt.Z,{title:t.meta.text,canEdit:a,onSaveTitle:this.handleChangeText,showTooltip:!1}),!a&&(0,b.tZ)(Rs,{anchorLinkId:t.id,filters:s,showShortLinkButton:!0}))),e&&(0,b.tZ)("div",e))))}}gl.propTypes=ml,gl.defaultProps={};const vl=gl,bl={id:l().string.isRequired,parentId:l().string.isRequired,component:M.cP.isRequired,parentComponent:M.cP.isRequired,index:l().number.isRequired,depth:l().number.isRequired,editMode:l().bool.isRequired,availableColumnCount:l().number.isRequired,columnWidth:l().number.isRequired,occupiedColumnCount:l().number.isRequired,onResizeStart:l().func.isRequired,onResize:l().func.isRequired,onResizeStop:l().func.isRequired,handleComponentDrop:l().func.isRequired,deleteComponent:l().func.isRequired,updateComponents:l().func.isRequired};class yl extends a.PureComponent{constructor(e){super(e),this.state={isFocused:!1},this.handleDeleteComponent=this.handleDeleteComponent.bind(this),this.handleUpdateMeta=this.handleUpdateMeta.bind(this),this.handleChangeBackground=this.handleUpdateMeta.bind(this,"background"),this.handleChangeFocus=this.handleChangeFocus.bind(this)}handleChangeFocus(e){this.setState((()=>({isFocused:Boolean(e)})))}handleUpdateMeta(e,t){const{updateComponents:n,component:i}=this.props;t&&i.meta[e]!==t&&n({[i.id]:{...i,meta:{...i.meta,[e]:t}}})}handleDeleteComponent(){const{deleteComponent:e,component:t,parentId:n}=this.props;e(t.id,n)}render(){const{component:e,parentComponent:t,index:n,availableColumnCount:i,columnWidth:r,occupiedColumnCount:o,depth:a,onResizeStart:s,onResize:l,onResizeStop:d,handleComponentDrop:c,editMode:u,onChangeTab:h,isComponentVisible:p}=this.props,f=e.children||[],m=rl.Z.find((t=>t.value===(e.meta.background||_.HE)));return(0,b.tZ)(te,{component:e,parentComponent:t,orientation:"row",index:n,depth:a,onDrop:c,editMode:u},(({dropIndicatorProps:t,dragSourceRef:n})=>(0,b.tZ)(Qs,{isFocused:this.state.isFocused,onChangeFocus:this.handleChangeFocus,disableClick:!0,menuItems:[(0,b.tZ)(sl,{id:`${e.id}-background`,value:m.value,onChange:this.handleChangeBackground})],editMode:u},u&&(0,b.tZ)(Ds,{innerRef:n,position:"left"},(0,b.tZ)(il,{position:"left"}),(0,b.tZ)(Fs,{onDelete:this.handleDeleteComponent}),(0,b.tZ)(mi,{onClick:this.handleChangeFocus,icon:(0,b.tZ)(nt.Z.Cog,{iconSize:"xl"})})),(0,b.tZ)("div",{className:g()("grid-row",0===f.length&&"grid-row--empty",m.className)},f.map(((t,n)=>(0,b.tZ)($l,{key:t,id:t,parentId:e.id,depth:a+1,index:n,availableColumnCount:i-o,columnWidth:r,onResizeStart:s,onResize:l,onResizeStop:d,isComponentVisible:p,onChangeTab:h}))),t&&(0,b.tZ)("div",t)))))}}yl.propTypes=bl;const Cl=yl,Sl="RENDER_TAB",xl="RENDER_TAB_CONTENT",wl={id:l().string.isRequired,parentId:l().string.isRequired,component:M.cP.isRequired,parentComponent:M.cP.isRequired,index:l().number.isRequired,depth:l().number.isRequired,renderType:l().oneOf([Sl,xl]).isRequired,onDropOnTab:l().func,editMode:l().bool.isRequired,filters:l().object.isRequired,availableColumnCount:l().number,columnWidth:l().number,onResizeStart:l().func,onResize:l().func,onResizeStop:l().func,handleComponentDrop:l().func.isRequired,updateComponents:l().func.isRequired,setDirectPathToChild:l().func.isRequired},kl={availableColumnCount:0,columnWidth:0,onDropOnTab(){},onResizeStart(){},onResize(){},onResizeStop(){}},Rl=v.iK.div`
  ${({isHighlighted:e,theme:{gridUnit:t,colors:n}})=>`\n    padding: ${t}px ${2*t}px;\n    margin: ${-t}px ${-2*t}px;\n    transition: box-shadow 0.2s ease-in-out;\n    ${e&&`box-shadow: 0 0 ${t}px ${n.primary.light1};`}\n  `}
`,Zl=e=>e.dropIndicatorProps&&(0,b.tZ)("div",{className:"drop-indicator drop-indicator--bottom"}),Fl=e=>e.dropIndicatorProps&&(0,b.tZ)("div",{className:"drop-indicator drop-indicator--top"});class Tl extends a.PureComponent{constructor(e){super(e),this.handleChangeText=this.handleChangeText.bind(this),this.handleDrop=this.handleDrop.bind(this),this.handleTopDropTargetDrop=this.handleTopDropTargetDrop.bind(this),this.handleChangeTab=this.handleChangeTab.bind(this)}handleChangeTab({pathToTabIndex:e}){this.props.setDirectPathToChild(e)}handleChangeText(e){const{updateComponents:t,component:n}=this.props;e&&e!==n.meta.text&&t({[n.id]:{...n,meta:{...n.meta,text:e}}})}handleDrop(e){this.props.handleComponentDrop(e),this.props.onDropOnTab(e)}handleTopDropTargetDrop(e){e&&this.props.handleComponentDrop({...e,destination:{...e.destination,index:0}})}renderTabContent(){const{component:e,parentComponent:t,depth:n,availableColumnCount:i,columnWidth:r,onResizeStart:o,onResize:a,onResizeStop:s,editMode:l,isComponentVisible:d}=this.props;return(0,b.tZ)("div",{className:"dashboard-component-tabs-content"},l&&(0,b.tZ)(te,{component:e,parentComponent:t,orientation:"column",index:0,depth:n,onDrop:this.handleTopDropTargetDrop,editMode:!0,className:"empty-droptarget"},Fl),e.children.map(((t,l)=>(0,b.tZ)($l,{key:t,id:t,parentId:e.id,depth:n,index:l,onDrop:this.handleDrop,availableColumnCount:i,columnWidth:r,onResizeStart:o,onResize:a,onResizeStop:s,isComponentVisible:d,onChangeTab:this.handleChangeTab}))),l&&(0,b.tZ)(te,{component:e,parentComponent:t,orientation:"column",index:e.children.length,depth:n,onDrop:this.handleDrop,editMode:!0,className:"empty-droptarget"},Zl))}renderTab(){const{component:e,parentComponent:t,index:n,depth:i,editMode:r,filters:o,isFocused:a,isHighlighted:s}=this.props;return(0,b.tZ)(te,{component:e,parentComponent:t,orientation:"column",index:n,depth:i,onDrop:this.handleDrop,editMode:r},(({dropIndicatorProps:t,dragSourceRef:i})=>(0,b.tZ)(Rl,{isHighlighted:s,className:"dragdroppable-tab",ref:i},(0,b.tZ)(rt.Z,{title:e.meta.text,defaultTitle:e.meta.defaultText,placeholder:e.meta.placeholder,canEdit:r&&a,onSaveTitle:this.handleChangeText,showTooltip:!1,editing:r&&a}),!r&&(0,b.tZ)(Rs,{anchorLinkId:e.id,filters:o,showShortLinkButton:!0,placement:n>=5?"left":"right"}),t&&(0,b.tZ)("div",t))))}render(){const{renderType:e}=this.props;return e===Sl?this.renderTab():this.renderTabContent()}}function Dl({currentComponent:e,directPathToChild:t=[]}){if(!e||0===t.length||-1===t.indexOf(e.id))return-1;const n=t.findIndex((t=>t===e.id)),i=t[n+1];return e.children.indexOf(i)>=0?e.children.findIndex((e=>e===i)):-1}function _l(e,t){const n=(e.parents||[]).slice();return n.push(e.id),n.push(e.children[t]),n}function Il(e=[]){if(e.length>0){const t=e.slice();for(;t.length;){const e=t.pop(),n=e&&e.split("-")[0];if(!_.Ep.includes(n))return e}}return null}Tl.propTypes=wl,Tl.defaultProps=kl;const Ml={id:l().string.isRequired,parentId:l().string.isRequired,component:M.cP.isRequired,parentComponent:M.cP.isRequired,index:l().number.isRequired,depth:l().number.isRequired,renderTabContent:l().bool,editMode:l().bool.isRequired,renderHoverMenu:l().bool,directPathToChild:l().arrayOf(l().string),filterboxMigrationState:Fe.Qi,logEvent:l().func.isRequired,setActiveTabs:l().func,availableColumnCount:l().number,columnWidth:l().number,onResizeStart:l().func,onResize:l().func,onResizeStop:l().func,createComponent:l().func.isRequired,handleComponentDrop:l().func.isRequired,onChangeTab:l().func.isRequired,deleteComponent:l().func.isRequired,updateComponents:l().func.isRequired},El={renderTabContent:!0,renderHoverMenu:!0,availableColumnCount:0,columnWidth:0,directPathToChild:[],filterboxMigrationState:Fe.Qi.NOOP,setActiveTabs(){},onResizeStart(){},onResize(){},onResizeStop(){}},Ol=v.iK.div`
  width: 100%;
  background-color: ${({theme:e})=>e.colors.grayscale.light5};

  .dashboard-component-tabs-content {
    min-height: ${({theme:e})=>12*e.gridUnit}px;
    margin-top: ${({theme:e})=>e.gridUnit/4}px;
    position: relative;
  }

  .ant-tabs {
    overflow: visible;

    .ant-tabs-nav-wrap {
      min-height: ${({theme:e})=>12.5*e.gridUnit}px;
    }

    .ant-tabs-content-holder {
      overflow: visible;
    }
  }

  div .ant-tabs-tab-btn {
    text-transform: none;
  }
`;class Pl extends a.PureComponent{constructor(e){super(e),this.showDeleteConfirmModal=e=>{const{component:t,deleteComponent:n}=this.props;Re.u_.confirm({title:(0,d.t)("Delete dashboard tab?"),content:(0,b.tZ)("span",null,"Deleting a tab will remove all content within it. You may still reverse this action with the ",(0,b.tZ)("b",null,"undo")," button (cmd + z) until you save your changes."),onOk:()=>{n(e,t.id);const i=t.children.indexOf(e);this.handleDeleteTab(i)},okType:"danger",okText:"DELETE",cancelText:"CANCEL",icon:null})},this.handleEdit=(e,t)=>{const{component:n,createComponent:i}=this.props;"add"===t?i({destination:{id:n.id,type:n.type,index:n.children.length},dragging:{id:_.Xk,type:p.gn}}):"remove"===t&&this.showDeleteConfirmModal(e)};const t=Math.max(0,Dl({currentComponent:e.component,directPathToChild:e.directPathToChild})),{children:n}=e.component,i=n[t];this.state={tabIndex:t,activeKey:i},this.handleClickTab=this.handleClickTab.bind(this),this.handleDeleteComponent=this.handleDeleteComponent.bind(this),this.handleDeleteTab=this.handleDeleteTab.bind(this),this.handleDropOnTab=this.handleDropOnTab.bind(this),this.handleDrop=this.handleDrop.bind(this)}componentDidMount(){this.props.setActiveTabs(this.state.activeKey)}componentDidUpdate(e,t){t.activeKey===this.state.activeKey&&e.filterboxMigrationState===this.props.filterboxMigrationState||this.props.setActiveTabs(this.state.activeKey,t.activeKey)}UNSAFE_componentWillReceiveProps(e){const t=Math.max(0,e.component.children.length-1),n=this.props.component.children,i=e.component.children;if(this.state.tabIndex>t&&this.setState((()=>({tabIndex:t}))),i.length){const e=i[i.length-1];i.length>n.length&&this.setState((()=>({activeKey:e,tabIndex:t}))),i.length<n.length&&this.setState((()=>({activeKey:i[0]})))}if(e.isComponentVisible&&Il(e.directPathToChild)!==Il(this.props.directPathToChild)){const t=Dl({currentComponent:e.component,directPathToChild:e.directPathToChild});t>-1&&t!==this.state.tabIndex&&this.setState((()=>({tabIndex:t,activeKey:i[t]})))}}handleClickTab(e){const{component:t}=this.props,{children:n}=t;if(e!==this.state.tabIndex){const n=_l(t,e),i=n[n.length-1];this.props.logEvent(et.Iq,{target_id:i,index:e}),this.props.onChangeTab({pathToTabIndex:n})}this.setState((()=>({activeKey:n[e]})))}handleDeleteComponent(){const{deleteComponent:e,id:t,parentId:n}=this.props;e(t,n)}handleDeleteTab(e){this.handleClickTab(Math.max(0,e-1))}handleDropOnTab(e){const{component:t}=this.props,{destination:n}=e;if(n){const e=n.id===t.id?n.index:t.children.indexOf(n.id);e>-1&&setTimeout((()=>{this.handleClickTab(e)}),30)}}handleDrop(e){e.dragging.type!==p.yR&&this.props.handleComponentDrop(e)}render(){const{depth:e,component:t,parentComponent:n,index:i,availableColumnCount:r,columnWidth:o,onResizeStart:a,onResize:s,onResizeStop:l,renderTabContent:d,renderHoverMenu:c,isComponentVisible:u,editMode:h,nativeFilters:p}=this.props,{children:f}=t,{tabIndex:m,activeKey:g}=this.state;let v;return null!=p&&p.focusedFilterId&&(v=p.filters[p.focusedFilterId].tabsInScope),(0,b.tZ)(te,{component:t,parentComponent:n,orientation:"row",index:i,depth:e,onDrop:this.handleDrop,editMode:h},(({dropIndicatorProps:i,dragSourceRef:p})=>(0,b.tZ)(Ol,{className:"dashboard-component dashboard-component-tabs"},h&&c&&(0,b.tZ)(Ds,{innerRef:p,position:"left"},(0,b.tZ)(il,{position:"left"}),(0,b.tZ)(Fs,{onDelete:this.handleDeleteComponent})),(0,b.tZ)(C.cl,{id:t.id,activeKey:g,onChange:e=>{this.handleClickTab(f.indexOf(e))},onEdit:this.handleEdit,type:h?"editable-card":"card"},f.map(((n,i)=>{var c;return(0,b.tZ)(C.cl.TabPane,{key:n,tab:(0,b.tZ)($l,{id:n,parentId:t.id,depth:e,index:i,renderType:Sl,availableColumnCount:r,columnWidth:o,onDropOnTab:this.handleDropOnTab,isFocused:g===n,isHighlighted:g!==n&&(null==(c=v)?void 0:c.includes(n))})},d&&(0,b.tZ)($l,{id:n,parentId:t.id,depth:e,index:i,renderType:xl,availableColumnCount:r,columnWidth:o,onResizeStart:a,onResize:s,onResizeStop:l,onDropOnTab:this.handleDropOnTab,isComponentVisible:m===i&&u}))}))),i&&n.id!==_._4&&(0,b.tZ)("div",i))))}}Pl.propTypes=Ml,Pl.defaultProps=El;const Nl=(0,o.$j)((function(e){return{nativeFilters:e.nativeFilters,directPathToChild:e.dashboardState.directPathToChild,filterboxMigrationState:e.dashboardState.filterboxMigrationState}}))(Pl),jl={[p.dW]:Vs,[p.xh]:nl,[p.BA]:cl,[p.hE]:pl,[p.Nc]:vl,[p.Os]:Cl,[p.gn]:Tl,[p.yR]:Nl};var ql=n(72673);const zl={id:l().string,parentId:l().string,depth:l().number,index:l().number,renderHoverMenu:l().bool,renderTabContent:l().bool,onChangeTab:l().func,component:M.cP.isRequired,parentComponent:M.cP.isRequired,createComponent:l().func.isRequired,deleteComponent:l().func.isRequired,updateComponents:l().func.isRequired,handleComponentDrop:l().func.isRequired,logEvent:l().func.isRequired,directPathToChild:l().arrayOf(l().string),directPathLastUpdated:l().number,dashboardId:l().number.isRequired,isComponentVisible:l().bool};class Al extends a.PureComponent{render(){const{component:e}=this.props,t=e?jl[e.type]:null;return t?(0,b.tZ)(t,this.props):null}}Al.propTypes=zl,Al.defaultProps={isComponentVisible:!0};const $l=(0,o.$j)((function({dashboardLayout:e,dashboardState:t,dashboardInfo:n},i){const r=e.present,{id:o,parentId:a}=i,s=r[o],l={component:s,getComponentById:e=>r[e],parentComponent:r[a],editMode:t.editMode,filters:(0,an.De)(),dashboardId:n.id,fullSizeChartId:t.fullSizeChartId};if(s){const e=s.type;if(e===p.Os||e===p.BA){const{occupiedWidth:t,minimumWidth:n}=(0,ql.Z)({id:o,components:r});e===p.Os&&(l.occupiedColumnCount=t),e===p.BA&&(l.minColumnWidth=n)}}return l}),(function(e){return(0,r.DE)({addDangerToast:di.Gb,createComponent:li.LM,deleteComponent:li.v7,updateComponents:li.WZ,handleComponentDrop:li._p,setDirectPathToChild:jt.E2,setFullSizeChartId:jt.zL,setActiveTabs:jt.$_,logEvent:ci.logEvent},e)}))(Al);var Ul,Ll=n(5977),Vl=n(90057),Kl=n(8868);!function(e){e.AllFilters="allFilters",e.FilterSets="filterSets"}(Ul||(Ul={}));const Bl=e=>Object.values(e).reduce(((e,t)=>({...e,[t.id]:t.extraFormData})),{}),Wl=(e,t)=>{var n;const i=null==t?void 0:t.value;return(null==(n=e.controlValues)?void 0:n.enableEmptyFilter)&&null==i};var Hl=n(52794),Gl=n(24350),Jl=n.n(Gl),Ql=n(63105),Yl=n.n(Ql),Xl=n(14073);const ed=()=>(0,o.v9)((e=>e.nativeFilters.filterSets||{})),td=()=>{const e=(0,o.v9)((e=>{var t;return null==(t=e.dashboardState)?void 0:t.preselectNativeFilters})),t=(0,o.v9)((e=>e.nativeFilters.filters));return(0,a.useMemo)((()=>Object.entries(t).reduce(((t,[n,i])=>({...t,[n]:{...i,preselect:null==e?void 0:e[n]}})),{})),[t,e])},nd=()=>{const e=(0,o.v9)((e=>e.dataMask));return(0,a.useMemo)((()=>Object.values(e).filter((e=>String(e.id).startsWith(Vo.rW))).reduce(((e,t)=>({...e,[t.id]:t})),{})),[e])},id=(e,t)=>{const n=ed(),i=Object.values(n),r=(0,a.useMemo)((()=>!!i.find((({name:t})=>t===e))),[i,e]);return t!==e&&r},rd=v.iK.div`
  display: flex;
  & button {
    ${({disabled:e})=>"pointer-events: "+(e?"none":"all")};
    flex: 1;
  }
`,od=v.iK.div`
  display: grid;
  flex-direction: row;
  justify-content: center;
  align-items: center;
  grid-gap: 10px;
  grid-template-columns: 1fr 1fr;
`,ad=({onCancel:e,editMode:t,onEdit:n,onCreate:i,disabled:r,filterSetName:o})=>{const s=id(o),l=!o||s||r;return(0,b.tZ)(a.Fragment,null,t?(0,b.tZ)(od,null,(0,b.tZ)(it.Z,{buttonStyle:"tertiary",buttonSize:"small",onClick:e},(0,d.t)("Cancel")),(0,b.tZ)(Ln.u,{placement:"right",title:!o&&(0,d.t)("Please filter set name")||s&&(0,d.t)("Filter set with this name already exists")||r&&qa},(0,b.tZ)(rd,{disabled:l},(0,b.tZ)(it.Z,ct()({disabled:l,buttonStyle:"primary",htmlType:"submit",buttonSize:"small",onClick:i},Rc("create-filter-set-button")),(0,d.t)("Create"))))):(0,b.tZ)(Ln.u,{placement:"bottom",title:r&&qa},(0,b.tZ)(rd,{disabled:r},(0,b.tZ)(it.Z,ct()({disabled:r,buttonStyle:"tertiary",buttonSize:"small",onClick:n},Rc("new-filter-set-button")),(0,d.t)("Create new filter set")))))},sd={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M912 190h-69.9c-9.8 0-19.1 4.5-25.1 12.2L404.7 724.5 207 474a32 32 0 00-25.1-12.2H112c-6.7 0-10.4 7.7-6.3 12.9l273.9 347c12.8 16.2 37.4 16.2 50.3 0l488.4-618.9c4.1-5.1.4-12.8-6.3-12.8z"}}]},name:"check",theme:"outlined"};var ld=function(e,t){return a.createElement(ba.Z,Object.assign({},e,{ref:t,icon:sd}))};ld.displayName="CheckOutlined";const dd=a.forwardRef(ld),cd={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M176 511a56 56 0 10112 0 56 56 0 10-112 0zm280 0a56 56 0 10112 0 56 56 0 10-112 0zm280 0a56 56 0 10112 0 56 56 0 10-112 0z"}}]},name:"ellipsis",theme:"outlined"};var ud=function(e,t){return a.createElement(ba.Z,Object.assign({},e,{ref:t,icon:cd}))};ud.displayName="EllipsisOutlined";const hd=a.forwardRef(ud),pd=v.iK.div`
  display: flex;
  align-items: center;
  font-size: ${({theme:e})=>e.typography.sizes.s}px;
`,fd=(0,v.iK)(Re.UO)`
  &.ant-collapse-ghost > .ant-collapse-item {
    & > .ant-collapse-content > .ant-collapse-content-box {
      padding: 0;
      padding-top: 0;
      padding-bottom: 0;
      font-size: ${({theme:e})=>e.typography.sizes.s}px;
    }
    & > .ant-collapse-header {
      padding: 0;
      display: flex;
      align-items: center;
      flex-direction: row-reverse;
      justify-content: flex-end;
      max-width: max-content;
      & .ant-collapse-arrow {
        position: static;
        padding-left: ${({theme:e})=>e.gridUnit}px;
      }
  }
`,md=v.iK.div`
  padding-top: ${({theme:e})=>e.gridUnit}px;
  padding-bottom: ${({theme:e})=>e.gridUnit}px;
`,gd=({dataMask:e,filterSet:t})=>{const n=(0,v.Fg)(),i=td(),r=Object.values(i).filter((e=>e.type===cr.B.NATIVE_FILTER));let o=null!=r?r:[];return null!=t&&t.nativeFilters&&(o=Object.values(null==t?void 0:t.nativeFilters)),(0,b.tZ)(fd,{ghost:!0,expandIconPosition:"right",defaultActiveKey:t?void 0:["filters"],expandIcon:({isActive:e})=>{const t=n.colors.grayscale.base,i=e?nt.Z.CaretUpOutlined:nt.Z.CaretDownOutlined;return(0,b.tZ)(i,{iconColor:t})}},(0,b.tZ)(Re.UO.Panel,ct()({},Rc("collapse-filter-set-description"),{header:(0,b.tZ)(pd,null,(0,b.tZ)(Re.ZT.Text,{type:"secondary"},(0,d.t)("Filters (%d)",o.length))),key:"filters"}),o.map((({id:n,name:r})=>{var o,a,s,l,c;const u=t&&!(0,bi.JB)(null==(o=i[n])?void 0:o.controlValues,null==t||null==(a=t.nativeFilters)||null==(s=a[n])?void 0:s.controlValues,{ignoreUndefined:!0}),h=!Object.keys(i).includes(n);return(0,b.tZ)(Re.u,{title:h&&(0,d.t)("This filter doesn't exist in dashboard. It will not be applied.")||u&&(0,d.t)("Filter metadata changed in dashboard. It will not be applied."),placement:"bottomLeft",key:n},(0,b.tZ)(md,null,(0,b.tZ)(Re.ZT.Text,{strong:!0,delete:h,mark:u},r,": "),(0,b.tZ)(Re.ZT.Text,{delete:h,mark:u},za(null==e||null==(l=e[n])||null==(c=l.filterState)?void 0:c.value)||(0,b.tZ)(Re.ZT.Text,{type:"secondary"},(0,d.t)("None")))))}))))},vd=(0,v.iK)(it.Z)`
  padding: 0;
`,bd=v.iK.div`
  display: flex;
  justify-content: space-between;
  align-items: center;
`,yd=v.iK.div`
  display: flex;
  justify-content: flex-end;
  align-items: center;
  & > *,
  & > button.superset-button {
    ${({theme:e})=>`margin-left: ${2*e.gridUnit}px`};
  }
`,Cd=({editMode:e,setFilterSetName:t,onDelete:n,onEdit:i,filterSetName:r,dataMaskSelected:o,filterSet:s,isApplied:l,onRebuild:c})=>{var u,h;const p=(0,b.tZ)(Re.v2,null,(0,b.tZ)(Re.v2.Item,{onClick:i},(0,d.t)("Edit")),(0,b.tZ)(Re.v2.Item,{onClick:c},(0,b.tZ)(Ln.u,{placement:"right",title:(0,d.t)("Remove invalid filters")},(0,d.t)("Rebuild"))),(0,b.tZ)(Re.v2.Item,{onClick:n,danger:!0},(0,d.t)("Delete")));return(0,b.tZ)(a.Fragment,null,(0,b.tZ)(bd,null,(0,b.tZ)(Re.ZT.Text,{strong:!0,editable:{editing:e,icon:(0,b.tZ)("span",null),onChange:t}},null!=(u=null==s?void 0:s.name)?u:r),(0,b.tZ)(yd,null,l&&(0,b.tZ)(dd,{style:{color:v.K6.colors.success.base}}),n&&(0,b.tZ)(Re.Lt,{overlay:p,placement:"bottomRight",trigger:["click"]},(0,b.tZ)(vd,ct()({onClick:e=>{e.stopPropagation(),e.preventDefault()}},Rc("filter-set-menu-button"),{buttonStyle:"link",buttonSize:"xsmall"}),(0,b.tZ)(hd,null))))),(0,b.tZ)(gd,{filterSet:s,dataMask:null!=(h=null==s?void 0:s.dataMask)?h:o}))},Sd=v.iK.div`
  display: grid;
  align-items: center;
  justify-content: center;
  grid-template-columns: 1fr;

  & button.superset-button {
    margin-left: 0;
  }
  & input {
    width: 100%;
  }
`,xd=v.iK.div`
  ${({theme:e,"data-selected":t,onClick:n})=>`\n    display: grid;\n    align-items: center;\n    justify-content: center;\n    grid-template-columns: 1fr;\n    grid-gap: ${e.gridUnit}px;\n    border-bottom: 1px solid ${e.colors.grayscale.light2};\n    padding: ${2*e.gridUnit}px ${4*e.gridUnit}px;\n    cursor: ${n?"pointer":"auto"};\n    background: ${t?e.colors.primary.light5:"transparent"};\n  `}
`,wd=(0,d.t)("New filter set"),kd=({dataMaskSelected:e,onEditFilterSet:t,disabled:n,onFilterSelectionChange:i,tab:r})=>{const s=(0,o.I0)(),[l,d]=(0,a.useState)(wd),[c,u]=(0,a.useState)(!1),h=nd(),p=ed(),f=Object.values(p),m=td(),g=Object.values(m),[v,y]=(0,a.useState)(null);(0,a.useEffect)((()=>{var t;if(r===Ul.AllFilters)return;if(!f.length)return void y(null);const n=Aa({dataMaskSelected:e,filterSetFilterValues:f});y(null!=(t=null==n?void 0:n.id)?t:null)}),[r,e,f]);const C=(e,t)=>{var n,i,r;return!g.find((t=>(null==t?void 0:t.id)===e))||!(0,bi.JB)(null==(n=m[e])?void 0:n.controlValues,null==t||null==(i=t.nativeFilters)||null==(r=i[e])?void 0:r.controlValues,{ignoreUndefined:!0})},S=(e,t)=>{var n;const r=null==t?void 0:t.target;if(r){var o;const e=r.closest(`[data-anchor=${Rc("filter-set-wrapper",!0)}]`);if(null!=e&&null!=(o=e.querySelector(".ant-collapse-header"))&&o.contains(r)||null!=r&&r.closest(".ant-dropdown"))return}if(y(e),!e)return;const a=p[e];(null!=(n=Object.values(null==a?void 0:a.dataMask))?n:[]).forEach((e=>{const{extraFormData:t,filterState:n,id:r}=e;C(r,a)||i({id:r},{extraFormData:t,filterState:n})}))};return(0,b.tZ)(Sd,null,!v&&(0,b.tZ)(xd,null,(0,b.tZ)(Cd,{dataMaskSelected:e,editMode:c,setFilterSetName:d,filterSetName:l}),(0,b.tZ)(ad,{filterSetName:l.trim(),disabled:n,onCancel:()=>{u(!1),d(wd)},editMode:c,onEdit:()=>u(!0),onCreate:()=>{const e={name:l.trim(),nativeFilters:m,dataMask:Object.keys(m).reduce(((e,t)=>({...e,[t]:h[t]})),{})};s((0,Hl.xQ)(e)),u(!1),d(wd)}})),f.map((i=>(0,b.tZ)(xd,ct()({},Rc("filter-set-wrapper"),{"data-anchor":Rc("filter-set-wrapper",!0),"data-selected":i.id===v,onClick:e=>S(i.id,e),key:i.id}),(0,b.tZ)(Cd,{isApplied:i.id===v&&!n,onDelete:()=>{return e=i.id,s((0,Hl.$l)(e)),void(e===v&&y(null));var e},onEdit:()=>{return e=i.id,S(e),void t(e);var e},onRebuild:()=>(e=>{var t;const n=p[e],i=Object.values(null!=(t=null==n?void 0:n.dataMask)?t:{}).filter((e=>{const{id:t}=e;return!C(t,n)})).reduce(((e,t)=>({...e,[t.id]:m[t.id]})),{}),r={...n,nativeFilters:i,dataMask:Object.keys(i).reduce(((e,t)=>{var i;return{...e,[t]:null==(i=n.dataMask)?void 0:i[t]}}),{})};s((0,Hl.ql)(r))})(i.id),dataMaskSelected:e,filterSet:i})))))},Rd={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M464 720a48 48 0 1096 0 48 48 0 10-96 0zm16-304v184c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V416c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8zm475.7 440l-416-720c-6.2-10.7-16.9-16-27.7-16s-21.6 5.3-27.7 16l-416 720C56 877.4 71.4 904 96 904h832c24.6 0 40-26.6 27.7-48zm-783.5-27.9L512 239.9l339.8 588.2H172.2z"}}]},name:"warning",theme:"outlined"};var Zd=function(e,t){return a.createElement(ba.Z,Object.assign({},e,{ref:t,icon:Rd}))};Zd.displayName="WarningOutlined";const Fd=a.forwardRef(Zd),Td=v.iK.div`
  display: grid;
  grid-template-columns: 1fr;
  align-items: flex-start;
  justify-content: flex-start;
  grid-gap: ${({theme:e})=>e.gridUnit}px;
  background: ${({theme:e})=>e.colors.primary.light4};
  padding: ${({theme:e})=>2*e.gridUnit}px;
`,Dd=(0,v.iK)(Re.ZT.Text)`
  color: ${({theme:e})=>e.colors.primary.dark2};
`,_d=(0,v.iK)(Re.ZT.Text)`
  font-size: ${({theme:e})=>e.typography.sizes.s}px;
  & .anticon {
    padding: ${({theme:e})=>e.gridUnit}px;
  }
`,Id=v.iK.div`
  display: flex;
  & button {
    ${({disabled:e})=>"pointer-events: "+(e?"none":"all")};
    flex: 1;
  }
`,Md=({filterSetId:e,onCancel:t,dataMaskSelected:n,disabled:i})=>{const r=nd(),s=(0,o.I0)(),l=ed(),c=td(),u=Object.values(l),[h,p]=(0,a.useState)(l[e].name),f=id(h,l[e].name),m=(0,a.useMemo)((()=>Aa({dataMaskSelected:n,filterSetFilterValues:u})),[n,u]),g=m&&m.id!==e,v=i||g||f;return(0,b.tZ)(Td,null,(0,b.tZ)(Dd,{strong:!0},(0,d.t)("Editing filter set:")),(0,b.tZ)(Dd,{editable:{editing:!0,icon:(0,b.tZ)("span",null),onChange:p}},h),(0,b.tZ)(od,null,(0,b.tZ)(it.Z,{ghost:!0,buttonStyle:"tertiary",buttonSize:"small",onClick:t},(0,d.t)("Cancel")),(0,b.tZ)(Re.u,{placement:"right",title:f&&(0,d.t)("Filter set with this name already exists")||g&&(0,d.t)("Filter set already exists")||i&&qa},(0,b.tZ)(Id,{disabled:v},(0,b.tZ)(it.Z,ct()({disabled:v,buttonStyle:"primary",htmlType:"submit",buttonSize:"small",onClick:()=>{s((0,Hl.ql)({id:e,name:h,nativeFilters:c,dataMask:{...r}})),t()}},Rc("filter-set-edit-save")),(0,d.t)("Save"))))),g&&(0,b.tZ)(_d,{mark:!0},(0,b.tZ)(Fd,null),(0,d.t)('This filter set is identical to: "%s"',null==m?void 0:m.name)))},Ed=(0,v.iK)(it.Z)`
  padding: 0;
`,Od=({createNewOnOpen:e,dashboardId:t,children:n})=>{const i=(0,o.I0)(),[r,s]=(0,a.useState)(!1);function l(){s(!1)}return(0,b.tZ)(a.Fragment,null,(0,b.tZ)(Ed,ct()({},Rc("create-filter"),{buttonStyle:"link",buttonSize:"xsmall",onClick:()=>s(!0)}),n),(0,b.tZ)(Yo,{isOpen:r,onSave:async function(e){i(await(0,Hl.RY)(e)),l()},onCancel:l,createNewOnOpen:e,key:`filters-for-${t}`}))},Pd=v.iK.h4`
  display: flex;
  flex-direction: row;
  justify-content: space-between;
  margin: 0;
  padding: ${({theme:e})=>2*e.gridUnit}px;

  & > span {
    flex-grow: 1;
  }
`,Nd=v.iK.div`
  display: grid;
  flex-direction: row;
  justify-content: center;
  align-items: center;
  grid-gap: 10px;
  grid-template-columns: 1fr 1fr;
  ${({theme:e})=>`padding: 0 ${2*e.gridUnit}px`};

  .btn {
    flex: 1;
  }
`,jd=(0,v.iK)(it.Z)`
  padding: 0;
`,qd=v.iK.div`
  padding: ${({theme:e})=>e.gridUnit}px
    ${({theme:e})=>2*e.gridUnit}px;
`,zd=({onApply:e,onClearAll:t,isApplyDisabled:n,dataMaskSelected:i,dataMaskApplied:r,toggleFiltersBar:a})=>{const s=(0,v.Fg)(),l=td(),c=Object.values(l),u=(0,o.v9)((({dashboardInfo:e})=>e.dash_edit_perm)),h=(0,o.v9)((({dashboardInfo:e})=>e.id)),p=Object.values(r).every((e=>{var t,n,r;return null===(null==(t=i[e.id])||null==(n=t.filterState)?void 0:n.value)||!i[e.id]&&null===(null==(r=e.filterState)?void 0:r.value)}));return(0,b.tZ)(qd,null,(0,b.tZ)(Pd,null,(0,b.tZ)("span",null,(0,d.t)("Filters")),u&&(0,b.tZ)(Od,{dashboardId:h,createNewOnOpen:0===c.length},(0,b.tZ)(nt.Z.Edit,{iconColor:s.colors.grayscale.base})),(0,b.tZ)(jd,ct()({},Rc("collapse-button"),{buttonStyle:"link",buttonSize:"xsmall",onClick:()=>a(!1)}),(0,b.tZ)(nt.Z.Expand,{iconColor:s.colors.grayscale.base}))),(0,b.tZ)(Nd,{className:"filter-action-buttons"},(0,b.tZ)(it.Z,ct()({disabled:p,buttonStyle:"tertiary",buttonSize:"small",className:"filter-clear-all-button",onClick:t},Rc("clear-button")),(0,d.t)("Clear all")),(0,b.tZ)(it.Z,ct()({disabled:n,buttonStyle:"primary",htmlType:"submit",buttonSize:"small",className:"filter-apply-button",onClick:e},Rc("apply-button")),(0,d.t)("Apply"))))};var Ad,$d=n(73935),Ud=(Ad=function(e,t){return Ad=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},Ad(e,t)},function(e,t){function n(){this.constructor=e}Ad(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),Ld="html",Vd="svg",Kd=function(e){var t,n,i,r={};if(e===Ld)i=document.createElement("div");else{if(e!==Vd)throw new Error('Invalid element type "'+e+'" for createPortalNode: must be "html" or "svg".');i=document.createElementNS("http://www.w3.org/2000/svg","g")}var o={element:i,elementType:e,setPortalProps:function(e){r=e},getInitialPortalProps:function(){return r},mount:function(i,r){if(r!==n){if(o.unmount(),i!==t&&!function(e,t){if(t===Ld)return e instanceof HTMLElement;if(t===Vd)return e instanceof SVGElement;throw new Error('Unrecognized element type "'+t+'" for validateElementType.')}(i,e))throw new Error('Invalid element type for portal: "'+e+'" portalNodes must be used with '+e+" elements, but OutPortal is within <"+i.tagName+">.");i.replaceChild(o.element,r),t=i,n=r}},unmount:function(e){e&&e!==n||t&&n&&(t.replaceChild(n,o.element),t=void 0,n=void 0)}};return o},Bd=function(e){function t(t){var n=e.call(this,t)||this;return n.addPropsChannel=function(){Object.assign(n.props.node,{setPortalProps:function(e){n.setState({nodeProps:e})}})},n.state={nodeProps:n.props.node.getInitialPortalProps()},n}return Ud(t,e),t.prototype.componentDidMount=function(){this.addPropsChannel()},t.prototype.componentDidUpdate=function(){this.addPropsChannel()},t.prototype.render=function(){var e=this,t=this.props,n=t.children,i=t.node;return $d.createPortal(a.Children.map(n,(function(t){return a.isValidElement(t)?a.cloneElement(t,e.state.nodeProps):t})),i.element)},t}(a.PureComponent),Wd=function(e){function t(t){var n=e.call(this,t)||this;return n.placeholderNode=a.createRef(),n.passPropsThroughPortal(),n}return Ud(t,e),t.prototype.passPropsThroughPortal=function(){var e=Object.assign({},this.props,{node:void 0});this.props.node.setPortalProps(e)},t.prototype.componentDidMount=function(){var e=this.props.node;this.currentPortalNode=e;var t=this.placeholderNode.current,n=t.parentNode;e.mount(n,t),this.passPropsThroughPortal()},t.prototype.componentDidUpdate=function(){var e=this.props.node;this.currentPortalNode&&e!==this.currentPortalNode&&(this.currentPortalNode.unmount(this.placeholderNode.current),this.currentPortalNode=e);var t=this.placeholderNode.current,n=t.parentNode;e.mount(n,t),this.passPropsThroughPortal()},t.prototype.componentWillUnmount=function(){this.props.node.unmount(this.placeholderNode.current)},t.prototype.render=function(){return a.createElement("div",{ref:this.placeholderNode})},t}(a.PureComponent),Hd=Kd.bind(null,Ld),Gd=(Kd.bind(null,Vd),n(8802)),Jd=n.n(Gd);const Qd=w()(((e,t)=>{e(t?(0,Hl.$7)(t):(0,Hl.Up)())}),300),Yd=v.iK.div`
  & > div {
    height: auto !important;
    min-height: ${32}px;
  }
`,Xd=[{data:[{}]}],ec=[Mi.cg.NATIVE_FILTER],tc=({dataMaskSelected:e,filter:t,directPathToChild:n,onFilterSelectionChange:i,inView:r=!0,showOverflow:s,parentRef:l})=>{var u,p,f;const{id:m,targets:g,filterType:v,adhoc_filters:y,time_range:C}=t,S=(0,Ii.Z)().get(v),x=function(e,t){const{filters:n}=(0,o.v9)((e=>e.nativeFilters)),i=n[e];return(0,a.useMemo)((()=>{var e;const n=null!=(e=null==i?void 0:i.cascadeParentIds)?e:[];let r={};return n.forEach((e=>{const n=null==t?void 0:t[e];r=(0,vi.on)(r,null==n?void 0:n.extraFormData)})),r}),[t,null==i?void 0:i.cascadeParentIds])}(m,e),w=(0,o.v9)((e=>e.dashboardState.isRefreshing)),[k,R]=(0,a.useState)([]),[Z,F]=(0,a.useState)(""),[T,D]=(0,a.useState)({inView:!1}),[_,I]=(0,a.useState)({}),[M,E]=(0,a.useState)(r),O=(0,a.useRef)(null),[P]=g,{datasetId:N,column:j={}}=P,{name:q}=j,z=!!N,[A,$]=(0,a.useState)(z),[U,L]=(0,a.useState)(!1),V=(0,o.I0)();(0,a.useEffect)((()=>{!M&&r&&E(!0)}),[r,M,E]),(0,a.useEffect)((()=>{var e;if(!M)return;const n=(0,vi.zi)({...t,datasetId:N,cascadingFilters:x,groupby:q,inputRef:O,adhoc_filters:y,time_range:C}),i=(null==(e=t.dataMask)?void 0:e.ownState)||{};if(!U&&(!Jd()(T,n,((e,t,n)=>"url_params"===n||void 0))||!Fi()(_,i)||w)){if(D(n),I(i),!z)return;L(!0),(0,gi.getChartDataRequest)({formData:n,force:!1,requestParams:{dashboardId:0},ownState:i}).then((({response:e,json:t})=>{if((0,tt.cr)(c.T.GLOBAL_ASYNC_QUERIES)){const n="result"in t?t.result[0]:t;if(200===e.status)L(!1),$(!1),R([n]);else{if(202!==e.status)throw new Error(`Received unexpected response status (${e.status}) while fetching chart data`);(0,Hr.YJ)(n).then((e=>{L(!1),$(!1),R(e)})).catch((e=>{F(e.message||e.error||(0,d.t)("Check configuration")),L(!1),$(!1)}))}}else R(t.result),F(""),L(!1),$(!1)})).catch((e=>{F(e.statusText),L(!1),$(!1)}))}}),[M,x,N,q,JSON.stringify(t),z,U,w]),(0,a.useEffect)((()=>{if((null==n?void 0:n[0])===t.id){const e=setTimeout((()=>{var e;null==O||null==(e=O.current)||e.focus()}),200);return()=>clearTimeout(e)}}),[O,n,t.id]);const K=(0,a.useCallback)((e=>i(t,e)),[t,i]),B=(0,a.useCallback)((()=>Qd(V,m)),[V,m]),W=(0,a.useCallback)((()=>Qd(V)),[V]),H=(0,a.useMemo)((()=>({setDataMask:K,setFocusedFilter:B,unsetFocusedFilter:W})),[K,B,W]),G=Wl(t,null==(u=t.dataMask)?void 0:u.filterState),J=(0,a.useMemo)((()=>{var e;return{...null==(e=t.dataMask)?void 0:e.filterState,validateStatus:G&&"error"}}),[null==(p=t.dataMask)?void 0:p.filterState,G]);return Z?(0,b.tZ)(Kr,{title:(0,d.t)("Cannot load filter"),body:Z,level:"error"}):(0,b.tZ)(Yd,null,A?(0,b.tZ)(h.Z,{position:"inline-centered"}):(0,b.tZ)(ho.Z,{height:32,width:"100%",showOverflow:s,formData:T,parentRef:l,queriesData:z?k:Xd,chartType:v,behaviors:ec,filterState:J,ownState:null==(f=t.dataMask)?void 0:f.ownState,enableNoResults:null==S?void 0:S.enableNoResults,isRefreshing:U,hooks:H}))},nc=v.iK.div`
  position: absolute;
  right: 0;
`,ic=v.iK.h4`
  font-size: ${({theme:e})=>e.typography.sizes.s}px;
  color: ${({theme:e})=>e.colors.grayscale.dark1};
  margin: 0;
  overflow-wrap: break-word;
`,rc=v.iK.div`
  display: flex;
  flex-direction: row;
  align-items: center;
  justify-content: space-between;
  margin-bottom: ${({theme:e})=>e.gridUnit}px;
`,oc=(0,v.iK)(kt.l0)`
  width: 100%;
  && .ant-form-item-label > label {
    text-transform: none;
    width: 100%;
    padding-right: ${({theme:e})=>11*e.gridUnit}px;
  }
  .ant-form-item-tooltip {
    margin-bottom: ${({theme:e})=>e.gridUnit}px;
  }
`,ac=(0,v.iK)(kt.xJ)`
  .ant-form-item-label {
    label.ant-form-item-required:not(.ant-form-item-required-mark-optional) {
      &::after {
        display: none;
      }
    }
  }
`,sc=v.iK.div`
  font-size: ${({theme:e})=>e.typography.sizes.m}px;
  display: flex;
`,lc=()=>(0,b.tZ)("span",{css:e=>({color:e.colors.error.base,fontSize:`${e.typography.sizes.s}px`,paddingLeft:"1px"})},"*"),dc=({description:e})=>(0,b.tZ)(sc,null,(0,b.tZ)(Ln.u,{title:e,placement:"right",overlayInnerStyle:{display:"-webkit-box",overflow:"hidden",WebkitLineClamp:20,WebkitBoxOrient:"vertical",textOverflow:"ellipsis"}},(0,b.tZ)("i",{className:"fa fa-info-circle text-muted",css:e=>({paddingLeft:`${e.gridUnit}px`,cursor:"pointer"})}))),cc=({dataMaskSelected:e,filter:t,icon:n,onFilterSelectionChange:i,directPathToChild:r,inView:o,showOverflow:s,parentRef:l})=>{var d,c,u;const{name:h="<undefined>"}=t,p=Wl(t,null==(d=t.dataMask)?void 0:d.filterState),f=!(null==(c=t.controlValues)||!c.enableEmptyFilter),m=(0,a.useMemo)((()=>(0,b.tZ)(rc,null,(0,b.tZ)(ic,null,h),f&&(0,b.tZ)(lc,null),t.description&&t.description.trim()&&(0,b.tZ)(dc,{description:t.description}),(0,b.tZ)(nc,null,n))),[h,f,t.description,n]);return(0,b.tZ)(oc,{layout:"vertical"},(0,b.tZ)(ac,{label:m,required:null==t||null==(u=t.controlValues)?void 0:u.enableEmptyFilter,validateStatus:p?"error":void 0},(0,b.tZ)(tc,{dataMaskSelected:e,filter:t,showOverflow:s,directPathToChild:r,onFilterSelectionChange:i,inView:o,parentRef:l})))},uc=a.memo(cc),hc=v.iK.div`
  display: flex;
  width: 100%;
  flex-direction: column;
  align-items: center;
  .ant-form-item {
    margin-bottom: ${({theme:e})=>4*e.gridUnit}px;
  }
`,pc=({dataMaskSelected:e,filter:t,directPathToChild:n,onFilterSelectionChange:i,parentRef:r})=>{var o;return(0,b.tZ)(a.Fragment,null,(0,b.tZ)(uc,{dataMaskSelected:e,filter:t,directPathToChild:n,parentRef:r,showOverflow:!0,onFilterSelectionChange:i}),(0,b.tZ)(hc,null,null==(o=t.cascadeChildren)?void 0:o.map((t=>(0,b.tZ)(pc,{key:t.id,dataMaskSelected:e,filter:t,directPathToChild:n,onFilterSelectionChange:i})))))},fc=pc,mc=v.iK.div`
  display: flex;
  flex-direction: row;
  justify-content: space-between;
  align-items: center;
  background-color: ${({theme:e})=>e.colors.grayscale.light4};
  margin: ${({theme:e})=>-1*e.gridUnit}px
    ${({theme:e})=>-4*e.gridUnit}px; // to override default antd padding
  padding: ${({theme:e})=>2*e.gridUnit}px
    ${({theme:e})=>4*e.gridUnit}px;

  & > *:last-child {
    cursor: pointer;
  }
`,gc=v.iK.h4`
  display: flex;
  align-items: center;
  color: ${({theme:e})=>e.colors.grayscale.dark1};
  margin: 0;
  padding: 0;
`,vc=e=>b.iv`
  margin-right: ${e.gridUnit}px;
  color: ${e.colors.grayscale.dark1};
  width: ${4*e.gridUnit}px;
`,bc=(0,v.iK)(Ta)`
  padding: ${({theme:e})=>e.gridUnit}px
    ${({theme:e})=>2*e.gridUnit}px;
  font-size: ${({theme:e})=>e.typography.sizes.s}px;
  background: ${({theme:e})=>e.colors.grayscale.light1};
`,yc=v.iK.div`
  max-height: 700px;
  overflow: auto;
`,Cc=({dataMaskSelected:e,filter:t,visible:n,onVisibleChange:i,onFilterSelectionChange:r,directPathToChild:o,inView:s})=>{var l;const[c,u]=(0,a.useState)(),h=e[t.id],p=(0,a.useRef)();(0,a.useEffect)((()=>{u(o);const e=setTimeout((()=>u(void 0)),500);return()=>clearTimeout(e)}),[o,u]);const f=(0,a.useCallback)((e=>{var t;const n=e.cascadeChildren||[],i=null==h||null==(t=h.filterState)?void 0:t.value,r=n.flatMap((e=>f(e)||[]));return r.length>0?r:null!=i?[e]:null}),[h]),m=e=>[e,...(e.cascadeChildren||[]).flatMap(m)],g=m(t),v=(0,a.useMemo)((()=>f(t)||[t]),[t,f]);if((0,a.useEffect)((()=>{const e=null==c?void 0:c[0];g.filter((e=>!v.includes(e))).some((t=>t.id===e))&&i(!0)}),[c]),null==(l=t.cascadeChildren)||!l.length)return(0,b.tZ)(uc,{dataMaskSelected:e,filter:t,directPathToChild:o,onFilterSelectionChange:r,inView:s});const y=(0,b.tZ)(mc,null,(0,b.tZ)(gc,null,(0,b.tZ)(nt.Z.Edit,{iconSize:"l",css:e=>vc(e)}),(0,d.t)("Select parent filters")," (",g.length,")"),(0,b.tZ)(nt.Z.Close,{iconSize:"l",css:e=>vc(e),onClick:()=>i(!1)})),C=(0,b.tZ)(yc,null,(0,b.tZ)(fc,{dataMaskSelected:e,key:t.id,filter:t,directPathToChild:n?c:void 0,onFilterSelectionChange:r,parentRef:p}));return(0,b.tZ)(Fa.Z,{content:C,title:y,trigger:"click",visible:n,onVisibleChange:i,placement:"rightTop",id:t.id,overlayStyle:{width:"400px",position:"relative",overflow:"auto"},ref:p},(0,b.tZ)("div",null,v.map((n=>(0,b.tZ)(uc,{dataMaskSelected:e,key:n.id,filter:n,onFilterSelectionChange:r,directPathToChild:c,inView:s,icon:(0,b.tZ)(a.Fragment,null,0!==t.cascadeChildren.length&&(0,b.tZ)(bc,{onClick:()=>i(!0)},(0,b.tZ)(nt.Z.Filter,{iconSize:"m"})," ",g.length))})))))},Sc=a.memo(Cc),xc=v.iK.div`
  padding: ${({theme:e})=>4*e.gridUnit}px;
  &:hover {
    cursor: pointer;
  }
`,wc=({directPathToChild:e,dataMaskSelected:t,onFilterSelectionChange:n})=>{const[i,r]=(0,a.useState)(null),s=td(),l=(0,a.useMemo)((()=>Object.values(s)),[s]),c=(0,a.useMemo)((()=>{const e=new Array(l.length);for(let t=0;t<l.length;t+=1)e[t]=Hd();return e}),[l.length]),u=(0,a.useMemo)((()=>{const e=l.map((e=>({...e,dataMask:t[e.id]})));return function(e){const t=function(e){const t={};return e.forEach((e=>{const[n]="cascadeParentIds"in e&&e.cascadeParentIds||[];n&&(t[n]||(t[n]=[]),t[n].push(e))})),t}(e),n=e=>{const i=t[e.id]||[];return{...e,cascadeChildren:i.map(n)}};return e.filter((e=>{var t;return e.type===cr.B.DIVIDER||!(null!=(t=e.cascadeParentIds)&&t.length)})).map(n)}(e)}),[l,t]),h=new Set(u.map((e=>e.id))),[f,m]=function(e){const t=fr(),n=function(){const e=(0,o.v9)((e=>{var t;return null==(t=e.dashboardState)?void 0:t.activeTabs})),t=function(){const e=pr();return t=>{const n=Object.values(e).find((e=>{var n;return(null==(n=e.meta)?void 0:n.chartId)===t}));return null==n?void 0:n.parents.filter((t=>e[t].type===p.gn))}}();return n=>{var i;return n.type===cr.B.DIVIDER||"chartsInScope"in n&&(null==(i=n.chartsInScope)?void 0:i.some((n=>{const i=t(n);return 0===(null==i?void 0:i.length)||(null==i?void 0:i.every((t=>e.includes(t))))})))}}();return(0,a.useMemo)((()=>{let i=[];const r=[];return t?e.forEach((e=>{n(e)?i.push(e):r.push(e)})):i=e,[i,r]}),[e,t,n])}(u),g=fr()&&u.length>0,v=(0,a.useCallback)((o=>{const a=u[o];return a.type===cr.B.DIVIDER?(0,b.tZ)("div",null,(0,b.tZ)("h3",null,a.title),(0,b.tZ)("p",null,a.description)):(0,b.tZ)(Sc,{key:a.id,dataMaskSelected:t,visible:i===a.id,onVisibleChange:e=>r(e?a.id:null),filter:a,onFilterSelectionChange:n,directPathToChild:e,inView:!1})}),[u,JSON.stringify(t),e,n,i]);return(0,b.tZ)(xc,null,c.filter(((e,t)=>h.has(l[t].id))).map(((e,t)=>(0,b.tZ)(Bd,{node:e},v(t)))),f.map((e=>{const t=l.findIndex((t=>t.id===e.id));return(0,b.tZ)(Wd,{node:c[t],inView:!0})})),g&&(0,b.tZ)(Re.UO,{ghost:!0,bordered:!0,expandIconPosition:"right",collapsible:0===m.length?"disabled":void 0,css:e=>(0,b.iv)("&.ant-collapse{margin-top:",f.length>0?6*e.gridUnit:0,"px;&>.ant-collapse-item{&>.ant-collapse-header{padding-left:0;padding-bottom:",2*e.gridUnit,"px;&>.ant-collapse-arrow{right:",e.gridUnit,"px;}}& .ant-collapse-content-box{padding:",4*e.gridUnit,"px 0 0;}}}","")},(0,b.tZ)(Re.UO.Panel,{header:(0,d.t)("Filters out of scope (%d)",m.length),key:"1"},m.map((e=>{const t=u.findIndex((t=>t.id===e.id));return(0,b.tZ)(Wd,{node:c[t],inView:!0})})))))},kc=a.memo(wc),Rc=(0,dr.Q)("filter-bar"),Zc=v.iK.div`
  width: ${({theme:e})=>8*e.gridUnit}px;

  & .ant-tabs-top > .ant-tabs-nav {
    margin: 0;
  }
  &.open {
    width: ${({width:e})=>e}px; // arbitrary...
  }
`,Fc=v.iK.div`
  & .ant-typography-edit-content {
    left: 0;
    margin-top: 0;
    width: 100%;
  }
  position: absolute;
  top: 0;
  left: 0;
  flex-direction: column;
  flex-grow: 1;
  width: ${({width:e})=>e}px;
  background: ${({theme:e})=>e.colors.grayscale.light5};
  border-right: 1px solid ${({theme:e})=>e.colors.grayscale.light2};
  border-bottom: 1px solid ${({theme:e})=>e.colors.grayscale.light2};
  min-height: 100%;
  display: none;
  &.open {
    display: flex;
  }
`,Tc=v.iK.div`
  position: absolute;
  top: ${({offset:e})=>e}px;
  left: 0;
  height: 100%;
  width: ${({theme:e})=>8*e.gridUnit}px;
  padding-top: ${({theme:e})=>2*e.gridUnit}px;
  display: none;
  text-align: center;
  &.open {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: ${({theme:e})=>2*e.gridUnit}px;
  }
  svg {
    cursor: pointer;
  }
`,Dc=(0,v.iK)(nt.Z.Collapse)`
  color: ${({theme:e})=>e.colors.primary.base};
  margin-bottom: ${({theme:e})=>3*e.gridUnit}px;
`,_c=(0,v.iK)(nt.Z.Filter)`
  color: ${({theme:e})=>e.colors.grayscale.base};
`,Ic=(0,v.iK)(Re.mQ)`
  & .ant-tabs-nav-list {
    width: 100%;
  }
  & .ant-tabs-tab {
    display: flex;
    justify-content: center;
    margin: 0;
    flex: 1;
  }
`,Mc=({filtersOpen:e,toggleFiltersBar:t,directPathToChild:n,width:i,height:r,offset:s})=>{const l=(0,Ll.k6)(),u=nd(),[p,f]=(0,a.useState)(null),[m,v]=(0,Vl.x)(u),y=(0,o.I0)(),[C,S]=(0,a.useState)(0),x=ed(),w=Object.values(x),[k,R]=(0,a.useState)(Ul.AllFilters),Z=td(),F=(0,Xr.D)(Z),T=Object.values(Z),D=(0,o.v9)((({dashboardInfo:e})=>null==e?void 0:e.id)),_=(0,a.useCallback)(((e,t)=>{v((n=>{var i,r,o;void 0!==(null==(i=t.filterState)?void 0:i.value)&&void 0===(null==(r=m[e.id])||null==(o=r.filterState)?void 0:o.value)&&e.requiredFirst&&y((0,He.eG)(e.id,t)),n[e.id]={...(0,Kl.H)(e.id),...t}}))}),[m,y,v,k]),I=(0,a.useCallback)((async e=>{const{location:t}=l,{search:n}=t,i=new(_n())(n),r=new(_n());let o="";i.forEach(((e,t)=>{t!==lt.KD.nativeFilters.name&&r.append(t,e)}));const a=(0,pt.e)(lt.KD.nativeFiltersKey),s=JSON.stringify(e);o=C&&a&&await(0,ft.TZ)(D,s,a)?a:await(0,ft.u7)(D,s),r.set(lt.KD.nativeFiltersKey.name,o),l.location.pathname=window.location.pathname,l.replace({search:r.toString()})}),[l,C]);(0,a.useEffect)((()=>{if(F){const e={};Object.values(Z).forEach((t=>{const n=t.filterType,i=t.targets,r=t.defaultDataMask,o=null==F?void 0:F[t.id],a=null==o?void 0:o.filterType,s=null==o?void 0:o.targets,l=null==o?void 0:o.defaultDataMask,d=n!==a,c=!Fi()(i,s),u=!Fi()(r,l);(d||c||u)&&(e[t.id]=(0,Kl.H)(t.id))})),zt()(e)||(v((t=>({...t,...e}))),Object.keys(e).forEach((e=>y((0,He.ze)(e)))))}}),[JSON.stringify(Z),JSON.stringify(F)]),(0,a.useEffect)((()=>{v((()=>u))}),[JSON.stringify(u),v]);const M=JSON.stringify(u);(0,a.useEffect)((()=>{I(u)}),[M,I]);const E=(0,a.useCallback)((()=>{const e=Object.keys(m);S(1),e.forEach((e=>{m[e]&&y((0,He.eG)(e,m[e]))}))}),[m,y]),O=(0,a.useCallback)((()=>{Object.keys(m).forEach((e=>{m[e]&&y((0,He.ze)(e))}))}),[m,y]),P=(0,a.useCallback)((()=>t(!0)),[t]);((e,t)=>{const n=td(),i=nd();(0,a.useEffect)((()=>{Object.keys(e).forEach((e=>{n[e]||t((t=>{delete t[e]}))}))}),[i,e,n,t])})(m,v);const N=((e,t,n)=>{const i=Object.values(e),r=Object.values(t);return(0,bi.JB)(Bl(e),Bl(t),{ignoreUndefined:!0})||i.length!==r.length||n.some((t=>{var n;return Wl(t,null==e||null==(n=e[null==t?void 0:t.id])?void 0:n.filterState)}))})(m,u,T),j=(()=>{const[e,t]=(0,a.useState)(!1),n=td(),i=(0,a.useContext)(Xl.MigrationContext);let r=(0,o.v9)((e=>e.charts)),s=0;if(!e)if(i===Fe.Qi.REVIEWING){r=Jl()(Yl()(r,(e=>{var t;return"filter_box"!==(null==(t=e.formData)?void 0:t.viz_type)})),"id");const e=document.querySelectorAll('[data-test-viz-type="filter_box"]').length;s=document.querySelectorAll('[data-ui-anchor="chart"]').length-e}else s=document.querySelectorAll('[data-ui-anchor="chart"]').length;return(0,a.useEffect)((()=>{if(e)return;if(Object.values(n).find((({requiredFirst:e})=>e)))return void t(!0);let i;0===s&&(i=setTimeout((()=>{t(!0)}),1e3)),s>0&&void 0!==i&&clearTimeout(i);const o=Object.values(r).filter((({chartStatus:e})=>"loading"!==e)).length;s>0&&o>=s&&t(!0)}),[r,e,s]),e})(),q=(0,a.useMemo)((()=>({overflow:"auto",height:r})),[r]),z=T.filter((e=>e.type===cr.B.NATIVE_FILTER)).length;return(0,b.tZ)(Zc,ct()({},Rc(),{className:g()({open:e}),width:i}),(0,b.tZ)(Tc,ct()({},Rc("collapsable"),{className:g()({open:!e}),onClick:P,offset:s}),(0,b.tZ)(Dc,ct()({},Rc("expand-button"),{iconSize:"l"})),(0,b.tZ)(_c,ct()({},Rc("filter-icon"),{iconSize:"l"}))),(0,b.tZ)(Fc,{className:g()({open:e}),width:i},(0,b.tZ)(zd,{toggleFiltersBar:t,onApply:E,onClearAll:O,isApplyDisabled:N,dataMaskSelected:m,dataMaskApplied:u}),j?(0,tt.cr)(c.T.DASHBOARD_NATIVE_FILTERS_SET)?(0,b.tZ)(Ic,{centered:!0,onChange:R,defaultActiveKey:Ul.AllFilters,activeKey:p?Ul.AllFilters:void 0},(0,b.tZ)(Re.mQ.TabPane,{tab:(0,d.t)("All filters (%(filterCount)d)",{filterCount:z}),key:Ul.AllFilters,css:q},p&&(0,b.tZ)(Md,{dataMaskSelected:m,disabled:!N,onCancel:()=>f(null),filterSetId:p}),(0,b.tZ)(kc,{dataMaskSelected:m,directPathToChild:n,onFilterSelectionChange:_})),(0,b.tZ)(Re.mQ.TabPane,{disabled:!!p,tab:(0,d.t)("Filter sets (%(filterSetCount)d)",{filterSetCount:w.length}),key:Ul.FilterSets,css:q},(0,b.tZ)(kd,{onEditFilterSet:f,disabled:!N,dataMaskSelected:m,tab:k,onFilterSelectionChange:_}))):(0,b.tZ)("div",{css:q},(0,b.tZ)(kc,{dataMaskSelected:m,directPathToChild:n,onFilterSelectionChange:_})):(0,b.tZ)("div",{css:(0,b.iv)({height:r},"","")},(0,b.tZ)(h.Z,null))))},Ec=a.memo(Mc),Oc=e=>{const t=e[_._4],n=null==t?void 0:t.children[0];return n===_.PV?e[_._4]:e[n]},Pc=(e,t)=>"ant-tabs-nav-wrap"===e.target.className||t.contains(e.target),Nc={depth:l().number.isRequired,editMode:l().bool.isRequired,gridComponent:M.cP.isRequired,handleComponentDrop:l().func.isRequired,isComponentVisible:l().bool.isRequired,resizeComponent:l().func.isRequired,setDirectPathToChild:l().func.isRequired,width:l().number.isRequired},jc=e=>e.dropIndicatorProps&&(0,b.tZ)("div",{className:"drop-indicator drop-indicator--bottom"}),qc=e=>e.dropIndicatorProps&&(0,b.tZ)("div",{className:"drop-indicator drop-indicator--top"});class zc extends a.PureComponent{constructor(e){super(e),this.state={isResizing:!1,rowGuideTop:null},this.handleResizeStart=this.handleResizeStart.bind(this),this.handleResize=this.handleResize.bind(this),this.handleResizeStop=this.handleResizeStop.bind(this),this.handleTopDropTargetDrop=this.handleTopDropTargetDrop.bind(this),this.getRowGuidePosition=this.getRowGuidePosition.bind(this),this.setGridRef=this.setGridRef.bind(this),this.handleChangeTab=this.handleChangeTab.bind(this)}getRowGuidePosition(e){return e&&this.grid?e.getBoundingClientRect().bottom-this.grid.getBoundingClientRect().top-2:null}setGridRef(e){this.grid=e}handleResizeStart({ref:e,direction:t}){let n=null;"bottom"!==t&&"bottomRight"!==t||(n=this.getRowGuidePosition(e)),this.setState((()=>({isResizing:!0,rowGuideTop:n})))}handleResize({ref:e,direction:t}){"bottom"!==t&&"bottomRight"!==t||this.setState((()=>({rowGuideTop:this.getRowGuidePosition(e)})))}handleResizeStop({id:e,widthMultiple:t,heightMultiple:n}){this.props.resizeComponent({id:e,width:t,height:n}),this.setState((()=>({isResizing:!1,rowGuideTop:null})))}handleTopDropTargetDrop(e){e&&this.props.handleComponentDrop({...e,destination:{...e.destination,index:0}})}handleChangeTab({pathToTabIndex:e}){this.props.setDirectPathToChild(e)}render(){var e,t;const{gridComponent:n,handleComponentDrop:i,depth:r,editMode:o,width:a,isComponentVisible:s}=this.props,l=(a+_.es)/_.cz-_.es,{isResizing:d,rowGuideTop:c}=this.state;return a<100?null:(0,b.tZ)("div",{className:"dashboard-grid",ref:this.setGridRef},(0,b.tZ)("div",{className:"grid-content"},o&&(0,b.tZ)(te,{component:n,depth:r,parentComponent:null,index:0,orientation:"column",onDrop:this.handleTopDropTargetDrop,className:"empty-droptarget",editMode:!0},jc),null==n||null==(e=n.children)?void 0:e.map(((e,t)=>(0,b.tZ)($l,{key:e,id:e,parentId:n.id,depth:r+1,index:t,availableColumnCount:_.cz,columnWidth:l,isComponentVisible:s,onResizeStart:this.handleResizeStart,onResize:this.handleResize,onResizeStop:this.handleResizeStop,onChangeTab:this.handleChangeTab}))),o&&(null==n||null==(t=n.children)?void 0:t.length)>0&&(0,b.tZ)(te,{component:n,depth:r,parentComponent:null,index:n.children.length,orientation:"column",onDrop:i,className:"empty-droptarget",editMode:!0},qc),d&&Array(_.cz).fill(null).map(((e,t)=>(0,b.tZ)("div",{key:`grid-column-${t}`,className:"grid-column-guide",style:{left:t*_.es+t*l,width:l}}))),d&&c&&(0,b.tZ)("div",{className:"grid-row-guide",style:{top:c,width:a}})))}}zc.propTypes=Nc,zc.defaultProps={};const Ac=zc,$c=(0,o.$j)((function({dashboardState:e}){return{editMode:e.editMode}}),(function(e){return(0,r.DE)({handleComponentDrop:li._p,resizeComponent:li.iO,setDirectPathToChild:jt.E2},e)}))(Ac),Uc=({topLevelTabs:e})=>{const t=(0,o.v9)((e=>e.dashboardLayout.present)),n=(0,o.v9)((e=>{var t;return null==(t=e.nativeFilters)?void 0:t.filters})),i=(0,o.v9)((e=>e.dashboardState.directPathToChild)),[r,s]=(0,a.useState)(((e,t)=>Math.max(0,Dl({currentComponent:Oc(e),directPathToChild:t})))(t,i)),l=(0,o.I0)();(0,a.useEffect)((()=>{const e=Dl({currentComponent:Oc(t),directPathToChild:i});e>-1&&s(e)}),[Il(i)]);const d=Object.values(null!=n?n:{}).map((e=>({id:e.id,scope:e.scope,type:e.type})));(0,a.useEffect)((()=>{if(!(0,c.c)(c.T.DASHBOARD_NATIVE_FILTERS)||0===d.length)return;const e=d.map((e=>{if(e.id.startsWith(Vo.Ky))return{filterId:e.id,tabsInScope:[],chartsInScope:[]};const{scope:n}=e,i=(0,an.Q1)({filterScope:{scope:n.rootPath,immune:n.excluded}}),r=(0,vi.Rz)(t,i);return{filterId:e.id,tabsInScope:Array.from(r),chartsInScope:i}}));l((0,Hl.xk)(e))}),[JSON.stringify(d),t,l]);const u=e?e.children:[_.PV],h=Math.min(r,u.length-1),p=0===h?_.PV:h.toString();return(0,b.tZ)("div",{className:"grid-container"},(0,b.tZ)(T,null,(({width:e})=>(0,b.tZ)(C.ZP,{id:_.PV,activeKey:p,renderTabBar:()=>(0,b.tZ)(a.Fragment,null),fullWidth:!1,animated:!1,allowOverflow:!0},u.map(((n,i)=>(0,b.tZ)(C.ZP.TabPane,{key:0===i?_.PV:i.toString()},(0,b.tZ)($c,{gridComponent:t[n],depth:_.Mu+1,width:e,isComponentVisible:i===r}))))))))},Lc=v.iK.div`
  display: grid;
  grid-template-columns: auto 1fr;
  grid-template-rows: auto 1fr;
  flex: 1;
  /* Special cases */

  /* A row within a column has inset hover menu */
  .dragdroppable-column .dragdroppable-row .hover-menu--left {
    left: -12px;
    background: ${({theme:e})=>e.colors.grayscale.light5};
    border: 1px solid ${({theme:e})=>e.colors.grayscale.light2};
  }

  .dashboard-component-tabs {
    position: relative;
  }

  /* A column within a column or tabs has inset hover menu */
  .dragdroppable-column .dragdroppable-column .hover-menu--top,
  .dashboard-component-tabs .dragdroppable-column .hover-menu--top {
    top: -12px;
    background: ${({theme:e})=>e.colors.grayscale.light5};
    border: 1px solid ${({theme:e})=>e.colors.grayscale.light2};
  }

  /* move Tabs hover menu to top near actual Tabs */
  .dashboard-component-tabs > .hover-menu-container > .hover-menu--left {
    top: 0;
    transform: unset;
    background: transparent;
  }

  /* push Chart actions to upper right */
  .dragdroppable-column .dashboard-component-chart-holder .hover-menu--top,
  .dragdroppable .dashboard-component-header .hover-menu--top {
    right: 8px;
    top: 8px;
    background: transparent;
    border: none;
    transform: unset;
    left: unset;
  }
  div:hover > .hover-menu-container .hover-menu,
  .hover-menu-container .hover-menu:hover {
    opacity: 1;
  }
`,Vc=v.iK.div`
  grid-column: 1;
  grid-row: 1 / span 2;
  z-index: 11;
`,Kc=v.iK.div`
  position: sticky;
  top: -1px;
  width: ${({width:e})=>e}px;
  flex: 0 0 ${({width:e})=>e}px;
`,Bc=v.iK.div`
  grid-column: 2;
  grid-row: 1;
  position: sticky;
  top: 0px;
  z-index: 100;
`,Wc=v.iK.div`
  grid-column: 2;
  grid-row: 2;
  // @z-index-above-dashboard-header (100) + 1 = 101
  ${({fullSizeChartId:e})=>e&&"z-index: 101;"}
`,Hc=v.iK.div`
  display: flex;
  flex-direction: row;
  flex-wrap: nowrap;
  height: auto;
  flex: 1;

  .grid-container .dashboard-component-tabs {
    box-shadow: none;
    padding-left: 0;
  }

  .grid-container {
    /* without this, the grid will not get smaller upon toggling the builder panel on */
    width: 0px;
    flex: 1;
    position: relative;
    margin-top: ${({theme:e})=>6*e.gridUnit}px;
    margin-right: ${({theme:e})=>8*e.gridUnit}px;
    margin-bottom: ${({theme:e})=>6*e.gridUnit}px;
    margin-left: ${({theme:e,dashboardFiltersOpen:t,editMode:n})=>t||n?8*e.gridUnit:0}px;

    ${({editMode:e,theme:t})=>e&&`\n      max-width: calc(100% - ${374+16*t.gridUnit}px);\n    `}
  }

  .dashboard-builder-sidepane {
    width: ${374}px;
  }

  .dashboard-component-chart-holder {
    // transitionable traits to show filter relevance
    transition: opacity ${({theme:e})=>e.transitionTiming}s,
      border-color ${({theme:e})=>e.transitionTiming}s,
      box-shadow ${({theme:e})=>e.transitionTiming}s;
    border: 0 solid transparent;
  }
`,Gc=()=>{const e=(0,o.I0)(),t=(0,_i.fG)(),n=(0,o.v9)((e=>e.dashboardLayout.present)),i=(0,o.v9)((e=>e.dashboardState.editMode)),r=(0,o.v9)((e=>e.dashboardState.directPathToChild)),s=(0,o.v9)((e=>e.dashboardState.fullSizeChartId)),l=(0,a.useCallback)((({pathToTabIndex:t})=>{e((0,jt.E2)(t))}),[e]),d=(0,a.useCallback)((()=>{e((0,li.g3)());const t=_l(Oc(n),0);e((0,jt.E2)(t))}),[n,e]),u=(0,a.useCallback)((t=>e((0,li._p)(t))),[e]),p=n[_._4],f=null==p?void 0:p.children[0],m=f!==_.PV?n[f]:void 0,v=(0,pt.e)(lt.KD.standalone),C=v===_._B.REPORT,S=t.hideTitle||v===_._B.HIDE_NAV_AND_TITLE||C,x=(S?0:72)+(m?50:0),{showDashboard:w,dashboardFiltersOpen:k,toggleDashboardFiltersOpen:R,nativeFiltersEnabled:Z}=(()=>{var e;const t=(0,a.useContext)(Xl.MigrationContext),[n,i]=(0,a.useState)(!1),[r,s]=(0,a.useState)(null==(e=(0,pt.e)(lt.KD.showFilters))||e),l=(0,o.v9)((e=>{var t;return null==(t=e.dashboardInfo.metadata)?void 0:t.show_native_filters})),d=(0,o.v9)((({dashboardInfo:e})=>e.dash_edit_perm)),u=td(),h=Object.values(u),p=l&&(0,tt.cr)(c.T.DASHBOARD_NATIVE_FILTERS)&&(d||!d&&0!==h.length),f=h.filter((e=>e.requiredFirst)),m=nd(),g=n||!p||!(p&&f.length&&f.find((({id:e})=>{var t,n;return void 0===(null==(t=m[e])||null==(n=t.filterState)?void 0:n.value)}))),v=(0,a.useCallback)((e=>{s(null!=e?e:!r)}),[r]);return(0,a.useEffect)((()=>{0===h.length&&p&&["CONVERTED","REVIEWING","NOOP"].includes(t)?v(!1):v(!0)}),[h.length,t]),(0,a.useEffect)((()=>{g&&i(!0)}),[g]),{showDashboard:g,dashboardFiltersOpen:r,toggleDashboardFiltersOpen:v,nativeFiltersEnabled:p}})(),F=k?260:32,[T,D]=function(e){const t=(0,a.useRef)(null),[n,i]=(0,a.useState)(!1),r=e=>{const[t]=e;i(t.intersectionRatio<1)};return(0,a.useEffect)((()=>{const n=new IntersectionObserver(r,e),i=t.current;return i&&n.observe(i),()=>{i&&n.unobserve(i)}}),[t,e]),[t,n]}({threshold:[1]}),I=`calc(100vh - ${80+(D||v?0:53)+((0,tt.cr)(c.T.DASHBOARD_NATIVE_FILTERS_SET)?46:0)}px)`,M=k?0:x+20,E=(0,a.useMemo)((()=>({marginLeft:k||i?0:-32})),[k,i]),O=(0,a.useCallback)((({dropIndicatorProps:e})=>(0,b.tZ)("div",null,!S&&(0,b.tZ)(hi,null),e&&(0,b.tZ)("div",e),!C&&m&&!t.hideNav&&(0,b.tZ)(Qs,{shouldFocus:Pc,menuItems:[(0,b.tZ)(mi,{icon:(0,b.tZ)(nt.Z.FallOutlined,{iconSize:"xl"}),label:"Collapse tab content",onClick:d})],editMode:i},(0,b.tZ)($l,{id:null==m?void 0:m.id,parentId:_._4,depth:_.Mu+1,index:0,renderTabContent:!1,renderHoverMenu:!1,onChangeTab:l})))),[i,l,d,S,C,m,t.hideNav]);return(0,b.tZ)(Lc,null,Z&&!i&&(0,b.tZ)(Vc,null,(0,b.tZ)(Kc,{ref:T,width:F},(0,b.tZ)(y.Z,null,(0,b.tZ)(Ec,{filtersOpen:k,toggleFiltersBar:R,directPathToChild:r,width:F,height:I,offset:M})))),(0,b.tZ)(Bc,null,(0,b.tZ)(te,{component:p,parentComponent:null,depth:_.Mu,index:0,orientation:"column",onDrop:u,editMode:i,disableDragDrop:!!m,style:E},O)),(0,b.tZ)(Wc,{fullSizeChartId:s},(0,b.tZ)(b.xB,{styles:b.iv`
            // @z-index-above-dashboard-header (100) + 1 = 101
            ${s&&"div > .filterStatusPopover.ant-popover{z-index: 101}"}
          `}),(0,b.tZ)("div",{className:g()("dashboard",i&&"dashboard--editing")},(0,b.tZ)(Hc,{className:"dashboard-content",dashboardFiltersOpen:k,editMode:i},w?(0,b.tZ)(Uc,{topLevelTabs:m}):(0,b.tZ)(h.Z,null),i&&(0,b.tZ)(We,{isStandalone:!!v,topOffset:x})))))};var Jc=n(49997);const Qc=[p.dW,p.xh];function Yc(e){return!Object.values(e).some((({type:e})=>e&&Qc.includes(e)))}const Xc={actions:l().shape({addSliceToDashboard:l().func.isRequired,removeSliceFromDashboard:l().func.isRequired,triggerQuery:l().func.isRequired,logEvent:l().func.isRequired,clearDataMaskState:l().func.isRequired}).isRequired,dashboardInfo:M.$X.isRequired,dashboardState:M.DZ.isRequired,charts:l().objectOf(M.$6).isRequired,slices:l().objectOf(M.Rw).isRequired,activeFilters:l().object.isRequired,chartConfiguration:l().object.isRequired,datasources:l().object.isRequired,ownDataCharts:l().object.isRequired,layout:l().object.isRequired,impressionId:l().string.isRequired,initMessages:l().array,timeout:l().number,userId:l().string};class eu extends a.PureComponent{static onBeforeUnload(e){e?window.addEventListener("beforeunload",eu.unload):window.removeEventListener("beforeunload",eu.unload)}static unload(){const e=(0,d.t)("You have unsaved changes.");return window.event.returnValue=e,e}constructor(e){var t,n;super(e),this.appliedFilters=null!=(t=e.activeFilters)?t:{},this.appliedOwnDataCharts=null!=(n=e.ownDataCharts)?n:{},this.onVisibilityChange=this.onVisibilityChange.bind(this)}componentDidMount(){const e=document.getElementById("app"),t=(null==e?void 0:e.getAttribute("data-bootstrap"))||"{}",{dashboardState:n,layout:i}=this.props,r={is_soft_navigation:et.Yd.timeOriginOffset>0,is_edit_mode:n.editMode,mount_duration:et.Yd.getTimestamp(),is_empty:Yc(i),is_published:n.isPublished,bootstrap_data_length:t.length},o=(0,xs.Z)();o&&(r.target_id=o),this.props.actions.logEvent(et.Wl,r),"hidden"===document.visibilityState&&(this.visibilityEventData={start_offset:et.Yd.getTimestamp(),ts:(new Date).getTime()}),window.addEventListener("visibilitychange",this.onVisibilityChange),this.applyCharts()}componentDidUpdate(){this.applyCharts()}UNSAFE_componentWillReceiveProps(e){const t=f(this.props.layout),n=f(e.layout);this.props.dashboardInfo.id===e.dashboardInfo.id&&(t.length<n.length?n.filter((e=>-1===t.indexOf(e))).forEach((t=>{return this.props.actions.addSliceToDashboard(t,(n=e.layout,i=t,Object.values(n).find((e=>e&&e.type===p.dW&&e.meta&&e.meta.chartId===i))));var n,i})):t.length>n.length&&t.filter((e=>-1===n.indexOf(e))).forEach((e=>this.props.actions.removeSliceFromDashboard(e))))}applyCharts(){const{hasUnsavedChanges:e,editMode:t}=this.props.dashboardState,{appliedFilters:n,appliedOwnDataCharts:i}=this,{activeFilters:r,ownDataCharts:o,chartConfiguration:a}=this.props;(0,c.c)(c.T.DASHBOARD_CROSS_FILTERS)&&!a||(t||(0,bi.JB)(i,o,{ignoreUndefined:!0})&&(0,bi.JB)(n,r,{ignoreUndefined:!0})||this.applyFilters(),e?eu.onBeforeUnload(!0):eu.onBeforeUnload(!1))}componentWillUnmount(){window.removeEventListener("visibilitychange",this.onVisibilityChange),this.props.actions.clearDataMaskState()}onVisibilityChange(){if("hidden"===document.visibilityState)this.visibilityEventData={start_offset:et.Yd.getTimestamp(),ts:(new Date).getTime()};else if("visible"===document.visibilityState){const e=this.visibilityEventData.start_offset;this.props.actions.logEvent(et.Ev,{...this.visibilityEventData,duration:et.Yd.getTimestamp()-e})}}getAllCharts(){return Object.values(this.props.charts)}applyFilters(){const{appliedFilters:e}=this,{activeFilters:t,ownDataCharts:n}=this.props,i=Object.keys(t),r=Object.keys(e),o=new Set(i.concat(r)),a=((e,t)=>{const n=Object.keys(e),i=Object.keys(t),r=(o=n,a=i,[...o.filter((e=>!a.includes(e))),...a.filter((e=>!o.includes(e)))]).filter((n=>e[n]||t[n]));var o,a;return new Set([...n,...i]).forEach((n=>{(0,bi.JB)(e[n],t[n])||r.push(n)})),[...new Set(r)]})(n,this.appliedOwnDataCharts);[...o].forEach((n=>{if(!i.includes(n)&&r.includes(n))a.push(...e[n].scope);else if(r.includes(n)){if((0,bi.JB)(e[n].values,t[n].values,{ignoreUndefined:!0})||a.push(...t[n].scope),!(0,bi.JB)(e[n].scope,t[n].scope)){const i=(t[n].scope||[]).concat(e[n].scope||[]);a.push(...i)}}else a.push(...t[n].scope)})),this.refreshCharts([...new Set(a)]),this.appliedFilters=t,this.appliedOwnDataCharts=n}refreshCharts(e){e.forEach((e=>{this.props.actions.triggerQuery(!0,e)}))}render(){return this.context.loading?(0,b.tZ)(h.Z,null):(0,b.tZ)(a.Fragment,null,(0,b.tZ)(Jc.Z,null),(0,b.tZ)(Gc,null))}}eu.contextType=u.Zn,eu.propTypes=Xc,eu.defaultProps={initMessages:[],timeout:60,userId:""};const tu=eu;var nu=n(50810);const iu=(0,o.$j)((function(e){var t,n,i,r,o;const{datasources:a,sliceEntities:s,charts:l,dataMask:d,dashboardInfo:c,dashboardState:u,dashboardLayout:h,impressionId:p,nativeFilters:f}=e;return{initMessages:null==(t=c.common)?void 0:t.flash_messages,timeout:null==(n=c.common)||null==(i=n.conf)?void 0:i.SUPERSET_WEBSERVER_TIMEOUT,userId:c.userId,dashboardInfo:c,dashboardState:u,charts:l,datasources:a,activeFilters:{...(0,an.De)(),...xi({chartConfiguration:null==(r=c.metadata)?void 0:r.chart_configuration,nativeFilters:f.filters,dataMask:d,layout:h.present})},chartConfiguration:null==(o=c.metadata)?void 0:o.chart_configuration,ownDataCharts:Si(d,"ownState"),slices:s.slices,layout:h.present,impressionId:p}}),(function(e){return{actions:(0,r.DE)({setDatasources:nu.Fy,clearDataMaskState:He.sh,addSliceToDashboard:jt.Pi,removeSliceFromDashboard:jt.rL,triggerQuery:gi.triggerQuery,logEvent:ci.logEvent},e)}}))(tu)},90057:(e,t,n)=>{"use strict";n.d(t,{x:()=>o,C:()=>a});var i=n(18172),r=n(67294);function o(e){var t=(0,r.useState)((function(){return(0,i.vV)("function"==typeof e?e():e,!0)})),n=t[1];return[t[0],(0,r.useCallback)((function(e){n("function"==typeof e?(0,i.ZP)(e):(0,i.vV)(e))}),[])]}function a(e,t,n){var o=(0,r.useMemo)((function(){return(0,i.ZP)(e)}),[e]);return(0,r.useReducer)(o,t,n)}}}]);