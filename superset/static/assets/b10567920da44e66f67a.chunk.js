/*! For license information please see b10567920da44e66f67a.chunk.js.LICENSE.txt */
(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[452],{8177:(e,t,n)=>{e.exports={default:n(77084),__esModule:!0}},77084:(e,t,n)=>{n(75789);var i=n(94731).Object;e.exports=function(e,t){return i.getOwnPropertyDescriptor(e,t)}},75789:(e,t,n)=>{var i=n(64874),r=n(18437).f;n(44903)("getOwnPropertyDescriptor",(function(){return function(e,t){return r(i(e),t)}}))},50139:(e,t)=>{"use strict";t.__esModule=!0,t.default=void 0;var n=!("undefined"==typeof window||!window.document||!window.document.createElement);t.default=n,e.exports=t.default},44825:(e,t,n)=>{"use strict";var i=n(95318);t.__esModule=!0,t.default=function(e){if((!r&&0!==r||e)&&o.default){var t=document.createElement("div");t.style.position="absolute",t.style.top="-9999px",t.style.width="50px",t.style.height="50px",t.style.overflow="scroll",document.body.appendChild(t),r=t.offsetWidth-t.clientWidth,document.body.removeChild(t)}return r};var r,o=i(n(50139));e.exports=t.default},82689:(e,t,n)=>{var i=n(29932),r=n(97786),o=n(67206),a=n(69199),s=n(71131),l=n(7518),d=n(85022),c=n(6557),u=n(1469);e.exports=function(e,t,n){t=t.length?i(t,(function(e){return u(e)?function(t){return r(t,1===e.length?e[0]:e)}:e})):[c];var h=-1;t=i(t,l(o));var p=a(e,(function(e,n,r){return{criteria:i(t,(function(t){return t(e)})),index:++h,value:e}}));return s(p,(function(e,t){return d(e,t,n)}))}},71131:e=>{e.exports=function(e,t){var n=e.length;for(e.sort(t);n--;)e[n]=e[n].value;return e}},26393:(e,t,n)=>{var i=n(33448);e.exports=function(e,t){if(e!==t){var n=void 0!==e,r=null===e,o=e==e,a=i(e),s=void 0!==t,l=null===t,d=t==t,c=i(t);if(!l&&!c&&!a&&e>t||a&&s&&d&&!l&&!c||r&&s&&d||!n&&d||!o)return 1;if(!r&&!a&&!c&&e<t||c&&n&&o&&!r&&!a||l&&n&&o||!s&&o||!d)return-1}return 0}},85022:(e,t,n)=>{var i=n(26393);e.exports=function(e,t,n){for(var r=-1,o=e.criteria,a=t.criteria,s=o.length,l=n.length;++r<s;){var d=i(o[r],a[r]);if(d)return r>=l?d:d*("desc"==n[r]?-1:1)}return e.index-t.index}},94654:(e,t,n)=>{var i=n(21078),r=n(35161);e.exports=function(e,t){return i(r(e,t),1)}},10752:(e,t,n)=>{var i=n(21078),r=n(35161);e.exports=function(e,t){return i(r(e,t),1/0)}},28368:(e,t,n)=>{var i=n(90939);e.exports=function(e,t,n){var r=(n="function"==typeof n?n:void 0)?n(e,t):void 0;return void 0===r?i(e,t,void 0,n):!!r}},89734:(e,t,n)=>{var i=n(21078),r=n(82689),o=n(5976),a=n(16612),s=o((function(e,t){if(null==e)return[];var n=t.length;return n>1&&a(e,t[0],t[1])?t=[]:n>2&&a(t[0],t[1],t[2])&&(t=[t[0]]),r(e,i(t,1),[])}));e.exports=s},44908:(e,t,n)=>{var i=n(45652);e.exports=function(e){return e&&e.length?i(e):[]}},87185:(e,t,n)=>{var i=n(45652);e.exports=function(e,t){return t="function"==typeof t?t:void 0,e&&e.length?i(e,void 0,t):[]}},75:function(e,t,n){var i=n(34155);(function(){var t,n,r,o,a,s;"undefined"!=typeof performance&&null!==performance&&performance.now?e.exports=function(){return performance.now()}:null!=i&&i.hrtime?(e.exports=function(){return(t()-a)/1e6},n=i.hrtime,o=(t=function(){var e;return 1e9*(e=n())[0]+e[1]})(),s=1e9*i.uptime(),a=o-s):Date.now?(e.exports=function(){return Date.now()-r},r=Date.now()):(e.exports=function(){return(new Date).getTime()-r},r=(new Date).getTime())}).call(this)},54087:(e,t,n)=>{for(var i=n(75),r="undefined"==typeof window?n.g:window,o=["moz","webkit"],a="AnimationFrame",s=r["request"+a],l=r["cancel"+a]||r["cancelRequest"+a],d=0;!s&&d<o.length;d++)s=r[o[d]+"Request"+a],l=r[o[d]+"Cancel"+a]||r[o[d]+"CancelRequest"+a];if(!s||!l){var c=0,u=0,h=[];s=function(e){if(0===h.length){var t=i(),n=Math.max(0,16.666666666666668-(t-c));c=n+t,setTimeout((function(){var e=h.slice(0);h.length=0;for(var t=0;t<e.length;t++)if(!e[t].cancelled)try{e[t].callback(c)}catch(e){setTimeout((function(){throw e}),0)}}),Math.round(n))}return h.push({handle:++u,callback:e,cancelled:!1}),u},l=function(e){for(var t=0;t<h.length;t++)h[t].handle===e&&(h[t].cancelled=!0)}}e.exports=function(e){return s.call(r,e)},e.exports.cancel=function(){l.apply(r,arguments)},e.exports.polyfill=function(e){e||(e=r),e.requestAnimationFrame=s,e.cancelAnimationFrame=l}},28388:(e,t,n)=>{var i;window,e.exports=(i=n(67294),function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=27)}([function(e,t,n){e.exports=n(96)()},function(e,t){e.exports=i},function(e,t,n){var i=n(16),r="object"==typeof self&&self&&self.Object===Object&&self,o=i||r||Function("return this")();e.exports=o},function(e,t,n){var i=n(41),r=n(47);e.exports=function(e,t){var n=r(e,t);return i(n)?n:void 0}},function(e,t,n){var i=n(31),r=n(32),o=n(33),a=n(34),s=n(35);function l(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}l.prototype.clear=i,l.prototype.delete=r,l.prototype.get=o,l.prototype.has=a,l.prototype.set=s,e.exports=l},function(e,t,n){var i=n(14);e.exports=function(e,t){for(var n=e.length;n--;)if(i(e[n][0],t))return n;return-1}},function(e,t,n){var i=n(12),r=n(43),o=n(44),a=i?i.toStringTag:void 0;e.exports=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":a&&a in Object(e)?r(e):o(e)}},function(e,t,n){var i=n(3)(Object,"create");e.exports=i},function(e,t,n){var i=n(56);e.exports=function(e,t){var n=e.__data__;return i(t)?n["string"==typeof t?"string":"hash"]:n.map}},function(e,t){e.exports=function(e){return null!=e&&"object"==typeof e}},function(e,t,n){var i;!function(){"use strict";var n={}.hasOwnProperty;function r(){for(var e=[],t=0;t<arguments.length;t++){var i=arguments[t];if(i){var o=typeof i;if("string"===o||"number"===o)e.push(i);else if(Array.isArray(i)&&i.length){var a=r.apply(null,i);a&&e.push(a)}else if("object"===o)for(var s in i)n.call(i,s)&&i[s]&&e.push(s)}}return e.join(" ")}e.exports?(r.default=r,e.exports=r):void 0===(i=function(){return r}.apply(t,[]))||(e.exports=i)}()},function(e,t,n){var i=n(3)(n(2),"Map");e.exports=i},function(e,t,n){var i=n(2).Symbol;e.exports=i},function(e,t){var n=Array.isArray;e.exports=n},function(e,t){e.exports=function(e,t){return e===t||e!=e&&t!=t}},function(e,t,n){var i=n(6),r=n(17);e.exports=function(e){if(!r(e))return!1;var t=i(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t}},function(e,t,n){(function(t){var n="object"==typeof t&&t&&t.Object===Object&&t;e.exports=n}).call(this,n(42))},function(e,t){e.exports=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}},function(e,t){var n=Function.prototype.toString;e.exports=function(e){if(null!=e){try{return n.call(e)}catch(e){}try{return e+""}catch(e){}}return""}},function(e,t,n){var i=n(48),r=n(55),o=n(57),a=n(58),s=n(59);function l(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}l.prototype.clear=i,l.prototype.delete=r,l.prototype.get=o,l.prototype.has=a,l.prototype.set=s,e.exports=l},function(e,t,n){var i=n(60),r=n(63),o=n(64);e.exports=function(e,t,n,a,s,l){var d=1&n,c=e.length,u=t.length;if(c!=u&&!(d&&u>c))return!1;var h=l.get(e);if(h&&l.get(t))return h==t;var p=-1,f=!0,m=2&n?new i:void 0;for(l.set(e,t),l.set(t,e);++p<c;){var g=e[p],v=t[p];if(a)var b=d?a(v,g,p,t,e,l):a(g,v,p,e,t,l);if(void 0!==b){if(b)continue;f=!1;break}if(m){if(!r(t,(function(e,t){if(!o(m,t)&&(g===e||s(g,e,n,a,l)))return m.push(t)}))){f=!1;break}}else if(g!==v&&!s(g,v,n,a,l)){f=!1;break}}return l.delete(e),l.delete(t),f}},function(e,t,n){(function(e){var i=n(2),r=n(81),o=t&&!t.nodeType&&t,a=o&&"object"==typeof e&&e&&!e.nodeType&&e,s=a&&a.exports===o?i.Buffer:void 0,l=(s?s.isBuffer:void 0)||r;e.exports=l}).call(this,n(22)(e))},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,n){var i=n(83),r=n(84),o=n(85),a=o&&o.isTypedArray,s=a?r(a):i;e.exports=s},function(e,t){e.exports=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}},function(e,t,n){var i=n(28);e.exports=function(e,t){return i(e,t)}},function(e,t,n){var i=self.crypto||self.msCrypto;e.exports=function(e){e=e||21;for(var t="",n=i.getRandomValues(new Uint8Array(e));0<e--;)t+="Uint8ArdomValuesObj012345679BCDEFGHIJKLMNPQRSTWXYZ_cfghkpqvwxyz-"[63&n[e]];return t}},function(e,t,n){e.exports=n(98).default},function(e,t,n){var i=n(29),r=n(9);e.exports=function e(t,n,o,a,s){return t===n||(null==t||null==n||!r(t)&&!r(n)?t!=t&&n!=n:i(t,n,o,a,e,s))}},function(e,t,n){var i=n(30),r=n(20),o=n(65),a=n(69),s=n(91),l=n(13),d=n(21),c=n(23),u="[object Arguments]",h="[object Array]",p="[object Object]",f=Object.prototype.hasOwnProperty;e.exports=function(e,t,n,m,g,v){var b=l(e),y=l(t),C=b?h:s(e),S=y?h:s(t),x=(C=C==u?p:C)==p,w=(S=S==u?p:S)==p,k=C==S;if(k&&d(e)){if(!d(t))return!1;b=!0,x=!1}if(k&&!x)return v||(v=new i),b||c(e)?r(e,t,n,m,g,v):o(e,t,C,n,m,g,v);if(!(1&n)){var Z=x&&f.call(e,"__wrapped__"),R=w&&f.call(t,"__wrapped__");if(Z||R){var T=Z?e.value():e,F=R?t.value():t;return v||(v=new i),g(T,F,n,m,v)}}return!!k&&(v||(v=new i),a(e,t,n,m,g,v))}},function(e,t,n){var i=n(4),r=n(36),o=n(37),a=n(38),s=n(39),l=n(40);function d(e){var t=this.__data__=new i(e);this.size=t.size}d.prototype.clear=r,d.prototype.delete=o,d.prototype.get=a,d.prototype.has=s,d.prototype.set=l,e.exports=d},function(e,t){e.exports=function(){this.__data__=[],this.size=0}},function(e,t,n){var i=n(5),r=Array.prototype.splice;e.exports=function(e){var t=this.__data__,n=i(t,e);return!(n<0||(n==t.length-1?t.pop():r.call(t,n,1),--this.size,0))}},function(e,t,n){var i=n(5);e.exports=function(e){var t=this.__data__,n=i(t,e);return n<0?void 0:t[n][1]}},function(e,t,n){var i=n(5);e.exports=function(e){return i(this.__data__,e)>-1}},function(e,t,n){var i=n(5);e.exports=function(e,t){var n=this.__data__,r=i(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this}},function(e,t,n){var i=n(4);e.exports=function(){this.__data__=new i,this.size=0}},function(e,t){e.exports=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n}},function(e,t){e.exports=function(e){return this.__data__.get(e)}},function(e,t){e.exports=function(e){return this.__data__.has(e)}},function(e,t,n){var i=n(4),r=n(11),o=n(19);e.exports=function(e,t){var n=this.__data__;if(n instanceof i){var a=n.__data__;if(!r||a.length<199)return a.push([e,t]),this.size=++n.size,this;n=this.__data__=new o(a)}return n.set(e,t),this.size=n.size,this}},function(e,t,n){var i=n(15),r=n(45),o=n(17),a=n(18),s=/^\[object .+?Constructor\]$/,l=Function.prototype,d=Object.prototype,c=l.toString,u=d.hasOwnProperty,h=RegExp("^"+c.call(u).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");e.exports=function(e){return!(!o(e)||r(e))&&(i(e)?h:s).test(a(e))}},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){var i=n(12),r=Object.prototype,o=r.hasOwnProperty,a=r.toString,s=i?i.toStringTag:void 0;e.exports=function(e){var t=o.call(e,s),n=e[s];try{e[s]=void 0;var i=!0}catch(e){}var r=a.call(e);return i&&(t?e[s]=n:delete e[s]),r}},function(e,t){var n=Object.prototype.toString;e.exports=function(e){return n.call(e)}},function(e,t,n){var i,r=n(46),o=(i=/[^.]+$/.exec(r&&r.keys&&r.keys.IE_PROTO||""))?"Symbol(src)_1."+i:"";e.exports=function(e){return!!o&&o in e}},function(e,t,n){var i=n(2)["__core-js_shared__"];e.exports=i},function(e,t){e.exports=function(e,t){return null==e?void 0:e[t]}},function(e,t,n){var i=n(49),r=n(4),o=n(11);e.exports=function(){this.size=0,this.__data__={hash:new i,map:new(o||r),string:new i}}},function(e,t,n){var i=n(50),r=n(51),o=n(52),a=n(53),s=n(54);function l(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}l.prototype.clear=i,l.prototype.delete=r,l.prototype.get=o,l.prototype.has=a,l.prototype.set=s,e.exports=l},function(e,t,n){var i=n(7);e.exports=function(){this.__data__=i?i(null):{},this.size=0}},function(e,t){e.exports=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}},function(e,t,n){var i=n(7),r=Object.prototype.hasOwnProperty;e.exports=function(e){var t=this.__data__;if(i){var n=t[e];return"__lodash_hash_undefined__"===n?void 0:n}return r.call(t,e)?t[e]:void 0}},function(e,t,n){var i=n(7),r=Object.prototype.hasOwnProperty;e.exports=function(e){var t=this.__data__;return i?void 0!==t[e]:r.call(t,e)}},function(e,t,n){var i=n(7);e.exports=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=i&&void 0===t?"__lodash_hash_undefined__":t,this}},function(e,t,n){var i=n(8);e.exports=function(e){var t=i(this,e).delete(e);return this.size-=t?1:0,t}},function(e,t){e.exports=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}},function(e,t,n){var i=n(8);e.exports=function(e){return i(this,e).get(e)}},function(e,t,n){var i=n(8);e.exports=function(e){return i(this,e).has(e)}},function(e,t,n){var i=n(8);e.exports=function(e,t){var n=i(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this}},function(e,t,n){var i=n(19),r=n(61),o=n(62);function a(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new i;++t<n;)this.add(e[t])}a.prototype.add=a.prototype.push=r,a.prototype.has=o,e.exports=a},function(e,t){e.exports=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this}},function(e,t){e.exports=function(e){return this.__data__.has(e)}},function(e,t){e.exports=function(e,t){for(var n=-1,i=null==e?0:e.length;++n<i;)if(t(e[n],n,e))return!0;return!1}},function(e,t){e.exports=function(e,t){return e.has(t)}},function(e,t,n){var i=n(12),r=n(66),o=n(14),a=n(20),s=n(67),l=n(68),d=i?i.prototype:void 0,c=d?d.valueOf:void 0;e.exports=function(e,t,n,i,d,u,h){switch(n){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":return!(e.byteLength!=t.byteLength||!u(new r(e),new r(t)));case"[object Boolean]":case"[object Date]":case"[object Number]":return o(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case"[object Map]":var p=s;case"[object Set]":var f=1&i;if(p||(p=l),e.size!=t.size&&!f)return!1;var m=h.get(e);if(m)return m==t;i|=2,h.set(e,t);var g=a(p(e),p(t),i,d,u,h);return h.delete(e),g;case"[object Symbol]":if(c)return c.call(e)==c.call(t)}return!1}},function(e,t,n){var i=n(2).Uint8Array;e.exports=i},function(e,t){e.exports=function(e){var t=-1,n=Array(e.size);return e.forEach((function(e,i){n[++t]=[i,e]})),n}},function(e,t){e.exports=function(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=e})),n}},function(e,t,n){var i=n(70),r=Object.prototype.hasOwnProperty;e.exports=function(e,t,n,o,a,s){var l=1&n,d=i(e),c=d.length;if(c!=i(t).length&&!l)return!1;for(var u=c;u--;){var h=d[u];if(!(l?h in t:r.call(t,h)))return!1}var p=s.get(e);if(p&&s.get(t))return p==t;var f=!0;s.set(e,t),s.set(t,e);for(var m=l;++u<c;){var g=e[h=d[u]],v=t[h];if(o)var b=l?o(v,g,h,t,e,s):o(g,v,h,e,t,s);if(!(void 0===b?g===v||a(g,v,n,o,s):b)){f=!1;break}m||(m="constructor"==h)}if(f&&!m){var y=e.constructor,C=t.constructor;y!=C&&"constructor"in e&&"constructor"in t&&!("function"==typeof y&&y instanceof y&&"function"==typeof C&&C instanceof C)&&(f=!1)}return s.delete(e),s.delete(t),f}},function(e,t,n){var i=n(71),r=n(73),o=n(76);e.exports=function(e){return i(e,o,r)}},function(e,t,n){var i=n(72),r=n(13);e.exports=function(e,t,n){var o=t(e);return r(e)?o:i(o,n(e))}},function(e,t){e.exports=function(e,t){for(var n=-1,i=t.length,r=e.length;++n<i;)e[r+n]=t[n];return e}},function(e,t,n){var i=n(74),r=n(75),o=Object.prototype.propertyIsEnumerable,a=Object.getOwnPropertySymbols,s=a?function(e){return null==e?[]:(e=Object(e),i(a(e),(function(t){return o.call(e,t)})))}:r;e.exports=s},function(e,t){e.exports=function(e,t){for(var n=-1,i=null==e?0:e.length,r=0,o=[];++n<i;){var a=e[n];t(a,n,e)&&(o[r++]=a)}return o}},function(e,t){e.exports=function(){return[]}},function(e,t,n){var i=n(77),r=n(86),o=n(90);e.exports=function(e){return o(e)?i(e):r(e)}},function(e,t,n){var i=n(78),r=n(79),o=n(13),a=n(21),s=n(82),l=n(23),d=Object.prototype.hasOwnProperty;e.exports=function(e,t){var n=o(e),c=!n&&r(e),u=!n&&!c&&a(e),h=!n&&!c&&!u&&l(e),p=n||c||u||h,f=p?i(e.length,String):[],m=f.length;for(var g in e)!t&&!d.call(e,g)||p&&("length"==g||u&&("offset"==g||"parent"==g)||h&&("buffer"==g||"byteLength"==g||"byteOffset"==g)||s(g,m))||f.push(g);return f}},function(e,t){e.exports=function(e,t){for(var n=-1,i=Array(e);++n<e;)i[n]=t(n);return i}},function(e,t,n){var i=n(80),r=n(9),o=Object.prototype,a=o.hasOwnProperty,s=o.propertyIsEnumerable,l=i(function(){return arguments}())?i:function(e){return r(e)&&a.call(e,"callee")&&!s.call(e,"callee")};e.exports=l},function(e,t,n){var i=n(6),r=n(9);e.exports=function(e){return r(e)&&"[object Arguments]"==i(e)}},function(e,t){e.exports=function(){return!1}},function(e,t){var n=/^(?:0|[1-9]\d*)$/;e.exports=function(e,t){var i=typeof e;return!!(t=null==t?9007199254740991:t)&&("number"==i||"symbol"!=i&&n.test(e))&&e>-1&&e%1==0&&e<t}},function(e,t,n){var i=n(6),r=n(24),o=n(9),a={};a["[object Float32Array]"]=a["[object Float64Array]"]=a["[object Int8Array]"]=a["[object Int16Array]"]=a["[object Int32Array]"]=a["[object Uint8Array]"]=a["[object Uint8ClampedArray]"]=a["[object Uint16Array]"]=a["[object Uint32Array]"]=!0,a["[object Arguments]"]=a["[object Array]"]=a["[object ArrayBuffer]"]=a["[object Boolean]"]=a["[object DataView]"]=a["[object Date]"]=a["[object Error]"]=a["[object Function]"]=a["[object Map]"]=a["[object Number]"]=a["[object Object]"]=a["[object RegExp]"]=a["[object Set]"]=a["[object String]"]=a["[object WeakMap]"]=!1,e.exports=function(e){return o(e)&&r(e.length)&&!!a[i(e)]}},function(e,t){e.exports=function(e){return function(t){return e(t)}}},function(e,t,n){(function(e){var i=n(16),r=t&&!t.nodeType&&t,o=r&&"object"==typeof e&&e&&!e.nodeType&&e,a=o&&o.exports===r&&i.process,s=function(){try{return o&&o.require&&o.require("util").types||a&&a.binding&&a.binding("util")}catch(e){}}();e.exports=s}).call(this,n(22)(e))},function(e,t,n){var i=n(87),r=n(88),o=Object.prototype.hasOwnProperty;e.exports=function(e){if(!i(e))return r(e);var t=[];for(var n in Object(e))o.call(e,n)&&"constructor"!=n&&t.push(n);return t}},function(e,t){var n=Object.prototype;e.exports=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||n)}},function(e,t,n){var i=n(89)(Object.keys,Object);e.exports=i},function(e,t){e.exports=function(e,t){return function(n){return e(t(n))}}},function(e,t,n){var i=n(15),r=n(24);e.exports=function(e){return null!=e&&r(e.length)&&!i(e)}},function(e,t,n){var i=n(92),r=n(11),o=n(93),a=n(94),s=n(95),l=n(6),d=n(18),c=d(i),u=d(r),h=d(o),p=d(a),f=d(s),m=l;(i&&"[object DataView]"!=m(new i(new ArrayBuffer(1)))||r&&"[object Map]"!=m(new r)||o&&"[object Promise]"!=m(o.resolve())||a&&"[object Set]"!=m(new a)||s&&"[object WeakMap]"!=m(new s))&&(m=function(e){var t=l(e),n="[object Object]"==t?e.constructor:void 0,i=n?d(n):"";if(i)switch(i){case c:return"[object DataView]";case u:return"[object Map]";case h:return"[object Promise]";case p:return"[object Set]";case f:return"[object WeakMap]"}return t}),e.exports=m},function(e,t,n){var i=n(3)(n(2),"DataView");e.exports=i},function(e,t,n){var i=n(3)(n(2),"Promise");e.exports=i},function(e,t,n){var i=n(3)(n(2),"Set");e.exports=i},function(e,t,n){var i=n(3)(n(2),"WeakMap");e.exports=i},function(e,t,n){"use strict";var i=n(97);function r(){}e.exports=function(){function e(e,t,n,r,o,a){if(a!==i){var s=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw s.name="Invariant Violation",s}}function t(){return e}e.isRequired=e;var n={array:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t};return n.checkPropTypes=r,n.PropTypes=n,n}},function(e,t,n){"use strict";e.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},function(e,t,n){"use strict";n.r(t);var i=n(10),r=n.n(i),o=n(25),a=n.n(o),s=n(26),l=n.n(s),d=n(0),c=n.n(d),u=n(1),h=n.n(u);function p(e){return(p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function f(){return(f=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e}).apply(this,arguments)}function m(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function g(e,t){return!t||"object"!==p(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function v(e){return(v=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function b(e,t){return(b=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function y(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var C=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),g(this,v(t).apply(this,arguments))}var n,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&b(e,t)}(t,h.a.PureComponent),n=t,(i=[{key:"render",value:function(){var e=this.props,t=e.children,n=e.title,i=function(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}(e,["children","title"]);return h.a.createElement("button",f({"aria-label":n,title:n,type:"button"},i),t)}}])&&m(n.prototype,i),t}();y(C,"propTypes",{children:c.a.node.isRequired,title:c.a.string}),y(C,"defaultProps",{title:null});var S=C;function x(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function w(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var k=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.props=t,this.flatNodes=n}var t,n;return t=e,(n=[{key:"setProps",value:function(e){this.props=e}},{key:"clone",value:function(){var t=this,n={};return Object.keys(this.flatNodes).forEach((function(e){var i=t.flatNodes[e];n[e]=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),i.forEach((function(t){x(e,t,n[t])}))}return e}({},i)})),new e(this.props,n)}},{key:"getNode",value:function(e){return this.flatNodes[e]}},{key:"flattenNodes",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(Array.isArray(e)&&0!==e.length){var r=this.props,o=r.disabled,a=r.noCascade;e.forEach((function(e,r){var s=t.nodeHasChildren(e);t.flatNodes[e.value]={label:e.label,value:e.value,children:e.children,parent:n,isParent:s,isLeaf:!s,showCheckbox:void 0===e.showCheckbox||e.showCheckbox,disabled:t.getDisabledState(e,n,o,a),treeDepth:i,index:r},t.flattenNodes(e.children,e,i+1)}))}}},{key:"nodeHasChildren",value:function(e){return Array.isArray(e.children)&&e.children.length>0}},{key:"getDisabledState",value:function(e,t,n,i){return!!n||!(i||!t.disabled)||Boolean(e.disabled)}},{key:"deserializeLists",value:function(e){var t=this,n=["checked","expanded"];Object.keys(this.flatNodes).forEach((function(e){n.forEach((function(n){t.flatNodes[e][n]=!1}))})),n.forEach((function(n){e[n].forEach((function(e){void 0!==t.flatNodes[e]&&(t.flatNodes[e][n]=!0)}))}))}},{key:"serializeList",value:function(e){var t=this,n=[];return Object.keys(this.flatNodes).forEach((function(i){t.flatNodes[i][e]&&n.push(i)})),n}},{key:"expandAllNodes",value:function(e){var t=this;return Object.keys(this.flatNodes).forEach((function(n){t.flatNodes[n].isParent&&(t.flatNodes[n].expanded=e)})),this}},{key:"toggleChecked",value:function(e,t,n){var i=this,r=this.flatNodes[e.value];if(r.isLeaf||n){if(e.disabled)return this;this.toggleNode(e.value,"checked",t)}else r.children.forEach((function(e){i.toggleChecked(e,t,n)}));return this}},{key:"toggleNode",value:function(e,t,n){return this.flatNodes[e][t]=n,this}}])&&w(t.prototype,n),e}();function Z(e){return(Z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function R(){return(R=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e}).apply(this,arguments)}function T(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function F(e,t){return!t||"object"!==Z(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function D(e){return(D=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _(e,t){return(_=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function E(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var I=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),F(this,D(t).apply(this,arguments))}var n,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_(e,t)}(t,h.a.PureComponent),n=t,(i=[{key:"componentDidMount",value:function(){this.updateDeterminateProperty()}},{key:"componentDidUpdate",value:function(){this.updateDeterminateProperty()}},{key:"updateDeterminateProperty",value:function(){var e=this.props.indeterminate;this.checkbox.indeterminate=e}},{key:"render",value:function(){var e=this,t=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),i.forEach((function(t){E(e,t,n[t])}))}return e}({},this.props);return delete t.indeterminate,h.a.createElement("input",R({},t,{ref:function(t){e.checkbox=t},type:"checkbox"}))}}])&&T(n.prototype,i),t}();E(I,"propTypes",{indeterminate:c.a.bool}),E(I,"defaultProps",{indeterminate:!1});var M=I,O=c.a.shape({check:c.a.node,uncheck:c.a.node,halfCheck:c.a.node,expandClose:c.a.node,expandOpen:c.a.node,expandAll:c.a.node,collapseAll:c.a.node,parentClose:c.a.node,parentOpen:c.a.node,leaf:c.a.node}),P=c.a.shape({collapseAll:c.a.string.isRequired,expandAll:c.a.string.isRequired,toggle:c.a.string.isRequired});function N(e){return(N="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function j(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function q(e){return(q=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function z(e,t){return(z=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function A(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function $(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var U=function(e){function t(e){var n,i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this,(n=!(i=q(t).call(this,e))||"object"!==N(i)&&"function"!=typeof i?A(this):i).onCheck=n.onCheck.bind(A(A(n))),n.onClick=n.onClick.bind(A(A(n))),n.onExpand=n.onExpand.bind(A(A(n))),n}var n,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&z(e,t)}(t,h.a.Component),n=t,(i=[{key:"onCheck",value:function(){var e=this.props,t=e.value;(0,e.onCheck)({value:t,checked:this.getCheckState({toggle:!0})})}},{key:"onClick",value:function(){var e=this.props,t=e.expandOnClick,n=e.isParent,i=e.value,r=e.onClick;n&&t&&this.onExpand(),r({value:i,checked:this.getCheckState({toggle:!1})})}},{key:"onExpand",value:function(){var e=this.props,t=e.expanded,n=e.value;(0,e.onExpand)({value:n,expanded:!t})}},{key:"getCheckState",value:function(e){var t=e.toggle,n=this.props,i=n.checked,r=n.optimisticToggle;return!(0!==i||!t)||1===i&&!t||2===i&&r}},{key:"renderCollapseButton",value:function(){var e=this.props,t=e.expandDisabled,n=e.isLeaf,i=e.lang;return n?h.a.createElement("span",{className:"rct-collapse"},h.a.createElement("span",{className:"rct-icon"})):h.a.createElement(S,{className:"rct-collapse rct-collapse-btn",disabled:t,title:i.toggle,onClick:this.onExpand},this.renderCollapseIcon())}},{key:"renderCollapseIcon",value:function(){var e=this.props,t=e.expanded,n=e.icons,i=n.expandClose,r=n.expandOpen;return t?r:i}},{key:"renderCheckboxIcon",value:function(){var e=this.props,t=e.checked,n=e.icons,i=n.uncheck,r=n.check,o=n.halfCheck;return 0===t?i:1===t?r:o}},{key:"renderNodeIcon",value:function(){var e=this.props,t=e.expanded,n=e.icon,i=e.icons,r=i.leaf,o=i.parentClose,a=i.parentOpen,s=e.isLeaf;return null!==n?n:s?r:t?a:o}},{key:"renderBareLabel",value:function(e){var t=this.props,n=t.onClick,i=t.title,r=null!==n;return h.a.createElement("span",{className:"rct-bare-label",title:i},r?h.a.createElement("span",{className:"rct-node-clickable",onClick:this.onClick,onKeyPress:this.onClick,role:"button",tabIndex:0},e):e)}},{key:"renderCheckboxLabel",value:function(e){var t=this.props,n=t.checked,i=t.disabled,r=t.title,o=t.treeId,a=t.value,s=null!==t.onClick,l="".concat(o,"-").concat(String(a).split(" ").join("_")),d=[h.a.createElement("label",{key:0,htmlFor:l,title:r},h.a.createElement(M,{checked:1===n,disabled:i,id:l,indeterminate:2===n,onClick:this.onCheck,onChange:function(){}}),h.a.createElement("span",{className:"rct-checkbox"},this.renderCheckboxIcon()),s?null:e)];return s&&d.push(h.a.createElement("span",{key:1,className:"rct-node-clickable",onClick:this.onClick,onKeyPress:this.onClick,role:"link",tabIndex:0},e)),d}},{key:"renderLabel",value:function(){var e=this.props,t=e.label,n=e.showCheckbox,i=[e.showNodeIcon?h.a.createElement("span",{key:0,className:"rct-node-icon"},this.renderNodeIcon()):null,h.a.createElement("span",{key:1,className:"rct-title"},t)];return n?this.renderCheckboxLabel(i):this.renderBareLabel(i)}},{key:"renderChildren",value:function(){return this.props.expanded?this.props.children:null}},{key:"render",value:function(){var e=this.props,t=e.className,n=e.disabled,i=e.expanded,o=e.isLeaf,a=r()({"rct-node":!0,"rct-node-leaf":o,"rct-node-parent":!o,"rct-node-expanded":!o&&i,"rct-node-collapsed":!o&&!i,"rct-disabled":n},t);return h.a.createElement("li",{className:a},h.a.createElement("span",{className:"rct-text"},this.renderCollapseButton(),this.renderLabel()),this.renderChildren())}}])&&j(n.prototype,i),t}();$(U,"propTypes",{checked:c.a.number.isRequired,disabled:c.a.bool.isRequired,expandDisabled:c.a.bool.isRequired,expanded:c.a.bool.isRequired,icons:O.isRequired,isLeaf:c.a.bool.isRequired,isParent:c.a.bool.isRequired,label:c.a.node.isRequired,lang:P.isRequired,optimisticToggle:c.a.bool.isRequired,showNodeIcon:c.a.bool.isRequired,treeId:c.a.string.isRequired,value:c.a.oneOfType([c.a.string,c.a.number]).isRequired,onCheck:c.a.func.isRequired,onExpand:c.a.func.isRequired,children:c.a.node,className:c.a.string,expandOnClick:c.a.bool,icon:c.a.node,showCheckbox:c.a.bool,title:c.a.string,onClick:c.a.func}),$(U,"defaultProps",{children:null,className:null,expandOnClick:!1,icon:null,showCheckbox:!0,title:null,onClick:function(){}});var L=U,V=c.a.oneOfType([c.a.arrayOf(c.a.string),c.a.arrayOf(c.a.number)]);function K(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var B={label:c.a.node.isRequired,value:c.a.oneOfType([c.a.string,c.a.number]).isRequired,disabled:c.a.bool,icon:c.a.node,showCheckbox:c.a.bool,title:c.a.string},W=c.a.oneOfType([c.a.shape(B),c.a.shape(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),i.forEach((function(t){K(e,t,n[t])}))}return e}({},B,{children:c.a.arrayOf(B).isRequired}))]);function H(e){return(H="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function G(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),i.forEach((function(t){ee(e,t,n[t])}))}return e}function Y(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function J(e){return(J=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Q(e,t){return(Q=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function X(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ee(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var te=function(e){function t(e){var n,i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=!(i=J(t).call(this,e))||"object"!==H(i)&&"function"!=typeof i?X(this):i;var r=new k(e);return r.flattenNodes(e.nodes),r.deserializeLists({checked:e.checked,expanded:e.expanded}),n.state={id:e.id||"rct-".concat(l()(7)),model:r,prevProps:e},n.onCheck=n.onCheck.bind(X(X(n))),n.onExpand=n.onExpand.bind(X(X(n))),n.onNodeClick=n.onNodeClick.bind(X(X(n))),n.onExpandAll=n.onExpandAll.bind(X(X(n))),n.onCollapseAll=n.onCollapseAll.bind(X(X(n))),n}var n,i,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Q(e,t)}(t,h.a.Component),n=t,o=[{key:"getDerivedStateFromProps",value:function(e,t){var n=t.model,i=t.prevProps,r=e.disabled,o=e.id,s=e.nodes,l=G({},t,{prevProps:e});return n.setProps(e),a()(i.nodes,s)&&i.disabled===r||n.flattenNodes(s),null!==o&&(l=G({},l,{id:o})),n.deserializeLists({checked:e.checked,expanded:e.expanded}),l}}],(i=[{key:"onCheck",value:function(e){var t=this.props,n=t.noCascade,i=t.onCheck,r=this.state.model.clone(),o=r.getNode(e.value);r.toggleChecked(e,e.checked,n),i(r.serializeList("checked"),G({},o,e))}},{key:"onExpand",value:function(e){var t=this.props.onExpand,n=this.state.model.clone(),i=n.getNode(e.value);n.toggleNode(e.value,"expanded",e.expanded),t(n.serializeList("expanded"),G({},i,e))}},{key:"onNodeClick",value:function(e){(0,this.props.onClick)(G({},this.state.model.getNode(e.value),e))}},{key:"onExpandAll",value:function(){this.expandAllNodes()}},{key:"onCollapseAll",value:function(){this.expandAllNodes(!1)}},{key:"expandAllNodes",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];(0,this.props.onExpand)(this.state.model.clone().expandAllNodes(e).serializeList("expanded"))}},{key:"determineShallowCheckState",value:function(e,t){var n=this.state.model.getNode(e.value);return n.isLeaf||t?n.checked?1:0:this.isEveryChildChecked(e)?1:this.isSomeChildChecked(e)?2:0}},{key:"isEveryChildChecked",value:function(e){var t=this;return e.children.every((function(e){return 1===t.state.model.getNode(e.value).checkState}))}},{key:"isSomeChildChecked",value:function(e){var t=this;return e.children.some((function(e){return t.state.model.getNode(e.value).checkState>0}))}},{key:"renderTreeNodes",value:function(e){var n=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=this.props,o=r.expandDisabled,a=r.expandOnClick,s=r.icons,l=r.lang,d=r.noCascade,c=r.onClick,u=r.onlyLeafCheckboxes,p=r.optimisticToggle,f=r.showNodeTitle,m=r.showNodeIcon,g=this.state,v=g.id,b=g.model,y=t.defaultProps.icons,C=e.map((function(e){var t=e.value,r=b.getNode(e.value),g=r.isParent?n.renderTreeNodes(e.children,e):null;r.checkState=n.determineShallowCheckState(e,d);var C=u?r.isLeaf:r.showCheckbox;return!i.value||b.getNode(i.value).expanded?h.a.createElement(L,{key:t,checked:r.checkState,className:e.className,disabled:r.disabled,expandDisabled:o,expandOnClick:a,expanded:r.expanded,icon:e.icon,icons:G({},y,s),label:e.label,lang:l,optimisticToggle:p,isLeaf:r.isLeaf,isParent:r.isParent,showCheckbox:C,showNodeIcon:m,title:f?e.title||e.label:e.title,treeId:v,value:e.value,onCheck:n.onCheck,onClick:c&&n.onNodeClick,onExpand:n.onExpand},g):null}));return h.a.createElement("ol",null,C)}},{key:"renderExpandAll",value:function(){var e=this.props,t=e.icons,n=t.expandAll,i=t.collapseAll,r=e.lang;return e.showExpandAll?h.a.createElement("div",{className:"rct-options"},h.a.createElement(S,{className:"rct-option rct-option-expand-all",title:r.expandAll,onClick:this.onExpandAll},n),h.a.createElement(S,{className:"rct-option rct-option-collapse-all",title:r.collapseAll,onClick:this.onCollapseAll},i)):null}},{key:"renderHiddenInput",value:function(){var e=this.props,t=e.name,n=e.nameAsArray;return void 0===t?null:n?this.renderArrayHiddenInput():this.renderJoinedHiddenInput()}},{key:"renderArrayHiddenInput",value:function(){var e=this.props,t=e.checked,n=e.name;return t.map((function(e){var t="".concat(n,"[]");return h.a.createElement("input",{key:e,name:t,type:"hidden",value:e})}))}},{key:"renderJoinedHiddenInput",value:function(){var e=this.props,t=e.checked,n=e.name,i=t.join(",");return h.a.createElement("input",{name:n,type:"hidden",value:i})}},{key:"render",value:function(){var e=this.props,t=e.disabled,n=e.nodes,i=e.nativeCheckboxes,o=this.renderTreeNodes(n),a=r()({"react-checkbox-tree":!0,"rct-disabled":t,"rct-native-display":i});return h.a.createElement("div",{className:a},this.renderExpandAll(),this.renderHiddenInput(),o)}}])&&Y(n.prototype,i),o&&Y(n,o),t}();ee(te,"propTypes",{nodes:c.a.arrayOf(W).isRequired,checked:V,disabled:c.a.bool,expandDisabled:c.a.bool,expandOnClick:c.a.bool,expanded:V,icons:O,id:c.a.string,lang:P,name:c.a.string,nameAsArray:c.a.bool,nativeCheckboxes:c.a.bool,noCascade:c.a.bool,onlyLeafCheckboxes:c.a.bool,optimisticToggle:c.a.bool,showExpandAll:c.a.bool,showNodeIcon:c.a.bool,showNodeTitle:c.a.bool,onCheck:c.a.func,onClick:c.a.func,onExpand:c.a.func}),ee(te,"defaultProps",{checked:[],disabled:!1,expandDisabled:!1,expandOnClick:!1,expanded:[],icons:{check:h.a.createElement("span",{className:"rct-icon rct-icon-check"}),uncheck:h.a.createElement("span",{className:"rct-icon rct-icon-uncheck"}),halfCheck:h.a.createElement("span",{className:"rct-icon rct-icon-half-check"}),expandClose:h.a.createElement("span",{className:"rct-icon rct-icon-expand-close"}),expandOpen:h.a.createElement("span",{className:"rct-icon rct-icon-expand-open"}),expandAll:h.a.createElement("span",{className:"rct-icon rct-icon-expand-all"}),collapseAll:h.a.createElement("span",{className:"rct-icon rct-icon-collapse-all"}),parentClose:h.a.createElement("span",{className:"rct-icon rct-icon-parent-close"}),parentOpen:h.a.createElement("span",{className:"rct-icon rct-icon-parent-open"}),leaf:h.a.createElement("span",{className:"rct-icon rct-icon-leaf"})},id:null,lang:{collapseAll:"Collapse all",expandAll:"Expand all",toggle:"Toggle"},name:void 0,nameAsArray:!1,nativeCheckboxes:!1,noCascade:!1,onlyLeafCheckboxes:!1,optimisticToggle:!0,showExpandAll:!1,showNodeIcon:!0,showNodeTitle:!1,onCheck:function(){},onClick:null,onExpand:function(){}}),t.default=te}]))},9238:(e,t,n)=>{"use strict";n.d(t,{DragLayer:()=>te,DragSource:()=>q,DropTarget:()=>K});var i=n(28195);function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function o(e){return"function"==typeof e}function a(){}function s(e){if(!function(e){return"object"===r(e)&&null!==e}(e))return!1;if(null===Object.getPrototypeOf(e))return!0;for(var t=e;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}function l(e){var t=e.current;return null==t?null:t.decoratedRef?t.decoratedRef.current:t}function d(e){return(t=e)&&t.prototype&&"function"==typeof t.prototype.render||function(e){var t;return"Symbol(react.forward_ref)"===(null==e||null===(t=e.$$typeof)||void 0===t?void 0:t.toString())}(e);var t}var c=n(67294),u=n(15047),h=n(8679),p=n.n(h),f=n(82514);function m(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function g(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function v(e,t,n){return t&&g(e.prototype,t),n&&g(e,n),e}var b=function(){var e=function(){function e(t){m(this,e),this.isDisposed=!1,this.action=o(t)?t:a}return v(e,[{key:"dispose",value:function(){this.isDisposed||(this.action(),this.isDisposed=!0)}}],[{key:"isDisposable",value:function(e){return Boolean(e&&o(e.dispose))}},{key:"_fixup",value:function(t){return e.isDisposable(t)?t:e.empty}},{key:"create",value:function(t){return new e(t)}}]),e}();return e.empty={dispose:a},e}(),y=function(){function e(){m(this,e),this.isDisposed=!1;for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];this.disposables=n}return v(e,[{key:"add",value:function(e){this.isDisposed?e.dispose():this.disposables.push(e)}},{key:"remove",value:function(e){var t=!1;if(!this.isDisposed){var n=this.disposables.indexOf(e);-1!==n&&(t=!0,this.disposables.splice(n,1),e.dispose())}return t}},{key:"clear",value:function(){if(!this.isDisposed){for(var e=this.disposables.length,t=new Array(e),n=0;n<e;n++)t[n]=this.disposables[n];this.disposables=[];for(var i=0;i<e;i++)t[i].dispose()}}},{key:"dispose",value:function(){if(!this.isDisposed){this.isDisposed=!0;for(var e=this.disposables.length,t=new Array(e),n=0;n<e;n++)t[n]=this.disposables[n];this.disposables=[];for(var i=0;i<e;i++)t[i].dispose()}}}]),e}(),C=function(){function e(){m(this,e),this.isDisposed=!1}return v(e,[{key:"getDisposable",value:function(){return this.current}},{key:"setDisposable",value:function(e){var t=this.isDisposed;if(!t){var n=this.current;this.current=e,n&&n.dispose()}t&&e&&e.dispose()}},{key:"dispose",value:function(){if(!this.isDisposed){this.isDisposed=!0;var e=this.current;this.current=void 0,e&&e.dispose()}}}]),e}();function S(e){return S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},S(e)}function x(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function w(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function k(e,t){return k=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},k(e,t)}function Z(e,t){return!t||"object"!==S(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function R(e){return R=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},R(e)}function T(e){var t=e.DecoratedComponent,n=e.createHandler,r=e.createMonitor,o=e.createConnector,a=e.registerHandler,s=e.containerDisplayName,l=e.getType,h=e.collect,m=e.options.arePropsEqual,g=void 0===m?u.w:m,v=t,S=t.displayName||t.name||"Component",T=function(){var e=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&k(e,t)}(F,e);var t,s,p,m,T=(p=F,m=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=R(p);if(m){var n=R(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Z(this,e)});function F(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,F),(t=T.call(this,e)).decoratedRef=c.createRef(),t.handleChange=function(){var e=t.getCurrentState();(0,u.w)(e,t.state)||t.setState(e)},t.disposable=new C,t.receiveProps(e),t.dispose(),t}return t=F,(s=[{key:"getHandlerId",value:function(){return this.handlerId}},{key:"getDecoratedComponentInstance",value:function(){return(0,i.k)(this.decoratedRef.current,"In order to access an instance of the decorated component, it must either be a class component or use React.forwardRef()"),this.decoratedRef.current}},{key:"shouldComponentUpdate",value:function(e,t){return!g(e,this.props)||!(0,u.w)(t,this.state)}},{key:"componentDidMount",value:function(){this.disposable=new C,this.currentType=void 0,this.receiveProps(this.props),this.handleChange()}},{key:"componentDidUpdate",value:function(e){g(this.props,e)||(this.receiveProps(this.props),this.handleChange())}},{key:"componentWillUnmount",value:function(){this.dispose()}},{key:"receiveProps",value:function(e){this.handler&&(this.handler.receiveProps(e),this.receiveType(l(e)))}},{key:"receiveType",value:function(e){if(this.handlerMonitor&&this.manager&&this.handlerConnector&&e!==this.currentType){this.currentType=e;var t=(o=a(e,this.handler,this.manager),s=2,function(e){if(Array.isArray(e))return e}(o)||function(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var n=[],i=!0,r=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(i=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);i=!0);}catch(e){r=!0,o=e}finally{try{i||null==s.return||s.return()}finally{if(r)throw o}}return n}}(o,s)||function(e,t){if(e){if("string"==typeof e)return x(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?x(e,t):void 0}}(o,s)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),n=t[0],i=t[1];this.handlerId=n,this.handlerMonitor.receiveHandlerId(n),this.handlerConnector.receiveHandlerId(n);var r=this.manager.getMonitor().subscribeToStateChange(this.handleChange,{handlerIds:[n]});this.disposable.setDisposable(new y(new b(r),new b(i)))}var o,s}},{key:"dispose",value:function(){this.disposable.dispose(),this.handlerConnector&&this.handlerConnector.receiveHandlerId(null)}},{key:"getCurrentState",value:function(){return this.handlerConnector?h(this.handlerConnector.hooks,this.handlerMonitor,this.props):{}}},{key:"render",value:function(){var e=this;return c.createElement(f.L.Consumer,null,(function(t){var n=t.dragDropManager;return e.receiveDragDropManager(n),"undefined"!=typeof requestAnimationFrame&&requestAnimationFrame((function(){var t;return null===(t=e.handlerConnector)||void 0===t?void 0:t.reconnect()})),c.createElement(v,Object.assign({},e.props,e.getCurrentState(),{ref:d(v)?e.decoratedRef:null}))}))}},{key:"receiveDragDropManager",value:function(e){void 0===this.manager&&((0,i.k)(void 0!==e,"Could not find the drag and drop manager in the context of %s. Make sure to render a DndProvider component in your top-level component. Read more: http://react-dnd.github.io/react-dnd/docs/troubleshooting#could-not-find-the-drag-and-drop-manager-in-the-context",S,S),void 0!==e&&(this.manager=e,this.handlerMonitor=r(e),this.handlerConnector=o(e.getBackend()),this.handler=n(this.handlerMonitor,this.decoratedRef)))}}])&&w(t.prototype,s),F}(c.Component);return e.DecoratedComponent=t,e.displayName="".concat(s,"(").concat(S,")"),e}();return p()(T,t)}var F=n(33273),D=n(60938),_=n(8556);function E(e){return E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},E(e)}function I(e,t){return"string"==typeof e||"symbol"===E(e)||!!t&&Array.isArray(e)&&e.every((function(e){return I(e,!1)}))}function M(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var O=["canDrag","beginDrag","isDragging","endDrag"],P=["beginDrag"],N=function(){function e(t,n,i){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.props=null,this.beginDrag=function(){if(r.props)return r.spec.beginDrag(r.props,r.monitor,r.ref.current)},this.spec=t,this.monitor=n,this.ref=i}var t,n;return t=e,(n=[{key:"receiveProps",value:function(e){this.props=e}},{key:"canDrag",value:function(){return!!this.props&&(!this.spec.canDrag||this.spec.canDrag(this.props,this.monitor))}},{key:"isDragging",value:function(e,t){return!!this.props&&(this.spec.isDragging?this.spec.isDragging(this.props,this.monitor):t===e.getSourceId())}},{key:"endDrag",value:function(){this.props&&this.spec.endDrag&&this.spec.endDrag(this.props,this.monitor,l(this.ref))}}])&&M(t.prototype,n),e}();function j(e){return Object.keys(e).forEach((function(t){(0,i.k)(O.indexOf(t)>-1,'Expected the drag source specification to only have some of the following keys: %s. Instead received a specification with an unexpected "%s" key. Read more: http://react-dnd.github.io/react-dnd/docs/api/drag-source',O.join(", "),t),(0,i.k)("function"==typeof e[t],"Expected %s in the drag source specification to be a function. Instead received a specification with %s: %s. Read more: http://react-dnd.github.io/react-dnd/docs/api/drag-source",t,t,e[t])})),P.forEach((function(t){(0,i.k)("function"==typeof e[t],"Expected %s in the drag source specification to be a function. Instead received a specification with %s: %s. Read more: http://react-dnd.github.io/react-dnd/docs/api/drag-source",t,t,e[t])})),function(t,n){return new N(e,t,n)}}function q(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=e;"function"!=typeof e&&((0,i.k)(I(e),'Expected "type" provided as the first argument to DragSource to be a string, or a function that returns a string given the current props. Instead, received %s. Read more: http://react-dnd.github.io/react-dnd/docs/api/drag-source',e),o=function(){return e}),(0,i.k)(s(t),'Expected "spec" provided as the second argument to DragSource to be a plain object. Instead, received %s. Read more: http://react-dnd.github.io/react-dnd/docs/api/drag-source',t);var a=j(t);return(0,i.k)("function"==typeof n,'Expected "collect" provided as the third argument to DragSource to be a function that returns a plain object of props to inject. Instead, received %s. Read more: http://react-dnd.github.io/react-dnd/docs/api/drag-source',n),(0,i.k)(s(r),'Expected "options" provided as the fourth argument to DragSource to be a plain object when specified. Instead, received %s. Read more: http://react-dnd.github.io/react-dnd/docs/api/drag-source',n),function(e){return T({containerDisplayName:"DragSource",createHandler:a,registerHandler:F.w,createConnector:function(e){return new _.x(e)},createMonitor:function(e){return new D.p(e)},DecoratedComponent:e,getType:o,collect:n,options:r})}}var z=n(89026),A=n(56941);function $(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var U=["canDrop","hover","drop"],L=function(){function e(t,n,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.props=null,this.spec=t,this.monitor=n,this.ref=i}var t,n;return t=e,(n=[{key:"receiveProps",value:function(e){this.props=e}},{key:"receiveMonitor",value:function(e){this.monitor=e}},{key:"canDrop",value:function(){return!this.spec.canDrop||this.spec.canDrop(this.props,this.monitor)}},{key:"hover",value:function(){this.spec.hover&&this.props&&this.spec.hover(this.props,this.monitor,l(this.ref))}},{key:"drop",value:function(){if(this.spec.drop)return this.spec.drop(this.props,this.monitor,this.ref.current)}}])&&$(t.prototype,n),e}();function V(e){return Object.keys(e).forEach((function(t){(0,i.k)(U.indexOf(t)>-1,'Expected the drop target specification to only have some of the following keys: %s. Instead received a specification with an unexpected "%s" key. Read more: http://react-dnd.github.io/react-dnd/docs/api/drop-target',U.join(", "),t),(0,i.k)("function"==typeof e[t],"Expected %s in the drop target specification to be a function. Instead received a specification with %s: %s. Read more: http://react-dnd.github.io/react-dnd/docs/api/drop-target",t,t,e[t])})),function(t,n){return new L(e,t,n)}}function K(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=e;"function"!=typeof e&&((0,i.k)(I(e,!0),'Expected "type" provided as the first argument to DropTarget to be a string, an array of strings, or a function that returns either given the current props. Instead, received %s. Read more: http://react-dnd.github.io/react-dnd/docs/api/drop-target',e),o=function(){return e}),(0,i.k)(s(t),'Expected "spec" provided as the second argument to DropTarget to be a plain object. Instead, received %s. Read more: http://react-dnd.github.io/react-dnd/docs/api/drop-target',t);var a=V(t);return(0,i.k)("function"==typeof n,'Expected "collect" provided as the third argument to DropTarget to be a function that returns a plain object of props to inject. Instead, received %s. Read more: http://react-dnd.github.io/react-dnd/docs/api/drop-target',n),(0,i.k)(s(r),'Expected "options" provided as the fourth argument to DropTarget to be a plain object when specified. Instead, received %s. Read more: http://react-dnd.github.io/react-dnd/docs/api/drop-target',n),function(e){return T({containerDisplayName:"DropTarget",createHandler:a,registerHandler:F.n,createMonitor:function(e){return new A.H(e)},createConnector:function(e){return new z.Y(e)},DecoratedComponent:e,getType:o,collect:n,options:r})}}function B(e){return B="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},B(e)}function W(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function H(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function G(e,t,n){return t&&H(e.prototype,t),n&&H(e,n),e}function Y(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&J(e,t)}function J(e,t){return J=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},J(e,t)}function Q(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=ee(e);if(t){var r=ee(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return X(this,n)}}function X(e,t){return!t||"object"!==B(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ee(e){return ee=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},ee(e)}function te(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,i.k)("function"==typeof e,'Expected "collect" provided as the first argument to DragLayer to be a function that collects props to inject into the component. ',"Instead, received %s. Read more: http://react-dnd.github.io/react-dnd/docs/api/drag-layer",e),(0,i.k)(s(t),'Expected "options" provided as the second argument to DragLayer to be a plain object when specified. Instead, received %s. Read more: http://react-dnd.github.io/react-dnd/docs/api/drag-layer',t),function(n){var r=n,o=t.arePropsEqual,a=void 0===o?u.w:o,s=r.displayName||r.name||"Component",l=function(){var t=function(t){Y(o,t);var n=Q(o);function o(){var e;return W(this,o),(e=n.apply(this,arguments)).isCurrentlyMounted=!1,e.ref=c.createRef(),e.handleChange=function(){if(e.isCurrentlyMounted){var t=e.getCurrentState();(0,u.w)(t,e.state)||e.setState(t)}},e}return G(o,[{key:"getDecoratedComponentInstance",value:function(){return(0,i.k)(this.ref.current,"In order to access an instance of the decorated component, it must either be a class component or use React.forwardRef()"),this.ref.current}},{key:"shouldComponentUpdate",value:function(e,t){return!a(e,this.props)||!(0,u.w)(t,this.state)}},{key:"componentDidMount",value:function(){this.isCurrentlyMounted=!0,this.handleChange()}},{key:"componentWillUnmount",value:function(){this.isCurrentlyMounted=!1,this.unsubscribeFromOffsetChange&&(this.unsubscribeFromOffsetChange(),this.unsubscribeFromOffsetChange=void 0),this.unsubscribeFromStateChange&&(this.unsubscribeFromStateChange(),this.unsubscribeFromStateChange=void 0)}},{key:"render",value:function(){var e=this;return c.createElement(f.L.Consumer,null,(function(t){var n=t.dragDropManager;return void 0===n?null:(e.receiveDragDropManager(n),e.isCurrentlyMounted?c.createElement(r,Object.assign({},e.props,e.state,{ref:d(r)?e.ref:null})):null)}))}},{key:"receiveDragDropManager",value:function(e){if(void 0===this.manager){this.manager=e,(0,i.k)("object"===B(e),"Could not find the drag and drop manager in the context of %s. Make sure to render a DndProvider component in your top-level component. Read more: http://react-dnd.github.io/react-dnd/docs/troubleshooting#could-not-find-the-drag-and-drop-manager-in-the-context",s,s);var t=this.manager.getMonitor();this.unsubscribeFromOffsetChange=t.subscribeToOffsetChange(this.handleChange),this.unsubscribeFromStateChange=t.subscribeToStateChange(this.handleChange)}}},{key:"getCurrentState",value:function(){if(!this.manager)return{};var t=this.manager.getMonitor();return e(t,this.props)}}]),o}(c.Component);return t.displayName="DragLayer(".concat(s,")"),t.DecoratedComponent=n,t}();return p()(l,n)}}},84785:(e,t,n)=>{"use strict";n.d(t,{DragLayer:()=>r.DragLayer,DragSource:()=>r.DragSource,DropTarget:()=>r.DropTarget});var i=n(31388);n.o(i,"DragLayer")&&n.d(t,{DragLayer:function(){return i.DragLayer}}),n.o(i,"DragSource")&&n.d(t,{DragSource:function(){return i.DragSource}}),n.o(i,"DropTarget")&&n.d(t,{DropTarget:function(){return i.DropTarget}});var r=n(9238)},73897:()=>{},48058:()=>{},31388:(e,t,n)=>{"use strict";var i=n(75253);n.o(i,"DragLayer")&&n.d(t,{DragLayer:function(){return i.DragLayer}}),n.o(i,"DragSource")&&n.d(t,{DragSource:function(){return i.DragSource}}),n.o(i,"DropTarget")&&n.d(t,{DropTarget:function(){return i.DropTarget}});var r=n(48058);n.o(r,"DragLayer")&&n.d(t,{DragLayer:function(){return r.DragLayer}}),n.o(r,"DragSource")&&n.d(t,{DragSource:function(){return r.DragSource}}),n.o(r,"DropTarget")&&n.d(t,{DropTarget:function(){return r.DropTarget}});var o=n(72105);n.o(o,"DragLayer")&&n.d(t,{DragLayer:function(){return o.DragLayer}}),n.o(o,"DragSource")&&n.d(t,{DragSource:function(){return o.DragSource}}),n.o(o,"DropTarget")&&n.d(t,{DropTarget:function(){return o.DropTarget}});var a=n(73897);n.o(a,"DragLayer")&&n.d(t,{DragLayer:function(){return a.DragLayer}}),n.o(a,"DragSource")&&n.d(t,{DragSource:function(){return a.DragSource}}),n.o(a,"DropTarget")&&n.d(t,{DropTarget:function(){return a.DropTarget}})},75253:()=>{},72105:()=>{},46871:(e,t,n)=>{"use strict";function i(){var e=this.constructor.getDerivedStateFromProps(this.props,this.state);null!=e&&this.setState(e)}function r(e){this.setState(function(t){var n=this.constructor.getDerivedStateFromProps(e,t);return null!=n?n:null}.bind(this))}function o(e,t){try{var n=this.props,i=this.state;this.props=e,this.state=t,this.__reactInternalSnapshotFlag=!0,this.__reactInternalSnapshot=this.getSnapshotBeforeUpdate(n,i)}finally{this.props=n,this.state=i}}function a(e){var t=e.prototype;if(!t||!t.isReactComponent)throw new Error("Can only polyfill class components");if("function"!=typeof e.getDerivedStateFromProps&&"function"!=typeof t.getSnapshotBeforeUpdate)return e;var n=null,a=null,s=null;if("function"==typeof t.componentWillMount?n="componentWillMount":"function"==typeof t.UNSAFE_componentWillMount&&(n="UNSAFE_componentWillMount"),"function"==typeof t.componentWillReceiveProps?a="componentWillReceiveProps":"function"==typeof t.UNSAFE_componentWillReceiveProps&&(a="UNSAFE_componentWillReceiveProps"),"function"==typeof t.componentWillUpdate?s="componentWillUpdate":"function"==typeof t.UNSAFE_componentWillUpdate&&(s="UNSAFE_componentWillUpdate"),null!==n||null!==a||null!==s){var l=e.displayName||e.name,d="function"==typeof e.getDerivedStateFromProps?"getDerivedStateFromProps()":"getSnapshotBeforeUpdate()";throw Error("Unsafe legacy lifecycles will not be called for components using new component APIs.\n\n"+l+" uses "+d+" but also contains the following legacy lifecycles:"+(null!==n?"\n  "+n:"")+(null!==a?"\n  "+a:"")+(null!==s?"\n  "+s:"")+"\n\nThe above lifecycles should be removed. Learn more about this warning here:\nhttps://fb.me/react-async-component-lifecycle-hooks")}if("function"==typeof e.getDerivedStateFromProps&&(t.componentWillMount=i,t.componentWillReceiveProps=r),"function"==typeof t.getSnapshotBeforeUpdate){if("function"!=typeof t.componentDidUpdate)throw new Error("Cannot polyfill getSnapshotBeforeUpdate() for components that do not define componentDidUpdate() on the prototype");t.componentWillUpdate=o;var c=t.componentDidUpdate;t.componentDidUpdate=function(e,t,n){var i=this.__reactInternalSnapshotFlag?this.__reactInternalSnapshot:n;c.call(this,e,t,i)}}return e}n.r(t),n.d(t,{polyfill:()=>a}),i.__suppressDeprecationWarning=!0,r.__suppressDeprecationWarning=!0,o.__suppressDeprecationWarning=!0},24903:(e,t,n)=>{"use strict";t.cj=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=n(67294),o=l(r),a=l(n(45697)),s=n(76597);function l(e){return e&&e.__esModule?e:{default:e}}var d=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={searchTerm:n.props.value||""},n.updateSearch=n.updateSearch.bind(n),n.filter=n.filter.bind(n),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),i(t,[{key:"componentWillReceiveProps",value:function(e){if(void 0!==e.value&&e.value!==this.props.value){var t={target:{value:e.value}};this.updateSearch(t)}}},{key:"render",value:function(){var e=this.props,t=e.className,n=(e.onChange,e.caseSensitive,e.sortResults,e.throttle,e.filterKeys,e.value,e.fuzzy,e.inputClassName),i=function(e,t){var n={};for(var i in e)t.indexOf(i)>=0||Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i]);return n}(e,["className","onChange","caseSensitive","sortResults","throttle","filterKeys","value","fuzzy","inputClassName"]);return i.type=i.type||"search",i.value=this.state.searchTerm,i.onChange=this.updateSearch,i.className=n,i.placeholder=i.placeholder||"Search",o.default.createElement("div",{className:t},o.default.createElement("input",i))}},{key:"updateSearch",value:function(e){var t=this,n=e.target.value;this.setState({searchTerm:n},(function(){t._throttleTimeout&&clearTimeout(t._throttleTimeout),t._throttleTimeout=setTimeout((function(){return t.props.onChange(n)}),t.props.throttle)}))}},{key:"filter",value:function(e){var t=this.props,n=t.filterKeys,i=t.caseSensitive,r=t.fuzzy,o=t.sortResults;return(0,s.createFilter)(this.state.searchTerm,e||n,{caseSensitive:i,fuzzy:r,sortResults:o})}}]),t}(r.Component);d.defaultProps={className:"",onChange:function(){},caseSensitive:!1,fuzzy:!1,throttle:200},d.propTypes={className:a.default.string,inputClassName:a.default.string,onChange:a.default.func,caseSensitive:a.default.bool,sortResults:a.default.bool,fuzzy:a.default.bool,throttle:a.default.number,filterKeys:a.default.oneOf([a.default.string,a.default.arrayOf(a.default.string)]),value:a.default.string},t.cj=s.createFilter},76597:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getValuesForKey=a,t.searchStrings=s,t.createFilter=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return function(i){if(""===e)return!0;n.caseSensitive||(e=e.toLowerCase());var r=e.split(" ");return t?("string"==typeof t&&(t=[t]),r.every((function(e){var r=void 0;if(-1!==e.indexOf(":")){var o=e.split(":")[0];e=e.split(":")[1],r=t.filter((function(e){return e.toLowerCase().indexOf(o)>-1}))}else r=t;return r.some((function(t){return s(a(t,i),e,n)}))}))):r.every((function(e){return s([i],e,n)}))}};var i,r=(i=n(69021))&&i.__esModule?i:{default:i};function o(e){return e.reduce((function(e,t){return e.concat(Array.isArray(t)?o(t):t)}),[])}function a(e,t){var n=e.split("."),i=[t];return n.forEach((function(e){var t=[];i.forEach((function(n){if(n)if(n instanceof Array){var i=parseInt(e,10);if(!isNaN(i))return t.push(n[i]);n.forEach((function(n){t.push(n[e])}))}else n&&"function"==typeof n.get?t.push(n.get(e)):t.push(n[e])})),i=t})),(i=o(i=i.map((function(e){return e&&e.push&&e.toArray?e.toArray():e})))).filter((function(e){return"string"==typeof e||"number"==typeof e}))}function s(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=n.caseSensitive,o=n.fuzzy,a=n.sortResults,s=n.exactMatch;e=e.map((function(e){return e.toString()}));try{if(o){"function"==typeof e.toJS&&(e=e.toJS());var l=new r.default(e.map((function(e){return{id:e}})),{keys:["id"],id:"id",caseSensitive:i,shouldSort:a});return l.search(t).length}return e.some((function(e){try{return i||(e=e.toLowerCase()),s&&(t=new RegExp("^"+t+"$","i")),!(!e||-1===e.search(t))}catch(e){return!1}}))}catch(e){return!1}}},69021:function(e){e.exports=function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var o=n(1),a=n(7),s=a.get,l=(a.deepValue,a.isArray),d=function(){function e(t,n){var i=n.location,r=void 0===i?0:i,o=n.distance,a=void 0===o?100:o,l=n.threshold,d=void 0===l?.6:l,c=n.maxPatternLength,u=void 0===c?32:c,h=n.caseSensitive,p=void 0!==h&&h,f=n.tokenSeparator,m=void 0===f?/ +/g:f,g=n.findAllMatches,v=void 0!==g&&g,b=n.minMatchCharLength,y=void 0===b?1:b,C=n.id,S=void 0===C?null:C,x=n.keys,w=void 0===x?[]:x,k=n.shouldSort,Z=void 0===k||k,R=n.getFn,T=void 0===R?s:R,F=n.sortFn,D=void 0===F?function(e,t){return e.score-t.score}:F,_=n.tokenize,E=void 0!==_&&_,I=n.matchAllTokens,M=void 0!==I&&I,O=n.includeMatches,P=void 0!==O&&O,N=n.includeScore,j=void 0!==N&&N,q=n.verbose,z=void 0!==q&&q;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.options={location:r,distance:a,threshold:d,maxPatternLength:u,isCaseSensitive:p,tokenSeparator:m,findAllMatches:v,minMatchCharLength:y,id:S,keys:w,includeMatches:P,includeScore:j,shouldSort:Z,getFn:T,sortFn:D,verbose:z,tokenize:E,matchAllTokens:M},this.setCollection(t),this._processKeys(w)}var t,n;return t=e,(n=[{key:"setCollection",value:function(e){return this.list=e,e}},{key:"_processKeys",value:function(e){if(this._keyWeights={},this._keyNames=[],e.length&&"string"==typeof e[0])for(var t=0,n=e.length;t<n;t+=1){var i=e[t];this._keyWeights[i]=1,this._keyNames.push(i)}else{for(var r=null,o=null,a=0,s=0,l=e.length;s<l;s+=1){var d=e[s];if(!d.hasOwnProperty("name"))throw new Error('Missing "name" property in key object');var c=d.name;if(this._keyNames.push(c),!d.hasOwnProperty("weight"))throw new Error('Missing "weight" property in key object');var u=d.weight;if(u<0||u>1)throw new Error('"weight" property in key must bein the range of [0, 1)');o=null==o?u:Math.max(o,u),r=null==r?u:Math.min(r,u),this._keyWeights[c]=u,a+=u}if(a>1)throw new Error("Total of weights cannot exceed 1")}}},{key:"search",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{limit:!1};this._log('---------\nSearch pattern: "'.concat(e,'"'));var n=this._prepareSearchers(e),i=n.tokenSearchers,r=n.fullSearcher,o=this._search(i,r);return this._computeScore(o),this.options.shouldSort&&this._sort(o),t.limit&&"number"==typeof t.limit&&(o=o.slice(0,t.limit)),this._format(o)}},{key:"_prepareSearchers",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=[];if(this.options.tokenize)for(var n=e.split(this.options.tokenSeparator),i=0,r=n.length;i<r;i+=1)t.push(new o(n[i],this.options));return{tokenSearchers:t,fullSearcher:new o(e,this.options)}}},{key:"_search",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0,n=this.list,i={},r=[];if("string"==typeof n[0]){for(var o=0,a=n.length;o<a;o+=1)this._analyze({key:"",value:n[o],record:o,index:o},{resultMap:i,results:r,tokenSearchers:e,fullSearcher:t});return r}for(var s=0,l=n.length;s<l;s+=1)for(var d=n[s],c=0,u=this._keyNames.length;c<u;c+=1){var h=this._keyNames[c];this._analyze({key:h,value:this.options.getFn(d,h),record:d,index:s},{resultMap:i,results:r,tokenSearchers:e,fullSearcher:t})}return r}},{key:"_analyze",value:function(e,t){var n=this,i=e.key,r=e.arrayIndex,o=void 0===r?-1:r,a=e.value,s=e.record,d=e.index,c=t.tokenSearchers,u=void 0===c?[]:c,h=t.fullSearcher,p=t.resultMap,f=void 0===p?{}:p,m=t.results,g=void 0===m?[]:m;!function e(t,r,o,a){if(null!=r)if("string"==typeof r){var s=!1,d=-1,c=0;n._log("\nKey: ".concat(""===i?"--":i));var p=h.search(r);if(n._log('Full text: "'.concat(r,'", score: ').concat(p.score)),n.options.tokenize){for(var m=r.split(n.options.tokenSeparator),v=m.length,b=[],y=0,C=u.length;y<C;y+=1){var S=u[y];n._log('\nPattern: "'.concat(S.pattern,'"'));for(var x=!1,w=0;w<v;w+=1){var k=m[w],Z=S.search(k),R={};Z.isMatch?(R[k]=Z.score,s=!0,x=!0,b.push(Z.score)):(R[k]=1,n.options.matchAllTokens||b.push(1)),n._log('Token: "'.concat(k,'", score: ').concat(R[k]))}x&&(c+=1)}d=b[0];for(var T=b.length,F=1;F<T;F+=1)d+=b[F];d/=T,n._log("Token score average:",d)}var D=p.score;d>-1&&(D=(D+d)/2),n._log("Score average:",D);var _=!n.options.tokenize||!n.options.matchAllTokens||c>=u.length;if(n._log("\nCheck Matches: ".concat(_)),(s||p.isMatch)&&_){var E={key:i,arrayIndex:t,value:r,score:D};n.options.includeMatches&&(E.matchedIndices=p.matchedIndices);var I=f[a];I?I.output.push(E):(f[a]={item:o,output:[E]},g.push(f[a]))}}else if(l(r))for(var M=0,O=r.length;M<O;M+=1)e(M,r[M],o,a)}(o,a,s,d)}},{key:"_computeScore",value:function(e){this._log("\n\nComputing score:\n");for(var t=this._keyWeights,n=!!Object.keys(t).length,i=0,r=e.length;i<r;i+=1){for(var o=e[i],a=o.output,s=a.length,l=1,d=0;d<s;d+=1){var c=a[d],u=c.key,h=n?t[u]:1,p=0===c.score&&t&&t[u]>0?Number.EPSILON:c.score;l*=Math.pow(p,h)}o.score=l,this._log(o)}}},{key:"_sort",value:function(e){this._log("\n\nSorting...."),e.sort(this.options.sortFn)}},{key:"_format",value:function(e){var t=[];if(this.options.verbose){var n=[];this._log("\n\nOutput:\n\n",JSON.stringify(e,(function(e,t){if("object"===i(t)&&null!==t){if(-1!==n.indexOf(t))return;n.push(t)}return t}),2)),n=null}var r=[];this.options.includeMatches&&r.push((function(e,t){var n=e.output;t.matches=[];for(var i=0,r=n.length;i<r;i+=1){var o=n[i];if(0!==o.matchedIndices.length){var a={indices:o.matchedIndices,value:o.value};o.key&&(a.key=o.key),o.hasOwnProperty("arrayIndex")&&o.arrayIndex>-1&&(a.arrayIndex=o.arrayIndex),t.matches.push(a)}}})),this.options.includeScore&&r.push((function(e,t){t.score=e.score}));for(var o=0,a=e.length;o<a;o+=1){var s=e[o];if(this.options.id&&(s.item=this.options.getFn(s.item,this.options.id)[0]),r.length){for(var l={item:s.item},d=0,c=r.length;d<c;d+=1)r[d](s,l);t.push(l)}else t.push(s.item)}return t}},{key:"_log",value:function(){var e;this.options.verbose&&(e=console).log.apply(e,arguments)}}])&&r(t.prototype,n),e}();e.exports=d},function(e,t,n){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var r=n(2),o=n(3),a=n(6),s=function(){function e(t,n){var i=n.location,r=void 0===i?0:i,o=n.distance,s=void 0===o?100:o,l=n.threshold,d=void 0===l?.6:l,c=n.maxPatternLength,u=void 0===c?32:c,h=n.isCaseSensitive,p=void 0!==h&&h,f=n.tokenSeparator,m=void 0===f?/ +/g:f,g=n.findAllMatches,v=void 0!==g&&g,b=n.minMatchCharLength,y=void 0===b?1:b,C=n.includeMatches,S=void 0!==C&&C;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.options={location:r,distance:s,threshold:d,maxPatternLength:u,isCaseSensitive:p,tokenSeparator:m,findAllMatches:v,includeMatches:S,minMatchCharLength:y},this.pattern=p?t:t.toLowerCase(),this.pattern.length<=u&&(this.patternAlphabet=a(this.pattern))}var t,n;return t=e,(n=[{key:"search",value:function(e){var t=this.options,n=t.isCaseSensitive,i=t.includeMatches;if(n||(e=e.toLowerCase()),this.pattern===e){var a={isMatch:!0,score:0};return i&&(a.matchedIndices=[[0,e.length-1]]),a}var s=this.options,l=s.maxPatternLength,d=s.tokenSeparator;if(this.pattern.length>l)return r(e,this.pattern,d);var c=this.options,u=c.location,h=c.distance,p=c.threshold,f=c.findAllMatches,m=c.minMatchCharLength;return o(e,this.pattern,this.patternAlphabet,{location:u,distance:h,threshold:p,findAllMatches:f,minMatchCharLength:m,includeMatches:i})}}])&&i(t.prototype,n),e}();e.exports=s},function(e,t){var n=/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g;e.exports=function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:/ +/g,r=new RegExp(t.replace(n,"\\$&").replace(i,"|")),o=e.match(r),a=!!o,s=[];if(a)for(var l=0,d=o.length;l<d;l+=1){var c=o[l];s.push([e.indexOf(c),c.length-1])}return{score:a?.5:1,isMatch:a,matchedIndices:s}}},function(e,t,n){var i=n(4),r=n(5);e.exports=function(e,t,n,o){for(var a=o.location,s=void 0===a?0:a,l=o.distance,d=void 0===l?100:l,c=o.threshold,u=void 0===c?.6:c,h=o.findAllMatches,p=void 0!==h&&h,f=o.minMatchCharLength,m=void 0===f?1:f,g=o.includeMatches,v=void 0!==g&&g,b=s,y=e.length,C=u,S=e.indexOf(t,b),x=t.length,w=[],k=0;k<y;k+=1)w[k]=0;if(-1!==S){var Z=i(t,{errors:0,currentLocation:S,expectedLocation:b,distance:d});if(C=Math.min(Z,C),-1!==(S=e.lastIndexOf(t,b+x))){var R=i(t,{errors:0,currentLocation:S,expectedLocation:b,distance:d});C=Math.min(R,C)}}S=-1;for(var T=[],F=1,D=x+y,_=1<<(x<=31?x-1:30),E=0;E<x;E+=1){for(var I=0,M=D;I<M;)i(t,{errors:E,currentLocation:b+M,expectedLocation:b,distance:d})<=C?I=M:D=M,M=Math.floor((D-I)/2+I);D=M;var O=Math.max(1,b-M+1),P=p?y:Math.min(b+M,y)+x,N=Array(P+2);N[P+1]=(1<<E)-1;for(var j=P;j>=O;j-=1){var q=j-1,z=n[e.charAt(q)];if(z&&(w[q]=1),N[j]=(N[j+1]<<1|1)&z,0!==E&&(N[j]|=(T[j+1]|T[j])<<1|1|T[j+1]),N[j]&_&&(F=i(t,{errors:E,currentLocation:q,expectedLocation:b,distance:d}))<=C){if(C=F,(S=q)<=b)break;O=Math.max(1,2*b-S)}}if(i(t,{errors:E+1,currentLocation:b,expectedLocation:b,distance:d})>C)break;T=N}var A={isMatch:S>=0,score:0===F?.001:F};return v&&(A.matchedIndices=r(w,m)),A}},function(e,t){e.exports=function(e,t){var n=t.errors,i=void 0===n?0:n,r=t.currentLocation,o=void 0===r?0:r,a=t.expectedLocation,s=void 0===a?0:a,l=t.distance,d=void 0===l?100:l,c=i/e.length,u=Math.abs(s-o);return d?c+u/d:u?1:c}},function(e,t){e.exports=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=[],i=-1,r=-1,o=0,a=e.length;o<a;o+=1){var s=e[o];s&&-1===i?i=o:s||-1===i||((r=o-1)-i+1>=t&&n.push([i,r]),i=-1)}return e[o-1]&&o-i>=t&&n.push([i,o-1]),n}},function(e,t){e.exports=function(e){for(var t={},n=e.length,i=0;i<n;i+=1)t[e.charAt(i)]=0;for(var r=0;r<n;r+=1)t[e.charAt(r)]|=1<<n-r-1;return t}},function(e,t){var n=function(e){return Array.isArray?Array.isArray(e):"[object Array]"===Object.prototype.toString.call(e)},i=function(e){return null==e?"":function(e){if("string"==typeof e)return e;var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}(e)},r=function(e){return"string"==typeof e},o=function(e){return"number"==typeof e};e.exports={get:function(e,t){var a=[];return function e(t,s){if(s){var l=s.indexOf("."),d=s,c=null;-1!==l&&(d=s.slice(0,l),c=s.slice(l+1));var u=t[d];if(null!=u)if(c||!r(u)&&!o(u))if(n(u))for(var h=0,p=u.length;h<p;h+=1)e(u[h],c);else c&&e(u,c);else a.push(i(u))}else a.push(t)}(e,t),a},isArray:n,isString:r,isNum:o,toString:i}}])},18474:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=n(67294),a=d(o),s=d(n(45697)),l=d(n(54087));function d(e){return e&&e.__esModule?e:{default:e}}function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var h=function(e){function t(){var e,n,i;c(this,t);for(var r=arguments.length,o=Array(r),a=0;a<r;a++)o[a]=arguments[a];return n=i=u(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(o))),i.events=["resize","scroll","touchstart","touchmove","touchend","pageshow","load"],i.subscribers=[],i.rafHandle=null,i.subscribe=function(e){i.subscribers=i.subscribers.concat(e)},i.unsubscribe=function(e){i.subscribers=i.subscribers.filter((function(t){return t!==e}))},i.notifySubscribers=function(e){if(!i.framePending){var t=e.currentTarget;i.rafHandle=(0,l.default)((function(){i.framePending=!1;var e=i.node.getBoundingClientRect(),n=e.top,r=e.bottom;i.subscribers.forEach((function(e){return e({distanceFromTop:n,distanceFromBottom:r,eventSource:t===window?document.body:i.node})}))})),i.framePending=!0}},i.getParent=function(){return i.node},u(i,n)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"getChildContext",value:function(){return{subscribe:this.subscribe,unsubscribe:this.unsubscribe,getParent:this.getParent}}},{key:"componentDidMount",value:function(){var e=this;this.events.forEach((function(t){return window.addEventListener(t,e.notifySubscribers)}))}},{key:"componentWillUnmount",value:function(){var e=this;this.rafHandle&&(l.default.cancel(this.rafHandle),this.rafHandle=null),this.events.forEach((function(t){return window.removeEventListener(t,e.notifySubscribers)}))}},{key:"render",value:function(){var e=this;return a.default.createElement("div",i({},this.props,{ref:function(t){return e.node=t},onScroll:this.notifySubscribers,onTouchStart:this.notifySubscribers,onTouchMove:this.notifySubscribers,onTouchEnd:this.notifySubscribers}))}}]),t}(o.PureComponent);h.childContextTypes={subscribe:s.default.func,unsubscribe:s.default.func,getParent:s.default.func},t.default=h},78579:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=n(67294),o=l(r),a=l(n(90731)),s=l(n(45697));function l(e){return e&&e.__esModule?e:{default:e}}function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var u=function(e){function t(){var e,n,i;d(this,t);for(var r=arguments.length,o=Array(r),a=0;a<r;a++)o[a]=arguments[a];return n=i=c(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(o))),i.state={isSticky:!1,wasSticky:!1,style:{}},i.handleContainerEvent=function(e){var t=e.distanceFromTop,n=e.distanceFromBottom,r=e.eventSource,o=i.context.getParent(),a=!1;i.props.relative&&(a=r!==o,t=-(r.scrollTop+r.offsetTop)+i.placeholder.offsetTop);var s=i.placeholder.getBoundingClientRect(),l=i.content.getBoundingClientRect().height,d=n-i.props.bottomOffset-l,c=!!i.state.isSticky,u=a?c:t<=-i.props.topOffset&&n>-i.props.bottomOffset;n=(i.props.relative?o.scrollHeight-o.scrollTop:n)-l;var h=u?{position:"fixed",top:d>0?i.props.relative?o.offsetTop-o.offsetParent.scrollTop:0:d,left:s.left,width:s.width}:{};i.props.disableHardwareAcceleration||(h.transform="translateZ(0)"),i.setState({isSticky:u,wasSticky:c,distanceFromTop:t,distanceFromBottom:n,calculatedHeight:l,style:h})},c(i,n)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),i(t,[{key:"componentWillMount",value:function(){if(!this.context.subscribe)throw new TypeError("Expected Sticky to be mounted within StickyContainer");this.context.subscribe(this.handleContainerEvent)}},{key:"componentWillUnmount",value:function(){this.context.unsubscribe(this.handleContainerEvent)}},{key:"componentDidUpdate",value:function(){this.placeholder.style.paddingBottom=this.props.disableCompensation?0:(this.state.isSticky?this.state.calculatedHeight:0)+"px"}},{key:"render",value:function(){var e=this,t=o.default.cloneElement(this.props.children({isSticky:this.state.isSticky,wasSticky:this.state.wasSticky,distanceFromTop:this.state.distanceFromTop,distanceFromBottom:this.state.distanceFromBottom,calculatedHeight:this.state.calculatedHeight,style:this.state.style}),{ref:function(t){e.content=a.default.findDOMNode(t)}});return o.default.createElement("div",null,o.default.createElement("div",{ref:function(t){return e.placeholder=t}}),t)}}]),t}(r.Component);u.propTypes={topOffset:s.default.number,bottomOffset:s.default.number,relative:s.default.bool,children:s.default.func.isRequired},u.defaultProps={relative:!1,topOffset:0,bottomOffset:0,disableCompensation:!1,disableHardwareAcceleration:!1},u.contextTypes={subscribe:s.default.func,unsubscribe:s.default.func,getParent:s.default.func},t.default=u},58439:(e,t,n)=>{"use strict";t.L9=t.Le=void 0;var i=o(n(78579)),r=o(n(18474));function o(e){return e&&e.__esModule?e:{default:e}}t.Le=i.default,t.L9=r.default,i.default},53652:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});const i=class{constructor(e){this.name="TypedRegistry",this.records=void 0,this.records=e}get(e){return this.records[e]}set(e,t){this.records[e]=t}}},75049:(e,t,n)=>{"use strict";n.d(t,{I:()=>a,_:()=>s});var i=n(53652),r=n(1875);class o extends i.Z{constructor(...e){super(...e),this.name="ExtensionsRegistry"}}const a=(0,r.Z)(o,{}),s=a},38270:(e,t,n)=>{"use strict";n.d(t,{Z:()=>f});var i=n(5872),r=n.n(i),o=n(67294),a=n(94184),s=n.n(a),l=n(51995),d=n(61988),c=n(11965),u=n(58593),h=n(79789);const p=(0,l.iK)(h.Z)`
  vertical-align: middle;
`;function f({canEdit:e=!1,editing:t=!1,extraClasses:n,multiLine:i=!1,noPermitTooltip:a,onSaveTitle:l,showTooltip:h=!0,style:f,title:m="",defaultTitle:g="",placeholder:v="",certifiedBy:b,certificationDetails:y,onClickTitle:C,...S}){const[x,w]=(0,o.useState)(t),[k,Z]=(0,o.useState)(m),[R,T]=(0,o.useState)(m),[F,D]=(0,o.useState)(null),_=(0,o.useRef)();function E(){if(!e||x)return;const t=_.current?_.current.getBoundingClientRect():null;w(!0),D(t)}function I(){const t=k.trim();e&&(w(!1),t.length?(R!==t&&T(t),m!==t&&l(t)):Z(R))}function M(e){" "===e.key&&e.stopPropagation(),"Enter"===e.key&&(e.preventDefault(),I())}function O(t){e&&Z(t.target.value)}function P(e){"Enter"===e.key&&(e.preventDefault(),I())}let N;(0,o.useEffect)((()=>{m!==k&&(T(k),Z(m))}),[m]),(0,o.useEffect)((()=>{if(x&&(_.current.focus(),_.current.setSelectionRange)){const{length:e}=_.current.value;_.current.setSelectionRange(e,e),_.current.scrollLeft=_.current.scrollWidth,_.current.scrollTop=_.current.scrollHeight}}),[x]),N=k,x||k||(N=g||m);const j=x&&F?{height:`${F.height}px`}:void 0;let q=i&&x?(0,c.tZ)("textarea",{ref:_,value:N,className:m?void 0:"text-muted",onKeyDown:M,onChange:O,onBlur:I,onClick:E,onKeyPress:P,placeholder:v,style:j}):(0,c.tZ)("input",{ref:_,type:x?"text":"button",value:N,className:m?void 0:"text-muted",onKeyDown:M,onChange:O,onBlur:I,onClick:E,onKeyPress:P,placeholder:v});return h&&!x&&(q=(0,c.tZ)(u.u,{id:"title-tooltip",title:e?(0,d.t)("Click to edit"):a||(0,d.t)("You don't have the rights to alter this title.")},q)),e||(q=C?(0,c.tZ)("span",{role:"button",onClick:C,tabIndex:0,css:c.iv`
          :hover {
            text-decoration: underline;
          }
        `},N):(0,c.tZ)("span",null,N)),(0,c.tZ)("span",r()({className:s()("editable-title",n,e&&"editable-title--editable",x&&"editable-title--editing"),style:f},S),b&&(0,c.tZ)(o.Fragment,null,(0,c.tZ)(p,{certifiedBy:b,details:y,size:"xl"})," "),q)}},84490:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>ih});var i=n(14890),r=n(37703),o=n(67294),a=n(45697),s=n.n(a),l=n(61988),d=n(93185),c=n(14278),u=n(38703),h=n(81255);function p(e){return Object.values(e).reduce(((e,t)=>(t&&t.type===h.dW&&t.meta&&t.meta.chartId&&e.push(t.meta.chartId),e)),[])}var f=n(94184),m=n.n(f),g=n(29119),v=n(51995),b=n(11965),y=n(57902),C=n(71262),S=n(58439),x=n(23279),w=n.n(x),k=n(91033);function Z(){return Z=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},Z.apply(this,arguments)}function R(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function T(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var F=function(e){var t,n;function i(t){var n;return T(R(n=e.call(this,t)||this),"animationFrameID",void 0),T(R(n),"resizeObserver",void 0),T(R(n),"target",null),T(R(n),"resize",(function(e){var t=e.width,i=e.height,r=e.top,o=e.left;n.setState((function(){return{width:t,height:i,top:r,left:o}}))})),T(R(n),"setTarget",(function(e){n.target=e})),n.state={width:0,height:0,top:0,left:0},n.resize=w()(n.resize,t.debounceTime),n.animationFrameID=null,n}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var r=i.prototype;return r.componentDidMount=function(){var e=this;this.resizeObserver=new k.Z((function(t){void 0===t&&(t=[]),t.forEach((function(t){var n=t.contentRect,i=n.left,r=n.top,o=n.width,a=n.height;e.animationFrameID=window.requestAnimationFrame((function(){e.resize({width:o,height:a,top:r,left:i})}))}))})),this.target&&this.resizeObserver.observe(this.target)},r.componentWillUnmount=function(){this.animationFrameID&&window.cancelAnimationFrame(this.animationFrameID),this.resizeObserver&&this.resizeObserver.disconnect()},r.render=function(){var e=this.props,t=e.className,n=e.children,i=(e.debounceTime,e.parentSizeStyles),r=function(e,t){if(null==e)return{};var n,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,["className","children","debounceTime","parentSizeStyles"]);return o.createElement("div",Z({style:i,ref:this.setTarget,className:t},r),n(Z({},this.state,{ref:this.target,resize:this.resize})))},i}(o.Component);T(F,"propTypes",{className:s().string,debounceTime:s().number,children:s().func.isRequired}),T(F,"defaultProps",{debounceTime:300,parentSizeStyles:{width:"100%",height:"100%"}});var D=n(68969),_=n(88239),E=n(8177),I=n.n(E),M=n(85105),O=n.n(M),P=n(99663),N=n(46058),j=n(49135),q=n(93196),z=n(75621),A=n(94396),$=function(e){function t(){var e,n,i,r;(0,P.default)(this,t);for(var o=arguments.length,a=Array(o),s=0;s<o;s++)a[s]=arguments[s];return n=i=(0,j.default)(this,(e=t.__proto__||O()(t)).call.apply(e,[this].concat(a))),i._cellRenderer=function(e){var t=e.parent,n=e.rowIndex,r=e.style,o=e.isScrolling,a=e.isVisible,s=e.key,l=i.props.rowRenderer;return I()(r,"width").writable&&(r.width="100%"),l({index:n,style:r,isScrolling:o,isVisible:a,key:s,parent:t})},i._setRef=function(e){i.Grid=e},i._onScroll=function(e){var t=e.clientHeight,n=e.scrollHeight,r=e.scrollTop;(0,i.props.onScroll)({clientHeight:t,scrollHeight:n,scrollTop:r})},i._onSectionRendered=function(e){var t=e.rowOverscanStartIndex,n=e.rowOverscanStopIndex,r=e.rowStartIndex,o=e.rowStopIndex;(0,i.props.onRowsRendered)({overscanStartIndex:t,overscanStopIndex:n,startIndex:r,stopIndex:o})},r=n,(0,j.default)(i,r)}return(0,q.default)(t,e),(0,N.default)(t,[{key:"forceUpdateGrid",value:function(){this.Grid&&this.Grid.forceUpdate()}},{key:"getOffsetForRow",value:function(e){var t=e.alignment,n=e.index;return this.Grid?this.Grid.getOffsetForCell({alignment:t,rowIndex:n,columnIndex:0}).scrollTop:0}},{key:"invalidateCellSizeAfterRender",value:function(e){var t=e.columnIndex,n=e.rowIndex;this.Grid&&this.Grid.invalidateCellSizeAfterRender({rowIndex:n,columnIndex:t})}},{key:"measureAllRows",value:function(){this.Grid&&this.Grid.measureAllCells()}},{key:"recomputeGridSize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.columnIndex,n=void 0===t?0:t,i=e.rowIndex,r=void 0===i?0:i;this.Grid&&this.Grid.recomputeGridSize({rowIndex:r,columnIndex:n})}},{key:"recomputeRowHeights",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.Grid&&this.Grid.recomputeGridSize({rowIndex:e,columnIndex:0})}},{key:"scrollToPosition",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.Grid&&this.Grid.scrollToPosition({scrollTop:e})}},{key:"scrollToRow",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.Grid&&this.Grid.scrollToCell({columnIndex:0,rowIndex:e})}},{key:"render",value:function(){var e=this.props,t=e.className,n=e.noRowsRenderer,i=e.scrollToIndex,r=e.width,a=m()("ReactVirtualized__List",t);return o.createElement(z.Z,(0,_.default)({},this.props,{autoContainerWidth:!0,cellRenderer:this._cellRenderer,className:a,columnWidth:r,columnCount:1,noContentRenderer:n,onScroll:this._onScroll,onSectionRendered:this._onSectionRendered,ref:this._setRef,scrollToRow:i}))}}]),t}(o.PureComponent);$.defaultProps={autoHeight:!1,estimatedRowSize:30,onScroll:function(){},noRowsRenderer:function(){return null},onRowsRendered:function(){},overscanIndicesGetter:A.ZP,overscanRowCount:10,scrollToAlignment:"auto",scrollToIndex:-1,style:{}},$.propTypes=null;const U=$;var L=n(24903),V=n(9875),K=n(26506),B=n(35932),W=n(70163),H=n(80621),G=n(2275),Y=n(69856);const J={datasourceUrl:s().string,datasourceName:s().string,innerRef:s().func,isSelected:s().bool,lastModified:s().string,sliceName:s().string.isRequired,style:s().object,visType:s().string.isRequired},Q=v.iK.div`
  ${({theme:e})=>`\n    .chart-card {\n      border: 1px solid ${e.colors.grayscale.light2};\n      border-radius: ${e.gridUnit}px;\n      background: ${e.colors.grayscale.light5};\n      padding: ${2*e.gridUnit}px;\n      margin: 0 ${3*e.gridUnit}px\n        ${3*e.gridUnit}px\n        ${3*e.gridUnit}px;\n      position: relative;\n      cursor: move;\n      white-space: nowrap;\n      overflow: hidden;\n\n      &:hover {\n        background: ${e.colors.grayscale.light4};\n      }\n    }\n\n    .chart-card.is-selected {\n      cursor: not-allowed;\n      opacity: 0.4;\n    }\n\n    .card-title {\n      margin-right: 60px;\n      margin-bottom: ${2*e.gridUnit}px;\n      font-weight: ${e.typography.weights.bold};\n    }\n\n    .card-body {\n      display: flex;\n      flex-direction: column;\n\n      .item {\n        span {\n          word-break: break-all;\n\n          &:first-child {\n            font-weight: ${e.typography.weights.normal};\n          }\n        }\n      }\n    }\n\n    .is-added-label {\n      background: ${e.colors.grayscale.base};\n      border-radius: ${e.gridUnit}px;\n      color: ${e.colors.grayscale.light5};\n      font-size: ${e.typography.sizes.s}px;\n      text-transform: uppercase;\n      position: absolute;\n      padding: ${e.gridUnit}px\n        ${2*e.gridUnit}px;\n      top: ${8*e.gridUnit}px;\n      right: ${8*e.gridUnit}px;\n      pointer-events: none;\n    }\n  `}
`;function X({datasourceUrl:e,datasourceName:t,innerRef:n,isSelected:i,lastModified:r,sliceName:o,style:a,visType:s}){return(0,b.tZ)(Q,{ref:n,style:a},(0,b.tZ)("div",{className:m()("chart-card",i&&"is-selected")},(0,b.tZ)("div",{className:"card-title"},o),(0,b.tZ)("div",{className:"card-body"},(0,b.tZ)("div",{className:"item"},(0,b.tZ)("span",null,(0,l.t)("Modified")," "),(0,b.tZ)("span",null,r)),(0,b.tZ)("div",{className:"item"},(0,b.tZ)("span",null,(0,l.t)("Visualization")," "),(0,b.tZ)("span",null,s)),(0,b.tZ)("div",{className:"item"},(0,b.tZ)("span",null,(0,l.t)("Data source")," "),(0,b.tZ)("a",{href:e},t)))),i&&(0,b.tZ)("div",{className:"is-added-label"},(0,l.t)("Added")))}X.propTypes=J,X.defaultProps={datasourceUrl:null,datasourceName:"-",innerRef:null,isSelected:!1,style:null,lastModified:null};const ee=X;var te=n(84785);const ne={position:"fixed",pointerEvents:"none",top:0,left:0,zIndex:101,width:344},ie={dragItem:s().shape({index:s().number.isRequired}),slices:s().arrayOf(G.Rw),isDragging:s().bool.isRequired,currentOffset:s().shape({x:s().number.isRequired,y:s().number.isRequired})};function re({dragItem:e,slices:t,isDragging:n,currentOffset:i}){if(!(n&&i&&e&&t))return null;const r=t[e.index];return r&&e.parentType===h.F0&&e.type===h.dW?(0,b.tZ)(ee,{style:{...ne,transform:`translate(${i.x}px, ${i.y}px)`},sliceName:r.slice_name,lastModified:r.changed_on_humanized,visType:r.viz_type,datasourceUrl:r.datasource_url,datasourceName:r.datasource_name}):null}re.propTypes=ie,re.defaultProps={currentOffset:null,dragItem:null,slices:null};const oe=(0,te.DragLayer)((e=>({dragItem:e.getItem(),currentOffset:e.getSourceClientOffset(),isDragging:e.isDragging()})))(re);var ae,se=n(23493),le=n.n(se);const de=H.Mu+1,ce=H.Mu+3,ue=H.Mu+4,he=H.Mu+5,pe={[h.U0]:{[h.yR]:H.Mu,[h.BG]:H.Mu},[h.BG]:{[h.dW]:de,[h.t]:de,[h.xh]:de,[h.BA]:de,[h.hE]:de,[h.Nc]:de,[h.Os]:de,[h.yR]:de},[h.Os]:{[h.dW]:ue,[h.t]:ue,[h.xh]:ue,[h.BA]:ue},[h.yR]:{[h.gn]:ce},[h.gn]:{[h.dW]:he,[h.t]:he,[h.xh]:he,[h.BA]:ce,[h.hE]:he,[h.Nc]:he,[h.Os]:ce,[h.yR]:ce},[h.BA]:{[h.dW]:he,[h.Nc]:he,[h.xh]:he,[h.Os]:ce,[h.hE]:ce,[h.yR]:ce},[h.dW]:{},[h.t]:{},[h.hE]:{},[h.Nc]:{},[h.xh]:{}};function fe(e){const{parentType:t,childType:n,parentDepth:i}=e;if(!t||!n||"number"!=typeof i)return!1;const r=(pe[t]||{})[n];return"number"==typeof r&&i<=r}const me="DROP_TOP",ge="DROP_RIGHT",ve="DROP_BOTTOM",be="DROP_LEFT";let ye,Ce={};function Se(e,t){const{depth:n,parentComponent:i,component:r,orientation:o,isDraggingOverShallow:a}=t.props,s=e.getItem();if(!s||s.id===r.id)return null;const l=fe({parentType:r.type,parentDepth:n,childType:s.type}),d=i&&i.type,c=fe({parentType:d,parentDepth:n+(d===h.gn||d===h.yR?0:-1),childType:s.type});if(!l&&!c)return null;const u=(r.children||[]).length>0,p="row"===o?"vertical":"horizontal",f="row"===o?"horizontal":"vertical";if(a&&l&&!c)return"vertical"===p?u?ge:be:u?ve:me;const m=t.ref.getBoundingClientRect(),g=e.getClientOffset()||Ce[r.id];if(!g||!m)return null;Ce[r.id]=g;const v=Math.abs(g.y-m.top),b=Math.abs(g.y-m.bottom),y=Math.abs(g.x-m.left),C=Math.abs(g.x-m.right);if(!a&&[v,b,y,C].every((e=>e>20)))return null;if(c&&!l){if("vertical"===f){const e=m.left+(m.right-m.left)/2;return g.x<e?be:ge}const e=m.top+(m.bottom-m.top)/2;return g.y<e?me:ve}if(c&&l){if("vertical"===f){if(y<20)return be;if(C<20)return ge}else{if(v<20)return me;if(b<20)return ve}return"vertical"===p?u?ge:be:u?ve:me}return null}const xe=le()((function(e,t,n){var i,r;if(!n.mounted)return;const o=Se(t,n);!function(e){const t="SCROLL_TOP"===e&&!ye&&0!==document.documentElement.scrollTop,n=ye&&("SCROLL_TOP"!==e||0===document.documentElement.scrollTop);t?ye=setInterval((()=>{if(0===document.documentElement.scrollTop)return clearInterval(ye),void(ye=null);let e=document.documentElement.scrollTop-120;e<0&&(e=0),window.scroll({top:e,behavior:"smooth"})}),50):n&&(clearInterval(ye),ye=null)}((null==n||null==(i=n.props)||null==(r=i.component)?void 0:r.type)===h.U0?"SCROLL_TOP":null),o?n.setState((()=>({dropIndicator:o}))):n.setState((()=>({dropIndicator:null})))}),100);const we="DRAG_DROPPABLE",ke=[we,{canDrag:e=>!e.disableDragDrop,beginDrag(e){const{component:t,index:n,parentComponent:i={}}=e;return{type:t.type,id:t.id,meta:t.meta,index:n,parentId:i.id,parentType:i.type}}},function(e,t){return{dragSourceRef:e.dragSource(),dragPreviewRef:e.dragPreview(),isDragging:t.isDragging()}}],Ze=[we,{canDrop:e=>!e.disableDragDrop,hover(e,t,n){n&&n.mounted&&xe(e,t,n)},drop(e,t,n){const i=t.getDropResult();if((!i||!i.destination)&&n.mounted)return function(e,t,n){if(!n.mounted)return;n.setState((()=>({dropIndicator:null})));const i=Se(t,n);if(!i)return;const{parentComponent:r,component:o,index:a,onDrop:s,orientation:l}=n.props,d=t.getItem(),c="row"===l&&(i===me||i===ve)||"column"===l&&(i===be||i===ge)?"sibling":"child",u={source:{id:d.parentId,type:d.parentType,index:d.index},dragging:{id:d.id,type:d.type,meta:d.meta}};if("child"===c)u.destination={id:o.id,type:o.type,index:o.children.length};else{let e=r&&d.parentId===r.id&&d.index<a?a-1:a;i!==ve&&i!==ge||(e+=1),u.destination={id:r.id,type:r.type,index:e}}return s(u),Ce={},u}(0,t,n)}},function(e,t){return{droppableRef:e.dropTarget(),isDraggingOver:t.isOver(),isDraggingOverShallow:t.isOver({shallow:!0})}}],Re={children:s().func,className:s().string,component:G.cP.isRequired,parentComponent:G.cP,depth:s().number.isRequired,disableDragDrop:s().bool,orientation:s().oneOf(["row","column"]),index:s().number.isRequired,style:s().object,onDrop:s().func,editMode:s().bool.isRequired,useEmptyDragPreview:s().bool,isDragging:s().bool.isRequired,isDraggingOver:s().bool.isRequired,isDraggingOverShallow:s().bool.isRequired,droppableRef:s().func.isRequired,dragSourceRef:s().func.isRequired,dragPreviewRef:s().func.isRequired},Te={className:null,style:null,parentComponent:null,disableDragDrop:!1,children(){},onDrop(){},orientation:"row",useEmptyDragPreview:!1};class Fe extends o.PureComponent{constructor(e){super(e),this.state={dropIndicator:null},this.setRef=this.setRef.bind(this)}componentDidMount(){this.mounted=!0}componentWillUnmount(){this.mounted=!1}setRef(e){this.ref=e,this.props.useEmptyDragPreview?this.props.dragPreviewRef((ae||((ae=new Image).src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="),ae),{captureDraggingState:!0}):this.props.dragPreviewRef(e),this.props.droppableRef(e)}render(){const{children:e,className:t,orientation:n,dragSourceRef:i,disableDragDrop:r,isDragging:o,isDraggingOver:a,style:s,editMode:l}=this.props,{dropIndicator:d}=this.state,c=a&&d&&!r?{className:m()("drop-indicator",d===me&&"drop-indicator--top",d===ve&&"drop-indicator--bottom",d===be&&"drop-indicator--left",d===ge&&"drop-indicator--right")}:null,u=l?{dragSourceRef:i,dropIndicatorProps:c}:{};return(0,b.tZ)("div",{style:s,ref:this.setRef,className:m()("dragdroppable","row"===n&&"dragdroppable-row","column"===n&&"dragdroppable-column",o&&"dragdroppable--dragging",t)},e(u))}}Fe.propTypes=Re,Fe.defaultProps=Te;const De=(0,te.DragSource)(...ke)((0,te.DropTarget)(...Ze)(Fe)),_e={fetchAllSlices:s().func.isRequired,isLoading:s().bool.isRequired,slices:s().objectOf(G.Rw).isRequired,lastUpdated:s().number.isRequired,errorMessage:s().string,userId:s().string.isRequired,selectedSliceIds:s().arrayOf(s().number),editMode:s().bool,height:s().number,filterboxMigrationState:Y.Qi,dashboardId:s().number},Ee={selectedSliceIds:[],editMode:!1,errorMessage:"",height:window.innerHeight,filterboxMigrationState:Y.Qi.NOOP},Ie=["slice_name","viz_type","datasource_name"],Me={slice_name:"name",viz_type:"viz type",datasource_name:"dataset",changed_on:"recent"},Oe=v.iK.div`
  display: flex;
  flex-direction: row;
  padding: ${({theme:e})=>3*e.gridUnit}px;
  padding-top: ${({theme:e})=>4*e.gridUnit}px;
`,Pe=(0,v.iK)(K.Ph)`
  margin-left: ${({theme:e})=>2*e.gridUnit}px;
  min-width: 150px;
`,Ne=v.iK.div`
  ${({theme:e})=>b.iv`
    display: flex;
    justify-content: flex-end;
    padding-right: ${2*e.gridUnit}px;
  `}
`,je=(0,v.iK)(B.Z)`
  ${({theme:e})=>b.iv`
    height: auto;
    & > .anticon + span {
      margin-left: 0;
    }
    & > [role='img']:first-of-type {
      margin-right: ${e.gridUnit}px;
      padding-bottom: 1px;
      line-height: 0;
    }
  `}
`;class qe extends o.Component{static sortByComparator(e){const t="changed_on"===e?-1:1;return(n,i)=>n[e]<i[e]?-1*t:n[e]>i[e]?1*t:0}constructor(e){super(e),this.handleChange=w()((e=>{this.searchUpdated(e);const{userId:t,filterboxMigrationState:n}=this.props;this.slicesRequest=this.props.fetchFilteredSlices(t,(0,d.c)(d.T.ENABLE_FILTER_BOX_MIGRATION)&&n!==Y.Qi.SNOOZED,e)}),300),this.state={filteredSlices:[],searchTerm:"",sortBy:"changed_on",selectedSliceIdsSet:new Set(e.selectedSliceIds)},this.rowRenderer=this.rowRenderer.bind(this),this.searchUpdated=this.searchUpdated.bind(this),this.handleKeyPress=this.handleKeyPress.bind(this),this.handleSelect=this.handleSelect.bind(this)}componentDidMount(){const{userId:e,filterboxMigrationState:t}=this.props;this.slicesRequest=this.props.fetchAllSlices(e,(0,d.c)(d.T.ENABLE_FILTER_BOX_MIGRATION)&&t!==Y.Qi.SNOOZED)}UNSAFE_componentWillReceiveProps(e){const t={};e.lastUpdated!==this.props.lastUpdated&&(t.filteredSlices=Object.values(e.slices).filter((0,L.cj)(this.state.searchTerm,Ie)).sort(qe.sortByComparator(this.state.sortBy))),e.selectedSliceIds!==this.props.selectedSliceIds&&(t.selectedSliceIdsSet=new Set(e.selectedSliceIds)),Object.keys(t).length&&this.setState(t)}componentWillUnmount(){this.slicesRequest&&this.slicesRequest.abort&&this.slicesRequest.abort()}getFilteredSortedSlices(e,t){return Object.values(this.props.slices).filter((0,L.cj)(e,Ie)).sort(qe.sortByComparator(t))}handleKeyPress(e){"Enter"===e.key&&(e.preventDefault(),this.searchUpdated(e.target.value))}searchUpdated(e){this.setState((t=>({searchTerm:e,filteredSlices:this.getFilteredSortedSlices(e,t.sortBy)})))}handleSelect(e){this.setState((t=>({sortBy:e,filteredSlices:this.getFilteredSortedSlices(t.searchTerm,e)})));const{userId:t,filterboxMigrationState:n}=this.props;this.slicesRequest=this.props.fetchSortedSlices(t,(0,d.c)(d.T.ENABLE_FILTER_BOX_MIGRATION)&&n!==Y.Qi.SNOOZED,e)}rowRenderer({key:e,index:t,style:n}){const{filteredSlices:i,selectedSliceIdsSet:r}=this.state,o=i[t],a=r.has(o.slice_id),s=h.dW,l=H.Jd,d={chartId:o.slice_id,sliceName:o.slice_name};return(0,b.tZ)(De,{key:e,component:{type:s,id:l,meta:d},parentComponent:{id:H.D0,type:h.F0},index:t,depth:0,disableDragDrop:a,editMode:this.props.editMode,useEmptyDragPreview:!0,style:{}},(({dragSourceRef:e})=>(0,b.tZ)(ee,{innerRef:e,style:n,sliceName:o.slice_name,lastModified:o.changed_on_humanized,visType:o.viz_type,datasourceUrl:o.datasource_url,datasourceName:o.datasource_name,isSelected:a})))}render(){const e=this.props.height-30-64-16;return(0,b.tZ)("div",{className:"slice-adder-container"},(0,b.tZ)(Ne,null,(0,b.tZ)(je,{buttonStyle:"link",buttonSize:"xsmall",onClick:()=>window.open(`/chart/add?dashboard_id=${this.props.dashboardId}`,"_blank","noopener noreferrer")},(0,b.tZ)(W.Z.PlusSmall,null),(0,l.t)("Create new chart"))),(0,b.tZ)(Oe,null,(0,b.tZ)(V.II,{placeholder:(0,l.t)("Filter your charts"),className:"search-input",onChange:e=>this.handleChange(e.target.value),onKeyPress:this.handleKeyPress}),(0,b.tZ)(Pe,{id:"slice-adder-sortby",value:this.state.sortBy,onChange:this.handleSelect,options:Object.entries(Me).map((([e,t])=>({label:(0,l.t)("Sort by %s",t),value:e}))),placeholder:(0,l.t)("Sort by")})),this.props.isLoading&&(0,b.tZ)(u.Z,null),!this.props.isLoading&&this.state.filteredSlices.length>0&&(0,b.tZ)(U,{width:376,height:e,rowCount:this.state.filteredSlices.length,rowHeight:112,rowRenderer:this.rowRenderer,searchTerm:this.state.searchTerm,sortBy:this.state.sortBy,selectedSliceIds:this.props.selectedSliceIds}),this.props.errorMessage&&(0,b.tZ)("div",{className:"error-message"},this.props.errorMessage),(0,b.tZ)(oe,{slices:this.state.filteredSlices}))}}qe.propTypes=_e,qe.defaultProps=Ee;const ze=qe,Ae=(0,r.$j)((function({sliceEntities:e,dashboardInfo:t,dashboardState:n},i){return{height:i.height,userId:t.userId,dashboardId:t.id,selectedSliceIds:n.sliceIds,slices:e.slices,isLoading:e.isLoading,errorMessage:e.errorMessage,lastUpdated:e.lastUpdated,editMode:n.editMode,filterboxMigrationState:n.filterboxMigrationState}}),(function(e){return(0,i.DE)({fetchAllSlices:D.To,fetchSortedSlices:D.Fv,fetchFilteredSlices:D.uC},e)}))(ze),$e=({registryKeys:e,registry:t})=>()=>e.map((e=>t[e])),Ue=({registryKeys:e,registry:t})=>n=>{e=e.filter((e=>e!==n)),delete t[n]},Le=({registry:e})=>t=>e[t],Ve=((e=[])=>{const t={registry:{},registryKeys:[]},n=(({registryKeys:e,registry:t})=>(n,i)=>{e.push(n),t[n]={key:n,metadata:i.metadata,Component:o.lazy(i.loadComponent)}})(t);return e.forEach((({key:e,item:t})=>{n(e,t)})),{set:n,get:Le(t),delete:Ue(t),getAll:$e(t)}})([]),Ke={id:s().string.isRequired,type:s().string.isRequired,label:s().string.isRequired,className:s().string};class Be extends o.PureComponent{render(){const{label:e,id:t,type:n,className:i,meta:r}=this.props;return(0,b.tZ)(De,{component:{type:n,id:t,meta:r},parentComponent:{id:H.D0,type:h.F0},index:0,depth:0,editMode:!0},(({dragSourceRef:t})=>(0,b.tZ)("div",{ref:t,className:"new-component"},(0,b.tZ)("div",{className:m()("new-component-placeholder",i)}),e)))}}function We(){return(0,b.tZ)(Be,{id:H.Nb,type:h.BA,label:(0,l.t)("Column"),className:"fa fa-long-arrow-down"})}function He(){return(0,b.tZ)(Be,{id:H.ES,type:h.hE,label:(0,l.t)("Divider"),className:"divider-placeholder"})}function Ge(){return(0,b.tZ)(Be,{id:H.Z1,type:h.Nc,label:(0,l.t)("Header"),className:"fa fa-header"})}function Ye(){return(0,b.tZ)(Be,{id:H.vD,type:h.Os,label:(0,l.t)("Row"),className:"fa fa-long-arrow-right"})}function Je(){return(0,b.tZ)(Be,{id:H.NN,type:h.yR,label:(0,l.t)("Tabs"),className:"fa fa-window-restore"})}function Qe(){return(0,b.tZ)(Be,{id:H.C3,type:h.xh,label:"Markdown",className:"fa fa-code"})}Be.propTypes=Ke,Be.defaultProps={className:null};const Xe=({componentKey:e,metadata:t})=>(0,b.tZ)(Be,{id:H.gR,type:h.t,label:t.name,meta:{metadata:t,componentKey:e},className:`fa fa-${t.iconName}`}),et=(0,v.iK)(C.ZP)`
  line-height: inherit;
  margin-top: ${({theme:e})=>2*e.gridUnit}px;
`,tt=v.iK.div`
  height: 100%;
  position: fixed;
  right: 0;
  top: 0;

  .ReactVirtualized__List {
    padding-bottom: ${({topOffset:e})=>`${124+e}px`};
  }
`,nt=({isStandalone:e,topOffset:t=0})=>(0,b.tZ)(tt,{topOffset:t,className:"dashboard-builder-sidepane"},(0,b.tZ)(F,null,(({height:n})=>(0,b.tZ)(S.L9,null,(0,b.tZ)(S.Le,{topOffset:-t,bottomOffset:1/0},(({style:i,isSticky:r})=>{const{pageYOffset:o}=window,a=o<59&&!e,s=t+(59-o-4);return(0,b.tZ)("div",{className:"viewport",style:{...i,top:a?s:t}},(0,b.tZ)(et,{id:"tabs",className:"tabs-components"},(0,b.tZ)(C.ZP.TabPane,{key:1,tab:(0,l.t)("Charts"),className:"tab-charts"},(0,b.tZ)(Ae,{height:n+(r?59:0)})),(0,b.tZ)(C.ZP.TabPane,{key:2,tab:(0,l.t)("Layout elements")},(0,b.tZ)(Je,null),(0,b.tZ)(Ye,null),(0,b.tZ)(We,null),(0,b.tZ)(Ge,null),(0,b.tZ)(Qe,null),(0,b.tZ)(He,null),Ve.getAll().map((({key:e,metadata:t})=>(0,b.tZ)(Xe,{metadata:t,componentKey:e}))))))}))))));var it=n(74599),rt=n(30381),ot=n.n(rt),at=n(78161),st=n(91877),lt=n(3741),dt=n(12617),ct=n(58593),ut=n(9679),ht=n(5872),pt=n.n(ht),ft=n(31069),mt=n(83862),gt=n(27600),vt=n(10222),bt=n(68492),yt=n(23525);const Ct=e=>{const{copyMenuItemTitle:t,emailMenuItemTitle:n,emailSubject:i,emailBody:o,addDangerToast:a,addSuccessToast:s,dashboardId:d,dashboardComponentId:c,...u}=e,{dataMask:h,activeTabs:p}=(0,r.v9)((e=>({dataMask:e.dataMask,activeTabs:e.dashboardState.activeTabs})));async function f(){return(0,yt.Nm)({dashboardId:d,dataMask:h,activeTabs:p,anchor:c})}return(0,b.tZ)(mt.v,{selectable:!1},(0,b.tZ)(mt.v.Item,pt()({key:"copy-url"},u),(0,b.tZ)("div",{onClick:async function(){try{await(0,vt.Z)(f),s((0,l.t)("Copied to clipboard!"))}catch(e){bt.Z.error(e),a((0,l.t)("Sorry, something went wrong. Try again later."))}},role:"button",tabIndex:0},t)),(0,b.tZ)(mt.v.Item,pt()({key:"share-by-email"},u),(0,b.tZ)("div",{onClick:async function(){try{const e=encodeURIComponent(`${o}${await f()}`),t=encodeURIComponent(i);window.location.href=`mailto:?Subject=${t}%20&Body=${e}`}catch(e){bt.Z.error(e),a((0,l.t)("Sorry, something went wrong. Try again later."))}},role:"button",tabIndex:0},n)))};var St=n(1304),xt=n(94670);const wt=v.iK.div`
  ${({theme:e})=>`\n    .css-editor-header {\n      display: flex;\n      flex-direction: row;\n      justify-content: space-between;\n      margin-bottom: ${2*e.gridUnit}px;\n\n      h5 {\n        margin-top: ${e.gridUnit}px;\n      }\n    }\n    .css-editor {\n      border: 1px solid ${e.colors.grayscale.light1};\n    }\n  `}
`,kt={initialCss:s().string,triggerNode:s().node.isRequired,onChange:s().func,templates:s().array};class Zt extends o.PureComponent{constructor(e){super(e),this.state={css:e.initialCss},this.changeCss=this.changeCss.bind(this),this.changeCssTemplate=this.changeCssTemplate.bind(this)}componentDidMount(){xt.ry.preload()}changeCss(e){this.setState({css:e},(()=>{this.props.onChange(e)}))}changeCssTemplate({key:e}){this.changeCss(e)}renderTemplateSelector(){if(this.props.templates){const e=(0,b.tZ)(mt.v,{onClick:this.changeCssTemplate},this.props.templates.map((e=>(0,b.tZ)(mt.v.Item,{key:e.css},e.label))));return(0,b.tZ)(K.Gj,{overlay:e,placement:"bottomRight"},(0,b.tZ)(B.Z,null,(0,l.t)("Load a CSS template")))}return null}render(){return(0,b.tZ)(St.Z,{triggerNode:this.props.triggerNode,modalTitle:(0,l.t)("CSS"),modalBody:(0,b.tZ)(wt,null,(0,b.tZ)("div",{className:"css-editor-header"},(0,b.tZ)("h5",null,(0,l.t)("Live CSS editor")),this.renderTemplateSelector()),(0,b.tZ)(xt.ry,{className:"css-editor",minLines:12,maxLines:30,onChange:this.changeCss,height:"200px",width:"100%",editorProps:{$blockScrolling:!0},enableLiveAutocompletion:!0,value:this.state.css||""}))})}}Zt.propTypes=kt,Zt.defaultProps={initialCss:"",onChange:()=>{}};const Rt=Zt;var Tt=n(81315),Ft=n(29487),Dt=n(49238);const _t=[[0,(0,l.t)("Don't refresh")],[10,(0,l.t)("10 seconds")],[30,(0,l.t)("30 seconds")],[60,(0,l.t)("1 minute")],[300,(0,l.t)("5 minutes")],[1800,(0,l.t)("30 minutes")],[3600,(0,l.t)("1 hour")],[21600,(0,l.t)("6 hours")],[43200,(0,l.t)("12 hours")],[86400,(0,l.t)("24 hours")]].map((e=>({value:e[0],label:e[1]}))),Et=(0,v.iK)(St.Z)`
  .ant-modal-body {
    overflow: visible;
  }
`,It=v.iK.div`
  margin-top: ${({theme:e})=>6*e.gridUnit}px;
`;class Mt extends o.PureComponent{constructor(e){super(e),this.modalRef=void 0,this.modalRef=o.createRef(),this.state={refreshFrequency:e.refreshFrequency},this.handleFrequencyChange=this.handleFrequencyChange.bind(this),this.onSave=this.onSave.bind(this),this.onCancel=this.onCancel.bind(this)}onSave(){var e,t;this.props.onChange(this.state.refreshFrequency,this.props.editMode),null==(e=this.modalRef)||null==(t=e.current)||t.close(),this.props.addSuccessToast((0,l.t)("Refresh interval saved"))}onCancel(){var e,t;this.setState({refreshFrequency:this.props.refreshFrequency}),null==(e=this.modalRef)||null==(t=e.current)||t.close()}handleFrequencyChange(e){this.setState({refreshFrequency:e||_t[0].value})}render(){const{refreshLimit:e=0,refreshWarning:t,editMode:n}=this.props,{refreshFrequency:i=0}=this.state,r=!!i&&!!t&&i<e;return(0,b.tZ)(Et,{ref:this.modalRef,triggerNode:this.props.triggerNode,modalTitle:(0,l.t)("Refresh interval"),modalBody:(0,b.tZ)("div",null,(0,b.tZ)(Dt.lX,null,(0,l.t)("Refresh frequency")),(0,b.tZ)(Tt.ZP,{ariaLabel:(0,l.t)("Refresh interval"),options:_t,value:i,onChange:this.handleFrequencyChange,sortComparator:(0,Tt.mj)("value")}),r&&(0,b.tZ)(It,null,(0,b.tZ)(Ft.Z,{type:"warning",message:(0,b.tZ)(o.Fragment,null,(0,b.tZ)("div",null,t),(0,b.tZ)("br",null),(0,b.tZ)("strong",null,(0,l.t)("Are you sure you want to proceed?")))}))),modalFooter:(0,b.tZ)(o.Fragment,null,(0,b.tZ)(B.Z,{buttonStyle:"primary",buttonSize:"small",onClick:this.onSave},n?(0,l.t)("Save"):(0,l.t)("Save for this session")),(0,b.tZ)(B.Z,{onClick:this.onCancel,buttonSize:"small"},(0,l.t)("Cancel")))})}}Mt.defaultProps={refreshLimit:0,refreshWarning:null};const Ot=Mt;var Pt=n(87183),Nt=n(87253);const jt={saveType:H.TN,colorNamespace:void 0,colorScheme:void 0,shouldPersistRefreshFrequency:!1};class qt extends o.PureComponent{constructor(e){super(e),this.modal=void 0,this.onSave=void 0,this.state={saveType:e.saveType,newDashName:`${e.dashboardTitle} [copy]`,duplicateSlices:!1},this.handleSaveTypeChange=this.handleSaveTypeChange.bind(this),this.handleNameChange=this.handleNameChange.bind(this),this.saveDashboard=this.saveDashboard.bind(this),this.toggleDuplicateSlices=this.toggleDuplicateSlices.bind(this),this.onSave=this.props.onSave.bind(this),this.modal=o.createRef()}toggleDuplicateSlices(){this.setState((e=>({duplicateSlices:!e.duplicateSlices})))}handleSaveTypeChange(e){this.setState({saveType:e.target.value})}handleNameChange(e){this.setState({newDashName:e,saveType:H.kS})}saveDashboard(){var e;const{saveType:t,newDashName:n}=this.state,{dashboardTitle:i,dashboardInfo:r,layout:o,customCss:a,dashboardId:s,refreshFrequency:d,shouldPersistRefreshFrequency:c,lastModifiedTime:u}=this.props,h=c?d:null==(e=r.metadata)?void 0:e.refresh_frequency,p={certified_by:r.certified_by,certification_details:r.certification_details,css:a,dashboard_title:t===H.kS?n:i,duplicate_slices:this.state.duplicateSlices,last_modified_time:u,owners:r.owners,roles:r.roles,metadata:{...null==r?void 0:r.metadata,positions:o,refresh_frequency:h}};var f,m;t!==H.kS||n?(this.onSave(p,s,t).then((e=>{t===H.kS&&e&&e.json&&e.json.id&&(window.location.href=`/superset/dashboard/${e.json.id}/`)})),null==(f=this.modal)||null==(m=f.current)||null==m.close||m.close()):this.props.addDangerToast((0,l.t)("You must pick a name for the new dashboard"))}render(){return(0,b.tZ)(St.Z,{ref:this.modal,triggerNode:this.props.triggerNode,modalTitle:(0,l.t)("Save dashboard"),modalBody:(0,b.tZ)("div",null,(0,b.tZ)(Pt.Y,{value:H.TN,onChange:this.handleSaveTypeChange,checked:this.state.saveType===H.TN,disabled:!this.props.canOverwrite},(0,l.t)("Overwrite Dashboard [%s]",this.props.dashboardTitle)),(0,b.tZ)("hr",null),(0,b.tZ)(Pt.Y,{value:H.kS,onChange:this.handleSaveTypeChange,checked:this.state.saveType===H.kS},(0,l.t)("Save as:")),(0,b.tZ)(V.II,{type:"text",placeholder:(0,l.t)("[dashboard name]"),value:this.state.newDashName,onFocus:e=>this.handleNameChange(e.target.value),onChange:e=>this.handleNameChange(e.target.value)}),(0,b.tZ)("div",{className:"m-l-25 m-t-5"},(0,b.tZ)(Nt.ZP,{checked:this.state.duplicateSlices,onChange:()=>this.toggleDuplicateSlices()}),(0,b.tZ)("span",{className:"m-l-5"},(0,l.t)("also copy (duplicate) charts")))),modalFooter:(0,b.tZ)("div",null,(0,b.tZ)(B.Z,{buttonStyle:"primary",onClick:this.saveDashboard},(0,l.t)("Save")))})}}qt.defaultProps=jt;const zt=qt;var At=n(97634),$t=n(14505),Ut=n(81395),Lt=n(31758),Vt=n(41609),Kt=n.n(Vt);const Bt=[h.gn,h.U0];function Wt({currentNode:e={},components:t={},filterFields:n=[],selectedChartId:i}){if(!e)return null;const{type:r}=e;if(h.dW===r&&e&&e.meta&&e.meta.chartId){const t={value:e.meta.chartId,label:e.meta.sliceName||`${r} ${e.meta.chartId}`,type:r,showCheckbox:i!==e.meta.chartId};return{...t,children:n.map((n=>({value:`${e.meta.chartId}:${n}`,label:`${t.label}`,type:"filter_box",showCheckbox:!1})))}}let o=[];if(e.children&&e.children.length&&e.children.forEach((e=>{const r=Wt({currentNode:t[e],components:t,filterFields:n,selectedChartId:i}),a=t[e].type;Bt.includes(a)?o.push(r):o=o.concat(r)})),Bt.includes(r)){let t=null;return t=r===h.U0?(0,l.t)("All charts"):e.meta&&e.meta.text?e.meta.text:`${r} ${e.id}`,{value:e.id,label:t,type:r,children:o}}return o}function Ht({components:e={},filterFields:t=[],selectedChartId:n}){return Kt()(e)?[]:[{...Wt({currentNode:e[H._4],components:e,filterFields:t,selectedChartId:n})}]}function Gt(e=[],t=-1){const n=[],i=(e,r)=>{e&&e.children&&(-1===t||r<t)&&(n.push(e.value),e.children.forEach((e=>i(e,r+1))))};return e.length>0&&e.forEach((e=>{i(e,0)})),n}function Yt({activeFilterField:e,checkedFilterFields:t}){return(0,ut.o)(e?[e]:t)}var Jt=n(20194);function Qt({activeFilterField:e,checkedFilterFields:t}){if(e)return(0,Jt._)(e).chartId;if(t.length){const{chartId:e}=(0,Jt._)(t[0]);return t.some((t=>(0,Jt._)(t).chartId!==e))?null:e}return null}function Xt({checkedFilterFields:e=[],activeFilterField:t,filterScopeMap:n={},layout:i={}}){const r=Yt({checkedFilterFields:e,activeFilterField:t}),o=t?[t]:e,a=Ht({components:i,filterFields:o,selectedChartId:Qt({checkedFilterFields:e,activeFilterField:t})}),s=new Set;o.forEach((e=>{(n[e].checked||[]).forEach((t=>{s.add(`${t}:${e}`)}))}));const l=[...s],d=n[r]?n[r].expanded:Gt(a,1);return{[r]:{nodes:a,nodesFiltered:[...a],checked:l,expanded:d}}}var en=n(94654),tn=n.n(en),nn=n(83927),rn=n.n(nn),on=n(58809),an=n.n(on),sn=n(8816),ln=n.n(sn);function dn({tabScopes:e,parentNodeValue:t,forceAggregate:n=!1,hasChartSiblings:i=!1,tabChildren:r=[],immuneChartSiblings:o=[]}){if(n||!i&&Object.entries(e).every((([e,{scope:t}])=>t&&t.length&&e===t[0]))){const n=function({tabs:e=[],tabsInScope:t=[]}){const n=[];return e.forEach((({value:e,children:i})=>{i&&!t.includes(e)&&i.forEach((({value:e,children:i})=>{i&&!t.includes(e)&&n.push(...i.filter((({type:e})=>e===h.dW)))}))})),n.map((({value:e})=>e))}({tabs:r,tabsInScope:tn()(e,(({scope:e})=>e))}),i=tn()(Object.values(e),(({immune:e})=>e));return{scope:[t],immune:[...new Set([...n,...i])]}}const a=Object.values(e).filter((({scope:e})=>e&&e.length));return{scope:tn()(a,(({scope:e})=>e)),immune:a.length?tn()(a,(({immune:e})=>e)):tn()(Object.values(e),(({immune:e})=>e)).concat(o)}}function cn({currentNode:e={},filterId:t,checkedChartIds:n=[]}){if(!e)return{};const{value:i,children:r}=e,o=r.filter((({type:e})=>e===h.dW)),a=r.filter((({type:e})=>e===h.gn)),s=o.filter((({value:e})=>t!==e&&!n.includes(e))).map((({value:e})=>e)),l=ln()(an()((e=>e.value)),rn()((e=>cn({currentNode:e,filterId:t,checkedChartIds:n}))))(a);if(!Kt()(o)&&o.some((({value:e})=>n.includes(e)))){if(Kt()(a))return{scope:[i],immune:s};const{scope:e,immune:t}=dn({tabScopes:l,parentNodeValue:i,forceAggregate:!0,tabChildren:a});return{scope:e,immune:s.concat(t)}}return a.length?dn({tabScopes:l,parentNodeValue:i,hasChartSiblings:!Kt()(o),tabChildren:a,immuneChartSiblings:s}):{scope:[],immune:s}}function un({filterKey:e,nodes:t=[],checkedChartIds:n=[]}){if(t.length){const{chartId:i}=(0,Jt._)(e);return cn({currentNode:t[0],filterId:i,checkedChartIds:n})}return{}}var hn=n(43399),pn=n(28388),fn=n.n(pn);const mn=(0,v.iK)(W.Z.BarChartOutlined)`
  ${({theme:e})=>`\n    position: relative;\n    top: ${e.gridUnit-1}px;\n    color: ${e.colors.primary.base};\n    margin-right: ${2*e.gridUnit}px;\n  `}
`;function gn({currentNode:e={},selectedChartId:t}){if(!e)return null;const{label:n,value:i,type:r,children:o}=e;if(o&&o.length){const a=o.map((e=>gn({currentNode:e,selectedChartId:t})));return{...e,label:(0,b.tZ)("span",{className:m()(`filter-scope-type ${r.toLowerCase()}`,{"selected-filter":t===i})},r===h.dW&&(0,b.tZ)(mn,null),n),children:a}}return{...e,label:(0,b.tZ)("span",{className:m()(`filter-scope-type ${r.toLowerCase()}`,{"selected-filter":t===i})},n)}}function vn({nodes:e,selectedChartId:t}){return e?e.map((e=>gn({currentNode:e,selectedChartId:t}))):[]}var bn=n(13842);const yn={check:(0,b.tZ)(bn.lU,null),uncheck:(0,b.tZ)(bn.zq,null),halfCheck:(0,b.tZ)(bn.dc,null),expandClose:(0,b.tZ)("span",{className:"rct-icon rct-icon-expand-close"}),expandOpen:(0,b.tZ)("span",{className:"rct-icon rct-icon-expand-open"}),expandAll:(0,b.tZ)("span",{className:"rct-icon rct-icon-expand-all"},(0,l.t)("Expand all")),collapseAll:(0,b.tZ)("span",{className:"rct-icon rct-icon-collapse-all"},(0,l.t)("Collapse all")),parentClose:(0,b.tZ)("span",{className:"rct-icon rct-icon-parent-close"}),parentOpen:(0,b.tZ)("span",{className:"rct-icon rct-icon-parent-open"}),leaf:(0,b.tZ)("span",{className:"rct-icon rct-icon-leaf"})},Cn={nodes:s().arrayOf(G.ck).isRequired,checked:s().arrayOf(s().oneOfType([s().number,s().string])).isRequired,expanded:s().arrayOf(s().oneOfType([s().number,s().string])).isRequired,onCheck:s().func.isRequired,onExpand:s().func.isRequired,selectedChartId:s().number},Sn=()=>{};function xn({nodes:e=[],checked:t=[],expanded:n=[],onCheck:i,onExpand:r,selectedChartId:o}){return(0,b.tZ)(fn(),{showExpandAll:!0,expandOnClick:!0,showNodeIcon:!1,nodes:vn({nodes:e,selectedChartId:o}),checked:t,expanded:n,onCheck:i,onExpand:r,onClick:Sn,icons:yn})}xn.propTypes=Cn,xn.defaultProps={selectedChartId:null};const wn={label:s().string.isRequired,isSelected:s().bool.isRequired};function kn({label:e,isSelected:t}){return(0,b.tZ)("span",{className:m()("filter-field-item filter-container",{"is-selected":t})},(0,b.tZ)(Dt.lX,{htmlFor:e},e))}function Zn({nodes:e,activeKey:t}){if(!e)return[];const n=e[0],i=n.children.map((e=>({...e,children:e.children.map((e=>{const{label:n,value:i}=e;return{...e,label:(0,b.tZ)(kn,{isSelected:i===t,label:n})}}))})));return[{...n,label:(0,b.tZ)("span",{className:"root"},n.label),children:i}]}kn.propTypes=wn;const Rn={activeKey:s().string,nodes:s().arrayOf(G.ck).isRequired,checked:s().arrayOf(s().oneOfType([s().number,s().string])).isRequired,expanded:s().arrayOf(s().oneOfType([s().number,s().string])).isRequired,onCheck:s().func.isRequired,onExpand:s().func.isRequired,onClick:s().func.isRequired};function Tn({activeKey:e,nodes:t=[],checked:n=[],expanded:i=[],onClick:r,onCheck:o,onExpand:a}){return(0,b.tZ)(fn(),{showExpandAll:!0,showNodeIcon:!1,expandOnClick:!0,nodes:Zn({nodes:t,activeKey:e}),checked:n,expanded:i,onClick:r,onCheck:o,onExpand:a,icons:yn})}Tn.propTypes=Rn,Tn.defaultProps={activeKey:null};const Fn={dashboardFilters:s().objectOf(G.Er).isRequired,layout:s().object.isRequired,updateDashboardFiltersScope:s().func.isRequired,setUnsavedChanges:s().func.isRequired,onCloseModal:s().func.isRequired},Dn=v.iK.div`
  ${({theme:e})=>`\n    height: ${16*e.gridUnit}px;\n\n    border-top: ${e.gridUnit/4}px solid ${e.colors.primary.light3};\n    padding: ${6*e.gridUnit}px;\n    margin: 0 0 0 ${6*-e.gridUnit}px;\n    text-align: right;\n\n    .btn {\n      margin-right: ${4*e.gridUnit}px;\n\n      &:last-child {\n        margin-right: 0;\n      }\n    }\n  `}
`;class _n extends o.PureComponent{constructor(e){super(e);const{dashboardFilters:t,layout:n}=e;if(Object.keys(t).length>0){const e=function({dashboardFilters:e={}}){const t=Object.values(e).map((e=>{const{chartId:t,filterName:n,columns:i,labels:r}=e,o=Object.keys(i).map((e=>({value:(0,Jt.w)({chartId:t,column:e}),label:r[e]||e})));return{value:t,label:n,children:o,showCheckbox:!0}}));return[{value:H.dU,type:h.U0,label:(0,l.t)("All filters"),children:t}]}({dashboardFilters:t}),i=e[0].children;this.allfilterFields=[],i.forEach((({children:e})=>{e.forEach((e=>{this.allfilterFields.push(e.value)}))})),this.defaultFilterKey=i[0].children[0].value;const r=Object.values(t).reduce(((e,{chartId:i,columns:r})=>({...e,...Object.keys(r).reduce(((e,r)=>{const o=(0,Jt.w)({chartId:i,column:r}),a=Ht({components:n,filterFields:[o],selectedChartId:i}),s=Gt(a,1),l=((0,hn.up)({filterScope:t[i].scopes[r]})||[]).filter((e=>e!==i));return{...e,[o]:{nodes:a,nodesFiltered:[...a],checked:l,expanded:s}}}),{})})),{}),{chartId:o}=(0,Jt._)(this.defaultFilterKey),a=[],s=this.defaultFilterKey,d=[H.dU].concat(o),c=Xt({checkedFilterFields:a,activeFilterField:s,filterScopeMap:r,layout:n});this.state={showSelector:!0,activeFilterField:s,searchText:"",filterScopeMap:{...r,...c},filterFieldNodes:e,checkedFilterFields:a,expandedFilterIds:d}}else this.state={showSelector:!1};this.filterNodes=this.filterNodes.bind(this),this.onChangeFilterField=this.onChangeFilterField.bind(this),this.onCheckFilterScope=this.onCheckFilterScope.bind(this),this.onExpandFilterScope=this.onExpandFilterScope.bind(this),this.onSearchInputChange=this.onSearchInputChange.bind(this),this.onCheckFilterField=this.onCheckFilterField.bind(this),this.onExpandFilterField=this.onExpandFilterField.bind(this),this.onClose=this.onClose.bind(this),this.onSave=this.onSave.bind(this)}onCheckFilterScope(e=[]){const{activeFilterField:t,filterScopeMap:n,checkedFilterFields:i}=this.state,r=Yt({activeFilterField:t,checkedFilterFields:i}),o=t?[t]:i,a={...n[r],checked:e},s=function({checked:e=[],filterFields:t=[],filterScopeMap:n={}}){const i=e.reduce(((e,t)=>{const[n,i]=t.split(":");return{...e,[i]:(e[i]||[]).concat(parseInt(n,10))}}),{});return t.reduce(((e,t)=>{const{chartId:r}=(0,Jt._)(t),o=(i[t]||[]).filter((e=>e!==r));return{...e,[t]:{...n[t],checked:o}}}),{})}({checked:e,filterFields:o,filterScopeMap:n});this.setState((()=>({filterScopeMap:{...n,...s,[r]:a}})))}onExpandFilterScope(e=[]){const{activeFilterField:t,checkedFilterFields:n,filterScopeMap:i}=this.state,r=Yt({activeFilterField:t,checkedFilterFields:n}),o={...i[r],expanded:e};this.setState((()=>({filterScopeMap:{...i,[r]:o}})))}onCheckFilterField(e=[]){const{layout:t}=this.props,{filterScopeMap:n}=this.state,i=Xt({checkedFilterFields:e,activeFilterField:null,filterScopeMap:n,layout:t});this.setState((()=>({activeFilterField:null,checkedFilterFields:e,filterScopeMap:{...n,...i}})))}onExpandFilterField(e=[]){this.setState((()=>({expandedFilterIds:e})))}onChangeFilterField(e={}){const{layout:t}=this.props,n=e.value,{activeFilterField:i,checkedFilterFields:r,filterScopeMap:o}=this.state;if(n===i){const e=Xt({checkedFilterFields:r,activeFilterField:null,filterScopeMap:o,layout:t});this.setState({activeFilterField:null,filterScopeMap:{...o,...e}})}else if(this.allfilterFields.includes(n)){const e=Xt({checkedFilterFields:r,activeFilterField:n,filterScopeMap:o,layout:t});this.setState({activeFilterField:n,filterScopeMap:{...o,...e}})}}onSearchInputChange(e){this.setState({searchText:e.target.value},this.filterTree)}onClose(){this.props.onCloseModal()}onSave(){const{filterScopeMap:e}=this.state,t=this.allfilterFields.reduce(((t,n)=>{const{nodes:i}=e[n];return{...t,[n]:un({filterKey:n,nodes:i,checkedChartIds:e[n].checked})}}),{});this.props.updateDashboardFiltersScope(t),this.props.setUnsavedChanges(!0),this.props.onCloseModal()}filterTree(){if(this.state.searchText){const e=e=>{const{activeFilterField:t,checkedFilterFields:n,filterScopeMap:i}=e,r=Yt({activeFilterField:t,checkedFilterFields:n}),o=i[r].nodes.reduce(this.filterNodes,[]),a=Gt([...o]),s={...i[r],nodesFiltered:o,expanded:a};return{filterScopeMap:{...i,[r]:s}}};this.setState(e)}else this.setState((e=>{const{activeFilterField:t,checkedFilterFields:n,filterScopeMap:i}=e,r=Yt({activeFilterField:t,checkedFilterFields:n}),o={...i[r],nodesFiltered:i[r].nodes};return{filterScopeMap:{...i,[r]:o}}}))}filterNodes(e=[],t={}){const{searchText:n}=this.state,i=(t.children||[]).reduce(this.filterNodes,[]);return(t.label.toLocaleLowerCase().indexOf(n.toLocaleLowerCase())>-1||i.length)&&e.push({...t,children:i}),e}renderFilterFieldList(){const{activeFilterField:e,filterFieldNodes:t,checkedFilterFields:n,expandedFilterIds:i}=this.state;return(0,b.tZ)(Tn,{activeKey:e,nodes:t,checked:n,expanded:i,onClick:this.onChangeFilterField,onCheck:this.onCheckFilterField,onExpand:this.onExpandFilterField})}renderFilterScopeTree(){const{filterScopeMap:e,activeFilterField:t,checkedFilterFields:n,searchText:i}=this.state,r=Yt({activeFilterField:t,checkedFilterFields:n}),a=Qt({activeFilterField:t,checkedFilterFields:n});return(0,b.tZ)(o.Fragment,null,(0,b.tZ)("input",{className:"filter-text scope-search multi-edit-mode",placeholder:(0,l.t)("Search..."),type:"text",value:i,onChange:this.onSearchInputChange}),(0,b.tZ)(xn,{nodes:e[r].nodesFiltered,checked:e[r].checked,expanded:e[r].expanded,onCheck:this.onCheckFilterScope,onExpand:this.onExpandFilterScope,selectedChartId:a}))}renderEditingFiltersName(){const{dashboardFilters:e}=this.props,{activeFilterField:t,checkedFilterFields:n}=this.state,i=[].concat(t||n).map((t=>{const{chartId:n,column:i}=(0,Jt._)(t);return e[n].labels[i]||i}));return(0,b.tZ)("div",{className:"selected-fields multi-edit-mode"},0===i.length&&(0,l.t)("No filter is selected."),1===i.length&&(0,l.t)("Editing 1 filter:"),i.length>1&&(0,l.t)("Batch editing %d filters:",i.length),(0,b.tZ)("span",{className:"selected-scopes"},i.join(", ")))}render(){const{showSelector:e}=this.state;return(0,b.tZ)("div",{className:"filter-scope-container"},(0,b.tZ)("div",{className:"filter-scope-header"},(0,b.tZ)("h4",null,(0,l.t)("Configure filter scopes")),e&&this.renderEditingFiltersName()),(0,b.tZ)("div",{className:"filter-scope-body"},e?(0,b.tZ)("div",{className:"filters-scope-selector"},(0,b.tZ)("div",{className:m()("filter-field-pane multi-edit-mode")},this.renderFilterFieldList()),(0,b.tZ)("div",{className:"filter-scope-pane multi-edit-mode"},this.renderFilterScopeTree())):(0,b.tZ)("div",{className:"warning-message"},(0,l.t)("There are no filters in this dashboard."))),(0,b.tZ)(Dn,null,(0,b.tZ)(B.Z,{buttonSize:"small",onClick:this.onClose},(0,l.t)("Close")),e&&(0,b.tZ)(B.Z,{buttonSize:"small",buttonStyle:"primary",onClick:this.onSave},(0,l.t)("Save"))))}}_n.propTypes=Fn;const En=(0,r.$j)((function({dashboardLayout:e,dashboardFilters:t}){return{dashboardFilters:t,layout:e.present}}),(function(e){return(0,i.DE)({updateDashboardFiltersScope:Ut.l6,setUnsavedChanges:Lt.if},e)}))(_n),In=v.iK.div((({theme:{gridUnit:e}})=>({padding:2*e,paddingBottom:3*e})));class Mn extends o.PureComponent{constructor(e){super(e),this.modal=void 0,this.modal=o.createRef(),this.handleCloseModal=this.handleCloseModal.bind(this)}handleCloseModal(){var e,t;null==this||null==(e=this.modal)||null==(t=e.current)||null==t.close||t.close()}render(){const e={onCloseModal:this.handleCloseModal};return(0,b.tZ)(St.Z,{ref:this.modal,triggerNode:this.props.triggerNode,modalBody:(0,b.tZ)(In,null,(0,b.tZ)(En,e)),width:"80%"})}}var On=n(56727),Pn=n(11370);function Nn({pathname:e,filters:t={},hash:n="",standalone:i}){const r=new URLSearchParams;r.set(gt.KD.preselectFilters.name,JSON.stringify((0,Pn.Z)(t))),i&&r.set(gt.KD.standalone.name,i.toString());const o=(0,yt.eY)(gt.KD.nativeFiltersKey);o&&r.set(gt.KD.nativeFiltersKey.name,o);const a=n?`#${n}`:"";return`${e}?${r.toString()}${a}`}const jn={addSuccessToast:s().func.isRequired,addDangerToast:s().func.isRequired,dashboardInfo:s().object.isRequired,dashboardId:s().number.isRequired,dashboardTitle:s().string.isRequired,dataMask:s().object.isRequired,customCss:s().string.isRequired,colorNamespace:s().string,colorScheme:s().string,onChange:s().func.isRequired,updateCss:s().func.isRequired,forceRefreshAllCharts:s().func.isRequired,refreshFrequency:s().number.isRequired,shouldPersistRefreshFrequency:s().bool.isRequired,setRefreshFrequency:s().func.isRequired,startPeriodicRender:s().func.isRequired,editMode:s().bool.isRequired,userCanEdit:s().bool.isRequired,userCanShare:s().bool.isRequired,userCanSave:s().bool.isRequired,userCanCurate:s().bool.isRequired,isLoading:s().bool.isRequired,layout:s().object.isRequired,expandedSlices:s().object.isRequired,onSave:s().func.isRequired,showPropertiesModal:s().func.isRequired,manageEmbedded:s().func.isRequired,refreshLimit:s().number,refreshWarning:s().string,lastModifiedTime:s().number.isRequired,filterboxMigrationState:Y.Qi},qn={colorNamespace:void 0,colorScheme:void 0,refreshLimit:0,refreshWarning:null,filterboxMigrationState:Y.Qi.NOOP},zn="refresh-dashboard",An="edit-properties",$n="download-as-image",Un="toggle-fullscreen",Ln="manage-embedded";class Vn extends o.PureComponent{static discardChanges(){window.location.reload()}constructor(e){super(e),this.state={css:e.customCss,cssTemplates:[],showReportSubMenu:null},this.changeCss=this.changeCss.bind(this),this.changeRefreshInterval=this.changeRefreshInterval.bind(this),this.handleMenuClick=this.handleMenuClick.bind(this),this.setShowReportSubMenu=this.setShowReportSubMenu.bind(this)}UNSAFE_componentWillMount(){ft.Z.get({endpoint:"/csstemplateasyncmodelview/api/read"}).then((({json:e})=>{const t=e.result.map((e=>({value:e.template_name,css:e.css,label:e.template_name})));this.setState({cssTemplates:t})})).catch((()=>{this.props.addDangerToast((0,l.t)("An error occurred while fetching available CSS templates"))}))}UNSAFE_componentWillReceiveProps(e){this.props.customCss!==e.customCss&&this.setState({css:e.customCss},(()=>{(0,$t.Z)(e.customCss)}))}setShowReportSubMenu(e){this.setState({showReportSubMenu:e})}changeCss(e){this.props.onChange(),this.props.updateCss(e)}changeRefreshInterval(e,t){this.props.setRefreshFrequency(e,t),this.props.startPeriodicRender(1e3*e)}handleMenuClick({key:e,domEvent:t}){switch(e){case zn:this.props.forceRefreshAllCharts(),this.props.addSuccessToast((0,l.t)("Refreshing charts"));break;case An:this.props.showPropertiesModal();break;case $n:{const e=document.querySelector(".ant-dropdown:not(.ant-dropdown-hidden)");e.style.visibility="hidden",(0,On.Z)(".dashboard",this.props.dashboardTitle,!0)(t).then((()=>{e.style.visibility="visible"}));break}case Un:{const e=Nn({pathname:window.location.pathname,filters:(0,hn.De)(),hash:window.location.hash,standalone:!(0,yt.eY)(gt.KD.standalone)});window.location.replace(e);break}case Ln:this.props.manageEmbedded()}}render(){const{dashboardTitle:e,dashboardId:t,dashboardInfo:n,refreshFrequency:i,shouldPersistRefreshFrequency:r,editMode:a,customCss:s,colorNamespace:d,colorScheme:c,layout:u,expandedSlices:h,onSave:p,userCanEdit:f,userCanShare:m,userCanSave:g,userCanCurate:v,isLoading:y,refreshLimit:C,refreshWarning:S,lastModifiedTime:x,addSuccessToast:w,addDangerToast:k,filterboxMigrationState:Z,setIsDropdownVisible:R,isDropdownVisible:T,...F}=this.props,D=`${(0,l.t)("Superset dashboard")} ${e}`,_=(0,l.t)("Check out this dashboard: "),E=Nn({pathname:window.location.pathname,filters:(0,hn.De)(),hash:window.location.hash});return(0,b.tZ)(mt.v,pt()({selectable:!1},F),!a&&(0,b.tZ)(mt.v.Item,{key:zn,disabled:y,onClick:this.handleMenuClick},(0,l.t)("Refresh dashboard")),!a&&(0,b.tZ)(mt.v.Item,{key:Un,onClick:this.handleMenuClick},(0,yt.eY)(gt.KD.standalone)?(0,l.t)("Exit fullscreen"):(0,l.t)("Enter fullscreen")),a&&(0,b.tZ)(mt.v.Item,{key:An,onClick:this.handleMenuClick},(0,l.t)("Edit properties")),a&&(0,b.tZ)(mt.v.Item,{key:"edit-css"},(0,b.tZ)(Rt,{triggerNode:(0,b.tZ)("span",null,(0,l.t)("Edit CSS")),initialCss:this.state.css,templates:this.state.cssTemplates,onChange:this.changeCss})),(0,b.tZ)(mt.v.Divider,null),g&&(0,b.tZ)(mt.v.Item,{key:"save-modal"},(0,b.tZ)(zt,{addSuccessToast:this.props.addSuccessToast,addDangerToast:this.props.addDangerToast,dashboardId:t,dashboardTitle:e,dashboardInfo:n,saveType:H.kS,layout:u,expandedSlices:h,refreshFrequency:i,shouldPersistRefreshFrequency:r,lastModifiedTime:x,customCss:s,colorNamespace:d,colorScheme:c,onSave:p,triggerNode:(0,b.tZ)("span",null,(0,l.t)("Save as")),canOverwrite:f})),!a&&(0,b.tZ)(mt.v.Item,{key:$n,onClick:this.handleMenuClick},(0,l.t)("Download as image")),m&&(0,b.tZ)(mt.v.SubMenu,{key:"share-dashboard",disabled:y,title:(0,l.t)("Share")},(0,b.tZ)(Ct,{url:E,copyMenuItemTitle:(0,l.t)("Copy permalink to clipboard"),emailMenuItemTitle:(0,l.t)("Share permalink by email"),emailSubject:D,emailBody:_,addSuccessToast:w,addDangerToast:k,dashboardId:t})),!a&&v&&(0,b.tZ)(mt.v.Item,{key:Ln,onClick:this.handleMenuClick},(0,l.t)("Embed dashboard")),(0,b.tZ)(mt.v.Divider,null),a?null:this.state.showReportSubMenu?(0,b.tZ)(o.Fragment,null,(0,b.tZ)(mt.v.SubMenu,{title:(0,l.t)("Manage email report")},(0,b.tZ)(At.Z,{dashboardId:n.id,setShowReportSubMenu:this.setShowReportSubMenu,showReportSubMenu:this.state.showReportSubMenu,setIsDropdownVisible:R,isDropdownVisible:T,useTextMenu:!0})),(0,b.tZ)(mt.v.Divider,null)):(0,b.tZ)(mt.v,null,(0,b.tZ)(At.Z,{dashboardId:n.id,setShowReportSubMenu:this.setShowReportSubMenu,setIsDropdownVisible:R,isDropdownVisible:T,useTextMenu:!0})),a&&Z!==Y.Qi.CONVERTED&&(0,b.tZ)(mt.v.Item,{key:"set-filter-mapping"},(0,b.tZ)(Mn,{className:"m-r-5",triggerNode:(0,l.t)("Set filter mapping")})),(0,b.tZ)(mt.v.Item,{key:"autorefresh-modal"},(0,b.tZ)(Ot,{addSuccessToast:this.props.addSuccessToast,refreshFrequency:i,refreshLimit:C,refreshWarning:S,onChange:this.changeRefreshInterval,editMode:a,triggerNode:(0,b.tZ)("span",null,(0,l.t)("Set auto-refresh interval"))})))}}Vn.propTypes=jn,Vn.defaultProps=qn;const Kn=Vn;var Bn=n(37921);const Wn={dashboardId:s().number.isRequired,isPublished:s().bool.isRequired,savePublished:s().func.isRequired,canEdit:s().bool.isRequired,canSave:s().bool.isRequired},Hn=(0,l.t)("This dashboard is not published, it will not show up in the list of dashboards. Click here to publish this dashboard."),Gn=(0,l.t)("This dashboard is not published which means it will not show up in the list of dashboards. Favorite it to see it there or access it by using the URL directly."),Yn=(0,l.t)("This dashboard is published. Click to make it a draft.");class Jn extends o.Component{componentDidMount(){this.togglePublished=this.togglePublished.bind(this)}togglePublished(){this.props.savePublished(this.props.dashboardId,!this.props.isPublished)}render(){return this.props.isPublished?this.props.canEdit&&this.props.canSave?(0,b.tZ)(ct.u,{id:"published-dashboard-tooltip",placement:"bottom",title:Yn},(0,b.tZ)(Bn.Z,{onClick:()=>{this.togglePublished()}},(0,l.t)("Published"))):null:this.props.canEdit&&this.props.canSave?(0,b.tZ)(ct.u,{id:"unpublished-dashboard-tooltip",placement:"bottom",title:Hn},(0,b.tZ)(Bn.Z,{onClick:()=>{this.togglePublished()}},(0,l.t)("Draft"))):(0,b.tZ)(ct.u,{id:"unpublished-dashboard-tooltip",placement:"bottom",title:Gn},(0,b.tZ)(Bn.Z,null,(0,l.t)("Draft")))}}Jn.propTypes=Wn;const Qn={onUndo:s().func.isRequired,onRedo:s().func.isRequired};class Xn extends o.PureComponent{constructor(e){super(e),this.handleKeydown=this.handleKeydown.bind(this)}componentDidMount(){document.addEventListener("keydown",this.handleKeydown)}componentWillUnmount(){document.removeEventListener("keydown",this.handleKeydown)}handleKeydown(e){if(e.ctrlKey||e.metaKey){const t="z"===e.key||90===e.keyCode,n="y"===e.key||89===e.keyCode,i=document&&document.querySelector(".dashboard-markdown--editing"),r=document&&document.querySelector(".editable-title--editing");i||r||!t&&!n||(e.preventDefault(),(t?this.props.onUndo:this.props.onRedo)())}}render(){return null}}Xn.propTypes=Qn;const ei=Xn;var ti=n(20818),ni=n(5558);const ii=e=>{e&&clearInterval(e)};var ri=n(52564),oi=n(75049),ai=n(22102),si=n(9882),li=n(74069),di=n(14114);const ci=(0,oi.I)(),ui=e=>e.split(/(?:\s|,)+/).filter((e=>e)),hi=v.iK.div`
  display: flex;
  flex-direction: row;
  justify-content: flex-end;
`,pi=({dashboardId:e,onHide:t})=>{var n;const{addInfoToast:i,addDangerToast:r}=(0,di.e1)(),[a,s]=(0,o.useState)(!0),[d,c]=(0,o.useState)(!1),[h,p]=(0,o.useState)(null),[f,m]=(0,o.useState)(""),g=`/api/v1/dashboard/${e}/embedded`,v=!h||ui(f).join()!==h.allowed_domains.join(),y=(0,o.useCallback)((()=>{c(!0),(0,ai.Z)({method:"POST",endpoint:g})({allowed_domains:ui(f)}).then((({result:e})=>{p(e),m(e.allowed_domains.join(", ")),i((0,l.t)("Changes saved."))}),(e=>{console.error(e),r((0,l.t)((0,l.t)("Sorry, something went wrong. The changes could not be saved.")))})).finally((()=>{c(!1)}))}),[g,f]),C=(0,o.useCallback)((()=>{li.Z.confirm({title:(0,l.t)("Disable embedding?"),content:(0,l.t)("This will remove your current embed configuration."),okType:"danger",onOk:()=>{c(!0),(0,ai.Z)({method:"DELETE",endpoint:g})({}).then((()=>{p(null),m(""),i((0,l.t)("Embedding deactivated.")),t()}),(e=>{console.error(e),r((0,l.t)("Sorry, something went wrong. Embedding could not be deactivated."))})).finally((()=>{c(!1)}))}})}),[g]);if((0,o.useEffect)((()=>{s(!1),(0,ai.Z)({method:"GET",endpoint:g})({}).catch((e=>{if(404===e.status)return{result:null};throw e})).then((({result:e})=>{s(!0),p(e),m(e?e.allowed_domains.join(", "):"")}))}),[e]),!a)return(0,b.tZ)(u.Z,null);const S=ci.get("embedded.documentation.description"),x=null!=(n=ci.get("embedded.documentation.url"))?n:"https://www.npmjs.com/package/@superset-ui/embedded-sdk";return(0,b.tZ)(o.Fragment,null,(0,b.tZ)("p",null,h?(0,b.tZ)(o.Fragment,null,(0,l.t)("This dashboard is ready to embed. In your application, pass the following id to the SDK:"),(0,b.tZ)("br",null),(0,b.tZ)("code",null,h.uuid)):(0,l.t)("Configure this dashboard to embed it into an external web application.")),(0,b.tZ)("p",null,(0,l.t)("For further instructions, consult the")," ",(0,b.tZ)("a",{href:x,target:"_blank",rel:"noreferrer"},S?S():(0,l.t)("Superset Embedded SDK documentation."))),(0,b.tZ)("h3",null,"Settings"),(0,b.tZ)(Dt.xJ,null,(0,b.tZ)("label",{htmlFor:"allowed-domains"},(0,l.t)("Allowed Domains (comma separated)")," ",(0,b.tZ)(si.V,{tooltip:(0,l.t)("A list of domain names that can embed this dashboard. Leaving this field empty will allow embedding from any domain.")})),(0,b.tZ)(V.II,{name:"allowed-domains",value:f,placeholder:"superset.example.com",onChange:e=>m(e.target.value)})),(0,b.tZ)(hi,null,h?(0,b.tZ)(o.Fragment,null,(0,b.tZ)(B.Z,{onClick:C,buttonStyle:"secondary",loading:d},(0,l.t)("Deactivate")),(0,b.tZ)(B.Z,{onClick:y,buttonStyle:"primary",disabled:!v,loading:d},(0,l.t)("Save changes"))):(0,b.tZ)(B.Z,{onClick:y,buttonStyle:"primary",loading:d},(0,l.t)("Enable embedding"))))},fi=e=>{const{show:t,onHide:n}=e;return(0,b.tZ)(li.Z,{show:t,onHide:n,title:(0,l.t)("Embed"),hideFooter:!0},(0,b.tZ)(pi,e))},mi={addSuccessToast:s().func.isRequired,addDangerToast:s().func.isRequired,addWarningToast:s().func.isRequired,user:ni.UserWithPermissionsAndRoles,dashboardInfo:s().object.isRequired,dashboardTitle:s().string.isRequired,dataMask:s().object.isRequired,charts:s().objectOf(G.$6).isRequired,layout:s().object.isRequired,expandedSlices:s().object.isRequired,customCss:s().string.isRequired,colorNamespace:s().string,colorScheme:s().string,setColorSchemeAndUnsavedChanges:s().func.isRequired,isStarred:s().bool.isRequired,isPublished:s().bool.isRequired,isLoading:s().bool.isRequired,onSave:s().func.isRequired,onChange:s().func.isRequired,fetchFaveStar:s().func.isRequired,fetchCharts:s().func.isRequired,saveFaveStar:s().func.isRequired,savePublished:s().func.isRequired,updateDashboardTitle:s().func.isRequired,editMode:s().bool.isRequired,setEditMode:s().func.isRequired,showBuilderPane:s().func.isRequired,updateCss:s().func.isRequired,logEvent:s().func.isRequired,hasUnsavedChanges:s().bool.isRequired,maxUndoHistoryExceeded:s().bool.isRequired,lastModifiedTime:s().number.isRequired,onRefresh:s().func.isRequired,onUndo:s().func.isRequired,onRedo:s().func.isRequired,undoLength:s().number.isRequired,redoLength:s().number.isRequired,setMaxUndoHistoryExceeded:s().func.isRequired,maxUndoHistoryToast:s().func.isRequired,refreshFrequency:s().number.isRequired,shouldPersistRefreshFrequency:s().bool.isRequired,setRefreshFrequency:s().func.isRequired,dashboardInfoChanged:s().func.isRequired,dashboardTitleChanged:s().func.isRequired},gi=e=>b.iv`
  border-bottom: 1px solid ${e.colors.grayscale.light2};
`,vi=e=>b.iv`
  color: ${e.colors.primary.dark2};
`,bi=e=>b.iv`
  display: flex;
  align-items: center;

  .action-schedule-report {
    margin-left: ${2*e.gridUnit}px;
  }

  .undoRedo {
    margin-right: ${2*e.gridUnit}px;
  }
`,yi=(0,v.iK)(K.C0)`
  padding: 0;
  &:hover {
    background: transparent;
  }
`,Ci=e=>b.iv`
  color: ${e.colors.grayscale.light1};
  &:hover {
    color: ${e.colors.grayscale.base};
  }
`,Si=e=>b.iv`
  color: ${e.colors.grayscale.base};
`,xi=e=>b.iv`
  color: ${e.colors.grayscale.light2};
`,wi=e=>b.iv`
  min-width: ${17*e.gridUnit}px;
  height: ${8*e.gridUnit}px;
`,ki=e=>b.iv`
  min-width: ${22*e.gridUnit}px;
  height: ${8*e.gridUnit}px;
`;class Zi extends o.PureComponent{static discardChanges(){const e=new URL(window.location.href);e.searchParams.delete("edit"),window.location.assign(e)}constructor(e){super(e),this.showEmbedModal=()=>{this.setState({showingEmbedModal:!0})},this.hideEmbedModal=()=>{this.setState({showingEmbedModal:!1})},this.state={didNotifyMaxUndoHistoryToast:!1,emphasizeUndo:!1,emphasizeRedo:!1,showingPropertiesModal:!1,isDropdownVisible:!1},this.handleChangeText=this.handleChangeText.bind(this),this.handleCtrlZ=this.handleCtrlZ.bind(this),this.handleCtrlY=this.handleCtrlY.bind(this),this.toggleEditMode=this.toggleEditMode.bind(this),this.forceRefresh=this.forceRefresh.bind(this),this.startPeriodicRender=this.startPeriodicRender.bind(this),this.overwriteDashboard=this.overwriteDashboard.bind(this),this.showPropertiesModal=this.showPropertiesModal.bind(this),this.hidePropertiesModal=this.hidePropertiesModal.bind(this),this.setIsDropdownVisible=this.setIsDropdownVisible.bind(this)}componentDidMount(){const{refreshFrequency:e}=this.props;this.startPeriodicRender(1e3*e)}componentDidUpdate(e){if(this.props.refreshFrequency!==e.refreshFrequency){const{refreshFrequency:e}=this.props;this.startPeriodicRender(1e3*e)}}UNSAFE_componentWillReceiveProps(e){H.Q9-e.undoLength<=0&&!this.state.didNotifyMaxUndoHistoryToast&&(this.setState((()=>({didNotifyMaxUndoHistoryToast:!0}))),this.props.maxUndoHistoryToast()),e.undoLength>H.Q9&&!this.props.maxUndoHistoryExceeded&&this.props.setMaxUndoHistoryExceeded()}componentWillUnmount(){ii(this.refreshTimer),this.props.setRefreshFrequency(0),clearTimeout(this.ctrlYTimeout),clearTimeout(this.ctrlZTimeout)}handleChangeText(e){const{updateDashboardTitle:t,onChange:n}=this.props;e&&this.props.dashboardTitle!==e&&(t(e),n())}setIsDropdownVisible(e){this.setState({isDropdownVisible:e})}handleCtrlY(){this.props.onRedo(),this.setState({emphasizeRedo:!0},(()=>{this.ctrlYTimeout&&clearTimeout(this.ctrlYTimeout),this.ctrlYTimeout=setTimeout((()=>{this.setState({emphasizeRedo:!1})}),100)}))}handleCtrlZ(){this.props.onUndo(),this.setState({emphasizeUndo:!0},(()=>{this.ctrlZTimeout&&clearTimeout(this.ctrlZTimeout),this.ctrlZTimeout=setTimeout((()=>{this.setState({emphasizeUndo:!1})}),100)}))}forceRefresh(){if(!this.props.isLoading){const e=Object.keys(this.props.charts);return this.props.logEvent(lt.H3,{force:!0,interval:0,chartCount:e.length}),this.props.onRefresh(e,!0,0,this.props.dashboardInfo.id)}return!1}startPeriodicRender(e){let t;if(e){const n=_t.find((t=>t.value===e/1e3));t=n?n.label:ot().duration(e,"millisecond").humanize()}this.refreshTimer=function({interval:e=0,periodicRender:t,refreshTimer:n}){return ii(n),e>0?setInterval(t,e):0}({interval:e,periodicRender:()=>{const{fetchCharts:n,logEvent:i,charts:r,dashboardInfo:o}=this.props,{metadata:a}=o,s=a.timed_refresh_immune_slices||[],d=Object.values(r).filter((e=>-1===s.indexOf(e.id))).map((e=>e.id));return i(lt.S,{interval:e,chartCount:d.length}),this.props.addWarningToast((0,l.t)("This dashboard is currently auto refreshing; the next auto refresh will be in %s.",t)),"fetch"===o.common.conf.DASHBOARD_AUTO_REFRESH_MODE?n(d,!1,.2*e,o.id):n(d,!0,.2*e,o.id)},refreshTimer:this.refreshTimer})}toggleEditMode(){this.props.logEvent(lt.vH,{edit_mode:!this.props.editMode}),this.props.setEditMode(!this.props.editMode)}overwriteDashboard(){var e,t,n;const{dashboardTitle:i,layout:r,colorScheme:o,colorNamespace:a,customCss:s,dashboardInfo:d,refreshFrequency:c,shouldPersistRefreshFrequency:u,lastModifiedTime:h,slug:p}=this.props,f=u?c:null==(e=d.metadata)?void 0:e.refresh_frequency,m=(null==d||null==(t=d.metadata)?void 0:t.color_scheme)||o,g=(null==d||null==(n=d.metadata)?void 0:n.color_namespace)||a,v=(0,at.Z)().getColorMap(g,m),b={certified_by:d.certified_by,certification_details:d.certification_details,css:s,dashboard_title:i,last_modified_time:h,owners:d.owners,roles:d.roles,slug:p,metadata:{...null==d?void 0:d.metadata,color_namespace:g,color_scheme:m,positions:r,refresh_frequency:f,shared_label_colors:v}},y=(0,ut.o)(r).length,C=d.common.conf.SUPERSET_DASHBOARD_POSITION_DATA_LIMIT||H.Bu;y>=C?this.props.addDangerToast((0,l.t)("Your dashboard is too large. Please reduce its size before saving it.")):(y>=.9*C&&this.props.addWarningToast("Your dashboard is near the size limit."),this.props.onSave(b,d.id,H.TN))}showPropertiesModal(){this.setState({showingPropertiesModal:!0})}hidePropertiesModal(){this.setState({showingPropertiesModal:!1})}render(){var e,t,n,i;const{dashboardTitle:r,layout:o,expandedSlices:a,customCss:s,colorNamespace:c,dataMask:u,setColorSchemeAndUnsavedChanges:h,colorScheme:p,onUndo:f,onRedo:m,undoLength:g,redoLength:v,onChange:y,onSave:C,updateCss:S,editMode:x,isPublished:w,user:k,dashboardInfo:Z,hasUnsavedChanges:R,isLoading:T,refreshFrequency:F,shouldPersistRefreshFrequency:D,setRefreshFrequency:_,lastModifiedTime:E,filterboxMigrationState:I}=this.props,M=Z.dash_edit_perm&&I!==Y.Qi.REVIEWING&&!Z.is_managed_externally,O=Z.dash_share_perm,P=Z.dash_save_perm&&I!==Y.Qi.REVIEWING,N=(0,st.cr)(d.T.EMBEDDED_SUPERSET)&&(0,dt.R)("can_set_embedded","Dashboard",k.roles),j=null==(e=Z.common)||null==(t=e.conf)?void 0:t.SUPERSET_DASHBOARD_PERIODICAL_REFRESH_LIMIT,q=null==(n=Z.common)||null==(i=n.conf)?void 0:i.SUPERSET_DASHBOARD_PERIODICAL_REFRESH_WARNING_MESSAGE;return(0,b.tZ)("div",{css:gi,"data-test-id":Z.id,className:"dashboard-header-container"},(0,b.tZ)(ri.u,{editableTitleProps:{title:r,canEdit:M&&x,onSave:this.handleChangeText,placeholder:(0,l.t)("Add the name of the dashboard"),label:(0,l.t)("Dashboard title"),showTooltip:!1},certificatiedBadgeProps:{certifiedBy:Z.certified_by,details:Z.certification_details},faveStarProps:{itemId:Z.id,fetchFaveStar:this.props.fetchFaveStar,saveFaveStar:this.props.saveFaveStar,isStarred:this.props.isStarred,showTooltip:!0},titlePanelAdditionalItems:(0,b.tZ)(Jn,{dashboardId:Z.id,isPublished:w,savePublished:this.props.savePublished,canEdit:M,canSave:P}),rightPanelAdditionalItems:(0,b.tZ)("div",{className:"button-container"},P&&(0,b.tZ)("div",{className:"button-container"},x&&(0,b.tZ)("div",{css:bi},(0,b.tZ)("div",{className:"undoRedo"},(0,b.tZ)(ct.u,{id:"dashboard-undo-tooltip",title:(0,l.t)("Undo the action")},(0,b.tZ)(yi,{type:"text",disabled:g<1},(0,b.tZ)(W.Z.Undo,{css:[Ci,this.state.emphasizeUndo&&Si,g<1&&xi,"",""],onClick:g&&f,iconSize:"xl"}))),(0,b.tZ)(ct.u,{id:"dashboard-redo-tooltip",title:(0,l.t)("Redo the action")},(0,b.tZ)(yi,{type:"text",disabled:v<1},(0,b.tZ)(W.Z.Redo,{css:[Ci,this.state.emphasizeRedo&&Si,v<1&&xi,"",""],onClick:v&&m,iconSize:"xl"})))),(0,b.tZ)(B.Z,{css:ki,buttonSize:"small",onClick:this.constructor.discardChanges,buttonStyle:"default","aria-label":(0,l.t)("Discard")},(0,l.t)("Discard")),(0,b.tZ)(B.Z,{css:wi,buttonSize:"small",disabled:!R,buttonStyle:"primary",onClick:this.overwriteDashboard,"aria-label":(0,l.t)("Save")},(0,l.t)("Save")))),x?(0,b.tZ)(ei,{onUndo:this.handleCtrlZ,onRedo:this.handleCtrlY}):(0,b.tZ)("div",{css:bi},M&&(0,b.tZ)(B.Z,{buttonStyle:"secondary",onClick:this.toggleEditMode,className:"action-button",css:vi,"aria-label":(0,l.t)("Edit dashboard")},(0,l.t)("Edit dashboard")))),menuDropdownProps:{getPopupContainer:e=>e.closest(".header-with-actions"),visible:this.state.isDropdownVisible,onVisibleChange:this.setIsDropdownVisible},additionalActionsMenu:(0,b.tZ)(Kn,{addSuccessToast:this.props.addSuccessToast,addDangerToast:this.props.addDangerToast,dashboardId:Z.id,dashboardTitle:r,dashboardInfo:Z,dataMask:u,layout:o,expandedSlices:a,customCss:s,colorNamespace:c,colorScheme:p,onSave:C,onChange:y,forceRefreshAllCharts:this.forceRefresh,startPeriodicRender:this.startPeriodicRender,refreshFrequency:F,shouldPersistRefreshFrequency:D,setRefreshFrequency:_,updateCss:S,editMode:x,hasUnsavedChanges:R,userCanEdit:M,userCanShare:O,userCanSave:P,userCanCurate:N,isLoading:T,showPropertiesModal:this.showPropertiesModal,manageEmbedded:this.showEmbedModal,refreshLimit:j,refreshWarning:q,lastModifiedTime:E,filterboxMigrationState:I,isDropdownVisible:this.state.isDropdownVisible,setIsDropdownVisible:this.setIsDropdownVisible}),showFaveStar:(null==k?void 0:k.userId)&&(null==Z?void 0:Z.id),showTitlePanelItems:!x}),this.state.showingPropertiesModal&&(0,b.tZ)(ti.Z,{dashboardId:Z.id,dashboardInfo:Z,dashboardTitle:r,show:this.state.showingPropertiesModal,onHide:this.hidePropertiesModal,colorScheme:this.props.colorScheme,onSubmit:e=>{const{dashboardInfoChanged:t,dashboardTitleChanged:n}=this.props;t({slug:e.slug,metadata:JSON.parse(e.jsonMetadata||"{}"),certified_by:e.certifiedBy,certification_details:e.certificationDetails,owners:e.owners,roles:e.roles}),h(e.colorScheme),n(e.title)},onlyApply:!0}),N&&(0,b.tZ)(fi,{show:this.state.showingEmbedModal,onHide:this.hideEmbedModal,dashboardId:Z.id}),(0,b.tZ)(b.xB,{styles:b.iv`
            .ant-menu-vertical {
              border-right: none;
            }
          `}))}}Zi.propTypes=mi,Zi.defaultProps={colorNamespace:void 0,colorScheme:void 0};const Ri=Zi;function Ti(e){return Object.values(e).some((e=>e.chartUpdateStartTime>(e.chartUpdateEndTime||0)))}var Fi=n(41295),Di=n(40701),_i=n(72570),Ei=n(97381),Ii=n(61358);const Mi=(0,r.$j)((function({dashboardLayout:e,dashboardState:t,reports:n,dashboardInfo:i,charts:r,dataMask:o,user:a}){return{dashboardInfo:i,undoLength:e.past.length,redoLength:e.future.length,layout:e.present,dashboardTitle:((e.present[H.M2]||{}).meta||{}).text,expandedSlices:t.expandedSlices,refreshFrequency:t.refreshFrequency,shouldPersistRefreshFrequency:!!t.shouldPersistRefreshFrequency,customCss:t.css,colorNamespace:t.colorNamespace,colorScheme:t.colorScheme,charts:r,dataMask:o,user:a,isStarred:!!t.isStarred,isPublished:!!t.isPublished,isLoading:Ti(r),hasUnsavedChanges:!!t.hasUnsavedChanges,maxUndoHistoryExceeded:!!t.maxUndoHistoryExceeded,lastModifiedTime:Math.max(t.lastModifiedTime,i.last_modified_time),editMode:!!t.editMode,slug:i.slug,metadata:i.metadata,reports:n,filterboxMigrationState:t.filterboxMigrationState}}),(function(e){return(0,i.DE)({addSuccessToast:_i.ws,addDangerToast:_i.Gb,addWarningToast:_i.Dz,onUndo:Di.Ou,onRedo:Di.az,setEditMode:Lt.Mb,showBuilderPane:Lt.O8,setColorSchemeAndUnsavedChanges:Lt.ps,fetchFaveStar:Lt.Lb,saveFaveStar:Lt.TN,savePublished:Lt.dr,fetchCharts:Lt.Mn,updateDashboardTitle:Di.A7,updateCss:Lt.Sn,onChange:Lt.z2,onSave:Lt.M8,setMaxUndoHistoryExceeded:Lt.uN,maxUndoHistoryToast:Lt.Qt,logEvent:Ei.logEvent,setRefreshFrequency:Lt.fE,onRefresh:Lt.Yy,dashboardInfoChanged:Fi.a8,dashboardTitleChanged:Di.Ww,updateDataMask:it.eG,fetchUISpecificReport:Ii.Aw},e)}))(Ri),Oi=v.iK.div`
  display: flex;
  align-items: center;
  color: ${({theme:e})=>e.colors.grayscale.base};
  &:hover {
    color: ${({theme:e})=>e.colors.primary.base};
  }
`,Pi=v.iK.span`
  margin-left: ${({theme:e})=>2*e.gridUnit}px;
`,Ni=({icon:e,label:t,onClick:n})=>(0,b.tZ)(Oi,{tabIndex:0,role:"button",onClick:e=>{e.preventDefault(),n(e)}},e,t&&(0,b.tZ)(Pi,null,t));var ji=n(52256),qi=n(1510),zi=n(99543);function Ai(e){return Object.entries(e).map((([e,t])=>({col:e,op:Array.isArray(t)?"IN":"==",val:t}))).filter((e=>null!==e.val))}const $i=({child:e,layout:t,scope:n,activeFilters:i,filterId:r,extraFormData:o})=>{var a,s;const l=null==(a=t[e])||null==(s=a.meta)?void 0:s.chartId;if(t[e].type===h.dW){if(n.excluded.includes(l))return;return i[r]||(i[r]={scope:[],values:o}),void i[r].scope.push(l)}t[e].children.forEach((e=>$i({child:e,layout:t,scope:n,activeFilters:i,filterId:r,extraFormData:o})))},Ui=(e,t)=>Object.values(e).filter((e=>e[t])).reduce(((e,n)=>({...e,[n.id]:t?n[t]:n})),{}),Li=({chartConfiguration:e,nativeFilters:t,dataMask:n,layout:i})=>{const r={};return Object.values(n).forEach((({id:n,extraFormData:o})=>{var a,s,l,d,c;const u=null!=(a=null!=(s=null==t||null==(l=t[n])?void 0:l.scope)?s:null==e||null==(d=e[n])||null==(c=d.crossFilters)?void 0:c.scope)?a:{rootPath:[H._4],excluded:[n]};u.rootPath.forEach((e=>{var t,a;null==(t=i[e])||null==(a=t.children)||a.forEach((e=>{$i({child:e,layout:i,scope:u,activeFilters:r,filterId:n,extraFormData:o})}))}))})),r},Vi={},Ki={};var Bi,Wi=n(18446),Hi=n.n(Wi),Gi=n(5977),Yi=n(12515),Ji=n(18239),Qi=n(40219),Xi=n(29147),er=n(38270),tr=n(11064),nr=n(16355),ir=n(88694),rr=n(65013);!function(e){e[e.all=0]="all",e[e.specific=1]="specific"}(Bi||(Bi={}));const or=({type:e,meta:t},n)=>{var i,r;return!(e!==h.gn&&e!==h.dW&&e!==h.U0||n&&"filter_box"===(null==(i=n[null==t?void 0:t.chartId])||null==(r=i.form_data)?void 0:r.viz_type))},ar=(e,t,n,i,r,o,a)=>{let s=t;if(or(e,i)&&e.type!==h.U0&&r.includes(e.id)){var d;const n=a(e.meta.sliceNameOverride||e.meta.sliceName||e.meta.text||e.meta.defaultText||e.id.toString(),o.includes(null==(d=e.meta)?void 0:d.chartId),(0,l.t)("This chart might be incompatible with the filter (datasets don't match)")),i={key:e.id,title:n,children:[]};t.children.push(i),s=i}e.children.forEach((e=>ar(n[e],s,n,i,r,o,a)))},sr=(e,t,n,i)=>{n.forEach((n=>{var r,o;sr(e,t,((e,t)=>{var n;return[...(null==(n=e[t])?void 0:n.children)||[],...Object.values(e).filter((n=>n.parents&&n.parents[n.parents.length-1]===t&&!or(e[n.parents[n.parents.length-1]]))).map((({id:e})=>e))]})(t,n),i),(null==(r=t[n])?void 0:r.type)!==h.dW||i.includes(null==(o=t[n])?void 0:o.meta.chartId)||e.push(n)}))},lr=(e,t=[])=>({rootPath:[H._4],excluded:e?[e,...t]:t}),dr=(e,t)=>!e||e.rootPath[0]===H._4&&!e.excluded.filter((e=>e!==t)).length,cr=(e,t,n)=>{let i=(0,b.tZ)("span",null,e);return t&&(i=(0,b.tZ)(o.Fragment,null,i,"",(0,b.tZ)(ct.u,{title:n},(0,b.tZ)(W.Z.Info,{iconSize:"m"})))),i},ur=({formScope:e,initialScope:t,forceUpdate:n,updateFormValues:i,chartId:a,initiallyExcludedCharts:s=[]})=>{const[d,c]=(0,o.useState)([H._4]),{treeData:u,layout:p}=function(e,t=[],n=(e=>e)){const i=(0,r.v9)((({dashboardLayout:{present:e}})=>e)),a=(0,r.v9)((({charts:e})=>e)),s={children:[],key:H._4,type:h.U0,title:(0,l.t)("All panels")},d=(0,o.useMemo)((()=>Object.values(i).reduce(((t,n)=>{const{id:i,parents:r=[],type:o,meta:a}=n;return o===h.dW&&e!==(null==a?void 0:a.chartId)?[...new Set([...t,...r,i])]:t}),[])),[i,e]);return(0,o.useMemo)((()=>{ar(i[H._4],s,i,a,d,t,n)}),[i,s,a,t,n]),{treeData:[s],layout:i}}(a,s,cr),[f,m]=(0,o.useState)(!0),g=(0,o.useMemo)((()=>((e,t)=>{const n=[];return sr(n,t,[...e.rootPath],[...e.excluded]),[...new Set(n)]})({...e||t},p)),[e,t,p]);return(0,b.tZ)(K.mp,{checkable:!0,selectable:!1,onExpand:e=>{c(e),m(!1)},expandedKeys:d,autoExpandParent:f,onCheck:e=>{n();const t=((e,t)=>{if(!e.length)return{rootPath:[],excluded:[]};const n=e.filter((e=>{var n;return(null==(n=t[e])?void 0:n.type)===h.dW})).map((e=>{var n;return[H._4,...(null==(n=t[e])?void 0:n.parents)||[]].filter((e=>or(t[e])))}));n.sort(((e,t)=>e.length-t.length));const i=n.map((e=>e[n[0].length-1])),r=[];return Object.entries(t).forEach((([t,n])=>{var o;const a=n.parents||[];n.type===h.dW&&null!=(o=[H._4,...a])&&o.find((n=>((t,n)=>i.includes(t)&&!e.includes(n))(n,t)))&&r.push(n.meta.chartId)})),{rootPath:[...new Set(i)],excluded:r}})(e,p);void 0!==a&&(t.excluded=[...new Set([...t.excluded,a])]),i({scope:t})},checkedKeys:g,treeData:u})},hr=v.iK.div`
  display: flex;
  flex-direction: column;
  & > * {
    margin-bottom: ${({theme:e})=>e.gridUnit}px;
  }
  padding: 0px ${({theme:e})=>4*e.gridUnit}px;
`,pr=(0,v.iK)(K.qz.Item)`
  margin-bottom: 0;
`,fr=({pathToFormValue:e=[],formScopingType:t,formFilterScope:n,forceUpdate:i,filterScope:r,updateFormValues:a,chartId:s,initiallyExcludedCharts:d})=>{const[c]=(0,o.useState)(r||lr(s,d)),[u]=(0,o.useState)(dr(c,s)?Bi.all:Bi.specific),[h,p]=(0,o.useState)(!!r),f=(0,o.useCallback)((e=>{a(e),p(!0)}),[a]),m=(0,o.useCallback)((()=>{if(r||h)return;const e=lr(s,d);a({scope:e,scoping:dr(e,s)?Bi.all:Bi.specific})}),[s,r,h,d,a]);return(0,rr.d)(m),(0,b.tZ)(hr,null,(0,b.tZ)(pr,{name:[...e,"scoping"],initialValue:u},(0,b.tZ)(Pt.Y.Group,{onChange:({target:{value:e}})=>{if(e===Bi.all){const e=lr(s);a({scope:e})}p(!0),i()}},(0,b.tZ)(Pt.Y,{value:Bi.all},(0,l.t)("Apply to all panels")),(0,b.tZ)(Pt.Y,{value:Bi.specific},(0,l.t)("Apply to specific panels")))),(0,b.tZ)(K.ZT.Text,{type:"secondary"},(null!=t?t:u)===Bi.specific?(0,l.t)("Only selected panels will be affected by this filter"):(0,l.t)("All panels with this column will be affected by this filter")),(null!=t?t:u)===Bi.specific&&(0,b.tZ)(ur,{updateFormValues:f,initialScope:c,formScope:n,forceUpdate:i,chartId:s,initiallyExcludedCharts:d}),(0,b.tZ)(pr,{name:[...e,"scope"],hidden:!0,initialValue:c}))};var mr=n(10752),gr=n.n(mr),vr=n(88889),br=n(55786);const yr="filters",Cr={filter_time:[vr.Z.TEMPORAL],filter_timegrain:[vr.Z.TEMPORAL],filter_timecolumn:[vr.Z.TEMPORAL],filter_select:[vr.Z.BOOLEAN,vr.Z.STRING,vr.Z.NUMERIC,vr.Z.TEMPORAL],filter_range:[vr.Z.NUMERIC]},Sr=()=>{const[,e]=o.useState({});return o.useCallback((()=>e({})),[])},xr=(e,t,n)=>{const i=e.getFieldValue(yr)||{};e.setFields([{name:yr,value:{...i,[t]:{...i[t],...n}}}])},wr=e=>({value:e.id,label:e.table_name}),kr=e=>{const t=(0,br.Z)(null==e?void 0:e.column_types);return 0===t.length||t.includes(vr.Z.TEMPORAL)},Zr=(e,t)=>{var n;return!t.type_generic||!(e in Cr)||(null==(n=Cr[e])?void 0:n.includes(t.type_generic))},Rr=({form:e,scope:t,chartId:n})=>{const i=Sr(),r=e.getFieldValue("scope"),o=e.getFieldValue("scoping");return(0,b.tZ)(fr,{updateFormValues:t=>{((e,t)=>{e.setFieldsValue({...t})})(e,{...t})},filterScope:t,chartId:n,formFilterScope:r,forceUpdate:i,formScopingType:o})};var Tr=n(89734),Fr=n.n(Tr),Dr=n(44908),_r=n.n(Dr),Er=n(68122),Ir=n(53350),Mr=n(10916);const Or=[];function Pr(){return(0,r.v9)((e=>{var t,n;return(null==(t=e.dashboardInfo)||null==(n=t.metadata)?void 0:n.native_filter_configuration)||Or}))}function Nr(){return(0,r.v9)((e=>{var t;return null==(t=e.dashboardLayout)?void 0:t.present}))}function jr(){const e=Nr();return(0,o.useMemo)((()=>Object.values(e).some((e=>e.type===h.gn))),[e])}var qr=n(27034),zr=n(22068);const Ar="FILTER",$r=v.iK.div`
  ${({isDragging:e,theme:t})=>`\n    opacity: ${e?.3:1};\n    cursor: ${e?"grabbing":"pointer"};\n    width: 100%;\n    display: flex;\n    padding:  ${t.gridUnit}px;\n  `}
`,Ur=(0,v.iK)(W.Z.Drag,{shouldForwardProp:e=>"isDragging"!==e})`
  ${({isDragging:e,theme:t})=>`\n    font-size: ${t.typography.sizes.m}px;\n    margin-top: 15px;\n    cursor: ${e?"grabbing":"grab"};\n    padding-left: ${t.gridUnit}px;\n  `}
`;var Lr={name:"82a6rk",styles:"flex:1"};const Vr=({index:e,onRearrange:t,filterIds:n,children:i})=>{const r=(0,o.useRef)(null),[{isDragging:a},s]=(0,qr.c)({item:{filterIds:n,type:Ar,index:e},collect:e=>({isDragging:e.isDragging()})}),[,l]=(0,zr.L)({accept:Ar,hover:(n,i)=>{var o;if(!r.current)return;const a=n.index,s=e;if(a===s)return;const l=null==(o=r.current)?void 0:o.getBoundingClientRect(),d=(l.bottom-l.top)/2,c=i.getClientOffset().y-l.top;a<s&&c<d||a>s&&c>d||(t(a,s),n.index=s)}});return s(l(r)),(0,b.tZ)($r,{ref:r,isDragging:a},(0,b.tZ)(Ur,{isDragging:a,alt:"Move icon",className:"dragIcon",viewBox:"4 4 16 16"}),(0,b.tZ)("div",{css:Lr},i))},Kr=v.iK.div`
  ${({theme:e})=>`\n      display: flex;\n      align-items: center;\n      padding: ${2*e.gridUnit}px;\n      width: 100%;\n      border-radius: ${e.borderRadius}px;\n      &.active {\n        color: ${e.colors.grayscale.dark1};\n        border-radius: ${e.borderRadius}px;\n        background-color: ${e.colors.secondary.light4};\n        span, .anticon {\n          color: ${e.colors.grayscale.dark1};\n        }\n      }\n      &:hover {\n        color: ${e.colors.primary.light1};\n        span, .anticon {\n          color: ${e.colors.primary.light1};\n        }\n      }\n      &.errored div, &.errored .warning {\n        color: ${e.colors.error.base};\n      }\n  `}
`,Br=(0,v.iK)(W.Z.Trash)`
  color: ${({theme:e})=>e.colors.grayscale.light3};
`,Wr=(0,v.iK)(W.Z.Warning)`
  color: ${({theme:e})=>e.colors.error.base};
  &.anticon {
    margin-left: auto;
  }
`,Hr=v.iK.div`
  height: 100%;
  overflow-y: auto;
`;var Gr={name:"7whenc",styles:"display:flex;width:100%"},Yr={name:"1vr7vmn",styles:"align-items:center;display:flex"},Jr={name:"1je5tt7",styles:"align-self:flex-end;margin-left:auto"},Qr={name:"an0ls6",styles:"align-self:flex-start;margin-left:auto"};const Xr=(0,o.forwardRef)((({getFilterTitle:e,onChange:t,onRemove:n,restoreFilter:i,onRearrange:r,currentFilterId:o,removedFilters:a,filters:s,erroredFilters:d=[]},c)=>(0,b.tZ)(Hr,{ref:c},(()=>{const c=[];return s.forEach(((s,u)=>{c.push((0,b.tZ)(Vr,{key:u,onRearrange:r,index:u,filterIds:[s]},(r=>{const s=!!a[r],c=d.includes(r),u=o===r,h=[];return c&&h.push("errored"),u&&h.push("active"),(0,b.tZ)(Kr,{role:"tab",key:`filter-title-tab-${r}`,onClick:()=>t(r),className:h.join(" ")},(0,b.tZ)("div",{css:Gr},(0,b.tZ)("div",{css:Yr},s?(0,l.t)("(Removed)"):e(r)),!a[r]&&c&&(0,b.tZ)(Wr,{className:"warning"}),s&&(0,b.tZ)("span",{css:Jr,role:"button",tabIndex:0,onClick:e=>{e.preventDefault(),i(r)}},(0,l.t)("Undo?"))),(0,b.tZ)("div",{css:Qr},s?null:(0,b.tZ)(Br,{onClick:e=>{e.stopPropagation(),n(r)},alt:"RemoveFilter"})))})(s)))})),c})()))),eo=v.iK.div`
  ${({theme:e})=>`\n  cursor: pointer;\n  margin: ${4*e.gridUnit}px;\n  color: ${e.colors.primary.base};\n  &:hover {\n    color: ${e.colors.primary.dark1};\n  }\n`}
`,to=v.iK.div`
  height: 100%;
  display: flex;
  flex-direction: column;
`,no=[{label:"Filter",type:Mr.BE.NATIVE_FILTER},{label:"Divider",type:Mr.BE.DIVIDER}],io=({getFilterTitle:e,onChange:t,onAdd:n,onRemove:i,onRearrange:r,restoreFilter:a,currentFilterId:s,filters:d,removedFilters:c,erroredFilters:u})=>{const h=(0,o.useRef)(null),p=(0,v.Fg)(),f=(0,b.tZ)(mt.$,{mode:"horizontal"},no.map((e=>(0,b.tZ)(mt.$.Item,{onClick:()=>{return t=e.type,n(t),void setTimeout((()=>{var e;const t=document.getElementById("native-filters-tabs");if(t){const e=t.getElementsByClassName("ant-tabs-nav-list")[0];e.scrollTop=e.scrollHeight}null==h||null==(e=h.current)||null==e.scroll||e.scroll({top:h.current.scrollHeight,behavior:"smooth"})}),0);var t}},e.label))));return(0,b.tZ)(to,null,(0,b.tZ)(K.Gj,{overlay:f,arrow:!0,placement:"topLeft",trigger:["hover"]},(0,b.tZ)(eo,null,(0,b.tZ)("div",{className:"fa fa-plus"})," ",(0,b.tZ)("span",null,(0,l.t)("Add filters and dividers")))),(0,b.tZ)("div",{css:(0,b.iv)({height:"100%",overflowY:"auto",marginLeft:3*p.gridUnit},"","")},(0,b.tZ)(Xr,{ref:h,filters:d,currentFilterId:s,removedFilters:c,getFilterTitle:e,erroredFilters:u,onChange:t,onRemove:i,onRearrange:r,restoreFilter:a})))},ro=v.iK.div`
  display: flex;
  height: 100%;
`,oo=v.iK.div`
  flex-grow: 3;
  margin-left: ${({theme:e})=>-1*e.gridUnit-1};
`,ao=v.iK.div`
  width: 270px;
  border-right: 1px solid ${({theme:e})=>e.colors.grayscale.light2};
`,so=({getFilterTitle:e,onChange:t,onRemove:n,onRearrange:i,restoreFilter:r,onAdd:o,erroredFilters:a,children:s,currentFilterId:l,filters:d,removedFilters:c})=>{const u=d.filter((e=>e===l))[0];return(0,b.tZ)(ro,null,(0,b.tZ)(ao,null,(0,b.tZ)(io,{currentFilterId:l,filters:d,removedFilters:c,erroredFilters:a,getFilterTitle:e,onChange:t,onAdd:e=>o(e),onRearrange:i,onRemove:e=>n(e),restoreFilter:r})),(0,b.tZ)(oo,null,d.map((e=>(0,b.tZ)("div",{key:e,style:{height:"100%",overflowY:"auto",display:e===u?"":"none"}},s(e))))))};var lo=n(43700);const co=v.iK.div`
  display: flex;
  flex-direction: row;
  background-color: ${({level:e,theme:t})=>t.colors[e].light2};
  border-radius: ${({theme:e})=>e.borderRadius}px;
  border: 1px solid ${({level:e,theme:t})=>t.colors[e].base};
  color: ${({level:e,theme:t})=>t.colors[e].dark2};
  padding: ${({theme:e})=>2*e.gridUnit}px;
  margin-bottom: ${({theme:e})=>e.gridUnit}px;
  width: 100%;
`,uo=v.iK.div`
  display: flex;
  flex-direction: column;
  margin-left: ${({theme:e})=>2*e.gridUnit}px;
`,ho=v.iK.span`
  font-weight: ${({theme:e})=>e.typography.weights.bold};
`;function po({body:e,level:t="error",title:n}){const i=(0,v.Fg)().colors[t].base;return(0,b.tZ)(co,{level:t,role:"alert"},"error"===t?(0,b.tZ)(W.Z.ErrorSolid,{iconColor:i}):(0,b.tZ)(W.Z.WarningSolid,{iconColor:i}),(0,b.tZ)(uo,null,(0,b.tZ)(ho,null,n),(0,b.tZ)("p",null,e)))}var fo=n(73375),mo=n(46566),go=n(77997);const vo=(e,t,n=((...e)=>JSON.stringify([...e])))=>(...i)=>{const r=n(...i);if(t.has(r))return t.get(r);const o=e(...i);return t.set(r,o),o};var bo=n(78676);const yo=v.iK.div`
  width: 100%;
  display: flex;
  flex-direction: column;
  align-items: flex-start;
  min-height: ${({theme:e})=>10*e.gridUnit}px;
  padding-top: ${({theme:e})=>2*e.gridUnit+2}px;

  .checkbox {
    margin-bottom: ${({theme:e,checked:t})=>t?e.gridUnit:0}px;
  }

  & > div {
    margin-bottom: ${({theme:e})=>2*e.gridUnit}px;
  }
`,Co=v.iK.div`
  margin-left: ${({theme:e})=>6*e.gridUnit}px;
`,So=e=>{const{checked:t,disabled:n,title:i,tooltip:r,children:a,onChange:s=(()=>{}),initialValue:l=!1}=e,[d,c]=(0,o.useState)(l);return(0,o.useEffect)((()=>{void 0!==t&&c(t)}),[t]),(0,b.tZ)(yo,{checked:d},(0,b.tZ)(K.r4,{className:"checkbox",checked:d,disabled:n,onChange:e=>{const n=e.target.checked;void 0===t&&c(n),s(n)}},(0,b.tZ)(o.Fragment,null,i,"",r&&(0,b.tZ)(si.V,{placement:"top",tooltip:r}))),d&&(0,b.tZ)(Co,null,a))};var xo=n(28615),wo=n(98286);const ko=new Map,Zo=vo(ft.Z.get,ko,(({endpoint:e})=>e||""));function Ro({allowClear:e=!1,filterValues:t=(()=>!0),form:n,formField:i="column",filterId:r,datasetId:a,value:s,onChange:d,mode:c}){var u;const[h,p]=(0,o.useState)(),{addDangerToast:f}=(0,di.e1)(),m=(0,o.useCallback)((()=>{n.setFields([{name:["filters",r,i],touched:!1,value:null}])}),[n,r,i]),g=(0,o.useMemo)((()=>(0,br.Z)(h).filter(t).map((e=>e.column_name)).map((e=>({label:e,value:e})))),[h,t]),v=null==(u=n.getFieldValue("filters"))?void 0:u[r].filterType,y=(0,o.useMemo)((()=>null==h?void 0:h.find((e=>e.column_name===s))),[h,s]);return(0,o.useEffect)((()=>{y&&!Zr(v,y)&&m()}),[y,v,m]),(0,xo.S)(a,(e=>{null!=e&&m(),null!=a&&Zo({endpoint:`/api/v1/dataset/${a}`}).then((({json:{result:e}})=>{const t=Array.isArray(s)?s:[s];e.columns.some((e=>null==t?void 0:t.includes(e.column_name)))||m(),p(e.columns)}),(async e=>{const{error:t,message:n}=await(0,wo.O)(e);let i=n||t||(0,l.t)("An error has occurred");"Forbidden"===n&&(i=(0,l.t)("You do not have permission to edit this dashboard")),f(i)}))})),(0,b.tZ)(K.Ph,{mode:c,value:"multiple"===c?s||[]:s,ariaLabel:(0,l.t)("Column select"),onChange:d,options:g,placeholder:(0,l.t)("Select a column"),notFoundContent:(0,l.t)("No compatible columns found"),showSearch:!0,allowClear:e})}var To=n(15926),Fo=n.n(To);const Do=new Map,_o=vo(ft.Z.get,Do,(({endpoint:e})=>e||"")),Eo=({onChange:e,value:t})=>{const n=(0,o.useCallback)((({error:e,message:t})=>{let n=t||e||(0,l.t)("An error has occurred");return"Forbidden"===t&&(n=(0,l.t)("You do not have permission to edit this dashboard")),n}),[]);return(0,b.tZ)(K.qb,{ariaLabel:(0,l.t)("Dataset"),value:t,options:async(e,t,i)=>{const r="table_name",o=Fo().encode({filters:[{col:r,opr:"ct",value:e}],page:t,page_size:i,order_column:r,order_direction:"asc"});return _o({endpoint:`/api/v1/dataset/?q=${o}`}).then((e=>({data:e.json.result.map(wr),totalCount:e.json.count}))).catch((async e=>{const t=n(await(0,wo.O)(e));throw new Error(t)}))},onChange:e})},Io=e=>(0,o.useMemo)((()=>(0,b.tZ)(Eo,e)),[]);var Mo=n(88274);const Oo=({hasDefaultValue:e,filterId:t,hasDataset:n,form:i,setDataMask:r,formData:o,enableNoResults:a})=>{var s,d,c;const h=(i.getFieldValue("filters")||{})[t],p=null==h?void 0:h.defaultValueQueriesData,f=n&&null===p,m=null==(s=h.defaultDataMask)||null==(d=s.filterState)?void 0:d.value,g=e&&null==m;return f?(0,b.tZ)(u.Z,{position:"inline-centered"}):(0,b.tZ)(Mo.Z,{height:32,width:"filter_time"===(null==h?void 0:h.filterType)?350:250,appSection:nr.Tr.FILTER_CONFIG_MODAL,behaviors:[nr.cg.NATIVE_FILTER],formData:o,queriesData:n?null==h?void 0:h.defaultValueQueriesData:[{data:[{}]}],chartType:null==h?void 0:h.filterType,hooks:{setDataMask:r},enableNoResults:a,filterState:{...null==(c=h.defaultDataMask)?void 0:c.filterState,validateMessage:g&&(0,l.t)("Value is required"),validateStatus:g&&"error"}})};var Po=n(37687);const No=(0,v.iK)(Dt.xJ)`
  margin-bottom: 0;
`;const jo=v.iK.div`
  display: flex;
  flex-direction: column;
  height: 400px; // arbitrary
  text-align: center;
  justify-content: center;
  align-items: center;
  color: ${({theme:e})=>e.colors.grayscale.base};
`,qo=({onClick:e})=>(0,b.tZ)(jo,null,(0,b.tZ)("p",null,(0,l.t)("You have removed this filter.")),(0,b.tZ)("div",null,(0,b.tZ)(B.Z,{buttonStyle:"primary",onClick:e},(0,l.t)("Restore Filter")))),zo=v.iK.div`
  display: flex;
  flex-direction: column;
`,Ao=v.iK.div`
  ${({theme:e})=>`\n    display: inline-flex;\n    flex-direction: row;\n    align-items: center;\n    cursor: pointer;\n    color: ${e.colors.primary.base};\n    &:hover {\n      color: ${e.colors.primary.dark1};\n    }\n  `}
`,$o=(0,v.iK)(W.Z.Trash)`
  ${({theme:e})=>`\n    cursor: pointer;\n    margin-left: ${2*e.gridUnit}px;\n    color: ${e.colors.grayscale.base};\n    &:hover {\n      color: ${e.colors.grayscale.dark1};\n    }\n  `}
`,Uo=v.iK.div`
  ${({theme:e})=>`\n    display: flex;\n    width: 220px;\n    flex-direction: row;\n    align-items: center;\n    margin-bottom: ${e.gridUnit}px;\n  `}
`,Lo=v.iK.div`
  text-transform: uppercase;
  font-size: ${({theme:e})=>e.typography.sizes.s}px;
  color: ${({theme:e})=>e.colors.grayscale.base};
  margin-bottom: ${({theme:e})=>e.gridUnit}px;
`,Vo=({availableFilters:e,selection:t,onChange:n,onDelete:i})=>{let r=e.find((e=>e.value===t)),o=e;return r||(r={label:(0,l.t)("(deleted or invalid type)"),value:t},o=[r,...o]),(0,b.tZ)(Uo,null,(0,b.tZ)(K.Ph,{ariaLabel:(0,l.t)("Limit type"),labelInValue:!0,options:o,onChange:e=>n(t,e.value),value:r}),(0,b.tZ)($o,{iconSize:"xl",onClick:()=>i(t)}))},Ko=({availableFilters:e=[],dependencies:t=[],onDependenciesChange:n})=>{const[i,r]=(0,o.useState)(t),a=e=>{r(e),n(e)},s=(e,t)=>{const n=i.findIndex((t=>t===e)),r=[...i];r[n]=t,a(r)},d=e=>{const t=[...i];t.splice(i.indexOf(e),1),a(t)};return 0===e.length?(0,b.tZ)("span",null,(0,l.t)("No available filters.")):(0,b.tZ)(o.Fragment,null,i.map((t=>(0,b.tZ)(Vo,{key:t,selection:t,availableFilters:e.filter((e=>e.value===t||!i.includes(e.value))),onChange:s,onDelete:d}))),e.length>i.length&&(0,b.tZ)(Ao,{onClick:()=>{const t=e.find((e=>!i.includes(e.value)));if(t){const e=[...i];e.push(t.value),a(e)}}},(0,b.tZ)(W.Z.PlusSmall,null),(0,l.t)("Add filter")))},Bo=({availableFilters:e=[],dependencies:t=[],onDependenciesChange:n,getDependencySuggestion:i})=>{const r=e.length>0,o=t.length>0;return(0,b.tZ)(zo,null,(0,b.tZ)(So,{title:(0,l.t)("Values are dependent on other filters"),initialValue:o,onChange:e=>{const t=[];e&&!o&&r&&t.push(i()),n(t)},tooltip:(0,l.t)("Values selected in other filters will affect the filter options to only show relevant values")},o&&(0,b.tZ)(Lo,null,(0,l.t)("Values dependent on")),(0,b.tZ)(Ko,{availableFilters:e,dependencies:t,onDependenciesChange:n,getDependencySuggestion:i})))},Wo=(0,v.iK)(C.ZP.TabPane)`
  padding: ${({theme:e})=>4*e.gridUnit}px 0px;
`,Ho=v.iK.div`
  ${({theme:e})=>`\n    display: flex;\n    flex-direction: row-reverse;\n    justify-content: space-between;\n    padding: 0px ${4*e.gridUnit}px;\n  `}
`,Go=v.iK.div`
  display: flex;
  flex-direction: row;
  justify-content: space-between;
  width: 100%;
  padding: 0px ${({theme:e})=>4*e.gridUnit}px;
`,Yo=["enableEmptyFilter","defaultToFirstItem","multiSelect","searchAllOptions","inverseSelection"],Jo=(0,v.iK)(Dt.xJ)`
  width: 49%;
  margin-bottom: ${({theme:e})=>4*e.gridUnit}px;

  & .ant-form-item-label {
    padding-bottom: 0;
  }

  & .ant-form-item-control-input {
    min-height: ${({theme:e})=>10*e.gridUnit}px;
  }
`,Qo=(0,v.iK)(Dt.xJ)`
  margin-bottom: 0;
  padding-bottom: 0;
  min-width: 50%;

  & .ant-form-item-label {
    padding-bottom: 0;
  }

  .ant-form-item-control-input-content > div > div {
    height: auto;
  }

  & .ant-form-item-control-input {
    min-height: ${({theme:e})=>10*e.gridUnit}px;
  }
`,Xo=(0,v.iK)(Dt.xJ)`
  min-width: 50%;

  & .ant-form-item-label {
    padding-bottom: 0;
  }

  .ant-form-item {
    margin-bottom: 0;
  }

  .ant-form-item-control-input-content > div > div {
    height: auto;
  }

  .ant-form-item-extra {
    display: none;
  }

  & .ant-form-item-control-input {
    height: auto;
  }
`,ea=v.iK.span`
  color: ${({theme:e})=>e.colors.grayscale.base};
  font-size: ${({theme:e})=>e.typography.sizes.s}px;
  text-transform: uppercase;
`,ta=(0,v.iK)(Dt.xJ)`
  margin-bottom: 0;
`,na=v.iK.div`
  display: flex;
  flex-direction: row;
  align-items: center;
`,ia=(0,v.iK)(W.Z.Refresh)`
  margin-left: ${({theme:e})=>2*e.gridUnit}px;
  color: ${({theme:e})=>e.colors.primary.base};
`,ra=(0,v.iK)(lo.Z)`
  border-left: 0;
  border-top: 1px solid ${({theme:e})=>e.colors.grayscale.light2};
  border-radius: 0;

  .ant-collapse-header {
    border-bottom: 1px solid ${({theme:e})=>e.colors.grayscale.light2};
    border-top: 1px solid ${({theme:e})=>e.colors.grayscale.light2};
    margin-top: -1px;
    border-radius: 0;
  }

  .ant-collapse-content {
    border: 0;
  }

  .ant-collapse-content-box {
    padding-top: ${({theme:e})=>2*e.gridUnit}px;
  }

  &.ant-collapse > .ant-collapse-item {
    border: 0;
    border-radius: 0;
  }
`,oa=(0,v.iK)(C.ZP)`
  .ant-tabs-nav {
    position: sticky;
    top: 0;
    background: ${({theme:e})=>e.colors.grayscale.light5};
    z-index: 1;
  }

  .ant-tabs-nav-list {
    padding: 0;
  }

  .ant-form-item-label {
    padding-bottom: 0;
  }
`,aa=v.iK.span`
  color: ${({theme:e})=>e.colors.error.base};
  font-size: ${({theme:e})=>e.typography.sizes.s}px;
  margin-left: ${({theme:e})=>e.gridUnit-1}px;
  &:before {
    content: '*';
  }
`,sa={configuration:{key:"configuration",name:(0,l.t)("Settings")},scoping:{key:"scoping",name:(0,l.t)("Scoping")}},la={configuration:{key:"configuration",name:(0,l.t)("Filter Configuration")},settings:{key:"settings",name:(0,l.t)("Filter Settings")}},da=["filter_select","filter_range"],ca={[(0,l.t)("Select filter")]:(0,l.t)("Value"),[(0,l.t)("Range filter")]:(0,l.t)("Numerical range"),[(0,l.t)("Time filter")]:(0,l.t)("Time range"),[(0,l.t)("Time column")]:(0,l.t)("Time column"),[(0,l.t)("Time grain")]:(0,l.t)("Time grain"),[(0,l.t)("Group By")]:(0,l.t)("Group by")},ua=new Map,ha=vo(ft.Z.get,ua,(({endpoint:e})=>e||"")),pa=({filterId:e,filterToEdit:t,removedFilters:n,form:i,getAvailableFilters:a,activeFilterPanelKeys:s,restoreFilter:c,handleActiveFilterPanelChange:h,setErroredFilters:p,validateDependencies:f,getDependencySuggestion:m},g)=>{var v,y,C,S,x,w,k,Z,R,T,F,D,_,E,I,M,O,P,N,j,q,z,A,$;const U=!!n[e],[L,B]=(0,o.useState)(""),[W,H]=(0,o.useState)([]),[G,Y]=(0,o.useState)(sa.configuration.key),[J,Q]=(0,o.useState)(null),X=Sr(),[ee,te]=(0,o.useState)(),ne=(0,o.useMemo)((()=>({})),[]),ie=i.getFieldValue("filters"),re=null==ie?void 0:ie[e],oe=re||J||ne,ae=(null==oe?void 0:oe.dependencies)||(null==t?void 0:t.cascadeParentIds),se=(0,tr.Z)().items,le=Object.entries(se).filter((([,{value:e}])=>{var t;return null==(t=e.behaviors)?void 0:t.includes(nr.cg.NATIVE_FILTER)})).map((([e])=>e)),de=(0,r.v9)((({datasources:e})=>e)),ce=(0,r.v9)((({charts:e})=>e)),ue=(0,o.useMemo)((()=>Object.values(de).some((e=>kr(e)))),[de]),he=(0,o.useMemo)((()=>{const e=Object.values(de).find((e=>{var t;return e.id===(null==oe||null==(t=oe.dataset)?void 0:t.value)}));return!e||kr(e)}),[null==oe||null==(v=oe.dataset)?void 0:v.value,de]),pe=!(null==(y=se[null==oe?void 0:oe.filterType])||null==(C=y.value)||!C.datasourceCount),fe=null!=(S=null!=(x=null==oe||null==(w=oe.dataset)?void 0:w.value)?x:null==t||null==(k=t.targets[0])?void 0:k.datasetId)?S:((e,t)=>{var n;const i=new Map;let r="",o=0;return Object.values(t).forEach((e=>{const{form_data:t}=e;if(t){const{datasource:e}=t,n=(i.get(e)||0)+1;i.set(e,n),n>o&&(o=n,r=e)}})),null==(n=e[r])?void 0:n.id})(de,ce),{controlItems:me={},mainControlItems:ge={}}=oe?function({datasetId:e,disabled:t,forceUpdate:n,form:i,filterId:r,filterType:a,filterToEdit:s,formFilter:d,removed:c}){var u;const h=null!=(u=((e={})=>{var t,n;return null!=(t=null==(n=gr()(e.controlPanelSections))?void 0:n.reduce(((e,{controlSetRows:t=[]})=>[...e,...gr()(t)]),[]))?t:[]})((0,Po.Z)().get(a)))?u:[],p={},f={};return h.filter((e=>"groupby"===(null==e?void 0:e.name))).forEach((t=>{var a,u,h,p,m,g,v,y,C;const S=null!=(a=null==s||null==(u=s.controlValues)?void 0:u[t.name])?a:null==t||null==(h=t.config)?void 0:h.default,x=null==s||null==(p=s.targets[0])||null==(m=p.column)?void 0:m.name,w=(0,b.tZ)(o.Fragment,null,(0,b.tZ)(No,{name:["filters",r,"requiredFirst",t.name],hidden:!0,initialValue:(null==t||null==(g=t.config)?void 0:g.requiredFirst)&&(null==s?void 0:s.requiredFirst)}),(0,b.tZ)(Jo,{name:["filters",r,"column"],initialValue:x,label:(0,b.tZ)(ea,null,(null==(v=t.config)?void 0:v.label)||(0,l.t)("Column")),rules:[{required:(null==(y=t.config)?void 0:y.required)&&!c,message:(0,l.t)("Column is required")}]},(0,b.tZ)(Ro,{mode:(null==(C=t.config)?void 0:C.multiple)&&"multiple",form:i,filterId:r,datasetId:e,filterValues:e=>Zr((null==d?void 0:d.filterType)||"",e),onChange:()=>{xr(i,r,{defaultDataMask:null}),n()}})));f[t.name]={element:w,checked:S}})),h.filter((e=>{var t;return(null==e||null==(t=e.config)?void 0:t.renderTrigger)&&"sortAscending"!==e.name&&"enableSingleValue"!==e.name})).forEach((e=>{var a,c,u,h;const f=null!=(a=null==s||null==(c=s.controlValues)?void 0:c[e.name])?a:null==e||null==(u=e.config)?void 0:u.default,m=(0,b.tZ)(o.Fragment,null,(0,b.tZ)(No,{name:["filters",r,"requiredFirst",e.name],hidden:!0,initialValue:(null==e||null==(h=e.config)?void 0:h.requiredFirst)&&(null==s?void 0:s.requiredFirst)}),(0,b.tZ)(ct.u,{key:e.name,placement:"left",title:e.config.affectsDataMask&&t&&(0,l.t)('Populate "Default value" to enable this control')},(0,b.tZ)(Qo,{key:e.name,name:["filters",r,"controlValues",e.name],initialValue:f,valuePropName:"checked",colon:!1},(0,b.tZ)(K.r4,{disabled:e.config.affectsDataMask&&t,onChange:({target:{checked:t}})=>{e.config.requiredFirst&&xr(i,r,{requiredFirst:{...null==d?void 0:d.requiredFirst,[e.name]:t}}),e.config.resetConfig&&xr(i,r,{defaultDataMask:null}),n()}},e.config.label,"",e.config.description&&(0,b.tZ)(si.V,{placement:"top",label:e.config.name,tooltip:e.config.description})))));p[e.name]={element:m,checked:f}})),{controlItems:p,mainControlItems:f}}({datasetId:fe,disabled:!1,forceUpdate:X,form:i,filterId:e,filterType:null==oe?void 0:oe.filterType,filterToEdit:t,formFilter:oe,removed:U}):{},ve=!!ge.groupby,be=!(null==(R=(null!=(Z=se[null==oe?void 0:oe.filterType])?Z:{}).value)||!R.enableNoResults),ye=ve&&!!W.length,Ce=!pe||fe&&((null==oe?void 0:oe.column)||!ve),Se=da.includes(null==oe?void 0:oe.filterType),xe=Ta.includes(null==oe?void 0:oe.filterType),we=null==(T=null==oe?void 0:oe.isDataDirty)||T,ke=t=>{xr(i,e,t),B(""),X()};let Ze={};ae&&ae.length>0&&ie&&ae.forEach((e=>{var t,n;const i=null==(t=ie[e])||null==(n=t.defaultDataMask)?void 0:n.extraFormData;Ze=(0,qi.on)(Ze,i)}));const Re=JSON.stringify(Ze),Te=(0,o.useCallback)(((t=!1)=>{var n,r;if(!pe||null==oe||null==(n=oe.dataset)||!n.value)return void X();const o=(0,qi.zi)({datasetId:null==oe||null==(r=oe.dataset)?void 0:r.value,groupby:null==oe?void 0:oe.column,...oe});o.extra_form_data=Ze,ke({defaultValueQueriesData:null,isDataDirty:!1}),(0,ji.getChartDataRequest)({formData:o,force:t,requestParams:{dashboardId:0}}).then((({response:e,json:t})=>{if((0,st.cr)(d.T.GLOBAL_ASYNC_QUERIES)){const n="result"in t?t.result[0]:t;if(200===e.status)ke({defaultValueQueriesData:[n]});else{if(202!==e.status)throw new Error(`Received unexpected response status (${e.status}) while fetching chart data`);(0,go.YJ)(n).then((e=>{ke({defaultValueQueriesData:e})})).catch((e=>{B(e.message||e.error||(0,l.t)("Check configuration"))}))}}else ke({defaultValueQueriesData:t.result})})).catch((t=>{t.json().then((n=>{(t=>{xr(i,e,{defaultValueQueriesData:null}),B(t),X()})(n.message||t.statusText||(0,l.t)("Check configuration"))}))}))}),[e,X,i,oe,pe,Re]);(0,o.useEffect)((()=>Te()),[Re]);const Fe=(0,qi.zi)({datasetId:fe,groupby:ve?null==oe?void 0:oe.column:void 0,...oe});Fe.extra_form_data=Ze;const[De,_e,Ee,Ie]=((e,t)=>{var n,i;const r=!(null==e||null==(n=e.controlValues)||!n.enableEmptyFilter),a=!(null==e||null==(i=e.controlValues)||!i.defaultToFirstItem),[s,d]=(0,o.useState)(!1),[c,u]=(0,o.useState)(r),[h,p]=(0,o.useState)(""),f=(e=!1)=>{const t=r&&!a;u(t),d(!!t||e)};return(0,o.useEffect)((()=>{var t,n;f(!a&&!(null==e||null==(t=e.defaultDataMask)||null==(n=t.filterState)||!n.value))}),[a,r]),(0,o.useEffect)((()=>{var e,n;f(!a&&!(null==t||null==(e=t.defaultDataMask)||null==(n=e.filterState)||!n.value))}),[]),(0,o.useEffect)((()=>{let e="";a?e=(0,l.t)('Default value set automatically when "Select first filter value by default" is checked'):c?e=(0,l.t)('Default value must be set when "Filter value is required" is checked'):s&&(e=(0,l.t)('Default value must be set when "Filter has default value" is checked')),p(e)}),[s,c,a]),[s,c,h,f]})(oe,t),Me=!fe||ee||(null==oe||null==(F=oe.dataset)?void 0:F.label),Oe=(0,o.useCallback)((()=>{i.setFields([{name:"changed",value:!0}])}),[i]),Pe=(0,o.useCallback)((t=>{xr(i,e,t),Oe()}),[e,i,Oe]),Ne=!!(null!=oe&&oe.adhoc_filters||null!=oe&&oe.time_range||null!=t&&null!=(D=t.adhoc_filters)&&D.length||null!=t&&t.time_range),je=void 0!==(null==oe||null==(_=oe.controlValues)?void 0:_.enableSingleValue)||void 0!==(null==t||null==(E=t.controlValues)?void 0:E.enableSingleValue);let qe=null==t||null==(I=t.controlValues)?void 0:I.enableSingleValue;void 0!==(null==oe||null==(M=oe.controlValues)?void 0:M.enableSingleMaxValue)&&({enableSingleValue:qe}=oe.controlValues);const ze="boolean"==typeof(null==oe||null==(O=oe.controlValues)?void 0:O.sortAscending)||"boolean"==typeof(null==t||null==(P=t.controlValues)?void 0:P.sortAscending);let Ae=null==t||null==(N=t.controlValues)?void 0:N.sortAscending;"boolean"==typeof(null==oe||null==(j=oe.controlValues)?void 0:j.sortAscending)&&(Ae=oe.controlValues.sortAscending);const $e=!pe||!we&&Ce||!ge.groupby,Ue=t=>{var n;const r=null==(n=i.getFieldValue("filters"))?void 0:n[e].controlValues;xr(i,e,{controlValues:{...r,sortAscending:t}}),X()},Le=t=>{var n;const r=null==(n=i.getFieldValue("filters"))?void 0:n[e].controlValues;xr(i,e,{controlValues:{...r,enableSingleValue:t}}),X()},Ve=()=>setTimeout((()=>i.validateFields([["filters",e,"adhoc_filters"],["filters",e,"time_range"]])),0),Ke=(null==oe?void 0:oe.time_range)&&"No filter"!==oe.time_range,Be=(null==oe||null==(q=oe.adhoc_filters)?void 0:q.length)>0,We=null==oe||null==(z=oe.controlValues)?void 0:z.defaultToFirstItem,He=(null==oe?void 0:oe.filterType)===(null==t?void 0:t.filterType)?null==t?void 0:t.defaultDataMask:null,Ge=()=>Ke||Be?Promise.resolve():Promise.reject(new Error((0,l.t)("Pre-filter is required"))),Ye=a(e),Je=Ye.length>0;(0,o.useEffect)((()=>{fe&&ha({endpoint:`/api/v1/dataset/${fe}`}).then((e=>{var t,n,i;H(null==(t=e.json)||null==(n=t.result)?void 0:n.metrics);const r=null==(i=e.json)?void 0:i.result;r.type=r.datasource_type,r.filter_select=!0,te(r)})).catch((e=>{(0,_i.Gb)(e.message)}))}),[fe]),(0,o.useImperativeHandle)(g,(()=>({changeTab(e){Y(e)}}))),((e,t)=>{var n;const i=Sr(),r=(e.getFieldValue("filters")||{})[t];(0,o.useEffect)((()=>{xr(e,t,{isDataDirty:!0,defaultValueQueriesData:null}),i()}),[e,null==r?void 0:r.filterType,null==r?void 0:r.column,null==r||null==(n=r.dataset)?void 0:n.value,JSON.stringify(null==r?void 0:r.adhoc_filters),null==r?void 0:r.time_range,i,t])})(i,e),(0,o.useEffect)((()=>{pe&&Ce&&De&&we&&Te()}),[pe,Ce,De,we,Te,Me]);const Qe=(0,o.useMemo)((()=>{var e;const t=[];return void 0===(null==oe||null==(e=oe.dataset)?void 0:e.value)?[]:(Object.values(ce).forEach((e=>{var n,i,r;const o=null==(n=e.form_data)?void 0:n.datasource;void 0!==o&&(null==(i=de[o])?void 0:i.id)!==(null==oe||null==(r=oe.dataset)?void 0:r.value)&&t.push(e.id)})),t)}),[JSON.stringify(ce),null==oe||null==(A=oe.dataset)?void 0:A.value,JSON.stringify(de)]);return(0,o.useEffect)((()=>{U&&Q(re)}),[U]),(0,o.useEffect)((()=>{J&&!U&&(xr(i,e,J),Q(null))}),[re,e,i,U,J]),U?(0,b.tZ)(qo,{onClick:()=>c(e)}):(0,b.tZ)(oa,{activeKey:G,onChange:e=>Y(e),centered:!0},(0,b.tZ)(Wo,{tab:sa.configuration.name,key:sa.configuration.key,forceRender:!0},(0,b.tZ)(Ho,null,(0,b.tZ)(Jo,{name:["filters",e,"type"],hidden:!0,initialValue:Mr.BE.NATIVE_FILTER},(0,b.tZ)(V.II,null)),(0,b.tZ)(Jo,{name:["filters",e,"name"],label:(0,b.tZ)(ea,null,(0,l.t)("Filter name")),initialValue:null==t?void 0:t.name,rules:[{required:!U,message:(0,l.t)("Name is required")}]},(0,b.tZ)(V.II,Ra("name-input"))),(0,b.tZ)(Jo,pt()({name:["filters",e,"filterType"],rules:[{required:!U,message:(0,l.t)("Name is required")}],initialValue:(null==t?void 0:t.filterType)||"filter_select",label:(0,b.tZ)(ea,null,(0,l.t)("Filter Type"))},Ra("filter-type")),(0,b.tZ)(K.Ph,{ariaLabel:(0,l.t)("Filter type"),options:le.map((e=>{var t,n,i;const r=null==(t=se[e])?void 0:t.value.name,o=r?ca[r]:void 0,a=1===(null==(n=Cr[e])?void 0:n.length)&&(null==(i=Cr[e])?void 0:i.includes(vr.Z.TEMPORAL))&&!ue;return{value:e,label:o||r,customLabel:a?(0,b.tZ)(ct.u,{title:(0,l.t)("Datasets do not contain a temporal column")},o||r):void 0,disabled:a}})),onChange:t=>{xr(i,e,{filterType:t,defaultDataMask:null,column:null}),X()}}))),pe&&(0,b.tZ)(Go,null,Me?(0,b.tZ)(Jo,pt()({name:["filters",e,"dataset"],label:(0,b.tZ)(ea,null,(0,l.t)("Dataset")),initialValue:ee?{label:ee.table_name,value:ee.id}:void 0,rules:[{required:!U,message:(0,l.t)("Dataset is required")}]},Ra("datasource-input")),(0,b.tZ)(Io,{onChange:t=>{t.value!==fe&&xr(i,e,{dataset:t,defaultDataMask:null,column:null}),X()}})):(0,b.tZ)(Jo,{label:(0,b.tZ)(ea,null,(0,l.t)("Dataset"))},(0,b.tZ)(u.Z,{position:"inline-centered"})),pe&&Object.keys(ge).map((e=>ge[e].element))),(0,b.tZ)(ra,{activeKey:s,onChange:e=>{h(e)},expandIconPosition:"right",key:`native-filter-config-${e}`},"filter_time"!==(null==oe?void 0:oe.filterType)&&(0,b.tZ)(lo.Z.Panel,{forceRender:!0,header:la.configuration.name,key:`${e}-${la.configuration.key}`},xe&&Je&&(0,b.tZ)(Qo,{name:["filters",e,"dependencies"],initialValue:ae},(0,b.tZ)(Bo,{availableFilters:Ye,dependencies:ae,onDependenciesChange:t=>{xr(i,e,{dependencies:t}),X(),f(),Oe()},getDependencySuggestion:()=>m(e)})),pe&&Se&&(0,b.tZ)(ta,{name:["filters",e,"preFilter"]},(0,b.tZ)(So,{initialValue:Ne,title:(0,l.t)("Pre-filter available values"),onChange:e=>{Oe(),e&&Ve()}},(0,b.tZ)(Xo,{name:["filters",e,"adhoc_filters"],initialValue:null==t?void 0:t.adhoc_filters,required:!0,rules:[{validator:Ge}]},(0,b.tZ)(mo.Z,{columns:(null==ee||null==($=ee.columns)?void 0:$.filter((e=>e.filterable)))||[],savedMetrics:(null==ee?void 0:ee.metrics)||[],datasource:ee,onChange:t=>{xr(i,e,{adhoc_filters:t}),X(),Ve()},label:(0,b.tZ)("span",null,(0,b.tZ)(ea,null,(0,l.t)("Pre-filter")),!Ke&&(0,b.tZ)(aa,null))})),he&&(0,b.tZ)(Qo,{name:["filters",e,"time_range"],label:(0,b.tZ)(ea,null,(0,l.t)("Time range")),initialValue:(null==t?void 0:t.time_range)||"No filter",required:!Be,rules:[{validator:Ge}]},(0,b.tZ)(fo.Z,{name:"time_range",onChange:t=>{xr(i,e,{time_range:t}),X(),Ve()}})),Ke&&(0,b.tZ)(Qo,{name:["filters",e,"granularity_sqla"],label:(0,b.tZ)(o.Fragment,null,(0,b.tZ)(ea,null,(0,l.t)("Time column")),"",(0,b.tZ)(si.V,{placement:"top",tooltip:(0,l.t)("Optional time column if time range should apply to another column than the default time column")})),initialValue:null==t?void 0:t.granularity_sqla},(0,b.tZ)(Ro,{allowClear:!0,form:i,formField:"granularity_sqla",filterId:e,filterValues:e=>!!e.is_dttm,datasetId:fe,onChange:t=>{xr(i,e,{granularity_sqla:t}),X()}})))),"filter_range"!==(null==oe?void 0:oe.filterType)?(0,b.tZ)(ta,{name:["filters",e,"sortFilter"]},(0,b.tZ)(So,{initialValue:ze,title:(0,l.t)("Sort filter values"),onChange:e=>{Ue(e||void 0),Oe()}},(0,b.tZ)(Qo,{name:["filters",e,"controlValues","sortAscending"],initialValue:Ae,label:(0,b.tZ)(ea,null,(0,l.t)("Sort type"))},(0,b.tZ)(Pt.Y.Group,{onChange:e=>{Ue(e.target.value)}},(0,b.tZ)(Pt.Y,{value:!0},(0,l.t)("Sort ascending")),(0,b.tZ)(Pt.Y,{value:!1},(0,l.t)("Sort descending")))),ye&&(0,b.tZ)(Xo,{name:["filters",e,"sortMetric"],initialValue:null==t?void 0:t.sortMetric,label:(0,b.tZ)(o.Fragment,null,(0,b.tZ)(ea,null,(0,l.t)("Sort Metric")),"",(0,b.tZ)(si.V,{placement:"top",tooltip:(0,l.t)("If a metric is specified, sorting will be done based on the metric value")}))},(0,b.tZ)(K.Ph,{allowClear:!0,ariaLabel:(0,l.t)("Sort metric"),name:"sortMetric",options:W.map((e=>{var t;return{value:e.metric_name,label:null!=(t=e.verbose_name)?t:e.metric_name}})),onChange:t=>{void 0!==t&&(xr(i,e,{sortMetric:t}),X())}})))):(0,b.tZ)(ta,{name:["filters",e,"rangeFilter"]},(0,b.tZ)(So,{initialValue:je,title:(0,l.t)("Single Value"),onChange:e=>{Le(e?bo.c.Exact:void 0),Oe()}},(0,b.tZ)(Qo,{name:["filters",e,"controlValues","enableSingleValue"],initialValue:qe,label:(0,b.tZ)(ea,null,(0,l.t)("Single value type"))},(0,b.tZ)(Pt.Y.Group,{onChange:e=>Le(e.target.value)},(0,b.tZ)(Pt.Y,{value:bo.c.Minimum},(0,l.t)("Minimum")),(0,b.tZ)(Pt.Y,{value:bo.c.Exact},(0,l.t)("Exact")),(0,b.tZ)(Pt.Y,{value:bo.c.Maximum},(0,l.t)("Maximum"))))))),(0,b.tZ)(lo.Z.Panel,{forceRender:!0,header:la.settings.name,key:`${e}-${la.settings.key}`},(0,b.tZ)(Jo,{name:["filters",e,"description"],initialValue:null==t?void 0:t.description,label:(0,b.tZ)(ea,null,(0,l.t)("Description"))},(0,b.tZ)(V.Kx,null)),(0,b.tZ)(ta,{name:["filters",e,"defaultValueQueriesData"],hidden:!0,initialValue:null}),(0,b.tZ)(ta,{name:["filters",e,"defaultValue"]},(0,b.tZ)(So,{checked:De,disabled:_e||We,initialValue:De,title:(0,l.t)("Filter has default value"),tooltip:Ee,onChange:t=>{Ie(t),t||xr(i,e,{defaultDataMask:null}),Oe()}},!U&&(0,b.tZ)(Xo,{name:["filters",e,"defaultDataMask"],initialValue:He,label:(0,b.tZ)(ea,null,(0,l.t)("Default Value")),required:De,rules:[{validator:()=>{var t,n;if(null!=oe&&null!=(t=oe.defaultDataMask)&&null!=(n=t.filterState)&&n.value){const e=i.getFieldsError();return p((t=>t.length&&!e.find((e=>e.errors.length>0))?[]:t)),Promise.resolve()}return p((t=>t.includes(e)?t:[...t,e])),Promise.reject(new Error((0,l.t)("Default value is required")))}}]},L?(0,b.tZ)(po,{title:(0,l.t)("Cannot load filter"),body:L,level:"error"}):$e?(0,b.tZ)(na,null,(0,b.tZ)(Oo,{setDataMask:t=>{var n,r;Hi()(null==He||null==(n=He.filterState)?void 0:n.value,null==t||null==(r=t.filterState)?void 0:r.value)||Oe(),xr(i,e,{defaultDataMask:t}),i.validateFields([["filters",e,"defaultDataMask"]]),X()},hasDefaultValue:De,filterId:e,hasDataset:pe,form:i,formData:Fe,enableNoResults:be}),pe&&fe&&(0,b.tZ)(ct.u,{title:(0,l.t)("Refresh the default values")},(0,b.tZ)(ia,{onClick:()=>Te(!0)}))):(0,l.t)('Fill all required fields to enable "Default Value"')))),Object.keys(me).sort(((e,t)=>Yo.indexOf(e)-Yo.indexOf(t))).map((e=>me[e].element))))),(0,b.tZ)(Wo,{tab:sa.scoping.name,key:sa.scoping.key,forceRender:!0},(0,b.tZ)(fr,{updateFormValues:Pe,pathToFormValue:["filters",e],forceUpdate:X,filterScope:null==t?void 0:t.scope,formFilterScope:null==oe?void 0:oe.scope,formScopingType:null==oe?void 0:oe.scoping,initiallyExcludedCharts:Qe})))},fa=(0,o.forwardRef)(pa);var ma={name:"ihui0v",styles:"text-align:left;& .ant-alert-action{align-self:center;}"},ga={name:"zjik7",styles:"display:flex"};function va({title:e,onConfirm:t,onDismiss:n,children:i}){return(0,b.tZ)(Ft.Z,{closable:!1,type:"warning",key:"alert",message:e,css:ma,description:i,action:(0,b.tZ)("div",{css:ga},(0,b.tZ)(B.Z,{key:"cancel",buttonSize:"small",buttonStyle:"secondary",onClick:n},(0,l.t)("Keep editing")),(0,b.tZ)(B.Z,{key:"submit",buttonSize:"small",buttonStyle:"primary",onClick:t},(0,l.t)("Yes, cancel")))})}const ba=({canSave:e=!0,onCancel:t,handleSave:n,onDismiss:i,onConfirmCancel:r,saveAlertVisible:a})=>a?(0,b.tZ)(va,{key:"cancel-confirm",title:(0,l.t)("There are unsaved changes."),onConfirm:r,onDismiss:i},(0,l.t)("Are you sure you want to cancel?")):(0,b.tZ)(o.Fragment,null,(0,b.tZ)(B.Z,{key:"cancel",buttonStyle:"secondary",onClick:t},(0,l.t)("Cancel")),(0,b.tZ)(B.Z,{disabled:!e,key:"submit",buttonStyle:"primary",onClick:n},(0,l.t)("Save")));var ya=n(60812),Ca=n(92242);const Sa=v.iK.div`
  ${({theme:e})=>`\n    padding: ${4*e.gridUnit}px;\n  `}
`,xa=({componentId:e,divider:t})=>(0,b.tZ)(Sa,null,(0,b.tZ)(Dt.xJ,{initialValue:t?t.title:"",label:(0,l.t)("Title"),name:["filters",e,"title"],rules:[{required:!0,message:(0,l.t)("Title is required"),whitespace:!0}]},(0,b.tZ)(V.II,null)),(0,b.tZ)(Dt.xJ,{initialValue:t?t.description:"",label:(0,l.t)("Description"),name:["filters",e,"description"]},(0,b.tZ)(V.Kx,{rows:4})),(0,b.tZ)(Dt.xJ,{hidden:!0,name:["filters",e,"type"],initialValue:Mr.BE.DIVIDER})),wa=(0,v.iK)(li.o)`
  min-width: 700px;
  .ant-modal-body {
    padding: 0px;
  }
`,ka=v.iK.div`
  display: flex;
  height: 700px;
  flex-direction: row;
  .filters-list {
    width: ${({theme:e})=>50*e.gridUnit}px;
    overflow: auto;
  }
`,Za=(0,v.iK)(K.qz)`
  width: 100%;
`,Ra=(0,Ir.Q)("filters-config-modal"),Ta=["filter_select"];function Fa({isOpen:e,initialFilterId:t,createNewOnOpen:n,onSave:i,onCancel:r}){const[a]=K.qz.useForm(),s=(0,o.useRef)(),d=Pr(),c=function(){const e=Pr();return(0,o.useMemo)((()=>e.reduce(((e,t)=>(e[t.id]=t,e)),{})),[e])}(),[u,h]=(0,o.useState)([]),[p,f]=(0,o.useState)({}),[m,g]=(0,o.useState)(!1),v=(0,o.useMemo)((()=>_r()([...(0,Ca.QN)(d),...u]).filter((e=>{var t;return!p[e]||(null==(t=p[e])?void 0:t.isPending)}))),[d,u,p]),C=null!=t?t:v[0],[S,x]=(0,o.useState)(C),[k,Z]=(0,o.useState)([]),[R,T]=(0,o.useState)({filters:{}}),F=u.filter((e=>!p[e])),D=e=>{const t=p[e];null!=t&&t.isPending&&clearTimeout(t.timerId),f((t=>({...t,[e]:null})))},_=()=>Object.keys(c),[E,I]=(0,o.useState)(_()),M=e=>[`${e}-${la.configuration.key}`,`${e}-${la.settings.key}`],[O,P]=(0,o.useState)(M(C)),N=(0,o.useCallback)((e=>{const t=(0,Ca.W6)(e);h([...u,t]),x(t),g(!1),I([...E,t]),P(M(t))}),[u,E,x,I,h]);((e,t,n)=>{const i=(0,ya.D)(e);(0,o.useEffect)((()=>{n&&e&&!i&&t(Mr.BE.NATIVE_FILTER)}),[n,e,i,t])})(e,N,n),((e,t,n,i)=>{(0,o.useEffect)((()=>{const r=e[t];if(r&&!r.isPending){const r=n.flat().find((n=>!e[n]&&n!==t));r&&i(r)}}),[t,e,n,i])})(p,S,E,x);const j=(0,Ca.EJ)(f,I,g),q=(e=!1)=>{h([]),x(C),f({}),g(!1),T({filters:{}}),Z([]),v.length>0&&P(M(v[0])),e||I(_()),a.resetFields(["filters"]),a.setFieldsValue({changed:!1})},z=(0,o.useCallback)((e=>{const t=R.filters[e],n=c[e];return t&&"name"in t&&t.name||t&&"title"in t&&t.title||n&&"name"in n&&n.name||n&&"title"in n&&n.title||(0,l.t)("[untitled]")}),[c,R.filters]),A=(0,o.useCallback)((e=>{var t;if(p[e])return!1;const n=(null==(t=a.getFieldValue("filters"))?void 0:t[e])||c[e];return n&&"filterType"in n&&Ta.includes(n.filterType)}),[c,a,p]),$=(0,o.useCallback)((e=>v.filter((t=>t!==e)).filter((e=>A(e))).map((e=>({label:z(e),value:e})))),[A,v,z]),U=(0,o.useCallback)((()=>{const e=a.getFieldsError(),t=[];e.forEach((e=>{const n=e.name[1];e.errors.length>0&&!t.includes(n)&&t.push(n)})),!t.length&&k.length>0?Z([]):t.length>0&&!Hi()(Fr()(k),Fr()(t))&&Z(t)}),[a,k]),L=async()=>{const e=await(0,Ca.G$)(a,S,x);U(),e?((e=>{Object.keys(c).forEach((e=>{const t=c[e];if(!("cascadeParentIds"in t))return;const{cascadeParentIds:n}=t;n&&(t.cascadeParentIds=n.filter((e=>A(e))))}));const t=null==e?void 0:e.filters;t&&Object.keys(t).forEach((e=>{const n=t[e];if(!("dependencies"in n))return;const{dependencies:i}=n;i&&(n.dependencies=i.filter((e=>A(e))))}))})(e),(0,Ca.GA)(c,E,p,i,e)(),q(!0)):s.current.changeTab("configuration")},V=()=>{q(),r()},B=()=>{const e=a.getFieldValue("changed"),t=_(),n=E.length!==t.length||E.some(((e,n)=>e!==t[n]));F.length>0||a.isFieldsTouched()||e||n?g(!0):V()},W=(0,o.useCallback)((()=>{const e=new Map,t=a.getFieldValue("filters");return t&&Object.keys(t).forEach((n=>{const i=t[n],r=c[n];let o=[];i&&"dependencies"in i?o=[...i.dependencies]:r&&r.cascadeParentIds&&(o=[...r.cascadeParentIds]),e.set(n,o)})),e}),[c,a]),H=()=>{const e=W();v.filter((e=>!p[e])).forEach((t=>{const n={name:["filters",t,"dependencies"],errors:(0,Ca.uh)(e,t)?[(0,l.t)("Cyclic dependency detected")]:[]};a.setFields([n])})),U()},G=e=>{const t=W(),n=E.filter((t=>t!==e&&A(t))),i=n.find((n=>{const i=t.get(e)||[];return i.push(n),!(0,Ca.uh)(t,e)||(i.pop(),!1)}));return i||n[0]},Y=(0,o.useMemo)((()=>w()(((e,t)=>{const n=e.filters&&Object.values(e.filters).some((e=>e.name&&null!==e.name)),i=e.filters&&Object.values(e.filters).some((e=>e.title&&null!==e.title));(n||i)&&T(t),g(!1),U()}),Er.M)),[U]);return(0,o.useEffect)((()=>{Z((e=>e.filter((e=>!p[e]))))}),[p]),(0,b.tZ)(wa,{visible:e,maskClosable:!1,title:(0,l.t)("Add and edit filters"),width:"50%",destroyOnClose:!0,onCancel:B,onOk:L,centered:!0,footer:(0,b.tZ)(ba,{onDismiss:()=>g(!1),onCancel:B,handleSave:L,canSave:!k.length,saveAlertVisible:m,onConfirmCancel:V})},(0,b.tZ)(y.Z,null,(0,b.tZ)(ka,null,(0,b.tZ)(Za,{form:a,onValuesChange:Y,layout:"vertical"},(0,b.tZ)(so,{erroredFilters:k,onRemove:j,onAdd:N,onChange:e=>{x(e),P(M(e))},getFilterTitle:z,currentFilterId:S,removedFilters:p,restoreFilter:D,onRearrange:(e,t)=>{const n=[...E],i=n.splice(e,1)[0];n.splice(t,0,i),I(n)},filters:E},(e=>(e=>e.startsWith(Ca.Ky)?(0,b.tZ)(xa,{componentId:e,divider:c[e]}):(0,b.tZ)(fa,{ref:s,form:a,filterId:e,filterToEdit:c[e],removedFilters:p,restoreFilter:D,getAvailableFilters:$,key:e,activeFilterPanelKeys:O,handleActiveFilterPanelChange:e=>P(e),isActive:S===e,setErroredFilters:Z,validateDependencies:H,getDependencySuggestion:G}))(e)))))))}const Da=({isOpen:e,chartId:t,onClose:n})=>{var i,a;const s=(0,r.I0)(),[d]=K.qz.useForm(),c=(0,r.v9)((({dashboardInfo:e})=>{var t;return null==e||null==(t=e.metadata)?void 0:t.chart_configuration})),u=null==c||null==(i=c[t])||null==(a=i.crossFilters)?void 0:a.scope,h=()=>{s((0,Fi.Aw)({...c,[t]:{id:t,crossFilters:{scope:d.getFieldValue("scope")}}})),n()};return(0,b.tZ)(li.o,{visible:e,maskClosable:!1,title:(0,l.t)("Cross Filter Scoping"),width:"55%",destroyOnClose:!0,onCancel:n,onOk:h,centered:!0,footer:(0,b.tZ)(o.Fragment,null,(0,b.tZ)(B.Z,{key:"cancel",buttonStyle:"secondary",onClick:n},(0,l.t)("Cancel")),(0,b.tZ)(B.Z,{key:"submit",buttonStyle:"primary",onClick:h},(0,l.t)("Save")))},(0,b.tZ)(Za,{preserve:!1,form:d,layout:"vertical"},(0,b.tZ)(Rr,{form:d,scope:u,chartId:t})))};var _a=n(54076);const Ea=e=>{if((0,d.c)(d.T.DASHBOARD_EDIT_CHART_IN_NEW_TAB))return e?(0,l.t)("Click to edit %s in a new tab",e):(0,l.t)("Click to edit chart.");const t="MacOS"===(0,_a.fV)(),n=e?(0,l.t)("Click to edit %s.",e):(0,l.t)("Click to edit chart."),i=(0,l.t)("Use %s to open in a new tab.",t?" + click":"ctrl + click");return(0,b.tZ)(o.Fragment,null,(0,b.tZ)("div",null,n),(0,b.tZ)("div",null,i))};var Ia=n(15423),Ma=n(95345);const Oa="cross_filter_scoping",Pa="download_as_image",Na="explore_chart",ja="export_csv",qa="export_full_csv",za="force_refresh",Aa="fullscreen",$a="toggle_chart_description",Ua=v.iK.div`
  padding: ${({theme:e})=>e.gridUnit/4}px
    ${({theme:e})=>1.5*e.gridUnit}px;

  .dot {
    display: block;
  }

  &:hover {
    cursor: pointer;
  }
`,La=v.iK.div`
  height: auto;
  margin: ${({theme:e})=>e.gridUnit}px 0;
  color: ${({theme:e})=>e.colors.grayscale.base};
  line-height: 21px;
  display: flex;
  flex-direction: column;
  align-items: flex-start;
  justify-content: flex-start;
`,Va=()=>(0,b.tZ)(Ua,null,(0,b.tZ)("span",{className:"dot"}),(0,b.tZ)("span",{className:"dot"}),(0,b.tZ)("span",{className:"dot"})),Ka=b.iv`
  &&.anticon > .anticon:first-child {
    margin-right: 0;
    vertical-align: 0;
  }
`;class Ba extends o.PureComponent{constructor(e){super(e),this.toggleControls=this.toggleControls.bind(this),this.refreshChart=this.refreshChart.bind(this),this.handleMenuClick=this.handleMenuClick.bind(this),this.state={showControls:!1,showCrossFilterScopingModal:!1}}refreshChart(){this.props.updatedDttm&&this.props.forceRefresh(this.props.slice.slice_id,this.props.dashboardId)}toggleControls(){this.setState((e=>({showControls:!e.showControls})))}handleMenuClick({key:e,domEvent:t}){switch(e){case za:this.refreshChart(),this.props.addSuccessToast((0,l.t)("Data refreshed"));break;case Oa:this.setState({showCrossFilterScopingModal:!0});break;case $a:this.props.toggleExpandSlice&&this.props.toggleExpandSlice(this.props.slice.slice_id);break;case Na:this.props.logExploreChart&&this.props.logExploreChart(this.props.slice.slice_id);break;case ja:this.props.exportCSV&&this.props.exportCSV(this.props.slice.slice_id);break;case Aa:this.props.handleToggleFullSize();break;case qa:this.props.exportFullCSV&&this.props.exportFullCSV(this.props.slice.slice_id);break;case Pa:{const e=document.querySelector(".ant-dropdown:not(.ant-dropdown-hidden)");e.style.visibility="hidden",(0,On.Z)((n=this.props.slice.slice_id,`.dashboard-chart-id-${n}`),this.props.slice.slice_name,!0)(t).then((()=>{e.style.visibility="visible"}));break}}var n}render(){var e;const{componentId:t,dashboardId:n,slice:i,isFullSize:r,cachedDttm:a=[],updatedDttm:s=null,addSuccessToast:c=(()=>{}),addDangerToast:u=(()=>{}),supersetCanShare:h=!1,isCached:p=[]}=this.props,f=(0,tr.Z)().items,m="table"===i.viz_type,g=Object.entries(f).filter((([,{value:e}])=>{var t;return null==(t=e.behaviors)?void 0:t.includes(nr.cg.INTERACTIVE_CHART)})).find((([e])=>e===i.viz_type)),v=null==(e=i.form_data)?void 0:e.emit_filter,y=(a||[]).map((e=>ot().utc(e).fromNow())),C=s?ot().utc(s).fromNow():"",S=[...new Set(p.map((e=>e?(0,l.t)("Cached %s",y):C?(0,l.t)("Fetched %s",C):""))||"")],x=S.map(((e,t)=>(0,b.tZ)("div",{key:`tooltip-${t}`},S.length>1?(0,l.t)("Query %s: %s",t+1,e):e))),w=r?(0,l.t)("Exit fullscreen"):(0,l.t)("Enter fullscreen"),k=(0,b.tZ)(mt.v,{onClick:this.handleMenuClick,selectable:!1},(0,b.tZ)(mt.v.Item,{key:za,disabled:"loading"===this.props.chartStatus,style:{height:"auto",lineHeight:"initial"}},(0,l.t)("Force refresh"),(0,b.tZ)(La,null,x)),(0,b.tZ)(mt.v.Item,{key:Aa},w),(0,b.tZ)(mt.v.Divider,null),i.description&&(0,b.tZ)(mt.v.Item,{key:$a},this.props.isDescriptionExpanded?(0,l.t)("Hide chart description"):(0,l.t)("Show chart description")),this.props.supersetCanExplore&&(0,b.tZ)(mt.v.Item,{key:Na,onClick:({domEvent:e})=>this.props.onExploreChart(e)},(0,b.tZ)(ct.u,{title:Ea(this.props.slice.slice_name)},(0,l.t)("Edit chart"))),this.props.supersetCanExplore&&(0,b.tZ)(mt.v.Item,{key:"view_query"},(0,b.tZ)(St.Z,{triggerNode:(0,b.tZ)("span",null,(0,l.t)("View query")),modalTitle:(0,l.t)("View query"),modalBody:(0,b.tZ)(Ia.Z,{latestQueryFormData:this.props.formData}),draggable:!0,resizable:!0,responsive:!0})),this.props.supersetCanExplore&&(0,b.tZ)(mt.v.Item,{key:"view_results"},(0,b.tZ)(St.Z,{triggerNode:(0,b.tZ)("span",null,(0,l.t)("View as table")),modalTitle:(0,l.t)("Chart Data: %s",i.slice_name),modalBody:(0,b.tZ)(Ma.Tg,{queryFormData:this.props.formData,queryForce:!1,dataSize:20,isRequest:!0,isVisible:!0}),modalFooter:(0,b.tZ)(B.Z,{buttonStyle:"secondary",buttonSize:"small",onClick:this.props.onExploreChart},(0,l.t)("Edit chart")),draggable:!0,resizable:!0,responsive:!0})),(i.description||this.props.supersetCanExplore)&&(0,b.tZ)(mt.v.Divider,null),(0,st.cr)(d.T.DASHBOARD_CROSS_FILTERS)&&g&&v&&(0,b.tZ)(o.Fragment,null,(0,b.tZ)(mt.v.Item,{key:Oa},(0,l.t)("Cross-filter scoping")),(0,b.tZ)(mt.v.Divider,null)),h&&(0,b.tZ)(mt.v.SubMenu,{title:(0,l.t)("Share")},(0,b.tZ)(Ct,{dashboardId:n,dashboardComponentId:t,copyMenuItemTitle:(0,l.t)("Copy permalink to clipboard"),emailMenuItemTitle:(0,l.t)("Share chart by email"),emailSubject:(0,l.t)("Superset chart"),emailBody:(0,l.t)("Check out this chart: "),addSuccessToast:c,addDangerToast:u})),"filter_box"!==this.props.slice.viz_type&&this.props.supersetCanCSV&&(0,b.tZ)(mt.v.SubMenu,{title:(0,l.t)("Download")},(0,b.tZ)(mt.v.Item,{key:ja,icon:(0,b.tZ)(W.Z.FileOutlined,{css:Ka})},(0,l.t)("Export to .CSV")),"filter_box"!==this.props.slice.viz_type&&(0,st.cr)(d.T.ALLOW_FULL_CSV_EXPORT)&&this.props.supersetCanCSV&&m&&(0,b.tZ)(mt.v.Item,{key:qa,icon:(0,b.tZ)(W.Z.FileOutlined,{css:Ka})},(0,l.t)("Export to full .CSV")),(0,b.tZ)(mt.v.Item,{key:Pa,icon:(0,b.tZ)(W.Z.FileImageOutlined,{css:Ka})},(0,l.t)("Download as image"))));return(0,b.tZ)(o.Fragment,null,(0,b.tZ)(Da,{chartId:i.slice_id,isOpen:this.state.showCrossFilterScopingModal,onClose:()=>this.setState({showCrossFilterScopingModal:!1})}),r&&(0,b.tZ)(W.Z.FullscreenExitOutlined,{style:{fontSize:22},onClick:()=>{this.props.handleToggleFullSize()}}),(0,b.tZ)(ir.$,{overlay:k,trigger:["click"],placement:"bottomRight"},(0,b.tZ)("span",{id:`slice_${i.slice_id}-controls`,role:"button","aria-label":"More Options"},(0,b.tZ)(Va,null))))}}const Wa=Ba;var Ha=n(87185),Ga=n.n(Ha);const Ya={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm193.5 301.7l-210.6 292a31.8 31.8 0 01-51.7 0L318.5 484.9c-3.8-5.3 0-12.7 6.5-12.7h46.9c10.2 0 19.9 4.9 25.9 13.3l71.2 98.8 157.2-218c6-8.3 15.6-13.3 25.9-13.3H699c6.5 0 10.3 7.4 6.5 12.7z"}}]},name:"check-circle",theme:"filled"};var Ja=n(27029),Qa=function(e,t){return o.createElement(Ja.Z,Object.assign({},e,{ref:t,icon:Ya}))};Qa.displayName="CheckCircleFilled";const Xa=o.forwardRef(Qa),es={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm-32 232c0-4.4 3.6-8 8-8h48c4.4 0 8 3.6 8 8v272c0 4.4-3.6 8-8 8h-48c-4.4 0-8-3.6-8-8V296zm32 440a48.01 48.01 0 010-96 48.01 48.01 0 010 96z"}}]},name:"exclamation-circle",theme:"filled"};var ts=function(e,t){return o.createElement(Ja.Z,Object.assign({},e,{ref:t,icon:es}))};ts.displayName="ExclamationCircleFilled";const ns=o.forwardRef(ts),is={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm192 472c0 4.4-3.6 8-8 8H328c-4.4 0-8-3.6-8-8v-48c0-4.4 3.6-8 8-8h368c4.4 0 8 3.6 8 8v48z"}}]},name:"minus-circle",theme:"filled"};var rs=function(e,t){return o.createElement(Ja.Z,Object.assign({},e,{ref:t,icon:is}))};rs.displayName="MinusCircleFilled";const os=o.forwardRef(rs);var as=n(76697);const ss=v.iK.div`
  ${({theme:e})=>b.iv`
    display: inline-block;
    color: ${e.colors.grayscale.light5};
    background: ${e.colors.grayscale.base};
    border-radius: 1em;
    vertical-align: text-top;
    padding: ${e.gridUnit}px ${2*e.gridUnit}px;
    font-size: ${e.typography.sizes.m}px;
    font-weight: ${e.typography.weights.bold};
    min-width: 1em;
    min-height: 1em;
    line-height: 1em;
    vertical-align: middle;
    white-space: nowrap;

    svg {
      position: relative;
      top: -2px;
      color: ${e.colors.grayscale.light5};
      width: 1em;
      height: 1em;
      display: inline-block;
      vertical-align: middle;
    }

    &:hover {
      cursor: pointer;
      background: ${e.colors.grayscale.dark1};
    }

    &.has-cross-filters {
      background: ${e.colors.primary.base};
      &:hover {
        background: ${e.colors.primary.dark1};
      }
    }

    &.has-incompatible-filters {
      color: ${e.colors.grayscale.dark2};
      background: ${e.colors.alert.base};
      &:hover {
        background: ${e.colors.alert.dark1};
      }
      svg {
        color: ${e.colors.grayscale.dark2};
      }
    }

    &.filters-inactive {
      color: ${e.colors.grayscale.light5};
      background: ${e.colors.grayscale.light1};
      padding: ${e.gridUnit}px;
      text-align: center;
      height: 22px;
      width: 22px;

      &:hover {
        background: ${e.colors.grayscale.base};
      }
    }
  `}
`,ls=v.iK.span`
  position: relative;
  margin-right: ${({theme:e})=>e.gridUnit}px;
  font-weight: ${({bold:e,theme:t})=>e?t.typography.weights.bold:"auto"};
  color: ${({color:e,theme:t})=>e||t.colors.grayscale.light5};
  display: flex;
  align-items: center;
  & > * {
    margin-right: ${({theme:e})=>e.gridUnit}px;
  }
`,ds=v.iK.i`
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  left: -${({theme:e})=>5*e.gridUnit}px;
`,cs=v.iK.button`
  cursor: pointer;
  display: flex;
  flex-wrap: wrap;
  text-align: left;
  padding: 0;
  border: none;
  background: none;
  outline: none;
  width: 100%;

  &::-moz-focus-inner {
    border: 0;
  }

  & i svg {
    color: transparent;
    margin-right: ${({theme:e})=>e.gridUnit}px;
  }

  &:hover i svg {
    color: inherit;
  }
`,us=v.iK.div`
  margin: 0 -${({theme:e})=>4*e.gridUnit}px;
`,hs=v.iK.div`
  padding-left: ${({theme:e})=>6*e.gridUnit}px;
  margin: -${({theme:e})=>3*e.gridUnit}px 0;
`,ps=v.iK.div`
  min-width: 200px;
  max-width: 300px;
  overflow-x: hidden;
`,fs=v.iK.div`
  max-width: 100%;
  flex-grow: 1;
  overflow: auto;
  color: ${({theme:e})=>e.colors.grayscale.light5};
`,ms=v.iK.div`
  ${({theme:e})=>`\n  padding-top: ${3*e.gridUnit}px;\n  max-width: 100%;\n  flex-grow: 1;\n  overflow: auto;\n  color: ${e.colors.grayscale.light5};\n  `}
`;var gs=n(76570);n(14670);const vs=(0,l.t)("Please apply filter changes"),bs=e=>null==e?"":"string"==typeof e||"number"==typeof e?`${e}`:Array.isArray(e)?e.join(", "):"object"==typeof e?JSON.stringify(e):(0,l.t)("Unknown value"),ys=({filterSetFilterValues:e,dataMaskSelected:t})=>e.find((({dataMask:e={}})=>{const n=Object.entries(t);return n.every((([t,i])=>{var r;const o=(0,zi.JB)(i.filterState,null==e||null==(r=e[t])?void 0:r.filterState,{ignoreUndefined:!0,ignoreNull:!0}),a=n.length===Object.keys(null!=e?e:{}).length;return o&&a}))})),Cs=({indicator:{column:e,name:t,value:n,path:i=[]},onClick:r=(()=>{}),text:a})=>{const s=bs(n);return(0,b.tZ)(o.Fragment,null,(0,b.tZ)(cs,{onClick:()=>r([...i,`LABEL-${e}`])},(0,b.tZ)(ls,{bold:!0},(0,b.tZ)(ds,null,(0,b.tZ)(gs.Z,null)),t,s?": ":""),(0,b.tZ)(fs,null,s)),a&&(0,b.tZ)(ms,null,a))},Ss=({appliedCrossFilterIndicators:e=[],appliedIndicators:t=[],incompatibleIndicators:n=[],unsetIndicators:i=[],onHighlightFilterSource:a,children:s})=>{const[d,c]=(0,o.useState)(!1),u=(0,v.Fg)(),h=(0,r.v9)((e=>{var t;return null==(t=e.dashboardState)?void 0:t.activeTabs}));(0,o.useEffect)((()=>{d&&window.addEventListener("resize",(()=>c(!1)),{once:!0})}),[d]),(0,o.useEffect)((()=>{c(!1)}),[h]);const p=()=>{const i=[];return e.length&&i.push("appliedCrossFilters"),t.length&&i.push("applied"),n.length&&i.push("incompatible"),i.length?i:["unset"]},[f,m]=(0,o.useState)((()=>[...p()])),g=e=>`${e.column} - ${e.name}`,y=(0,b.tZ)(ps,null,(0,b.tZ)(b.xB,{styles:(0,b.iv)(".filterStatusPopover{.ant-popover-inner{background-color:",u.colors.grayscale.dark2,"cc;.ant-popover-inner-content{padding-top:0;padding-bottom:0;}}&.ant-popover-placement-bottom,&.ant-popover-placement-bottomLeft,&.ant-popover-placement-bottomRight{&>.ant-popover-content>.ant-popover-arrow{border-top-color:",u.colors.grayscale.dark2,"cc;border-left-color:",u.colors.grayscale.dark2,"cc;}}&.ant-popover-placement-top,&.ant-popover-placement-topLeft,&.ant-popover-placement-topRight{&>.ant-popover-content>.ant-popover-arrow{border-bottom-color:",u.colors.grayscale.dark2,"cc;border-right-color:",u.colors.grayscale.dark2,"cc;}}&.ant-popover-placement-left,&.ant-popover-placement-leftTop,&.ant-popover-placement-leftBottom{&>.ant-popover-content>.ant-popover-arrow{border-top-color:",u.colors.grayscale.dark2,"cc;border-right-color:",u.colors.grayscale.dark2,"cc;}}&.ant-popover-placement-right,&.ant-popover-placement-rightTop,&.ant-popover-placement-rightBottom{&>.ant-popover-content>.ant-popover-arrow{border-bottom-color:",u.colors.grayscale.dark2,"cc;border-left-color:",u.colors.grayscale.dark2,"cc;}}&.ant-popover{color:",u.colors.grayscale.light4,";z-index:99;}}","")}),(0,b.tZ)(us,null,(0,b.tZ)(lo.Z,{ghost:!0,light:!0,activeKey:f,onChange:function(e){m("string"==typeof e?[e]:e)}},e.length?(0,b.tZ)(lo.Z.Panel,{key:"appliedCrossFilters",header:(0,b.tZ)(ls,{bold:!0,color:u.colors.primary.light1},(0,b.tZ)(W.Z.CursorTarget,{css:(0,b.iv)({fill:u.colors.primary.light1},"",""),iconSize:"xl"}),(0,l.t)("Applied Cross Filters (%d)",e.length))},(0,b.tZ)(hs,{css:(0,b.iv)({paddingBottom:3*u.gridUnit},"","")},e.map((e=>(0,b.tZ)(Cs,{key:g(e),indicator:e,onClick:a}))))):null,t.length?(0,b.tZ)(lo.Z.Panel,{key:"applied",header:(0,b.tZ)(ls,{bold:!0,color:u.colors.success.base},(0,b.tZ)(Xa,null)," ",(0,l.t)("Applied Filters (%d)",t.length))},(0,b.tZ)(hs,{css:(0,b.iv)({paddingBottom:3*u.gridUnit},"","")},t.map((e=>(0,b.tZ)(Cs,{key:g(e),indicator:e,onClick:a}))))):null,n.length?(0,b.tZ)(lo.Z.Panel,{key:"incompatible",header:(0,b.tZ)(ls,{bold:!0,color:u.colors.alert.base},(0,b.tZ)(ns,null)," ",(0,l.t)("Incompatible Filters (%d)",n.length))},(0,b.tZ)(hs,{css:(0,b.iv)({paddingBottom:3*u.gridUnit},"","")},n.map((e=>(0,b.tZ)(Cs,{key:g(e),indicator:e,onClick:a}))))):null,i.length?(0,b.tZ)(lo.Z.Panel,{key:"unset",header:(0,b.tZ)(ls,{bold:!0,color:u.colors.grayscale.light1},(0,b.tZ)(os,null)," ",(0,l.t)("Unset Filters (%d)",i.length)),disabled:!i.length},(0,b.tZ)(hs,{css:(0,b.iv)({paddingBottom:3*u.gridUnit},"","")},i.map((e=>(0,b.tZ)(Cs,{key:g(e),indicator:e,onClick:a}))))):null)));return(0,b.tZ)(as.ZP,{overlayClassName:"filterStatusPopover",content:y,visible:d,onVisibleChange:function(e){c(e),e&&m(p())},placement:"bottomRight",trigger:"click"},s)};var xs;!function(e){e.Unset="UNSET",e.Applied="APPLIED",e.Incompatible="INCOMPATIBLE",e.CrossFilterApplied="CROSS_FILTER_APPLIED"}(xs||(xs={}));const ws=new Set(Object.values(Y.i2)),ks=e=>null!=e&&e.label?e.label:null!=e&&e.value?(0,br.Z)(null==e?void 0:e.value).join(", "):null,Zs=(e,t,n)=>{const i=t.columns[e],r=Array.isArray(i)?i:[i];if(null==i||t.isDateFilter&&i===Y.vM||0===r.length)return[];if(t.isDateFilter&&ws.has(e)){const t=((e===Y.i2.time_grain_sqla?n.time_grain_sqla:n.granularity)||[]).reduce(((e,[t,n])=>({...e,[t]:n})),{});return r.map((e=>t[e]||e))}return r},Rs=e=>{var t,n;return new Set(((null==e||null==(t=e.queriesResponse)||null==(n=t[0])?void 0:n.applied_filters)||[]).map((e=>e.column)))},Ts=e=>{var t,n;return new Set(((null==e||null==(t=e.queriesResponse)||null==(n=t[0])?void 0:n.rejected_filters)||[]).map((e=>e.column)))},Fs={},Ds={},_s={},Es={},Is={},Ms=[],Os=({chartId:e})=>{var t,n;const i=(0,r.I0)(),a=(0,r.v9)((e=>e.datasources)),s=(0,r.v9)((e=>e.dashboardFilters)),l=(0,r.v9)((e=>{var t;return null==(t=e.nativeFilters)?void 0:t.filters})),c=(0,r.v9)((e=>e.dashboardInfo)),u=(0,r.v9)((e=>e.charts)),p=(0,r.v9)((e=>e.dashboardLayout.present)),f=(0,r.v9)((e=>e.dataMask)),[g,v]=(0,o.useState)(Ms),[y,C]=(0,o.useState)(Ms),S=(0,o.useCallback)((e=>{i((0,Lt.E2)(e))}),[i]),x=u[e],w=(0,ya.D)(x),k=null==w?void 0:w.chartStatus,Z=(0,ya.D)(s),R=(0,ya.D)(a),T=(null==x?void 0:x.chartStatus)&&["rendered","success"].includes(x.chartStatus);(0,o.useEffect)((()=>{if(!T&&y.length>0)C(Ms);else if("success"!==k){var t,n,i,r,o,l,d,c;(null==x||null==(t=x.queriesResponse)||null==(n=t[0])?void 0:n.rejected_filters)===(null==w||null==(i=w.queriesResponse)||null==(r=i[0])?void 0:r.rejected_filters)&&(null==x||null==(o=x.queriesResponse)||null==(l=o[0])?void 0:l.applied_filters)===(null==w||null==(d=w.queriesResponse)||null==(c=d[0])?void 0:c.applied_filters)&&s===Z&&a===R||C(((e,t,n,i)=>{const r=Rs(i),o=Ts(i),a=Object.values(t).filter((t=>t.chartId!==e)),s=Object.entries(n).filter((([e])=>a.find((t=>t.datasourceId===e)))).map((([,e])=>e)),l=Ds[e];if(Fs[e]&&(0,zi.JB)(null==l?void 0:l.appliedColumns,r)&&(0,zi.JB)(null==l?void 0:l.rejectedColumns,o)&&(0,zi.JB)(null==l?void 0:l.matchingFilters,a)&&(0,zi.JB)(null==l?void 0:l.matchingDatasources,s))return Fs[e];const d=a.reduce(((t,i)=>t.concat(((e,t,n,i,r)=>{const o=(e,t)=>i.has(e)&&t.columns[e]?xs.Applied:r.has(e)?xs.Incompatible:xs.Unset;return Object.keys(t.columns).filter((n=>(0,hn.up)({filterScope:t.scopes[n]}).includes(e))).map((e=>({column:e,name:t.labels[e]||e,value:Zs(e,t,n),status:o(e,t),path:t.directPathToFilter})))})(e,i,n[i.datasourceId]||{},r,o))),[]);return d.sort(((e,t)=>e.name.localeCompare(t.name))),Fs[e]=d,Ds[e]={appliedColumns:r,rejectedColumns:o,matchingFilters:a,matchingDatasources:s},d})(e,s,a,x))}}),[x,e,s,y.length,a,null==w?void 0:w.queriesResponse,k,Z,R,T]);const F=(0,ya.D)(l),D=(0,ya.D)(p),_=(0,ya.D)(f),E=(0,ya.D)(null==(t=c.metadata)?void 0:t.chart_configuration);(0,o.useEffect)((()=>{if(!T&&g.length>0)v(Ms);else if("success"!==k){var t,n,i,r,o,a,s,u,m,b;(null==x||null==(t=x.queriesResponse)||null==(n=t[0])?void 0:n.rejected_filters)===(null==w||null==(i=w.queriesResponse)||null==(r=i[0])?void 0:r.rejected_filters)&&(null==x||null==(o=x.queriesResponse)||null==(a=o[0])?void 0:a.applied_filters)===(null==w||null==(s=w.queriesResponse)||null==(u=s[0])?void 0:u.applied_filters)&&l===F&&p===D&&f===_&&E===(null==(m=c.metadata)?void 0:m.chart_configuration)||v(((e,t,n,i,r,o=Is)=>{const a=Rs(i),s=Ts(i),l=Es[n];if(_s[n]&&(0,zi.JB)(null==l?void 0:l.appliedColumns,a)&&(0,zi.JB)(null==l?void 0:l.rejectedColumns,s)&&(null==l?void 0:l.nativeFilters)===e&&(null==l?void 0:l.dashboardLayout)===r&&(null==l?void 0:l.chartConfiguration)===o&&(null==l?void 0:l.dataMask)===t)return _s[n];const c=({label:e,column:t,type:n=Mr.gT.NativeFilters})=>{const i=null!==e;return n===Mr.gT.CrossFilters&&i?xs.CrossFilterApplied:!t&&i?xs.Applied:t&&s.has(t)?xs.Incompatible:t&&a.has(t)&&i?xs.Applied:xs.Unset};let u=[];(0,d.c)(d.T.DASHBOARD_NATIVE_FILTERS)&&(u=e&&Object.values(e).filter((e=>{var t;return e.type===Mr.BE.NATIVE_FILTER&&(null==(t=e.chartsInScope)?void 0:t.includes(n))})).map((e=>{var n,i,r,o;const a=null==(n=e.targets)||null==(i=n[0])||null==(r=i.column)?void 0:r.name,s=null==(o=t[e.id])?void 0:o.filterState,l=ks(s);return{column:a,name:e.name,path:[e.id],status:c({label:l,column:a}),value:l}})));let p=[];if((0,d.c)(d.T.DASHBOARD_CROSS_FILTERS)){const e=Object.values(r),i=e.find((e=>{var t;return(null==e||null==(t=e.meta)?void 0:t.chartId)===n}));p=Object.values(o).filter((e=>!e.crossFilters.scope.excluded.includes(n)&&e.crossFilters.scope.rootPath.some((e=>{var t;return(null==i?void 0:i.type)===h.dW&&(null==i||null==(t=i.parents)?void 0:t.includes(e))})))).map((n=>{var i,r,o;const a=null==(i=t[n.id])?void 0:i.filterState,s=ks(a),l=null==a?void 0:a.filters,d=l&&Object.keys(l)[0],u=e.find((e=>{var t;return(null==e||null==(t=e.meta)?void 0:t.chartId)===n.id}));return{column:d,name:null==u||null==(r=u.meta)?void 0:r.sliceName,path:[...null!=(o=null==u?void 0:u.parents)?o:[],null==u?void 0:u.id],status:c({label:s,type:Mr.gT.CrossFilters}),value:s}})).filter((e=>e.status===xs.CrossFilterApplied))}const f=p.concat(u);return _s[n]=f,Es[n]={nativeFilters:e,dashboardLayout:r,chartConfiguration:o,dataMask:t,appliedColumns:a,rejectedColumns:s},f})(l,f,e,x,p,null==(b=c.metadata)?void 0:b.chart_configuration))}}),[x,e,null==(n=c.metadata)?void 0:n.chart_configuration,f,l,g.length,p,null==w?void 0:w.queriesResponse,E,k,D,_,F,T]);const I=(0,o.useMemo)((()=>Ga()((e=>{const t=[xs.Applied,xs.Unset,xs.Incompatible];return e.sort(((e,n)=>t.indexOf(e.status)-t.indexOf(n.status)))})([...y,...g]),((e,t)=>e.column===t.column&&e.name===t.name&&(e.status!==xs.Applied||t.status!==xs.Applied)))),[y,g]),M=(0,o.useMemo)((()=>I.filter((e=>e.status===xs.CrossFilterApplied))),[I]),O=(0,o.useMemo)((()=>I.filter((e=>e.status===xs.Applied))),[I]),P=(0,o.useMemo)((()=>I.filter((e=>e.status===xs.Unset))),[I]),N=(0,o.useMemo)((()=>I.filter((e=>e.status===xs.Incompatible))),[I]);if(!(M.length||O.length||N.length||P.length))return null;const j=!M.length&&!O.length&&!N.length;return(0,b.tZ)(Ss,{appliedCrossFilterIndicators:M,appliedIndicators:O,unsetIndicators:P,incompatibleIndicators:N,onHighlightFilterSource:S},(0,b.tZ)(ss,{className:m()("filter-counts",!!N.length&&"has-incompatible-filters",!!M.length&&"has-cross-filters",j&&"filters-inactive")},(0,b.tZ)(W.Z.Filter,{iconSize:"m"}),!j&&(0,b.tZ)("span",null,O.length+M.length),N.length?(0,b.tZ)(o.Fragment,null," ",(0,b.tZ)(W.Z.AlertSolid,null),(0,b.tZ)("span",null,N.length)):null))},Ps=o.memo(Os),Ns=(0,l.t)("Annotation layers are still loading."),js=(0,l.t)("One ore more annotation layers failed loading."),qs=(0,v.iK)(W.Z.CursorTarget)`
  cursor: pointer;
  color: ${({theme:e})=>e.colors.primary.base};
  height: 22px;
  width: 22px;
`,zs=({innerRef:e=null,forceRefresh:t=(()=>({})),updateSliceName:n=(()=>({})),toggleExpandSlice:i=(()=>({})),logExploreChart:a=(()=>({})),onExploreChart:s,exportCSV:d=(()=>({})),editMode:c=!1,annotationQuery:u={},annotationError:h={},cachedDttm:p=null,updatedDttm:f=null,isCached:m=[],isExpanded:g=!1,sliceName:v="",supersetCanExplore:y=!1,supersetCanShare:C=!1,supersetCanCSV:S=!1,sliceCanEdit:x=!1,exportFullCSV:w,slice:k,componentId:Z,dashboardId:R,addSuccessToast:T,addDangerToast:F,handleToggleFullSize:D,isFullSize:_,chartStatus:E,formData:I,width:M,height:O})=>{const P=(0,r.I0)(),N=(0,Xi.fG)(),[j,q]=(0,o.useState)(null),z=(0,o.useRef)(null),A=(0,r.v9)((e=>{var t,n;return null==(t=e.dataMask[null==k?void 0:k.slice_id])||null==(n=t.filterState)?void 0:n.value})),$=(0,o.useMemo)((()=>({value:A,name:(0,l.t)("Emitted values")})),[A]),U=!c&&y?s:void 0;return(0,o.useEffect)((()=>{const e=z.current;U?q(Ea(v)):e&&(e.scrollWidth>e.offsetWidth||e.scrollHeight>e.offsetHeight)?q(null!=v?v:null):q(null)}),[v,M,O,U]),(0,b.tZ)("div",{className:"chart-header",ref:e},(0,b.tZ)("div",{className:"header-title",ref:z},(0,b.tZ)(ct.u,{title:j},(0,b.tZ)(er.Z,{title:v||(c?"---":""),canEdit:c,emptyText:"",onSaveTitle:n,showTooltip:!1,onClickTitle:U})),!!Object.values(u).length&&(0,b.tZ)(ct.u,{id:"annotations-loading-tooltip",placement:"top",title:Ns},(0,b.tZ)("i",{role:"img","aria-label":Ns,className:"fa fa-refresh warning"})),!!Object.values(h).length&&(0,b.tZ)(ct.u,{id:"annoation-errors-tooltip",placement:"top",title:js},(0,b.tZ)("i",{role:"img","aria-label":js,className:"fa fa-exclamation-circle danger"}))),(0,b.tZ)("div",{className:"header-controls"},!c&&(0,b.tZ)(o.Fragment,null,A&&(0,b.tZ)(ct.u,{placement:"top",title:(0,b.tZ)(Cs,{indicator:$,text:(0,l.t)("Click to clear emitted filters")})},(0,b.tZ)(qs,{onClick:()=>P((0,it.ze)(null==k?void 0:k.slice_id))})),!N.hideChartControls&&(0,b.tZ)(Ps,{chartId:k.slice_id}),!N.hideChartControls&&(0,b.tZ)(Wa,{slice:k,isCached:m,isExpanded:g,cachedDttm:p,updatedDttm:f,toggleExpandSlice:i,forceRefresh:t,logExploreChart:a,onExploreChart:s,exportCSV:d,exportFullCSV:w,supersetCanExplore:y,supersetCanShare:C,supersetCanCSV:S,sliceCanEdit:x,componentId:Z,dashboardId:R,addSuccessToast:T,addDangerToast:F,handleToggleFullSize:D,isFullSize:_,isDescriptionExpanded:g,chartStatus:E,formData:I}))))},As={height:s().number.isRequired};function $s({height:e}){return(0,b.tZ)("div",{className:"missing-chart-container",style:{height:e+20}},(0,b.tZ)("div",{className:"missing-chart-body"},(0,l.t)("There is no chart definition associated with this component, could it have been deleted?"),(0,b.tZ)("br",null),(0,b.tZ)("br",null),(0,l.t)("Delete this container and save to remove this message.")))}$s.propTypes=As;const Us={id:s().number.isRequired,componentId:s().string.isRequired,dashboardId:s().number.isRequired,width:s().number.isRequired,height:s().number.isRequired,updateSliceName:s().func.isRequired,isComponentVisible:s().bool,handleToggleFullSize:s().func.isRequired,setControlValue:s().func,chart:G.$6.isRequired,formData:s().object.isRequired,labelColors:s().object,sharedLabelColors:s().object,datasource:s().object,slice:G.Rw.isRequired,sliceName:s().string.isRequired,timeout:s().number.isRequired,maxRows:s().number.isRequired,filterboxMigrationState:Y.Qi,filters:s().object.isRequired,refreshChart:s().func.isRequired,logEvent:s().func.isRequired,toggleExpandSlice:s().func.isRequired,changeFilter:s().func.isRequired,setFocusedFilterField:s().func.isRequired,unsetFocusedFilterField:s().func.isRequired,editMode:s().bool.isRequired,isExpanded:s().bool.isRequired,isCached:s().bool,supersetCanExplore:s().bool.isRequired,supersetCanShare:s().bool.isRequired,supersetCanCSV:s().bool.isRequired,sliceCanEdit:s().bool.isRequired,addSuccessToast:s().func.isRequired,addDangerToast:s().func.isRequired,ownState:s().object,filterState:s().object,postTransformProps:s().func,datasetsStatus:s().oneOf(["loading","error","complete"])},Ls=Object.keys(Us).filter((e=>"width"!==e&&"height"!==e&&"isComponentVisible"!==e)),Vs=new Set(["filter_box"]),Ks=v.iK.div`
  position: absolute;
  top: 0;
  left: 0;
  z-index: 5;

  &.is-deactivated {
    opacity: 0.5;
    background-color: ${({theme:e})=>e.colors.grayscale.light1};
  }
`,Bs=v.iK.div`
  display: flex;
  flex-direction: column;
  max-height: 100%;
`;class Ws extends o.Component{constructor(e){super(e),this.logExploreChart=()=>{this.props.logEvent(lt.oK,{slice_id:this.props.slice.slice_id,is_cached:this.props.isCached})},this.onExploreChart=async e=>{const t=e.shiftKey||e.ctrlKey||e.metaKey;try{const e=window.localStorage.getItem("last_tab_id"),n=e?String(Number.parseInt(e,10)+1):void 0,i=await(0,Qi.nv)(this.props.datasource.id,this.props.datasource.type,this.props.formData,this.props.slice.slice_id,n),r=(0,Yi.y8)(null,{[gt.KD.formDataKey.name]:i,[gt.KD.sliceId.name]:this.props.slice.slice_id});(0,d.c)(d.T.DASHBOARD_EDIT_CHART_IN_NEW_TAB)||t?window.open(r,"_blank","noreferrer"):this.props.history.push(r)}catch(e){bt.Z.error(e),this.props.addDangerToast((0,l.t)("An error occurred while opening Explore"))}},this.state={width:e.width,height:e.height,descriptionHeight:0},this.changeFilter=this.changeFilter.bind(this),this.handleFilterMenuOpen=this.handleFilterMenuOpen.bind(this),this.handleFilterMenuClose=this.handleFilterMenuClose.bind(this),this.exportCSV=this.exportCSV.bind(this),this.exportFullCSV=this.exportFullCSV.bind(this),this.forceRefresh=this.forceRefresh.bind(this),this.resize=this.resize.bind(this),this.setDescriptionRef=this.setDescriptionRef.bind(this),this.setHeaderRef=this.setHeaderRef.bind(this),this.getChartHeight=this.getChartHeight.bind(this),this.getDescriptionHeight=this.getDescriptionHeight.bind(this)}shouldComponentUpdate(e,t){var n,i,r,o,a;if(t.width!==this.state.width||t.height!==this.state.height||t.descriptionHeight!==this.state.descriptionHeight||!Hi()(e.datasource,this.props.datasource))return!0;if((null==(n=this.props)||null==(i=n.chart)?void 0:i.chartStatus)!==(null==e||null==(r=e.chart)?void 0:r.chartStatus)&&"loading"===(null==(o=this.props)||null==(a=o.chart)?void 0:a.chartStatus))return!0;if(e.isComponentVisible){if(e.chart.triggerQuery)return!0;if(e.isFullSize!==this.props.isFullSize)return clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout(this.resize,350),!1;e.width===this.props.width&&e.height===this.props.height||(clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout(this.resize,350));for(let t=0;t<Ls.length;t+=1){const n=Ls[t];if(!(0,zi.JB)(e[n],this.props[n]))return!0}}return this.props.cacheBusterProp!==e.cacheBusterProp}componentDidMount(){if(this.props.isExpanded){const e=this.getDescriptionHeight();this.setState({descriptionHeight:e})}}componentWillUnmount(){clearTimeout(this.resizeTimeout)}componentDidUpdate(e){if(this.props.isExpanded!==e.isExpanded){const e=this.getDescriptionHeight();this.setState({descriptionHeight:e})}}getDescriptionHeight(){return this.props.isExpanded&&this.descriptionRef?this.descriptionRef.offsetHeight:0}getChartHeight(){const e=this.getHeaderHeight();return Math.max(this.state.height-e-this.state.descriptionHeight,20)}getHeaderHeight(){if(this.headerRef){const e=getComputedStyle(this.headerRef).getPropertyValue("margin-bottom"),t=parseInt(e,10)||0;return this.headerRef.offsetHeight+t}return 22}setDescriptionRef(e){this.descriptionRef=e}setHeaderRef(e){this.headerRef=e}resize(){const{width:e,height:t}=this.props;this.setState((()=>({width:e,height:t})))}changeFilter(e={}){this.props.logEvent(lt.Qg,{id:this.props.chart.id,columns:Object.keys(e)}),this.props.changeFilter(this.props.chart.id,e)}handleFilterMenuOpen(e,t){this.props.setFocusedFilterField(e,t)}handleFilterMenuClose(e,t){this.props.unsetFocusedFilterField(e,t)}exportCSV(e=!1){this.props.logEvent(lt.PC,{slice_id:this.props.slice.slice_id,is_cached:this.props.isCached}),(0,Yi.pe)({formData:e?{...this.props.formData,row_limit:this.props.maxRows}:this.props.formData,resultType:"full",resultFormat:"csv",force:!0,ownState:this.props.ownState})}exportFullCSV(){this.exportCSV(!0)}forceRefresh(){return this.props.logEvent(lt.TD,{slice_id:this.props.slice.slice_id,is_cached:this.props.isCached}),this.props.refreshChart(this.props.chart.id,!0,this.props.dashboardId)}render(){const{id:e,componentId:t,dashboardId:n,chart:i,slice:r,datasource:o,isExpanded:a,editMode:s,filters:l,formData:d,labelColors:c,sharedLabelColors:u,updateSliceName:h,sliceName:p,toggleExpandSlice:f,timeout:g,supersetCanExplore:v,supersetCanShare:y,supersetCanCSV:C,sliceCanEdit:S,addSuccessToast:x,addDangerToast:w,ownState:k,filterState:Z,handleToggleFullSize:R,isFullSize:T,setControlValue:F,filterboxMigrationState:D,postTransformProps:_,datasetsStatus:E}=this.props,{width:I}=this.state;if(!i||!r)return(0,b.tZ)($s,{height:this.getChartHeight()});const{queriesResponse:M,chartUpdateEndTime:O,chartStatus:P}=i,N="loading"===P,j="filter_box"===r.viz_type&&[Y.Qi.REVIEWING,Y.Qi.CONVERTED].includes(D),q=(null==M?void 0:M.map((({is_cached:e})=>e)))||[],z=(null==M?void 0:M.map((({cached_dttm:e})=>e)))||[],A=Vs.has(r.viz_type),$=(0,hn.Z3)(e)?function({activeFilters:e={},filterId:t}){return Object.entries(e).reduce(((e,n)=>{const[i,{values:r}]=n,{chartId:o,column:a}=(0,Jt._)(i);return o===t?{...e,[a]:r}:e}),{})}({activeFilters:l,filterId:e}):{};return(0,b.tZ)(Bs,{className:"chart-slice","data-test-chart-id":e,"data-test-viz-type":r.viz_type,"data-test-chart-name":r.slice_name},(0,b.tZ)(zs,{innerRef:this.setHeaderRef,slice:r,isExpanded:a,isCached:q,cachedDttm:z,updatedDttm:O,toggleExpandSlice:f,forceRefresh:this.forceRefresh,editMode:s,annotationQuery:i.annotationQuery,logExploreChart:this.logExploreChart,onExploreChart:this.onExploreChart,exportCSV:this.exportCSV,exportFullCSV:this.exportFullCSV,updateSliceName:h,sliceName:p,supersetCanExplore:v,supersetCanShare:y,supersetCanCSV:C,sliceCanEdit:S,componentId:t,dashboardId:n,filters:l,addSuccessToast:x,addDangerToast:w,handleToggleFullSize:R,isFullSize:T,chartStatus:i.chartStatus,formData:d,width:I,height:this.getHeaderHeight()}),a&&r.description_markeddown&&(0,b.tZ)("div",{className:"slice_description bs-callout bs-callout-default",ref:this.setDescriptionRef,dangerouslySetInnerHTML:{__html:r.description_markeddown}}),(0,b.tZ)("div",{className:m()("dashboard-chart",A&&"dashboard-chart--overflowable")},(N||j)&&(0,b.tZ)(Ks,{className:m()(j&&"is-deactivated"),style:{width:I,height:this.getChartHeight()}}),(0,b.tZ)(Ji.Z,{width:I,height:this.getChartHeight(),addFilter:this.changeFilter,onFilterMenuOpen:this.handleFilterMenuOpen,onFilterMenuClose:this.handleFilterMenuClose,annotationData:i.annotationData,chartAlert:i.chartAlert,chartId:e,chartStatus:P,datasource:o,dashboardId:n,initialValues:$,formData:d,labelColors:c,sharedLabelColors:u,ownState:k,filterState:Z,queriesResponse:i.queriesResponse,timeout:g,triggerQuery:i.triggerQuery,vizType:r.viz_type,setControlValue:F,isDeactivatedViz:j,filterboxMigrationState:D,postTransformProps:_,datasetsStatus:E})))}}Ws.propTypes=Us,Ws.defaultProps={isCached:!1,isComponentVisible:!0};const Hs=(0,Gi.EN)(Ws);var Gs=n(9531);const Ys={},Js=(0,r.$j)((function({charts:e,dashboardInfo:t,dashboardState:n,dashboardLayout:i,dataMask:r,datasources:o,sliceEntities:a,nativeFilters:s,common:l},d){var c,u,h,p,f;const{id:m,extraControls:g,setControlValue:v}=d,b=e[m]||Ys,y=b&&b.form_data&&o[b.form_data.datasource]||Gs.tw,{colorScheme:C,colorNamespace:S,datasetsStatus:x}=n,w=(null==t||null==(c=t.metadata)?void 0:c.label_colors)||{},k=(null==t||null==(u=t.metadata)?void 0:u.shared_label_colors)||{},Z=function({chart:e,charts:t,filters:n,nativeFilters:i,chartConfiguration:r,colorScheme:o,colorNamespace:a,sliceId:s,layout:l,dataMask:d,extraControls:c,labelColors:u,sharedLabelColors:h}){const p=Ki[s];if(Vi[s]===n&&(0,zi.JB)(null==p?void 0:p.color_scheme,o,{ignoreUndefined:!0})&&(0,zi.JB)(null==p?void 0:p.color_namespace,a,{ignoreUndefined:!0})&&(0,zi.JB)(null==p?void 0:p.label_colors,u,{ignoreUndefined:!0})&&(0,zi.JB)(null==p?void 0:p.shared_label_colors,h,{ignoreUndefined:!0})&&p&&(0,zi.JB)(null==p?void 0:p.dataMask,d,{ignoreUndefined:!0})&&(0,zi.JB)(null==p?void 0:p.extraControls,c,{ignoreUndefined:!0}))return p;let f={};const m=Li({chartConfiguration:r,dataMask:d,layout:l,nativeFilters:i.filters}),g=Object.entries(m).filter((([,{scope:t}])=>t.includes(e.id))).map((([e])=>e));g.length&&(f={extra_form_data:(0,qi.vk)(d,t,g)});const v={...e.form_data,label_colors:u,shared_label_colors:h,...o&&{color_scheme:o},extra_filters:Ai(n),...f,...c};return Vi[s]=n,Ki[s]={...v,dataMask:d,extraControls:c},v}({layout:i.present,chart:b,chartConfiguration:null==(h=t.metadata)?void 0:h.chart_configuration,charts:e,filters:(0,hn._f)(m),colorScheme:C,colorNamespace:S,sliceId:m,nativeFilters:s,dataMask:r,extraControls:g,labelColors:w,sharedLabelColors:k});return Z.dashboardId=t.id,{chart:b,datasource:y,labelColors:w,sharedLabelColors:k,slice:a.slices[m],timeout:t.common.conf.SUPERSET_WEBSERVER_TIMEOUT,filters:(0,hn.De)()||Ys,formData:Z,editMode:n.editMode,isExpanded:!!n.expandedSlices[m],supersetCanExplore:!!t.superset_can_explore,supersetCanShare:!!t.superset_can_share,supersetCanCSV:!!t.superset_can_csv,sliceCanEdit:!!t.slice_can_edit,ownState:null==(p=r[m])?void 0:p.ownState,filterState:null==(f=r[m])?void 0:f.filterState,maxRows:l.conf.SQL_MAX_ROW,setControlValue:v,filterboxMigrationState:n.filterboxMigrationState,datasetsStatus:x}}),(function(e){return(0,i.DE)({updateComponents:Di.WZ,addSuccessToast:_i.ws,addDangerToast:_i.Gb,toggleExpandSlice:Lt.WL,changeFilter:Ut.M6,setFocusedFilterField:Lt.GH,unsetFocusedFilterField:Lt.oY,refreshChart:ji.refreshChart,logEvent:Ei.logEvent},e)}))(Hs);var Qs=n(13433);function Xs({dashboardId:e,anchorLinkId:t,placement:n="right",emailContent:i="",emailSubject:a=""}){const[s,d]=(0,o.useState)(""),{addDangerToast:c}=(0,di.e1)(),{dataMask:u,activeTabs:h}=(0,r.v9)((e=>({dataMask:e.dataMask,activeTabs:e.dashboardState.activeTabs}))),p=`mailto:?Subject=${a}%20&Body=${i}${s||""}`;return(0,b.tZ)(as.ZP,{trigger:"click",placement:n,content:(0,b.tZ)("div",{id:"shorturl-popover",onClick:e=>{e.stopPropagation()}},(0,b.tZ)(Qs.Z,{text:s,copyNode:(0,b.tZ)("i",{className:"fa fa-clipboard",title:(0,l.t)("Copy to clipboard")})}),"",(0,b.tZ)("a",{href:p},(0,b.tZ)("i",{className:"fa fa-envelope"})))},(0,b.tZ)("span",{className:"short-link-trigger btn btn-default btn-sm",tabIndex:0,role:"button",onClick:n=>{n.stopPropagation(),(async()=>{try{const n=await(0,yt.Nm)({dashboardId:e,dataMask:u,activeTabs:h,anchor:t});d(n)}catch(e){e&&c((await(0,wo.O)(e)).error||(0,l.t)("Something went wrong."))}})()}},(0,b.tZ)("i",{className:"short-link-trigger fa fa-link"}),""))}var el=n(56967);function tl({id:e,dashboardId:t,placement:n="right",scrollIntoView:i=!1,showShortLinkButton:r=!0}){const a=e=>{const t=document.getElementById(e);t&&t.scrollIntoView({block:"center",behavior:"smooth"})},s=(0,el.Z)();return(0,o.useEffect)((()=>{s&&e===s&&a(e)}),[s,e]),(0,o.useEffect)((()=>{i&&a(e)}),[e,i]),(0,b.tZ)("span",{className:"anchor-link-container",id:e},r&&t&&(0,b.tZ)(Xs,{anchorLinkId:e,dashboardId:t,emailSubject:(0,l.t)("Superset chart"),emailContent:(0,l.t)("Check out this chart in dashboard:"),placement:n}))}const nl=({onDelete:e})=>(0,b.tZ)(Ni,{onClick:e,icon:(0,b.tZ)(W.Z.Trash,{iconSize:"xl"})}),il=v.iK.div`
  .hover-menu {
    opacity: 0;
    position: absolute;
    z-index: 10;
    font-size: ${({theme:e})=>e.typography.sizes.m};
  }

  .hover-menu--left {
    width: ${({theme:e})=>6*e.gridUnit}px;
    top: 50%;
    transform: translate(0, -50%);
    left: ${({theme:e})=>-7*e.gridUnit}px;
    padding: ${({theme:e})=>2*e.gridUnit}px 0;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
  }

  .hover-menu--left > :nth-child(n):not(:only-child):not(:last-child) {
    margin-bottom: ${({theme:e})=>3*e.gridUnit}px;
  }

  .hover-menu--top {
    height: ${({theme:e})=>6*e.gridUnit}px;
    top: ${({theme:e})=>-6*e.gridUnit}px;
    left: 50%;
    transform: translate(-50%);
    padding: 0 ${({theme:e})=>2*e.gridUnit}px;
    display: flex;
    flex-direction: row;
    justify-content: center;
    align-items: center;
  }
`;class rl extends o.PureComponent{render(){const{innerRef:e,position:t,children:n}=this.props;return(0,b.tZ)(il,{className:"hover-menu-container"},(0,b.tZ)("div",{ref:e,className:m()("hover-menu","left"===t&&"hover-menu--left","top"===t&&"hover-menu--top")},n))}}rl.defaultProps={position:"left",innerRef:null,children:null};const ol={right:function(){return(0,b.tZ)("div",{className:"resize-handle resize-handle--right"})},bottom:function(){return(0,b.tZ)("div",{className:"resize-handle resize-handle--bottom"})},bottomRight:function(){return(0,b.tZ)("div",{className:"resize-handle resize-handle--bottom-right"})}},al={top:!1,right:!0,bottom:!0,left:!1,topRight:!1,bottomRight:!0,bottomLeft:!1,topLeft:!1},sl={widthAndHeight:al,widthOnly:{...al,bottomRight:!1,bottom:!1},heightOnly:{...al,bottomRight:!1,right:!1},notAdjustable:{...al,bottomRight:!1,bottom:!1,right:!1}},ll=Number.MAX_VALUE,dl={id:s().string.isRequired,children:s().node,adjustableWidth:s().bool,adjustableHeight:s().bool,gutterWidth:s().number,widthStep:s().number,heightStep:s().number,widthMultiple:s().number,heightMultiple:s().number,minWidthMultiple:s().number,maxWidthMultiple:s().number,minHeightMultiple:s().number,maxHeightMultiple:s().number,staticHeight:s().number,staticHeightMultiple:s().number,staticWidth:s().number,staticWidthMultiple:s().number,onResizeStop:s().func,onResize:s().func,onResizeStart:s().func,editMode:s().bool.isRequired},cl={children:null,adjustableWidth:!0,adjustableHeight:!0,gutterWidth:H.es,widthStep:H.cd,heightStep:H.cd,widthMultiple:null,heightMultiple:null,minWidthMultiple:1,maxWidthMultiple:ll,minHeightMultiple:1,maxHeightMultiple:ll,staticHeight:null,staticHeightMultiple:null,staticWidth:null,staticWidthMultiple:null,onResizeStop:null,onResize:null,onResizeStart:null},ul=[H.cd,H.cd],hl={right:"resizable-container-handle--right",bottom:"resizable-container-handle--bottom"};class pl extends o.PureComponent{constructor(e){super(e),this.state={isResizing:!1},this.handleResizeStart=this.handleResizeStart.bind(this),this.handleResize=this.handleResize.bind(this),this.handleResizeStop=this.handleResizeStop.bind(this)}handleResizeStart(e,t,n){const{id:i,onResizeStart:r}=this.props;r&&r({id:i,direction:t,ref:n}),this.setState((()=>({isResizing:!0})))}handleResize(e,t,n){const{onResize:i,id:r}=this.props;i&&i({id:r,direction:t,ref:n})}handleResizeStop(e,t,n,i){const{id:r,onResizeStop:o,widthStep:a,heightStep:s,widthMultiple:l,heightMultiple:d,adjustableHeight:c,adjustableWidth:u,gutterWidth:h}=this.props;if(o){const e=l+Math.round(i.width/(a+h)),t=d+Math.round(i.height/s);o({id:r,widthMultiple:u?e:null,heightMultiple:c?t:null}),this.setState((()=>({isResizing:!1})))}}render(){const{children:e,adjustableWidth:t,adjustableHeight:n,widthStep:i,heightStep:r,widthMultiple:o,heightMultiple:a,staticHeight:s,staticHeightMultiple:l,staticWidth:d,staticWidthMultiple:c,minWidthMultiple:u,maxWidthMultiple:h,minHeightMultiple:p,maxHeightMultiple:f,gutterWidth:v,editMode:y}=this.props,C={width:t?(i+v)*o-v:c&&c*i||d||void 0,height:n?r*a:l&&l*r||s||void 0};let S=sl.notAdjustable;y&&t&&n?S=sl.widthAndHeight:y&&t?S=sl.widthOnly:y&&n&&(S=sl.heightOnly);const{isResizing:x}=this.state;return(0,b.tZ)(g.e,{enable:S,grid:ul,minWidth:t?u*(i+v)-v:void 0,minHeight:n?p*r:void 0,maxWidth:t?Math.max(C.width,Math.min(ll,h*(i+v)-v)):void 0,maxHeight:n?Math.max(C.height,Math.min(ll,f*r)):void 0,size:C,onResizeStart:this.handleResizeStart,onResize:this.handleResize,onResizeStop:this.handleResizeStop,handleComponent:ol,className:m()("resizable-container",x&&"resizable-container--resizing"),handleClasses:hl},e)}}pl.propTypes=dl,pl.defaultProps=cl;const fl=pl,ml={id:s().string.isRequired,parentId:s().string.isRequired,dashboardId:s().number.isRequired,component:G.cP.isRequired,parentComponent:G.cP.isRequired,getComponentById:s().func.isRequired,index:s().number.isRequired,depth:s().number.isRequired,editMode:s().bool.isRequired,directPathToChild:s().arrayOf(s().string),directPathLastUpdated:s().number,focusedFilterScope:s().object,fullSizeChartId:s().oneOf([s().number,null]),availableColumnCount:s().number.isRequired,columnWidth:s().number.isRequired,onResizeStart:s().func.isRequired,onResize:s().func.isRequired,onResizeStop:s().func.isRequired,deleteComponent:s().func.isRequired,updateComponents:s().func.isRequired,handleComponentDrop:s().func.isRequired,setFullSizeChartId:s().func.isRequired,postAddSliceFromDashboard:s().func},gl=o.forwardRef((({chartId:e,...t},n)=>{const i=(0,v.Fg)(),o=(0,r.v9)((e=>e.nativeFilters)),a=function(e,t){if(!e.focusedFilterField)return null;const{chartId:n,column:i}=e.focusedFilterField;return{chartId:n,scope:t[n].scopes[i]}}((0,r.v9)((e=>e.dashboardState)),(0,r.v9)((e=>e.dashboardFilters))),s=o.focusedFilterId;if(!a&&!s)return(0,b.tZ)("div",pt()({ref:n},t));const l={borderColor:i.colors.primary.light2,opacity:1,boxShadow:`0px 0px ${2*i.gridUnit}px ${i.colors.primary.base}`,pointerEvents:"auto"};var d,c;if(s){if(null!=(d=o.filters[s])&&null!=(c=d.chartsInScope)&&c.includes(e))return(0,b.tZ)("div",pt()({ref:n,style:l},t))}else if(e===a.chartId||(0,hn.up)({filterScope:a.scope}).includes(e))return(0,b.tZ)("div",pt()({ref:n,style:l},t));return(0,b.tZ)("div",pt()({ref:n,style:{opacity:.3,pointerEvents:"none"}},t))}));class vl extends o.Component{static renderInFocusCSS(e){return(0,b.tZ)("style",null,`label[for=${e}] + .Select .Select__control {\n                    border-color: #00736a;\n                    transition: border-color 1s ease-in-out;\n           }`)}static getDerivedStateFromProps(e,t){const{component:n,directPathToChild:i,directPathLastUpdated:r}=e,{label:o,chart:a}=function(e){const t={};if(e.length>0){const n=e.slice();for(;n.length;){const e=n.pop(),i=e.split("-")[0];if(t[i.toLowerCase()]=e,!H.Ep.includes(i))break}}return t}(i);return r!==t.directPathLastUpdated&&n.id===a?{outlinedComponentId:n.id,outlinedColumnName:o,directPathLastUpdated:r}:null}constructor(e){super(e),this.state={isFocused:!1,outlinedComponentId:null,outlinedColumnName:null,directPathLastUpdated:0,extraControls:{}},this.handleChangeFocus=this.handleChangeFocus.bind(this),this.handleDeleteComponent=this.handleDeleteComponent.bind(this),this.handleUpdateSliceName=this.handleUpdateSliceName.bind(this),this.handleToggleFullSize=this.handleToggleFullSize.bind(this),this.handleExtraControl=this.handleExtraControl.bind(this),this.handlePostTransformProps=this.handlePostTransformProps.bind(this)}componentDidMount(){this.hideOutline({},this.state)}componentDidUpdate(e,t){this.hideOutline(t,this.state)}hideOutline(e,t){const{outlinedComponentId:n}=t,{outlinedComponentId:i}=e;n&&!i&&setTimeout((()=>{this.setState((()=>({outlinedComponentId:null,outlinedColumnName:null})))}),2e3)}handleChangeFocus(e){this.setState((()=>({isFocused:e})))}handleDeleteComponent(){const{deleteComponent:e,id:t,parentId:n}=this.props;e(t,n)}handleUpdateSliceName(e){const{component:t,updateComponents:n}=this.props;n({[t.id]:{...t,meta:{...t.meta,sliceNameOverride:e}}})}handleToggleFullSize(){const{component:e,fullSizeChartId:t,setFullSizeChartId:n}=this.props,{chartId:i}=e.meta;n(t===i?null:i)}handleExtraControl(e,t){this.setState((n=>({extraControls:{...n.extraControls,[e]:t}})))}handlePostTransformProps(e){return this.props.postAddSliceFromDashboard(),e}render(){var e,t,n;const{isFocused:i,extraControls:r}=this.state,{component:o,parentComponent:a,index:s,depth:l,availableColumnCount:d,columnWidth:c,onResizeStart:u,onResize:p,onResizeStop:f,handleComponentDrop:g,editMode:v,isComponentVisible:y,dashboardId:C,fullSizeChartId:S,getComponentById:x=(()=>{})}=this.props,{chartId:w}=o.meta,k=S===w,Z=null==(e=x(null==(n=a.parents)?void 0:n.find((e=>e.startsWith(h.BA)))))||null==(t=e.meta)?void 0:t.width;let R=o.meta.width||H.cx;a.type===h.BA?R=a.meta.width||H.cx:Z&&R>Z&&(R=Z);let T=0,F=0;return k?(T=window.innerWidth-32,F=window.innerHeight-32):(T=Math.floor(R*c+(R-1)*H.es-32),F=Math.floor(o.meta.height*H.cd-32)),(0,b.tZ)(De,{component:o,parentComponent:a,orientation:a.type===h.Os?"column":"row",index:s,depth:l,onDrop:g,disableDragDrop:i,editMode:v},(({dropIndicatorProps:e,dragSourceRef:t})=>(0,b.tZ)(fl,{id:o.id,adjustableWidth:a.type===h.Os,adjustableHeight:!0,widthStep:c,widthMultiple:R,heightStep:H.cd,heightMultiple:o.meta.height,minWidthMultiple:H.cx,minHeightMultiple:H.AA,maxWidthMultiple:d+R,onResizeStart:u,onResize:p,onResizeStop:f,editMode:v},(0,b.tZ)(gl,{chartId:w,ref:t,className:m()("dashboard-component","dashboard-component-chart-holder",`dashboard-chart-id-${w}`,this.state.outlinedComponentId?"fade-in":"fade-out",k&&"full-size")},!v&&(0,b.tZ)(tl,{id:o.id,scrollIntoView:this.state.outlinedComponentId===o.id}),!!this.state.outlinedComponentId&&vl.renderInFocusCSS(this.state.outlinedColumnName),(0,b.tZ)(Js,{componentId:o.id,id:o.meta.chartId,dashboardId:C,width:T,height:F,sliceName:o.meta.sliceNameOverride||o.meta.sliceName||"",updateSliceName:this.handleUpdateSliceName,isComponentVisible:y,handleToggleFullSize:this.handleToggleFullSize,isFullSize:k,setControlValue:this.handleExtraControl,extraControls:r,postTransformProps:this.handlePostTransformProps}),v&&(0,b.tZ)(rl,{position:"top"},(0,b.tZ)("div",null,(0,b.tZ)(nl,{onDelete:this.handleDeleteComponent})))),e&&(0,b.tZ)("div",e))))}}vl.propTypes=ml,vl.defaultProps={directPathToChild:[],directPathLastUpdated:0};const bl=(0,r.$j)((function(e){return{directPathToChild:e.dashboardState.directPathToChild,directPathLastUpdated:e.dashboardState.directPathLastUpdated}}))(vl);var yl=n(78186);const Cl=(0,v.iK)(mt.v.Item)`
  &.ant-menu-item {
    height: auto;
    line-height: 1.4;

    padding-top: ${({theme:e})=>e.gridUnit}px;
    padding-bottom: ${({theme:e})=>e.gridUnit}px;

    margin-top: 0;
    margin-bottom: 0;

    &:not(:last-child) {
      margin-bottom: 0;
    }

    &:hover {
      background: ${({theme:e})=>e.colors.grayscale.light3};
    }

    &.active {
      font-weight: ${({theme:e})=>e.typography.weights.bold};
      background: ${({theme:e})=>e.colors.grayscale.light2};
    }
  }

  &.ant-menu-item-selected {
    color: unset;
  }
`;var Sl={name:"s5xdrg",styles:"display:flex;align-items:center"};const xl=e=>{const{value:t,options:n,onChange:i,renderButton:r=(e=>e.label),renderOption:o=(e=>(0,b.tZ)("div",{className:e.className},e.label))}=e,a=(0,v.Fg)(),s=n.find((e=>e.value===t));return(0,b.tZ)(K.Gj,{trigger:["click"],overlayStyle:{zIndex:a.zIndex.max},overlay:(0,b.tZ)(mt.v,{onClick:({key:e})=>i(e)},n.map((e=>(0,b.tZ)(Cl,{id:"menu-item",key:e.value,className:m()("dropdown-item",{active:e.value===t})},o(e)))))},(0,b.tZ)("div",{role:"button",css:Sl},s&&r(s),(0,b.tZ)(W.Z.CaretDown,{iconColor:a.colors.grayscale.base,css:(0,b.iv)({marginTop:.5*a.gridUnit},"","")})))},wl=[{value:"edit",label:(0,l.t)("Edit")},{value:"preview",label:(0,l.t)("Preview")}];class kl extends o.PureComponent{render(){const{id:e,value:t,onChange:n}=this.props;return(0,b.tZ)(xl,{id:e,options:wl,value:t,onChange:n})}}class Zl extends o.PureComponent{constructor(e){super(e),this.container=void 0,this.state={isFocused:e.isFocused},this.setRef=this.setRef.bind(this),this.handleClick=this.handleClick.bind(this)}UNSAFE_componentWillReceiveProps(e){e.editMode&&e.isFocused&&!this.state.isFocused?(document.addEventListener("click",this.handleClick),document.addEventListener("drag",this.handleClick),this.setState({isFocused:!0})):this.state.isFocused&&!e.editMode&&(document.removeEventListener("click",this.handleClick),document.removeEventListener("drag",this.handleClick),this.setState({isFocused:!1}))}componentWillUnmount(){document.removeEventListener("click",this.handleClick),document.removeEventListener("drag",this.handleClick)}setRef(e){this.container=e}handleClick(e){if(!this.props.editMode)return;const{onChangeFocus:t,shouldFocus:n,disableClick:i}=this.props,r=n(e,this.container);i||!r||this.state.isFocused?!r&&this.state.isFocused&&(document.removeEventListener("click",this.handleClick),document.removeEventListener("drag",this.handleClick),this.setState((()=>({isFocused:!1}))),t&&t(!1)):(document.addEventListener("click",this.handleClick),document.addEventListener("drag",this.handleClick),this.setState((()=>({isFocused:!0}))),t&&t(!0))}render(){var e;const{children:t,menuItems:n,editMode:i,style:r}=this.props,{isFocused:o}=this.state;return(0,b.tZ)("div",{ref:this.setRef,onClick:this.handleClick,role:"none",className:m()("with-popover-menu",i&&o&&"with-popover-menu--focused"),style:r},t,i&&o&&(null!=(e=null==n?void 0:n.length)?e:0)>0&&(0,b.tZ)("div",{className:"popover-menu"},n.map(((e,t)=>(0,b.tZ)("div",{className:"menu-item",key:`menu-item-${t}`},e)))))}}Zl.defaultProps={children:null,disableClick:!1,onChangeFocus:null,menuItems:[],isFocused:!1,shouldFocus:(e,t)=>{var n;return(null==t?void 0:t.contains(e.target))||"menu-item"===e.target.id||"menu-item"===(null==(n=e.target.parentNode)?void 0:n.id)},style:null};const Rl={id:s().string.isRequired,parentId:s().string.isRequired,component:G.cP.isRequired,parentComponent:G.cP.isRequired,index:s().number.isRequired,depth:s().number.isRequired,editMode:s().bool.isRequired,logEvent:s().func.isRequired,addDangerToast:s().func.isRequired,undoLength:s().number.isRequired,redoLength:s().number.isRequired,availableColumnCount:s().number.isRequired,columnWidth:s().number.isRequired,onResizeStart:s().func.isRequired,onResize:s().func.isRequired,onResizeStop:s().func.isRequired,deleteComponent:s().func.isRequired,handleComponentDrop:s().func.isRequired,updateComponents:s().func.isRequired},Tl="# Markdown\n## Markdown\n### Markdown\n\n<br />\n\nClick here to edit [markdown](https://bit.ly/1dQOfRK)",Fl=(0,l.t)("This markdown component has an error.");class Dl extends o.PureComponent{constructor(e){super(e),this.state={isFocused:!1,markdownSource:e.component.meta.code,editor:null,editorMode:"preview",undoLength:e.undoLength,redoLength:e.redoLength},this.renderStartTime=lt.Yd.getTimestamp(),this.handleChangeFocus=this.handleChangeFocus.bind(this),this.handleChangeEditorMode=this.handleChangeEditorMode.bind(this),this.handleMarkdownChange=this.handleMarkdownChange.bind(this),this.handleDeleteComponent=this.handleDeleteComponent.bind(this),this.handleResizeStart=this.handleResizeStart.bind(this),this.setEditor=this.setEditor.bind(this)}componentDidMount(){this.props.logEvent(lt.aD,{viz_type:"markdown",start_offset:this.renderStartTime,ts:(new Date).getTime(),duration:lt.Yd.getTimestamp()-this.renderStartTime})}static getDerivedStateFromProps(e,t){const{hasError:n,editorMode:i,markdownSource:r,undoLength:o,redoLength:a}=t,{component:s,undoLength:l,redoLength:d}=e;return l!==o||d!==a?{...t,undoLength:l,redoLength:d,markdownSource:s.meta.code,hasError:!1}:n||"preview"!==i||s.meta.code===r?t:{...t,markdownSource:s.meta.code}}static getDerivedStateFromError(){return{hasError:!0}}componentDidUpdate(e){!this.state.editor||e.component.meta.width===this.props.component.meta.width&&e.columnWidth===this.props.columnWidth||this.state.editor.resize(!0),this.props.editMode&&xt.cE.preload()}componentDidCatch(){this.state.editor&&"preview"===this.state.editorMode&&this.props.addDangerToast((0,l.t)("This markdown component has an error. Please revert your recent changes."))}setEditor(e){e.getSession().setUseWrapMode(!0),this.setState({editor:e})}handleChangeFocus(e){const t=!!e,n=t?"edit":"preview";this.setState((()=>({isFocused:t}))),this.handleChangeEditorMode(n)}handleChangeEditorMode(e){const t={...this.state,editorMode:e};"preview"===e&&(this.updateMarkdownContent(),t.hasError=!1),this.setState(t)}updateMarkdownContent(){const{updateComponents:e,component:t}=this.props;t.meta.code!==this.state.markdownSource&&e({[t.id]:{...t,meta:{...t.meta,code:this.state.markdownSource}}})}handleMarkdownChange(e){this.setState({markdownSource:e})}handleDeleteComponent(){const{deleteComponent:e,id:t,parentId:n}=this.props;e(t,n)}handleResizeStart(e){const{editorMode:t}=this.state,{editMode:n,onResizeStart:i}=this.props,r="edit"===t;i(e),n&&r&&this.updateMarkdownContent()}renderEditMode(){return(0,b.tZ)(xt.cE,{onChange:this.handleMarkdownChange,width:"100%",height:"100%",showGutter:!1,editorProps:{$blockScrolling:!0},value:"string"==typeof this.state.markdownSource?this.state.markdownSource:Tl,readOnly:!1,onLoad:this.setEditor})}renderPreviewMode(){const{hasError:e}=this.state;return(0,b.tZ)(yl.Z,{source:e?Fl:this.state.markdownSource||Tl})}render(){const{isFocused:e,editorMode:t}=this.state,{component:n,parentComponent:i,index:r,depth:o,availableColumnCount:a,columnWidth:s,onResize:l,onResizeStop:d,handleComponentDrop:c,editMode:u}=this.props,p=i.type===h.BA?i.meta.width||H.cx:n.meta.width||H.cx,f="edit"===t;return(0,b.tZ)(De,{component:n,parentComponent:i,orientation:i.type===h.Os?"column":"row",index:r,depth:o,onDrop:c,disableDragDrop:e,editMode:u},(({dropIndicatorProps:t,dragSourceRef:r})=>(0,b.tZ)(Zl,{onChangeFocus:this.handleChangeFocus,menuItems:[(0,b.tZ)(kl,{id:`${n.id}-mode`,value:this.state.editorMode,onChange:this.handleChangeEditorMode})],editMode:u},(0,b.tZ)("div",{className:m()("dashboard-markdown",f&&"dashboard-markdown--editing"),id:n.id},(0,b.tZ)(fl,{id:n.id,adjustableWidth:i.type===h.Os,adjustableHeight:!0,widthStep:s,widthMultiple:p,heightStep:H.cd,heightMultiple:n.meta.height,minWidthMultiple:H.cx,minHeightMultiple:H.AA,maxWidthMultiple:a+p,onResizeStart:this.handleResizeStart,onResize:l,onResizeStop:d,editMode:!e&&u},(0,b.tZ)("div",{ref:r,className:"dashboard-component dashboard-component-chart-holder"},u&&(0,b.tZ)(rl,{position:"top"},(0,b.tZ)(nl,{onDelete:this.handleDeleteComponent})),u&&f?this.renderEditMode():this.renderPreviewMode()))),t&&(0,b.tZ)("div",t))))}}Dl.propTypes=Rl,Dl.defaultProps={};const _l=(0,r.$j)((function(e){return{undoLength:e.dashboardLayout.past.length,redoLength:e.dashboardLayout.future.length}}))(Dl),El=v.iK.div`
  ${({theme:e,position:t})=>b.iv`
    height: ${5*e.gridUnit}px;
    overflow: hidden;
    cursor: move;
    ${"top"===t&&b.iv`
      transform: rotate(90deg);
    `}
    & path {
      fill: ${e.colors.grayscale.base};
    }
  `}
`;function Il({position:e="left",innerRef:t=null}){return(0,b.tZ)(El,{ref:t,position:e},(0,b.tZ)(W.Z.Drag,null))}var Ml=n(713);function Ol(e){return(0,b.tZ)("div",{className:m()("background-style-option",e.className)},`${e.label} background`)}function Pl(e){return(0,b.tZ)("div",{className:m()("background-style-option",e.className)},e.label)}class Nl extends o.PureComponent{render(){const{id:e,value:t,onChange:n}=this.props;return(0,b.tZ)(xl,{id:e,options:Ml.Z,value:t,onChange:n,renderButton:Ol,renderOption:Pl})}}const jl={id:s().string.isRequired,parentId:s().string.isRequired,component:G.cP.isRequired,parentComponent:G.cP.isRequired,index:s().number.isRequired,depth:s().number.isRequired,editMode:s().bool.isRequired,availableColumnCount:s().number.isRequired,columnWidth:s().number.isRequired,minColumnWidth:s().number.isRequired,onResizeStart:s().func.isRequired,onResize:s().func.isRequired,onResizeStop:s().func.isRequired,deleteComponent:s().func.isRequired,handleComponentDrop:s().func.isRequired,updateComponents:s().func.isRequired};class ql extends o.PureComponent{constructor(e){super(e),this.state={isFocused:!1},this.handleChangeBackground=this.handleUpdateMeta.bind(this,"background"),this.handleChangeFocus=this.handleChangeFocus.bind(this),this.handleDeleteComponent=this.handleDeleteComponent.bind(this)}handleDeleteComponent(){const{deleteComponent:e,id:t,parentId:n}=this.props;e(t,n)}handleChangeFocus(e){this.setState((()=>({isFocused:Boolean(e)})))}handleUpdateMeta(e,t){const{updateComponents:n,component:i}=this.props;t&&i.meta[e]!==t&&n({[i.id]:{...i,meta:{...i.meta,[e]:t}}})}render(){const{component:e,parentComponent:t,index:n,availableColumnCount:i,columnWidth:r,minColumnWidth:o,depth:a,onResizeStart:s,onResize:l,onResizeStop:d,handleComponentDrop:c,editMode:u,onChangeTab:h,isComponentVisible:p}=this.props,f=e.children||[],g=Ml.Z.find((t=>t.value===(e.meta.background||H.HE)));return(0,b.tZ)(De,{component:e,parentComponent:t,orientation:"column",index:n,depth:a,onDrop:c,editMode:u},(({dropIndicatorProps:t,dragSourceRef:n})=>(0,b.tZ)(fl,{id:e.id,adjustableWidth:!0,adjustableHeight:!1,widthStep:r,widthMultiple:e.meta.width,minWidthMultiple:o,maxWidthMultiple:i+(e.meta.width||0),onResizeStart:s,onResize:l,onResizeStop:d,editMode:u},(0,b.tZ)(Zl,{isFocused:this.state.isFocused,onChangeFocus:this.handleChangeFocus,disableClick:!0,menuItems:[(0,b.tZ)(Nl,{id:`${e.id}-background`,value:e.meta.background,onChange:this.handleChangeBackground})],editMode:u},u&&(0,b.tZ)(rl,{innerRef:n,position:"top"},(0,b.tZ)(Il,{position:"top"}),(0,b.tZ)(nl,{onDelete:this.handleDeleteComponent}),(0,b.tZ)(Ni,{onClick:this.handleChangeFocus,icon:(0,b.tZ)(W.Z.Cog,{iconSize:"xl"})})),(0,b.tZ)("div",{className:m()("grid-column",0===f.length&&"grid-column--empty",g.className)},f.map(((t,n)=>(0,b.tZ)(bd,{key:t,id:t,parentId:e.id,depth:a+1,index:n,availableColumnCount:e.meta.width,columnWidth:r,onResizeStart:s,onResize:l,onResizeStop:d,isComponentVisible:p,onChangeTab:h}))),t&&(0,b.tZ)("div",t))))))}}ql.propTypes=jl,ql.defaultProps={};const zl=ql,Al={id:s().string.isRequired,parentId:s().string.isRequired,component:G.cP.isRequired,depth:s().number.isRequired,parentComponent:G.cP.isRequired,index:s().number.isRequired,editMode:s().bool.isRequired,handleComponentDrop:s().func.isRequired,deleteComponent:s().func.isRequired};class $l extends o.PureComponent{constructor(e){super(e),this.handleDeleteComponent=this.handleDeleteComponent.bind(this)}handleDeleteComponent(){const{deleteComponent:e,id:t,parentId:n}=this.props;e(t,n)}render(){const{component:e,depth:t,parentComponent:n,index:i,handleComponentDrop:r,editMode:o}=this.props;return(0,b.tZ)(De,{component:e,parentComponent:n,orientation:"row",index:i,depth:t,onDrop:r,editMode:o},(({dropIndicatorProps:e,dragSourceRef:t})=>(0,b.tZ)("div",{ref:t},o&&(0,b.tZ)(rl,{position:"left"},(0,b.tZ)(nl,{onDelete:this.handleDeleteComponent})),(0,b.tZ)("div",{className:"dashboard-component dashboard-component-divider"}),e&&(0,b.tZ)("div",e))))}}$l.propTypes=Al;const Ul=$l;var Ll=n(79271);const Vl={id:s().string.isRequired,dashboardId:s().string.isRequired,parentId:s().string.isRequired,component:G.cP.isRequired,depth:s().number.isRequired,parentComponent:G.cP.isRequired,index:s().number.isRequired,editMode:s().bool.isRequired,handleComponentDrop:s().func.isRequired,deleteComponent:s().func.isRequired,updateComponents:s().func.isRequired};class Kl extends o.PureComponent{constructor(e){super(e),this.state={isFocused:!1},this.handleDeleteComponent=this.handleDeleteComponent.bind(this),this.handleChangeFocus=this.handleChangeFocus.bind(this),this.handleUpdateMeta=this.handleUpdateMeta.bind(this),this.handleChangeSize=this.handleUpdateMeta.bind(this,"headerSize"),this.handleChangeBackground=this.handleUpdateMeta.bind(this,"background"),this.handleChangeText=this.handleUpdateMeta.bind(this,"text")}handleChangeFocus(e){this.setState((()=>({isFocused:e})))}handleUpdateMeta(e,t){const{updateComponents:n,component:i}=this.props;t&&i.meta[e]!==t&&n({[i.id]:{...i,meta:{...i.meta,[e]:t}}})}handleDeleteComponent(){const{deleteComponent:e,id:t,parentId:n}=this.props;e(t,n)}render(){const{isFocused:e}=this.state,{dashboardId:t,component:n,depth:i,parentComponent:r,index:o,handleComponentDrop:a,editMode:s}=this.props,l=Ll.Z.find((e=>e.value===(n.meta.headerSize||H.u_))),d=Ml.Z.find((e=>e.value===(n.meta.background||H.HE)));return(0,b.tZ)(De,{component:n,parentComponent:r,orientation:"row",index:o,depth:i,onDrop:a,disableDragDrop:e,editMode:s},(({dropIndicatorProps:e,dragSourceRef:r})=>(0,b.tZ)("div",{ref:r},s&&i<=2&&(0,b.tZ)(rl,{position:"left"},(0,b.tZ)(Il,{position:"left"})),(0,b.tZ)(Zl,{onChangeFocus:this.handleChangeFocus,menuItems:[(0,b.tZ)(xl,{id:`${n.id}-header-style`,options:Ll.Z,value:n.meta.headerSize,onChange:this.handleChangeSize}),(0,b.tZ)(Nl,{id:`${n.id}-background`,value:n.meta.background,onChange:this.handleChangeBackground})],editMode:s},(0,b.tZ)("div",{className:m()("dashboard-component","dashboard-component-header",l.className,d.className)},s&&(0,b.tZ)(rl,{position:"top"},(0,b.tZ)(nl,{onDelete:this.handleDeleteComponent})),(0,b.tZ)(er.Z,{title:n.meta.text,canEdit:s,onSaveTitle:this.handleChangeText,showTooltip:!1}),!s&&(0,b.tZ)(tl,{id:n.id,dashboardId:t}))),e&&(0,b.tZ)("div",e))))}}Kl.propTypes=Vl,Kl.defaultProps={};const Bl=Kl,Wl={id:s().string.isRequired,parentId:s().string.isRequired,component:G.cP.isRequired,parentComponent:G.cP.isRequired,index:s().number.isRequired,depth:s().number.isRequired,editMode:s().bool.isRequired,availableColumnCount:s().number.isRequired,columnWidth:s().number.isRequired,occupiedColumnCount:s().number.isRequired,onResizeStart:s().func.isRequired,onResize:s().func.isRequired,onResizeStop:s().func.isRequired,handleComponentDrop:s().func.isRequired,deleteComponent:s().func.isRequired,updateComponents:s().func.isRequired};class Hl extends o.PureComponent{constructor(e){super(e),this.state={isFocused:!1},this.handleDeleteComponent=this.handleDeleteComponent.bind(this),this.handleUpdateMeta=this.handleUpdateMeta.bind(this),this.handleChangeBackground=this.handleUpdateMeta.bind(this,"background"),this.handleChangeFocus=this.handleChangeFocus.bind(this)}handleChangeFocus(e){this.setState((()=>({isFocused:Boolean(e)})))}handleUpdateMeta(e,t){const{updateComponents:n,component:i}=this.props;t&&i.meta[e]!==t&&n({[i.id]:{...i,meta:{...i.meta,[e]:t}}})}handleDeleteComponent(){const{deleteComponent:e,component:t,parentId:n}=this.props;e(t.id,n)}render(){const{component:e,parentComponent:t,index:n,availableColumnCount:i,columnWidth:r,occupiedColumnCount:o,depth:a,onResizeStart:s,onResize:l,onResizeStop:d,handleComponentDrop:c,editMode:u,onChangeTab:h,isComponentVisible:p}=this.props,f=e.children||[],g=Ml.Z.find((t=>t.value===(e.meta.background||H.HE)));return(0,b.tZ)(De,{component:e,parentComponent:t,orientation:"row",index:n,depth:a,onDrop:c,editMode:u},(({dropIndicatorProps:t,dragSourceRef:n})=>(0,b.tZ)(Zl,{isFocused:this.state.isFocused,onChangeFocus:this.handleChangeFocus,disableClick:!0,menuItems:[(0,b.tZ)(Nl,{id:`${e.id}-background`,value:g.value,onChange:this.handleChangeBackground})],editMode:u},u&&(0,b.tZ)(rl,{innerRef:n,position:"left"},(0,b.tZ)(Il,{position:"left"}),(0,b.tZ)(nl,{onDelete:this.handleDeleteComponent}),(0,b.tZ)(Ni,{onClick:this.handleChangeFocus,icon:(0,b.tZ)(W.Z.Cog,{iconSize:"xl"})})),(0,b.tZ)("div",{className:m()("grid-row",0===f.length&&"grid-row--empty",g.className)},f.map(((t,n)=>(0,b.tZ)(bd,{key:t,id:t,parentId:e.id,depth:a+1,index:n,availableColumnCount:i-o,columnWidth:r,onResizeStart:s,onResize:l,onResizeStop:d,isComponentVisible:p,onChangeTab:h}))),t&&(0,b.tZ)("div",t)))))}}Hl.propTypes=Wl;const Gl=Hl;var Yl=n(94301);const Jl="RENDER_TAB",Ql="RENDER_TAB_CONTENT",Xl={dashboardId:s().number.isRequired,id:s().string.isRequired,parentId:s().string.isRequired,component:G.cP.isRequired,parentComponent:G.cP.isRequired,index:s().number.isRequired,depth:s().number.isRequired,renderType:s().oneOf([Jl,Ql]).isRequired,onDropOnTab:s().func,editMode:s().bool.isRequired,canEdit:s().bool.isRequired,availableColumnCount:s().number,columnWidth:s().number,onResizeStart:s().func,onResize:s().func,onResizeStop:s().func,handleComponentDrop:s().func.isRequired,updateComponents:s().func.isRequired,setDirectPathToChild:s().func.isRequired,setEditMode:s().func.isRequired},ed={availableColumnCount:0,columnWidth:0,onDropOnTab(){},onResizeStart(){},onResize(){},onResizeStop(){}},td=v.iK.div`
  ${({isHighlighted:e,theme:{gridUnit:t,colors:n}})=>`\n    padding: ${t}px ${2*t}px;\n    margin: ${-t}px ${-2*t}px;\n    transition: box-shadow 0.2s ease-in-out;\n    ${e&&`box-shadow: 0 0 ${t}px ${n.primary.light1};`}\n  `}
`,nd=e=>e.dropIndicatorProps&&(0,b.tZ)("div",{className:"drop-indicator drop-indicator--bottom"}),id=e=>e.dropIndicatorProps&&(0,b.tZ)("div",{className:"drop-indicator drop-indicator--top"});class rd extends o.PureComponent{constructor(e){super(e),this.handleChangeText=this.handleChangeText.bind(this),this.handleDrop=this.handleDrop.bind(this),this.handleTopDropTargetDrop=this.handleTopDropTargetDrop.bind(this),this.handleChangeTab=this.handleChangeTab.bind(this)}handleChangeTab({pathToTabIndex:e}){this.props.setDirectPathToChild(e)}handleChangeText(e){const{updateComponents:t,component:n}=this.props;e&&e!==n.meta.text&&t({[n.id]:{...n,meta:{...n.meta,text:e}}})}handleDrop(e){this.props.handleComponentDrop(e),this.props.onDropOnTab(e)}handleTopDropTargetDrop(e){e&&this.props.handleComponentDrop({...e,destination:{...e.destination,index:0}})}renderTabContent(){const{component:e,parentComponent:t,depth:n,availableColumnCount:i,columnWidth:r,onResizeStart:o,onResize:a,onResizeStop:s,editMode:d,isComponentVisible:c,canEdit:u,setEditMode:h,dashboardId:p}=this.props,f=0===e.children.length;return(0,b.tZ)("div",{className:"dashboard-component-tabs-content"},d&&(0,b.tZ)(De,{component:e,parentComponent:t,orientation:"column",index:0,depth:n,onDrop:this.handleTopDropTargetDrop,editMode:!0,className:"empty-droptarget"},id),f&&(0,b.tZ)(Yl.x3,{title:d?(0,l.t)("Drag and drop components to this tab"):(0,l.t)("There are no components added to this tab"),description:u&&(d?(0,b.tZ)("span",null,(0,l.t)("You can")," ",(0,b.tZ)("a",{href:`/chart/add?dashboard_id=${p}`,rel:"noopener noreferrer",target:"_blank"},(0,l.t)("create a new chart"))," ",(0,l.t)("or use existing ones from the panel on the right")):(0,b.tZ)("span",null,(0,l.t)("You can add the components in the")," ",(0,b.tZ)("span",{role:"button",tabIndex:0,onClick:()=>h(!0)},(0,l.t)("edit mode")))),image:"chart.svg"}),e.children.map(((t,l)=>(0,b.tZ)(bd,{key:t,id:t,parentId:e.id,depth:n,index:l,onDrop:this.handleDrop,availableColumnCount:i,columnWidth:r,onResizeStart:o,onResize:a,onResizeStop:s,isComponentVisible:c,onChangeTab:this.handleChangeTab}))),d&&(0,b.tZ)(De,{component:e,parentComponent:t,orientation:"column",index:e.children.length,depth:n,onDrop:this.handleDrop,editMode:!0,className:"empty-droptarget"},nd))}renderTab(){const{component:e,parentComponent:t,index:n,depth:i,editMode:r,isFocused:o,isHighlighted:a}=this.props;return(0,b.tZ)(De,{component:e,parentComponent:t,orientation:"column",index:n,depth:i,onDrop:this.handleDrop,editMode:r},(({dropIndicatorProps:t,dragSourceRef:i})=>(0,b.tZ)(td,{isHighlighted:a,className:"dragdroppable-tab",ref:i},(0,b.tZ)(er.Z,{title:e.meta.text,defaultTitle:e.meta.defaultText,placeholder:e.meta.placeholder,canEdit:r&&o,onSaveTitle:this.handleChangeText,showTooltip:!1,editing:r&&o}),!r&&(0,b.tZ)(tl,{id:e.id,dashboardId:this.props.dashboardId,placement:n>=5?"left":"right"}),t&&(0,b.tZ)("div",t))))}render(){const{renderType:e}=this.props;return e===Jl?this.renderTab():this.renderTabContent()}}rd.propTypes=Xl,rd.defaultProps=ed;const od=(0,r.$j)((function(e){return{canEdit:e.dashboardInfo.dash_edit_perm}}),(function(e){return(0,i.DE)({setEditMode:Lt.Mb},e)}))(rd);function ad({currentComponent:e,directPathToChild:t=[]}){if(!e||0===t.length||-1===t.indexOf(e.id))return-1;const n=t.findIndex((t=>t===e.id)),i=t[n+1];return e.children.indexOf(i)>=0?e.children.findIndex((e=>e===i)):-1}function sd(e,t){const n=(e.parents||[]).slice();return n.push(e.id),n.push(e.children[t]),n}function ld(e=[]){if(e.length>0){const t=e.slice();for(;t.length;){const e=t.pop(),n=e&&e.split("-")[0];if(!H.Ep.includes(n))return e}}return null}const dd={id:s().string.isRequired,parentId:s().string.isRequired,component:G.cP.isRequired,parentComponent:G.cP.isRequired,index:s().number.isRequired,depth:s().number.isRequired,renderTabContent:s().bool,editMode:s().bool.isRequired,renderHoverMenu:s().bool,directPathToChild:s().arrayOf(s().string),activeTabs:s().arrayOf(s().string),filterboxMigrationState:Y.Qi,logEvent:s().func.isRequired,setActiveTabs:s().func,availableColumnCount:s().number,columnWidth:s().number,onResizeStart:s().func,onResize:s().func,onResizeStop:s().func,createComponent:s().func.isRequired,handleComponentDrop:s().func.isRequired,onChangeTab:s().func.isRequired,deleteComponent:s().func.isRequired,updateComponents:s().func.isRequired},cd={renderTabContent:!0,renderHoverMenu:!0,availableColumnCount:0,columnWidth:0,activeTabs:[],directPathToChild:[],filterboxMigrationState:Y.Qi.NOOP,setActiveTabs(){},onResizeStart(){},onResize(){},onResizeStop(){}},ud=v.iK.div`
  width: 100%;
  background-color: ${({theme:e})=>e.colors.grayscale.light5};

  .dashboard-component-tabs-content {
    min-height: ${({theme:e})=>12*e.gridUnit}px;
    margin-top: ${({theme:e})=>e.gridUnit/4}px;
    position: relative;
  }

  .ant-tabs {
    overflow: visible;

    .ant-tabs-nav-wrap {
      min-height: ${({theme:e})=>12.5*e.gridUnit}px;
    }

    .ant-tabs-content-holder {
      overflow: visible;
    }
  }

  div .ant-tabs-tab-btn {
    text-transform: none;
  }
`;class hd extends o.PureComponent{constructor(e){var t;super(e),this.showDeleteConfirmModal=e=>{const{component:t,deleteComponent:n}=this.props;K.xT.confirm({title:(0,l.t)("Delete dashboard tab?"),content:(0,b.tZ)("span",null,"Deleting a tab will remove all content within it. You may still reverse this action with the ",(0,b.tZ)("b",null,"undo")," button (cmd + z) until you save your changes."),onOk:()=>{n(e,t.id);const i=t.children.indexOf(e);this.handleDeleteTab(i)},okType:"danger",okText:"DELETE",cancelText:"CANCEL",icon:null})},this.handleEdit=(e,t)=>{const{component:n,createComponent:i}=this.props;"add"===t?(null==e||null==e.stopPropagation||e.stopPropagation(),i({destination:{id:n.id,type:n.type,index:n.children.length},dragging:{id:H.Xk,type:h.gn}})):"remove"===t&&this.showDeleteConfirmModal(e)};let n=Math.max(0,ad({currentComponent:e.component,directPathToChild:e.directPathToChild}));0===n&&null!=(t=e.activeTabs)&&t.length&&e.component.children.forEach(((t,i)=>{0===n&&e.activeTabs.includes(t)&&(n=i)}));const{children:i}=e.component,r=i[n];this.state={tabIndex:n,activeKey:r},this.handleClickTab=this.handleClickTab.bind(this),this.handleDeleteComponent=this.handleDeleteComponent.bind(this),this.handleDeleteTab=this.handleDeleteTab.bind(this),this.handleDropOnTab=this.handleDropOnTab.bind(this),this.handleDrop=this.handleDrop.bind(this)}componentDidMount(){this.props.setActiveTabs(this.state.activeKey)}componentDidUpdate(e,t){t.activeKey===this.state.activeKey&&e.filterboxMigrationState===this.props.filterboxMigrationState||this.props.setActiveTabs(this.state.activeKey,t.activeKey)}UNSAFE_componentWillReceiveProps(e){const t=Math.max(0,e.component.children.length-1),n=this.props.component.children,i=e.component.children;if(this.state.tabIndex>t&&this.setState((()=>({tabIndex:t}))),e.isComponentVisible){const t=ld(e.directPathToChild),r=ld(this.props.directPathToChild);if(t!==r||t===r&&n!==i){const t=ad({currentComponent:e.component,directPathToChild:e.directPathToChild});t>-1&&t!==this.state.tabIndex&&this.setState((()=>({tabIndex:t,activeKey:i[t]})))}}}handleClickTab(e){const{component:t}=this.props,{children:n}=t;if(e!==this.state.tabIndex){const n=sd(t,e),i=n[n.length-1];this.props.logEvent(lt.Iq,{target_id:i,index:e}),this.props.onChangeTab({pathToTabIndex:n})}this.setState((()=>({activeKey:n[e]})))}handleDeleteComponent(){const{deleteComponent:e,id:t,parentId:n}=this.props;e(t,n)}handleDeleteTab(e){this.state.tabIndex===e&&this.handleClickTab(Math.max(0,e-1))}handleDropOnTab(e){const{component:t}=this.props,{destination:n}=e;if(n){const e=n.id===t.id?n.index:t.children.indexOf(n.id);e>-1&&setTimeout((()=>{this.handleClickTab(e)}),30)}}handleDrop(e){e.dragging.type!==h.yR&&this.props.handleComponentDrop(e)}render(){const{depth:e,component:t,parentComponent:n,index:i,availableColumnCount:r,columnWidth:o,onResizeStart:a,onResize:s,onResizeStop:l,renderTabContent:d,renderHoverMenu:c,isComponentVisible:u,editMode:h,nativeFilters:p}=this.props,{children:f}=t,{tabIndex:m,activeKey:g}=this.state;let v;return null!=p&&p.focusedFilterId&&(v=p.filters[p.focusedFilterId].tabsInScope),(0,b.tZ)(De,{component:t,parentComponent:n,orientation:"row",index:i,depth:e,onDrop:this.handleDrop,editMode:h},(({dropIndicatorProps:i,dragSourceRef:p})=>(0,b.tZ)(ud,{className:"dashboard-component dashboard-component-tabs"},h&&c&&(0,b.tZ)(rl,{innerRef:p,position:"left"},(0,b.tZ)(Il,{position:"left"}),(0,b.tZ)(nl,{onDelete:this.handleDeleteComponent})),(0,b.tZ)(C.cl,{id:t.id,activeKey:g,onChange:e=>{this.handleClickTab(f.indexOf(e))},onEdit:this.handleEdit,type:h?"editable-card":"card"},f.map(((n,i)=>{var c;return(0,b.tZ)(C.cl.TabPane,{key:n,tab:(0,b.tZ)(bd,{id:n,parentId:t.id,depth:e,index:i,renderType:Jl,availableColumnCount:r,columnWidth:o,onDropOnTab:this.handleDropOnTab,isFocused:g===n,isHighlighted:g!==n&&(null==(c=v)?void 0:c.includes(n))})},d&&(0,b.tZ)(bd,{id:n,parentId:t.id,depth:e,index:i,renderType:Ql,availableColumnCount:r,columnWidth:o,onResizeStart:a,onResize:s,onResizeStop:l,onDropOnTab:this.handleDropOnTab,isComponentVisible:m===i&&u}))}))),i&&n.id!==H._4&&(0,b.tZ)("div",i))))}}hd.propTypes=dd,hd.defaultProps=cd;const pd=(0,r.$j)((function(e){return{nativeFilters:e.nativeFilters,activeTabs:e.dashboardState.activeTabs,directPathToChild:e.dashboardState.directPathToChild,filterboxMigrationState:e.dashboardState.filterboxMigrationState}}))(hd),fd={[h.dW]:bl,[h.xh]:_l,[h.BA]:zl,[h.hE]:Ul,[h.Nc]:Bl,[h.Os]:Gl,[h.gn]:od,[h.yR]:pd,[h.t]:({component:e,parentComponent:t,index:n,depth:i,handleComponentDrop:a,editMode:s,columnWidth:d,availableColumnCount:c,onResizeStart:u,onResizeStop:p,onResize:f,deleteComponent:g,parentId:v,updateComponents:y,id:C})=>{const S=t.type===h.BA?t.meta.width||H.cx:e.meta.width||H.cx,x=()=>{g(C,v)},w=Ml.Z.find((t=>t.value===(e.meta.background||H.HE))),{Component:k}=Ve.get(e.meta.componentKey),Z=(0,r.v9)((({nativeFilters:e,dataMask:t})=>({nativeFilters:e,dataMask:t})));return(0,b.tZ)(De,{component:e,parentComponent:t,orientation:t.type===h.Os?"column":"row",index:n,depth:i,onDrop:a,editMode:s},(({dropIndicatorProps:n,dragSourceRef:i})=>(0,b.tZ)(Zl,{menuItems:[(0,b.tZ)(Nl,{id:`${e.id}-background`,value:e.meta.background,onChange:t=>{return"background",n=t,void y({[e.id]:{...e,meta:{...e.meta,background:n}}});var n}})],editMode:s},(0,b.tZ)("div",{className:m()("dashboard-component",`dashboard-${e.componentKey}`,null==w?void 0:w.className),id:e.id},(0,b.tZ)(fl,{id:e.id,adjustableWidth:t.type===h.Os,widthStep:d,widthMultiple:S,heightStep:H.cd,adjustableHeight:!1,heightMultiple:e.meta.height,minWidthMultiple:H.cx,minHeightMultiple:H.cx,maxWidthMultiple:c+S,onResizeStart:u,onResize:f,onResizeStop:p},(0,b.tZ)("div",{ref:i,className:"dashboard-component"},s&&(0,b.tZ)(rl,{position:"top"},(0,b.tZ)(nl,{onDelete:x})),(0,b.tZ)(o.Suspense,{fallback:(0,b.tZ)("div",null,(0,l.t)("Loading..."))},(0,b.tZ)(k,{dashboardData:Z}))))),n&&(0,b.tZ)("div",n))))}};var md=n(72673);const gd={id:s().string,parentId:s().string,depth:s().number,index:s().number,renderHoverMenu:s().bool,renderTabContent:s().bool,onChangeTab:s().func,component:G.cP.isRequired,parentComponent:G.cP.isRequired,createComponent:s().func.isRequired,deleteComponent:s().func.isRequired,updateComponents:s().func.isRequired,handleComponentDrop:s().func.isRequired,logEvent:s().func.isRequired,directPathToChild:s().arrayOf(s().string),directPathLastUpdated:s().number,dashboardId:s().number.isRequired,isComponentVisible:s().bool};class vd extends o.PureComponent{render(){const{component:e}=this.props,t=e?fd[e.type]:null;return t?(0,b.tZ)(t,this.props):null}}vd.propTypes=gd,vd.defaultProps={isComponentVisible:!0};const bd=(0,r.$j)((function({dashboardLayout:e,dashboardState:t,dashboardInfo:n},i){const r=e.present,{id:o,parentId:a}=i,s=r[o],l={component:s,getComponentById:e=>r[e],parentComponent:r[a],editMode:t.editMode,filters:(0,hn.De)(),dashboardId:n.id,fullSizeChartId:t.fullSizeChartId};if(s){const e=s.type;if(e===h.Os||e===h.BA){const{occupiedWidth:t,minimumWidth:n}=(0,md.Z)({id:o,components:r});e===h.Os&&(l.occupiedColumnCount=t),e===h.BA&&(l.minColumnWidth=n)}}return l}),(function(e){return(0,i.DE)({addDangerToast:_i.Gb,createComponent:Di.LM,deleteComponent:Di.v7,updateComponents:Di.WZ,handleComponentDrop:Di._p,setDirectPathToChild:Lt.E2,setFullSizeChartId:Lt.zL,setActiveTabs:Lt.$_,logEvent:Ei.logEvent,postAddSliceFromDashboard:Lt.Cd},e)}))(vd);var yd,Cd=n(90057),Sd=n(8868),xd=n(6954);!function(e){e.AllFilters="allFilters",e.FilterSets="filterSets"}(yd||(yd={}));const wd=e=>Object.values(e).reduce(((e,t)=>({...e,[t.id]:t.extraFormData})),{}),kd=(e,t)=>{var n;const i=null==t?void 0:t.value;return(null==(n=e.controlValues)?void 0:n.enableEmptyFilter)&&null==i};var Zd=n(52794),Rd=n(24350),Td=n.n(Rd),Fd=n(63105),Dd=n.n(Fd),_d=n(37936);const Ed=()=>(0,r.v9)((e=>e.nativeFilters.filterSets||{})),Id=()=>{const e=(0,r.v9)((e=>{var t;return null==(t=e.dashboardState)?void 0:t.preselectNativeFilters})),t=(0,r.v9)((e=>e.nativeFilters.filters));return(0,o.useMemo)((()=>Object.entries(t).reduce(((t,[n,i])=>({...t,[n]:{...i,preselect:null==e?void 0:e[n]}})),{})),[t,e])},Md=()=>{const e=(0,r.v9)((e=>e.dataMask));return(0,o.useMemo)((()=>Object.values(e).filter((e=>String(e.id).startsWith(Ca.rW))).reduce(((e,t)=>({...e,[t.id]:t})),{})),[e])},Od=(e,t)=>{const n=Ed(),i=Object.values(n),r=(0,o.useMemo)((()=>!!i.find((({name:t})=>t===e))),[i,e]);return t!==e&&r},Pd=v.iK.div`
  display: flex;
  & button {
    ${({disabled:e})=>"pointer-events: "+(e?"none":"all")};
    flex: 1;
  }
`,Nd=v.iK.div`
  display: grid;
  flex-direction: row;
  justify-content: center;
  align-items: center;
  grid-gap: 10px;
  grid-template-columns: 1fr 1fr;
`,jd=({onCancel:e,editMode:t,onEdit:n,onCreate:i,disabled:r,filterSetName:a})=>{const s=Od(a),d=!a||s||r;return(0,b.tZ)(o.Fragment,null,t?(0,b.tZ)(Nd,null,(0,b.tZ)(B.Z,{buttonStyle:"tertiary",buttonSize:"small",onClick:e},(0,l.t)("Cancel")),(0,b.tZ)(ct.u,{placement:"right",title:!a&&(0,l.t)("Please filter set name")||s&&(0,l.t)("Filter set with this name already exists")||r&&vs},(0,b.tZ)(Pd,{disabled:d},(0,b.tZ)(B.Z,pt()({disabled:d,buttonStyle:"primary",htmlType:"submit",buttonSize:"small",onClick:i},vu("create-filter-set-button")),(0,l.t)("Create"))))):(0,b.tZ)(ct.u,{placement:"bottom",title:r&&vs},(0,b.tZ)(Pd,{disabled:r},(0,b.tZ)(B.Z,pt()({disabled:r,buttonStyle:"tertiary",buttonSize:"small",onClick:n},vu("new-filter-set-button")),(0,l.t)("Create new filter set")))))},qd={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M912 190h-69.9c-9.8 0-19.1 4.5-25.1 12.2L404.7 724.5 207 474a32 32 0 00-25.1-12.2H112c-6.7 0-10.4 7.7-6.3 12.9l273.9 347c12.8 16.2 37.4 16.2 50.3 0l488.4-618.9c4.1-5.1.4-12.8-6.3-12.8z"}}]},name:"check",theme:"outlined"};var zd=function(e,t){return o.createElement(Ja.Z,Object.assign({},e,{ref:t,icon:qd}))};zd.displayName="CheckOutlined";const Ad=o.forwardRef(zd),$d={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M176 511a56 56 0 10112 0 56 56 0 10-112 0zm280 0a56 56 0 10112 0 56 56 0 10-112 0zm280 0a56 56 0 10112 0 56 56 0 10-112 0z"}}]},name:"ellipsis",theme:"outlined"};var Ud=function(e,t){return o.createElement(Ja.Z,Object.assign({},e,{ref:t,icon:$d}))};Ud.displayName="EllipsisOutlined";const Ld=o.forwardRef(Ud),Vd=v.iK.div`
  display: flex;
  align-items: center;
  font-size: ${({theme:e})=>e.typography.sizes.s}px;
`,Kd=(0,v.iK)(K.Ol)`
  &.ant-collapse-ghost > .ant-collapse-item {
    & > .ant-collapse-content > .ant-collapse-content-box {
      padding: 0;
      padding-top: 0;
      padding-bottom: 0;
      font-size: ${({theme:e})=>e.typography.sizes.s}px;
    }
    & > .ant-collapse-header {
      padding: 0;
      display: flex;
      align-items: center;
      flex-direction: row-reverse;
      justify-content: flex-end;
      max-width: max-content;
      & .ant-collapse-arrow {
        position: static;
        padding-left: ${({theme:e})=>e.gridUnit}px;
      }
  }
`,Bd=v.iK.div`
  padding-top: ${({theme:e})=>e.gridUnit}px;
  padding-bottom: ${({theme:e})=>e.gridUnit}px;
`,Wd=({dataMask:e,filterSet:t})=>{const n=(0,v.Fg)(),i=Id(),r=Object.values(i).filter(Mr.kI);let o=null!=r?r:[];return null!=t&&t.nativeFilters&&(o=Object.values(null==t?void 0:t.nativeFilters).filter(Mr.kI)),(0,b.tZ)(Kd,{ghost:!0,expandIconPosition:"right",defaultActiveKey:t?void 0:["filters"],expandIcon:({isActive:e})=>{const t=n.colors.grayscale.base,i=e?W.Z.CaretUpOutlined:W.Z.CaretDownOutlined;return(0,b.tZ)(i,{iconColor:t})}},(0,b.tZ)(K.Ol.Panel,pt()({},vu("collapse-filter-set-description"),{header:(0,b.tZ)(Vd,null,(0,b.tZ)(K.ZT.Text,{type:"secondary"},(0,l.t)("Filters (%d)",o.length))),key:"filters"}),o.map((({id:n,name:r})=>{var o,a,s,d,c;const u=t&&!(0,zi.JB)(null==(o=i[n])?void 0:o.controlValues,null==t||null==(a=t.nativeFilters)||null==(s=a[n])?void 0:s.controlValues,{ignoreUndefined:!0}),h=!Object.keys(i).includes(n);return(0,b.tZ)(K._e,{title:h&&(0,l.t)("This filter doesn't exist in dashboard. It will not be applied.")||u&&(0,l.t)("Filter metadata changed in dashboard. It will not be applied."),placement:"bottomLeft",key:n},(0,b.tZ)(Bd,null,(0,b.tZ)(K.ZT.Text,{strong:!0,delete:h,mark:u},r,":"),(0,b.tZ)(K.ZT.Text,{delete:h,mark:u},bs(null==e||null==(d=e[n])||null==(c=d.filterState)?void 0:c.value)||(0,b.tZ)(K.ZT.Text,{type:"secondary"},(0,l.t)("None")))))}))))},Hd=(0,v.iK)(B.Z)`
  padding: 0;
`,Gd=v.iK.div`
  display: flex;
  justify-content: space-between;
  align-items: center;
`,Yd=v.iK.div`
  display: flex;
  justify-content: flex-end;
  align-items: center;
  & > *,
  & > button.superset-button {
    ${({theme:e})=>`margin-left: ${2*e.gridUnit}px`};
  }
`,Jd=({editMode:e,setFilterSetName:t,onDelete:n,onEdit:i,filterSetName:r,dataMaskSelected:a,filterSet:s,isApplied:d,onRebuild:c})=>{var u,h;const p=(0,v.Fg)(),f=(0,b.tZ)(mt.v,null,(0,b.tZ)(mt.v.Item,{onClick:i},(0,l.t)("Edit")),(0,b.tZ)(mt.v.Item,{onClick:c},(0,b.tZ)(ct.u,{placement:"right",title:(0,l.t)("Remove invalid filters")},(0,l.t)("Rebuild"))),(0,b.tZ)(mt.v.Item,{onClick:n,danger:!0},(0,l.t)("Delete")));return(0,b.tZ)(o.Fragment,null,(0,b.tZ)(Gd,null,(0,b.tZ)(K.ZT.Text,{strong:!0,editable:{editing:e,icon:(0,b.tZ)("span",null),onChange:t}},null!=(u=null==s?void 0:s.name)?u:r),(0,b.tZ)(Yd,null,d&&(0,b.tZ)(Ad,{style:{color:p.colors.success.base}}),n&&(0,b.tZ)(K.Gj,{overlay:f,placement:"bottomRight",trigger:["click"]},(0,b.tZ)(Hd,pt()({onClick:e=>{e.stopPropagation(),e.preventDefault()}},vu("filter-set-menu-button"),{buttonStyle:"link",buttonSize:"xsmall"}),(0,b.tZ)(Ld,null))))),(0,b.tZ)(Wd,{filterSet:s,dataMask:null!=(h=null==s?void 0:s.dataMask)?h:a}))},Qd=v.iK.div`
  display: grid;
  align-items: center;
  justify-content: center;
  grid-template-columns: 1fr;
  // 108px padding to make room for buttons with position: absolute
  padding-bottom: ${({theme:e})=>27*e.gridUnit}px;

  & button.superset-button {
    margin-left: 0;
  }
  & input {
    width: 100%;
  }
`,Xd=v.iK.div`
  ${({theme:e,"data-selected":t,onClick:n})=>`\n    display: grid;\n    align-items: center;\n    justify-content: center;\n    grid-template-columns: 1fr;\n    grid-gap: ${e.gridUnit}px;\n    border-bottom: 1px solid ${e.colors.grayscale.light2};\n    padding: ${2*e.gridUnit}px ${4*e.gridUnit}px;\n    cursor: ${n?"pointer":"auto"};\n    background: ${t?e.colors.primary.light5:"transparent"};\n  `}
`,ec=(0,l.t)("New filter set"),tc=({dataMaskSelected:e,onEditFilterSet:t,disabled:n,onFilterSelectionChange:i,tab:a})=>{const s=(0,r.I0)(),[l,d]=(0,o.useState)(ec),[c,u]=(0,o.useState)(!1),h=Md(),p=Ed(),f=Object.values(p),m=Id(),g=Object.values(m),[v,y]=(0,o.useState)(null);(0,o.useEffect)((()=>{var t;if(a===yd.AllFilters)return;if(!f.length)return void y(null);const n=ys({dataMaskSelected:e,filterSetFilterValues:f});y(null!=(t=null==n?void 0:n.id)?t:null)}),[a,e,f]);const C=(e,t)=>{var n,i,r;return!g.find((t=>(null==t?void 0:t.id)===e))||!(0,zi.JB)(null==(n=m[e])?void 0:n.controlValues,null==t||null==(i=t.nativeFilters)||null==(r=i[e])?void 0:r.controlValues,{ignoreUndefined:!0})},S=(e,t)=>{var n;const r=null==t?void 0:t.target;if(r){var o;const e=r.closest(`[data-anchor=${vu("filter-set-wrapper",!0)}]`);if(null!=e&&null!=(o=e.querySelector(".ant-collapse-header"))&&o.contains(r)||null!=r&&r.closest(".ant-dropdown"))return}if(y(e),!e)return;const a=p[e];(null!=(n=Object.values(null==a?void 0:a.dataMask))?n:[]).forEach((e=>{const{extraFormData:t,filterState:n,id:r}=e;C(r,a)||i({id:r},{extraFormData:t,filterState:n})}))};return(0,b.tZ)(Qd,null,!v&&(0,b.tZ)(Xd,null,(0,b.tZ)(Jd,{dataMaskSelected:e,editMode:c,setFilterSetName:d,filterSetName:l}),(0,b.tZ)(jd,{filterSetName:l.trim(),disabled:n,onCancel:()=>{u(!1),d(ec)},editMode:c,onEdit:()=>u(!0),onCreate:()=>{const e={name:l.trim(),nativeFilters:m,dataMask:Object.keys(m).reduce(((e,t)=>({...e,[t]:h[t]})),{})};s((0,Zd.xQ)(e)),u(!1),d(ec)}})),f.map((i=>(0,b.tZ)(Xd,pt()({},vu("filter-set-wrapper"),{"data-anchor":vu("filter-set-wrapper",!0),"data-selected":i.id===v,onClick:e=>S(i.id,e),key:i.id}),(0,b.tZ)(Jd,{isApplied:i.id===v&&!n,onDelete:()=>{return e=i.id,s((0,Zd.$l)(e)),void(e===v&&y(null));var e},onEdit:()=>{return e=i.id,S(e),void t(e);var e},onRebuild:()=>(e=>{var t;const n=p[e],i=Object.values(null!=(t=null==n?void 0:n.dataMask)?t:{}).filter((e=>{const{id:t}=e;return!C(t,n)})).reduce(((e,t)=>({...e,[t.id]:m[t.id]})),{}),r={...n,nativeFilters:i,dataMask:Object.keys(i).reduce(((e,t)=>{var i;return{...e,[t]:null==(i=n.dataMask)?void 0:i[t]}}),{})};s((0,Zd.ql)(r))})(i.id),dataMaskSelected:e,filterSet:i})))))};var nc=n(81788);const ic={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M464 720a48 48 0 1096 0 48 48 0 10-96 0zm16-304v184c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V416c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8zm475.7 440l-416-720c-6.2-10.7-16.9-16-27.7-16s-21.6 5.3-27.7 16l-416 720C56 877.4 71.4 904 96 904h832c24.6 0 40-26.6 27.7-48zm-783.5-27.9L512 239.9l339.8 588.2H172.2z"}}]},name:"warning",theme:"outlined"};var rc=function(e,t){return o.createElement(Ja.Z,Object.assign({},e,{ref:t,icon:ic}))};rc.displayName="WarningOutlined";const oc=o.forwardRef(rc),ac=v.iK.div`
  display: grid;
  grid-template-columns: 1fr;
  align-items: flex-start;
  justify-content: flex-start;
  grid-gap: ${({theme:e})=>e.gridUnit}px;
  background: ${({theme:e})=>e.colors.primary.light4};
  padding: ${({theme:e})=>2*e.gridUnit}px;
`,sc=(0,v.iK)(K.ZT.Text)`
  color: ${({theme:e})=>e.colors.primary.dark2};
`,lc=(0,v.iK)(K.ZT.Text)`
  font-size: ${({theme:e})=>e.typography.sizes.s}px;
  & .anticon {
    padding: ${({theme:e})=>e.gridUnit}px;
  }
`,dc=v.iK.div`
  display: flex;
  & button {
    ${({disabled:e})=>"pointer-events: "+(e?"none":"all")};
    flex: 1;
  }
`,cc=({filterSetId:e,onCancel:t,dataMaskSelected:n,disabled:i})=>{const a=Md(),s=(0,r.I0)(),d=Ed(),c=Id(),u=Object.values(d),[h,p]=(0,o.useState)(d[e].name),f=Od(h,d[e].name),m=(0,o.useMemo)((()=>ys({dataMaskSelected:n,filterSetFilterValues:u})),[n,u]),g=m&&m.id!==e,v=i||g||f;return(0,b.tZ)(ac,null,(0,b.tZ)(sc,{strong:!0},(0,l.t)("Editing filter set:")),(0,b.tZ)(sc,{editable:{editing:!0,icon:(0,b.tZ)("span",null),onChange:p}},h),(0,b.tZ)(Nd,null,(0,b.tZ)(B.Z,{ghost:!0,buttonStyle:"tertiary",buttonSize:"small",onClick:t},(0,l.t)("Cancel")),(0,b.tZ)(K._e,{placement:"right",title:f&&(0,l.t)("Filter set with this name already exists")||g&&(0,l.t)("Filter set already exists")||i&&vs},(0,b.tZ)(dc,{disabled:v},(0,b.tZ)(B.Z,pt()({disabled:v,buttonStyle:"primary",htmlType:"submit",buttonSize:"small",onClick:()=>{s((0,Zd.ql)({id:e,name:h,nativeFilters:c,dataMask:{...a}})),t()}},vu("filter-set-edit-save")),(0,l.t)("Save"))))),g&&(0,b.tZ)(lc,{mark:!0},(0,b.tZ)(oc,null),(0,l.t)('This filter set is identical to: "%s"',null==m?void 0:m.name)))},uc=(0,v.iK)(B.Z)`
  padding: 0;
`,hc=({createNewOnOpen:e,dashboardId:t,children:n})=>{const i=(0,r.I0)(),[a,s]=(0,o.useState)(!1);function l(){s(!1)}return(0,b.tZ)(o.Fragment,null,(0,b.tZ)(uc,pt()({},vu("create-filter"),{buttonStyle:"link",buttonSize:"xsmall",onClick:()=>s(!0)}),n),(0,b.tZ)(Fa,{isOpen:a,onSave:async function(e){i(await(0,Zd.RY)(e)),l()},onCancel:l,createNewOnOpen:e,key:`filters-for-${t}`}))},pc=v.iK.h4`
  display: flex;
  flex-direction: row;
  justify-content: space-between;
  margin: 0;
  padding: ${({theme:e})=>2*e.gridUnit}px;

  & > span {
    flex-grow: 1;
  }
`,fc=(0,v.iK)(B.Z)`
  padding: 0;
`,mc=v.iK.div`
  padding: ${({theme:e})=>e.gridUnit}px
    ${({theme:e})=>2*e.gridUnit}px;
`,gc=v.iK.div`
  ${({theme:e})=>b.iv`
    margin-top: ${2*e.gridUnit}px;

    & button > [role='img']:first-of-type {
      margin-right: ${e.gridUnit}px;
      line-height: 0;
    }

    span[role='img'] {
      padding-bottom: 1px;
    }

    .ant-btn > .anticon + span {
      margin-left: 0;
    }
  `}
`,vc=({toggleFiltersBar:e})=>{const t=(0,v.Fg)(),n=Id(),i=Object.values(n),o=(0,r.v9)((({dashboardInfo:e})=>e.dash_edit_perm)),a=(0,r.v9)((({dashboardInfo:e})=>e.id));return(0,b.tZ)(mc,null,(0,b.tZ)(pc,null,(0,b.tZ)("span",null,(0,l.t)("Filters")),(0,b.tZ)(fc,pt()({},vu("collapse-button"),{buttonStyle:"link",buttonSize:"xsmall",onClick:()=>e(!1)}),(0,b.tZ)(W.Z.Expand,{iconColor:t.colors.grayscale.base}))),o&&(0,b.tZ)(gc,null,(0,b.tZ)(hc,{dashboardId:a,createNewOnOpen:0===i.length},(0,b.tZ)(W.Z.PlusSmall,null)," ",(0,l.t)("Add/Edit Filters"))))};var bc,yc=n(90731),Cc=(bc=function(e,t){return bc=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},bc(e,t)},function(e,t){function n(){this.constructor=e}bc(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),Sc="html",xc="svg",wc=function(e){var t,n,i,r={};if(e===Sc)i=document.createElement("div");else{if(e!==xc)throw new Error('Invalid element type "'+e+'" for createPortalNode: must be "html" or "svg".');i=document.createElementNS("http://www.w3.org/2000/svg","g")}var o={element:i,elementType:e,setPortalProps:function(e){r=e},getInitialPortalProps:function(){return r},mount:function(i,r){if(r!==n){if(o.unmount(),i!==t&&!function(e,t){if(t===Sc)return e instanceof HTMLElement;if(t===xc)return e instanceof SVGElement;throw new Error('Unrecognized element type "'+t+'" for validateElementType.')}(i,e))throw new Error('Invalid element type for portal: "'+e+'" portalNodes must be used with '+e+" elements, but OutPortal is within <"+i.tagName+">.");i.replaceChild(o.element,r),t=i,n=r}},unmount:function(e){e&&e!==n||t&&n&&(t.replaceChild(n,o.element),t=void 0,n=void 0)}};return o},kc=function(e){function t(t){var n=e.call(this,t)||this;return n.addPropsChannel=function(){Object.assign(n.props.node,{setPortalProps:function(e){n.setState({nodeProps:e})}})},n.state={nodeProps:n.props.node.getInitialPortalProps()},n}return Cc(t,e),t.prototype.componentDidMount=function(){this.addPropsChannel()},t.prototype.componentDidUpdate=function(){this.addPropsChannel()},t.prototype.render=function(){var e=this,t=this.props,n=t.children,i=t.node;return yc.createPortal(o.Children.map(n,(function(t){return o.isValidElement(t)?o.cloneElement(t,e.state.nodeProps):t})),i.element)},t}(o.PureComponent),Zc=function(e){function t(t){var n=e.call(this,t)||this;return n.placeholderNode=o.createRef(),n.passPropsThroughPortal(),n}return Cc(t,e),t.prototype.passPropsThroughPortal=function(){var e=Object.assign({},this.props,{node:void 0});this.props.node.setPortalProps(e)},t.prototype.componentDidMount=function(){var e=this.props.node;this.currentPortalNode=e;var t=this.placeholderNode.current,n=t.parentNode;e.mount(n,t),this.passPropsThroughPortal()},t.prototype.componentDidUpdate=function(){var e=this.props.node;this.currentPortalNode&&e!==this.currentPortalNode&&(this.currentPortalNode.unmount(this.placeholderNode.current),this.currentPortalNode=e);var t=this.placeholderNode.current,n=t.parentNode;e.mount(n,t),this.passPropsThroughPortal()},t.prototype.componentWillUnmount=function(){this.props.node.unmount(this.placeholderNode.current)},t.prototype.render=function(){return o.createElement("div",{ref:this.placeholderNode})},t}(o.PureComponent),Rc=wc.bind(null,Sc),Tc=(wc.bind(null,xc),n(28368)),Fc=n.n(Tc);const Dc=w()(((e,t)=>{e(t?(0,Zd.$7)(t):(0,Zd.Up)())}),300),_c=v.iK.div`
  & > div {
    height: auto !important;
    min-height: ${32}px;
  }
`,Ec=[{data:[{}]}],Ic=[nr.cg.NATIVE_FILTER],Mc=({dataMaskSelected:e,filter:t,directPathToChild:n,onFilterSelectionChange:i,inView:a=!0,showOverflow:s,parentRef:c,setFilterActive:h})=>{var p,f,m;const{id:g,targets:v,filterType:y,adhoc_filters:C,time_range:S}=t,x=(0,tr.Z)().get(y),w=function(e,t){const n=(0,r.v9)((t=>{var n;return null==(n=t.nativeFilters.filters[e])?void 0:n.cascadeParentIds}));return(0,o.useMemo)((()=>{let e={};return(0,br.Z)(n).forEach((n=>{const i=null==t?void 0:t[n];e=(0,qi.on)(e,null==i?void 0:i.extraFormData)})),e}),[t,n])}(g,e),k=(()=>{const e=(0,r.v9)((e=>e.dashboardState.isRefreshing)),t=(0,r.v9)((e=>e.dashboardState.isFiltersRefreshing));return!e&&t})(),[Z,R]=(0,o.useState)([]),[T,F]=(0,o.useState)(""),[D,_]=(0,o.useState)({inView:!1}),[E,I]=(0,o.useState)({}),[M,O]=(0,o.useState)(a),P=(0,o.useRef)(null),[N]=v,{datasetId:j,column:q={}}=N,{name:z}=q,A=!!j,[$,U]=(0,o.useState)(A),[L,V]=(0,o.useState)(!1),K=(0,r.I0)(),B=(0,o.useCallback)((()=>{V(!1),U(!1),k&&K((0,Lt.YC)())}),[K,k]);(0,o.useEffect)((()=>{!M&&a&&O(!0)}),[a,M,O]),(0,o.useEffect)((()=>{var e;if(!M)return;const n=(0,qi.zi)({...t,datasetId:j,dependencies:w,groupby:z,adhoc_filters:C,time_range:S}),i=(null==(e=t.dataMask)?void 0:e.ownState)||{};if(!L&&(!Fc()(D,n,((e,t,n)=>"url_params"===n||void 0))||!Hi()(E,i)||k)){if(_(n),I(i),!A)return;V(!0),(0,ji.getChartDataRequest)({formData:n,force:!1,requestParams:{dashboardId:0},ownState:i}).then((({response:e,json:t})=>{if((0,st.cr)(d.T.GLOBAL_ASYNC_QUERIES)){const n="result"in t?t.result[0]:t;if(200===e.status)R([n]),B();else{if(202!==e.status)throw new Error(`Received unexpected response status (${e.status}) while fetching chart data`);(0,go.YJ)(n).then((e=>{R(e),B()})).catch((e=>{F(e.message||e.error||(0,l.t)("Check configuration")),B()}))}}else R(t.result),F(""),B()})).catch((e=>{F(e.statusText),B()}))}}),[M,w,j,z,B,JSON.stringify(t),A,L,k]),(0,o.useEffect)((()=>{var e;(null==n?void 0:n[0])===t.id&&(null==P||null==(e=P.current)||e.focus())}),[P,n,t.id]);const W=(0,o.useCallback)((e=>i(t,e)),[t,i]),H=(0,o.useCallback)((()=>Dc(K,g)),[K,g]),G=(0,o.useCallback)((()=>Dc(K)),[K]),Y=(0,o.useMemo)((()=>({setDataMask:W,setFocusedFilter:H,unsetFocusedFilter:G,setFilterActive:h})),[W,h,H,G]),J=kd(t,null==(p=t.dataMask)?void 0:p.filterState),Q=(0,o.useMemo)((()=>{var e;return{...null==(e=t.dataMask)?void 0:e.filterState,validateStatus:J&&"error"}}),[null==(f=t.dataMask)?void 0:f.filterState,J]);return T?(0,b.tZ)(po,{title:(0,l.t)("Cannot load filter"),body:T,level:"error"}):(0,b.tZ)(_c,null,$?(0,b.tZ)(u.Z,{position:"inline-centered"}):(0,b.tZ)(Mo.Z,{height:32,width:"100%",showOverflow:s,formData:D,parentRef:c,inputRef:P,queriesData:A?Z:Ec,chartType:y,behaviors:Ic,filterState:Q,ownState:null==(m=t.dataMask)?void 0:m.ownState,enableNoResults:null==x?void 0:x.enableNoResults,isRefreshing:L,hooks:Y}))},Oc=e=>{var t,n;return(null==e||null==(t=e.meta)?void 0:t.text)||(null==e||null==(n=e.meta)?void 0:n.defaultText)||""},Pc=e=>{var t,n;return(null==e||null==(t=e.meta)?void 0:t.sliceNameOverride)||(null==e||null==(n=e.meta)?void 0:n.sliceName)||(null==e?void 0:e.id)||""},Nc=v.iK.div`
  ${({theme:e})=>b.iv`
    display: flex;
    align-items: center;
    margin: ${e.gridUnit}px 0;
    font-size: ${e.typography.sizes.s}px;

    &:first-of-type {
      margin-top: 0;
    }

    &:last-of-type {
      margin-bottom: 0;
    }

    & .ant-tooltip-open {
      display: inline-flex;
    }
  `};
`,jc=v.iK.span`
  ${({theme:e})=>b.iv`
    color: ${e.colors.grayscale.base};
    padding-right: ${4*e.gridUnit}px;
    margin-right: auto;
    text-transform: uppercase;
    white-space: nowrap;
  `};
`,qc=v.iK.div`
  ${({theme:e})=>b.iv`
    color: ${e.colors.grayscale.dark1};
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    display: inline;
  `};
`,zc=v.iK.span`
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
`,Ac=v.iK.span`
  text-decoration: underline;
  cursor: pointer;
`,$c=v.iK.span`
  ${({theme:e})=>b.iv`
    color: ${e.colors.primary.base};
  `}
`,Uc=v.iK.ul`
  ${({theme:e})=>b.iv`
    padding-left: ${3*e.gridUnit}px;
    margin-bottom: 0;
  `};
`,Lc=v.iK.span`
  font-weight: ${({theme:e})=>e.typography.weights.bold};
`,Vc=v.iK.div`
  min-width: 0;
  display: inline-flex;
  white-space: nowrap;
`,Kc=e=>{var t,n;const[i,r]=(0,o.useState)(0),[a,s]=(0,o.useState)(!1),l=(0,o.useRef)({scrollWidth:0,parentElementWidth:0});return(0,o.useLayoutEffect)((()=>{var t;const n=e.current;if(!n)return;const{scrollWidth:i,clientWidth:o,childNodes:a}=n,d=l.current,c=(null==(t=n.parentElement)?void 0:t.clientWidth)||0;if(l.current={scrollWidth:i,parentElementWidth:c},d.parentElementWidth!==c||d.scrollWidth!==i)if(i>o){const e=o-6,t=a.length;let n=0,i=0;for(;n<e;)n+=a[i].offsetWidth,i+=1;i===t?(r(1),s(!1)):(r(t-i),s(!0))}else r(0)}),[null==(t=e.current)?void 0:t.offsetWidth,null==(n=e.current)?void 0:n.clientWidth,e]),[i,a]},Bc=({title:e,children:t,...n})=>(0,b.tZ)(ct.u,pt()({title:e,placement:"bottom",overlayClassName:"filter-card-tooltip"},n),(0,b.tZ)(Vc,null,t)),Wc=(e,t)=>Array.isArray(e)&&e.length>0?(0,b.tZ)(o.Fragment,null,(0,b.tZ)(Lc,null,t,":"),(0,b.tZ)(Uc,null,e.map((e=>(0,b.tZ)("li",null,e))))):null,Hc=o.memo((({filter:e})=>{const t=(e=>{const t=(0,r.v9)((e=>e.dashboardLayout.present)),n=(()=>{const e=(0,r.v9)((e=>e.charts));return(0,o.useMemo)((()=>Object.values(e)),[e])})();return(0,o.useMemo)((()=>{let i;const r=t[H._4].children[0];if(r.startsWith("TABS-")&&(i=t[r].children),0===e.scope.rootPath.length)return;if(0===e.scope.excluded.length&&(e.scope.rootPath[0]===H._4||i&&i.every((t=>e.scope.rootPath.includes(t)))))return{all:[(0,l.t)("All charts")]};if(0===e.scope.excluded.length&&i)return{tabs:e.scope.rootPath.map((e=>Oc(t[e]))).filter(Boolean)};const o=Object.values(t).filter((e=>e.type===h.dW));if(e.scope.rootPath[0]===H._4)return{charts:n.filter((t=>!e.scope.excluded.includes(t.id))).map((e=>{const t=o.find((t=>t.meta.chartId===e.id));return Pc(t)})).filter(Boolean)};if(i){const i=[...e.scope.rootPath],r=o.filter((e=>e.parents.some((e=>i.includes(e)))));e.scope.excluded.forEach((e=>{const t=i.findIndex((t=>{var n;return null==(n=r.find((t=>t.meta.chartId===e)))?void 0:n.parents.includes(t)}));t>-1&&i.splice(t,1)}));const a=n.filter((t=>!e.scope.excluded.includes(t.id))).reduce(((e,t)=>{const n=r.find((e=>e.meta.chartId===t.id&&e.parents.every((e=>!i.includes(e)))));return n&&e.push(n),e}),[]);return{tabs:i.map((e=>Oc(t[e]))).filter(Boolean),charts:a.map(Pc).filter(Boolean)}}}),[n,e.scope.excluded,e.scope.rootPath,t])})(e),n=(0,o.useRef)(null),[i,a]=Kc(n),s=(0,o.useMemo)((()=>0!==i&&t?t.all?(0,b.tZ)("span",null,(0,l.t)("All charts")):(0,b.tZ)("div",null,Wc(t.tabs,(0,l.t)("Tabs")),Wc(t.charts,(0,l.t)("Charts"))):null),[i,t]);return(0,b.tZ)(Nc,null,(0,b.tZ)(jc,null,(0,l.t)("Scope")),(0,b.tZ)(Bc,{title:s},(0,b.tZ)(qc,{ref:n},t?Object.values(t).flat().map(((e,t)=>(0,b.tZ)("span",null,0===t?e:`, ${e}`))):(0,l.t)("None")),a>0&&(0,b.tZ)($c,null,"+",i)))})),Gc=({dependency:e,hasSeparator:t})=>{const n=(0,r.I0)(),i=(0,o.useCallback)((()=>{n((0,Lt.E2)([e.id]))}),[e.id,n]);return(0,b.tZ)("span",null,t&&(0,b.tZ)("span",null,", "),(0,b.tZ)(Ac,{role:"button",onClick:i,tabIndex:0},e.name))},Yc=o.memo((({filter:e})=>{const t=(e=>{const t=(0,br.Z)(e.cascadeParentIds);return(0,r.v9)((e=>0===t.length?[]:t.reduce(((t,n)=>(t.push(e.nativeFilters.filters[n]),t)),[])))})(e),n=(0,o.useRef)(null),[i,a]=Kc(n),s=(0,v.Fg)(),d=(0,o.useMemo)((()=>i>0&&t?(0,b.tZ)(Uc,null,t.map((e=>(0,b.tZ)("li",null,(0,b.tZ)(Gc,{dependency:e}))))):null),[i,t]);return Array.isArray(t)&&0!==t.length?(0,b.tZ)(Nc,null,(0,b.tZ)(jc,{css:b.iv`
          display: inline-flex;
          align-items: center;
        `},(0,l.t)("Dependent on")," ",(0,b.tZ)(Bc,{title:(0,l.t)("Filter only displays values relevant to selections made in other filters.")},(0,b.tZ)(W.Z.Info,{iconSize:"m",iconColor:s.colors.grayscale.light1,css:b.iv`
              margin-left: ${s.gridUnit}px;
            `}))),(0,b.tZ)(Bc,{title:d},(0,b.tZ)(qc,{ref:n},t.map(((e,t)=>(0,b.tZ)(Gc,{dependency:e,hasSeparator:0!==t})))),a&&(0,b.tZ)($c,null,"+",i))):null})),Jc=({filter:e})=>{const t=(0,o.useRef)(null),[n]=Kc(t);return(0,b.tZ)(Nc,{css:e=>b.iv`
          margin-bottom: ${3*e.gridUnit}px;
        `},(0,b.tZ)(W.Z.FilterSmall,{css:e=>b.iv`
            margin-right: ${e.gridUnit}px;
          `}),(0,b.tZ)(Bc,{title:n?e.name:null},(0,b.tZ)(zc,{ref:t},e.name)))},Qc=({filter:e})=>{const t=(0,o.useMemo)((()=>(0,tr.Z)().get(e.filterType)),[e.filterType]);return(0,b.tZ)(Nc,null,(0,b.tZ)(jc,null,(0,l.t)("Filter type")),(0,b.tZ)(qc,null,null==t?void 0:t.name))},Xc=({filter:e})=>(0,b.tZ)("div",null,(0,b.tZ)(Jc,{filter:e}),(0,b.tZ)(Qc,{filter:e}),(0,b.tZ)(Hc,{filter:e}),(0,b.tZ)(Yc,{filter:e})),eu=({children:e,filter:t,getPopupContainer:n,isVisible:i=!0})=>{const[r,a]=(0,o.useState)(!1);return(0,o.useEffect)((()=>{i||a(!1)}),[i]),(0,b.tZ)(as.ZP,{placement:"right",overlayClassName:"filter-card-popover",mouseEnterDelay:.2,mouseLeaveDelay:.2,onVisibleChange:e=>{a(i&&e)},visible:i&&r,content:(0,b.tZ)(Xc,{filter:t}),getPopupContainer:null!=n?n:()=>document.body,destroyTooltipOnHide:!0},e)},tu=v.iK.div`
  position: absolute;
  right: 0;
`,nu=v.iK.h4`
  font-size: ${({theme:e})=>e.typography.sizes.s}px;
  color: ${({theme:e})=>e.colors.grayscale.dark1};
  margin: 0;
  overflow-wrap: break-word;
`,iu=v.iK.div`
  display: flex;
  flex-direction: row;
  align-items: center;
  justify-content: space-between;
  margin-bottom: ${({theme:e})=>e.gridUnit}px;
`,ru=(0,v.iK)(Dt.l0)`
  width: 100%;
  && .ant-form-item-label > label {
    text-transform: none;
    width: 100%;
    padding-right: ${({theme:e})=>11*e.gridUnit}px;
  }
  .ant-form-item-tooltip {
    margin-bottom: ${({theme:e})=>e.gridUnit}px;
  }
`,ou=(0,v.iK)(Dt.xJ)`
  .ant-form-item-label {
    label.ant-form-item-required:not(.ant-form-item-required-mark-optional) {
      &::after {
        display: none;
      }
    }
  }
`,au=v.iK.div`
  font-size: ${({theme:e})=>e.typography.sizes.m}px;
  display: flex;
`,su=()=>(0,b.tZ)("span",{css:e=>({color:e.colors.error.base,fontSize:`${e.typography.sizes.s}px`,paddingLeft:"1px"})},"*"),lu=({description:e})=>(0,b.tZ)(au,null,(0,b.tZ)(ct.u,{title:e,placement:"right",overlayInnerStyle:{display:"-webkit-box",overflow:"hidden",WebkitLineClamp:20,WebkitBoxOrient:"vertical",textOverflow:"ellipsis"}},(0,b.tZ)("i",{className:"fa fa-info-circle text-muted",css:e=>({paddingLeft:`${e.gridUnit}px`,cursor:"pointer"})}))),du=({dataMaskSelected:e,filter:t,icon:n,onFilterSelectionChange:i,directPathToChild:r,inView:a,showOverflow:s,parentRef:l})=>{var d,c,u;const[h,p]=(0,o.useState)(!1),{name:f="<undefined>"}=t,m=kd(t,null==(d=t.dataMask)?void 0:d.filterState),g=!(null==(c=t.controlValues)||!c.enableEmptyFilter),v=(0,o.useMemo)((()=>(0,b.tZ)(iu,null,(0,b.tZ)(nu,null,f),g&&(0,b.tZ)(su,null),t.description&&t.description.trim()&&(0,b.tZ)(lu,{description:t.description}),(0,b.tZ)(tu,null,n))),[f,g,t.description,n]),y=(0,o.useContext)(Tu);return(0,b.tZ)(ru,{layout:"vertical"},(0,b.tZ)(eu,{filter:t,isVisible:!h&&!y},(0,b.tZ)("div",null,(0,b.tZ)(ou,{label:v,required:null==t||null==(u=t.controlValues)?void 0:u.enableEmptyFilter,validateStatus:m?"error":void 0},(0,b.tZ)(Mc,{dataMaskSelected:e,filter:t,showOverflow:s,directPathToChild:r,onFilterSelectionChange:i,inView:a,parentRef:l,setFilterActive:p})))))},cu=o.memo(du),uu=v.iK.div`
  padding: ${({theme:e})=>4*e.gridUnit}px;
  // 108px padding to make room for buttons with position: absolute
  padding-bottom: ${({theme:e})=>27*e.gridUnit}px;
`,hu=({directPathToChild:e,dataMaskSelected:t,onFilterSelectionChange:n})=>{const i=Id(),a=(0,o.useMemo)((()=>Object.values(i)),[i]),s=(0,o.useMemo)((()=>{const e=new Array(a.length);for(let t=0;t<a.length;t+=1)e[t]=Rc();return e}),[a.length]),d=(0,o.useMemo)((()=>a.map((e=>({...e,dataMask:t[e.id]})))),[a,t]),c=new Set(d.map((e=>e.id))),[u,p]=function(e){const t=jr(),n=function(){const e=(0,r.v9)((e=>{var t;return null==(t=e.dashboardState)?void 0:t.activeTabs})),t=function(){const e=Nr();return t=>{const n=Object.values(e).find((e=>{var n;return(null==(n=e.meta)?void 0:n.chartId)===t}));return null==n?void 0:n.parents.filter((t=>e[t].type===h.gn))}}();return n=>{var i;return(0,Mr.nY)(n)||"chartsInScope"in n&&(null==(i=n.chartsInScope)?void 0:i.some((n=>{const i=t(n);return 0===(null==i?void 0:i.length)||(null==i?void 0:i.every((t=>e.includes(t))))})))}}();return(0,o.useMemo)((()=>{let i=[];const r=[];return t?e.forEach((e=>{n(e)?i.push(e):r.push(e)})):i=e,[i,r]}),[e,t,n])}(d),f=jr()&&d.length>0,m=(0,o.useCallback)((i=>{const r=d[i];return(0,Mr.nY)(r)?(0,b.tZ)("div",null,(0,b.tZ)("h3",null,r.title),(0,b.tZ)("p",null,r.description)):(0,b.tZ)(cu,{dataMaskSelected:t,filter:r,directPathToChild:e,onFilterSelectionChange:n,inView:!1})}),[d,JSON.stringify(t),e,n]);return(0,b.tZ)(uu,null,s.filter(((e,t)=>c.has(a[t].id))).map(((e,t)=>(0,b.tZ)(kc,{node:e},m(t)))),u.map((e=>{const t=a.findIndex((t=>t.id===e.id));return(0,b.tZ)(Zc,{node:s[t],inView:!0})})),f&&(0,b.tZ)(K.Ol,{ghost:!0,bordered:!0,expandIconPosition:"right",collapsible:0===p.length?"disabled":void 0,css:e=>(0,b.iv)("&.ant-collapse{margin-top:",u.length>0?6*e.gridUnit:0,"px;&>.ant-collapse-item{&>.ant-collapse-header{padding-left:0;padding-bottom:",2*e.gridUnit,"px;&>.ant-collapse-arrow{right:",e.gridUnit,"px;}}& .ant-collapse-content-box{padding:",4*e.gridUnit,"px 0 0;}}}","")},(0,b.tZ)(K.Ol.Panel,{header:(0,l.t)("Filters out of scope (%d)",p.length),key:"1"},p.map((e=>{const t=d.findIndex((t=>t.id===e.id));return(0,b.tZ)(Zc,{node:s[t],inView:!0})})))))},pu=o.memo(hu);var fu=n(49484);const mu=v.iK.div`
  ${({theme:e,width:t})=>b.iv`
    display: flex;
    flex-direction: column;
    align-items: center;

    position: fixed;
    z-index: 100;

    // filter bar width minus 1px for border
    width: ${t-1}px;
    bottom: 0;

    padding: ${4*e.gridUnit}px;
    padding-top: ${6*e.gridUnit}px;

    background: linear-gradient(
      ${(0,fu.rgba)(e.colors.grayscale.light5,0)},
      ${e.colors.grayscale.light5} ${e.opacity.mediumLight}
    );

    pointer-events: none;

    & > button {
      pointer-events: auto;
    }

    & > .filter-apply-button {
      margin-bottom: ${3*e.gridUnit}px;
    }

    && > .filter-clear-all-button {
      color: ${e.colors.grayscale.base};
      margin-left: 0;
      &:hover {
        color: ${e.colors.primary.dark1};
      }

      &[disabled],
      &[disabled]:hover {
        color: ${e.colors.grayscale.light1};
      }
    }
  `};
`,gu=({width:e=Gs.I6,onApply:t,onClearAll:n,dataMaskApplied:i,dataMaskSelected:r,isApplyDisabled:a})=>{const s=(0,o.useMemo)((()=>Object.values(i).some((e=>{var t,n,i;return!(0,_a.Rw)(null==(t=r[e.id])||null==(n=t.filterState)?void 0:n.value)||!r[e.id]&&!(0,_a.Rw)(null==(i=e.filterState)?void 0:i.value)}))),[i,r]);return(0,b.tZ)(mu,{width:e},(0,b.tZ)(B.Z,pt()({disabled:a,buttonStyle:"primary",htmlType:"submit",className:"filter-apply-button",onClick:t},vu("apply-button")),(0,l.t)("Apply filters")),(0,b.tZ)(B.Z,pt()({disabled:!s,buttonStyle:"link",buttonSize:"small",className:"filter-clear-all-button",onClick:n},vu("clear-button")),(0,l.t)("Clear all")))},vu=(0,Ir.Q)("filter-bar"),bu=v.iK.div`
  width: ${({theme:e})=>8*e.gridUnit}px;

  & .ant-tabs-top > .ant-tabs-nav {
    margin: 0;
  }
  &.open {
    width: ${({width:e})=>e}px; // arbitrary...
  }
`,yu=v.iK.div`
  & .ant-typography-edit-content {
    left: 0;
    margin-top: 0;
    width: 100%;
  }
  position: absolute;
  top: 0;
  left: 0;
  flex-direction: column;
  flex-grow: 1;
  width: ${({width:e})=>e}px;
  background: ${({theme:e})=>e.colors.grayscale.light5};
  border-right: 1px solid ${({theme:e})=>e.colors.grayscale.light2};
  border-bottom: 1px solid ${({theme:e})=>e.colors.grayscale.light2};
  min-height: 100%;
  display: none;
  &.open {
    display: flex;
  }
`,Cu=v.iK.div`
  position: absolute;
  top: ${({offset:e})=>e}px;
  left: 0;
  height: 100%;
  width: ${({theme:e})=>8*e.gridUnit}px;
  padding-top: ${({theme:e})=>2*e.gridUnit}px;
  display: none;
  text-align: center;
  &.open {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: ${({theme:e})=>2*e.gridUnit}px;
  }
  svg {
    cursor: pointer;
  }
`,Su=(0,v.iK)(W.Z.Collapse)`
  color: ${({theme:e})=>e.colors.primary.base};
  margin-bottom: ${({theme:e})=>3*e.gridUnit}px;
`,xu=(0,v.iK)(W.Z.Filter)`
  color: ${({theme:e})=>e.colors.grayscale.base};
`,wu=(0,v.iK)(K.D6)`
  & .ant-tabs-nav-list {
    width: 100%;
  }
  & .ant-tabs-tab {
    display: flex;
    justify-content: center;
    margin: 0;
    flex: 1;
  }

  & > .ant-tabs-nav .ant-tabs-nav-operations {
    display: none;
  }
`,ku=v.iK.div`
  margin-top: ${({theme:e})=>8*e.gridUnit}px;
`,Zu=[gt.KD.nativeFilters.name,gt.KD.permalinkKey.name],Ru=w()((async(e,t,n,i,r)=>{const{location:o}=e,{search:a}=o,s=new URLSearchParams(a),l=new URLSearchParams;let d;s.forEach(((e,t)=>{Zu.includes(t)||l.append(t,e)}));const c=(0,yt.eY)(gt.KD.nativeFiltersKey),u=JSON.stringify(i);d=n&&c&&await(0,nc.TZ)(t,u,c,r)?c:await(0,nc.u7)(t,u,r),d&&l.set(gt.KD.nativeFiltersKey.name,d),e.location.pathname=window.location.pathname,e.replace({search:l.toString()})}),Er.M),Tu=(0,o.createContext)(!1),Fu=({filtersOpen:e,toggleFiltersBar:t,directPathToChild:n,width:i,height:a,offset:s})=>{const c=(0,Gi.k6)(),h=Md(),[p,f]=(0,o.useState)(null),[g,v]=(0,Cd.x)(h),y=(0,r.I0)(),[C,S]=(0,o.useState)(0),x=(0,xd.z)(),w=Ed(),k=Object.values(w),[Z,R]=(0,o.useState)(yd.AllFilters),T=Id(),F=(0,ya.D)(T),D=Object.values(T),_=D.filter(Mr.kI),E=(0,r.v9)((({dashboardInfo:e})=>null==e?void 0:e.id)),I=(0,r.v9)((({dashboardInfo:e})=>e.dash_edit_perm)),[M,O]=(0,o.useState)(!1),P=(0,o.useRef)(),N=(0,o.useCallback)(((e,t)=>{v((n=>{var i,r,o;void 0!==(null==(i=t.filterState)?void 0:i.value)&&void 0===(null==(r=g[e.id])||null==(o=r.filterState)?void 0:o.value)&&e.requiredFirst&&y((0,it.eG)(e.id,t)),n[e.id]={...(0,Sd.H)(e.id),...t}}))}),[g,y,v]);(0,o.useEffect)((()=>{if(F){const e={};Object.values(T).forEach((t=>{const n=null==F?void 0:F[t.id];if(!n)return;const i=t.filterType,r=t.targets,o=t.defaultDataMask,a=null==n?void 0:n.filterType,s=null==n?void 0:n.targets,l=null==n?void 0:n.defaultDataMask,d=i!==a,c=!Hi()(r,s),u=!Hi()(o,l);(d||c||u)&&(e[t.id]=(0,Sd.H)(t.id))})),Kt()(e)||(v((t=>({...t,...e}))),Object.keys(e).forEach((e=>y((0,it.ze)(e)))))}}),[JSON.stringify(T),JSON.stringify(F)]);const j=JSON.stringify(h);(0,o.useEffect)((()=>{v((()=>h))}),[j,v]),(0,o.useEffect)((()=>{Ru(c,E,C,h,x)}),[E,j,c,C,x]);const q=(0,o.useCallback)((()=>{const e=Object.keys(g);S(1),e.forEach((e=>{g[e]&&y((0,it.eG)(e,g[e]))}))}),[g,y]),z=(0,o.useCallback)((()=>{Object.keys(g).forEach((e=>{g[e]&&(y((0,it.ze)(e)),v((t=>{var n;void 0!==(null==(n=t[e].filterState)?void 0:n.value)&&(t[e].filterState.value=void 0)})))}))}),[g,y,v]),A=(0,o.useCallback)((()=>t(!0)),[t]),$=(0,o.useCallback)(le()((()=>{clearTimeout(P.current),O(!0),P.current=setTimeout((()=>{O(!1)}),300)}),200),[]);(0,o.useEffect)((()=>(document.onscroll=$,()=>{document.onscroll=null})),[$]),((e,t)=>{const n=Id(),i=Md();(0,o.useEffect)((()=>{Object.keys(e).forEach((e=>{n[e]||t((t=>{delete t[e]}))}))}),[i,e,n,t])})(g,v);const U=((e,t,n)=>{const i=Object.values(e),r=Object.values(t);return(0,zi.JB)(wd(e),wd(t),{ignoreUndefined:!0})||i.length!==r.length||n.some((t=>{var n;return kd(t,null==e||null==(n=e[null==t?void 0:t.id])?void 0:n.filterState)}))})(g,h,_),L=(()=>{const[e,t]=(0,o.useState)(!1),n=Id(),i=(0,o.useContext)(_d.MigrationContext);let a=(0,r.v9)((e=>e.charts)),s=0;if(!e)if(i===Y.Qi.REVIEWING){a=Td()(Dd()(a,(e=>{var t;return"filter_box"!==(null==(t=e.form_data)?void 0:t.viz_type)})),"id");const e=document.querySelectorAll('[data-test-viz-type="filter_box"]').length;s=document.querySelectorAll('[data-ui-anchor="chart"]').length-e}else s=document.querySelectorAll('[data-ui-anchor="chart"]').length;return(0,o.useEffect)((()=>{if(e)return;if(Object.values(n).find((({requiredFirst:e})=>e)))return void t(!0);let i;0===s&&(i=setTimeout((()=>{t(!0)}),1e3)),s>0&&void 0!==i&&clearTimeout(i);const r=Object.values(a).filter((({chartStatus:e})=>"loading"!==e)).length;s>0&&r>=s&&t(!0)}),[a,e,s]),e})(),V=(0,o.useMemo)((()=>({overflow:"auto",height:a,overscrollBehavior:"contain"})),[a]),B=_.length;return(0,b.tZ)(Tu.Provider,{value:M},(0,b.tZ)(bu,pt()({},vu(),{className:m()({open:e}),width:i}),(0,b.tZ)(Cu,pt()({},vu("collapsable"),{className:m()({open:!e}),onClick:A,offset:s}),(0,b.tZ)(Su,pt()({},vu("expand-button"),{iconSize:"l"})),(0,b.tZ)(xu,pt()({},vu("filter-icon"),{iconSize:"l"}))),(0,b.tZ)(yu,{className:m()({open:e}),width:i},(0,b.tZ)(vc,{toggleFiltersBar:t}),L?(0,st.cr)(d.T.DASHBOARD_NATIVE_FILTERS_SET)?(0,b.tZ)(wu,{centered:!0,onChange:R,defaultActiveKey:yd.AllFilters,activeKey:p?yd.AllFilters:void 0},(0,b.tZ)(K.D6.TabPane,{tab:(0,l.t)("All filters (%(filterCount)d)",{filterCount:B}),key:yd.AllFilters,css:V},p&&(0,b.tZ)(cc,{dataMaskSelected:g,disabled:!U,onCancel:()=>f(null),filterSetId:p}),0===D.length?(0,b.tZ)(ku,null,(0,b.tZ)(Yl.Tc,{title:(0,l.t)("No filters are currently added"),image:"filter.svg",description:I&&(0,l.t)("Click the button above to add a filter to the dashboard")})):(0,b.tZ)(pu,{dataMaskSelected:g,directPathToChild:n,onFilterSelectionChange:N})),(0,b.tZ)(K.D6.TabPane,{disabled:!!p,tab:(0,l.t)("Filter sets (%(filterSetCount)d)",{filterSetCount:k.length}),key:yd.FilterSets,css:V},(0,b.tZ)(tc,{onEditFilterSet:f,disabled:!U,dataMaskSelected:g,tab:Z,onFilterSelectionChange:N}))):(0,b.tZ)("div",{css:V,onScroll:$},0===D.length?(0,b.tZ)(ku,null,(0,b.tZ)(Yl.Tc,{title:(0,l.t)("No filters are currently added"),image:"filter.svg",description:I&&(0,l.t)("Click the button above to add a filter to the dashboard")})):(0,b.tZ)(pu,{dataMaskSelected:g,directPathToChild:n,onFilterSelectionChange:N})):(0,b.tZ)("div",{css:(0,b.iv)({height:a},"","")},(0,b.tZ)(u.Z,null)),(0,b.tZ)(gu,{width:i,onApply:q,onClearAll:z,dataMaskSelected:g,dataMaskApplied:h,isApplyDisabled:U}))))},Du=o.memo(Fu),_u=e=>{const t=e[H._4],n=null==t?void 0:t.children[0];return n===H.PV?e[H._4]:e[n]},Eu=(e,t)=>"ant-tabs-nav-wrap"===e.target.className||t.contains(e.target);var Iu=n(78718),Mu=n.n(Iu);const Ou={depth:s().number.isRequired,editMode:s().bool.isRequired,gridComponent:G.cP.isRequired,handleComponentDrop:s().func.isRequired,isComponentVisible:s().bool.isRequired,resizeComponent:s().func.isRequired,setDirectPathToChild:s().func.isRequired,width:s().number.isRequired,dashboardId:s().number},Pu=e=>e.dropIndicatorProps&&(0,b.tZ)("div",{className:"drop-indicator drop-indicator--bottom"}),Nu=e=>e.dropIndicatorProps&&(0,b.tZ)("div",{className:"drop-indicator drop-indicator--top"}),ju=v.iK.div`
  position: absolute;
  top: 0;
  bottom: 0;
  left: 0;
  right: 0;
`;class qu extends o.PureComponent{constructor(e){super(e),this.state={isResizing:!1,rowGuideTop:null},this.handleResizeStart=this.handleResizeStart.bind(this),this.handleResize=this.handleResize.bind(this),this.handleResizeStop=this.handleResizeStop.bind(this),this.handleTopDropTargetDrop=this.handleTopDropTargetDrop.bind(this),this.getRowGuidePosition=this.getRowGuidePosition.bind(this),this.setGridRef=this.setGridRef.bind(this),this.handleChangeTab=this.handleChangeTab.bind(this)}getRowGuidePosition(e){return e&&this.grid?e.getBoundingClientRect().bottom-this.grid.getBoundingClientRect().top-2:null}setGridRef(e){this.grid=e}handleResizeStart({ref:e,direction:t}){let n=null;"bottom"!==t&&"bottomRight"!==t||(n=this.getRowGuidePosition(e)),this.setState((()=>({isResizing:!0,rowGuideTop:n})))}handleResize({ref:e,direction:t}){"bottom"!==t&&"bottomRight"!==t||this.setState((()=>({rowGuideTop:this.getRowGuidePosition(e)})))}handleResizeStop({id:e,widthMultiple:t,heightMultiple:n}){this.props.resizeComponent({id:e,width:t,height:n}),this.setState((()=>({isResizing:!1,rowGuideTop:null})))}handleTopDropTargetDrop(e){e&&this.props.handleComponentDrop({...e,destination:{...e.destination,index:0}})}handleChangeTab({pathToTabIndex:e}){this.props.setDirectPathToChild(e)}render(){var e,t,n;const{gridComponent:i,handleComponentDrop:r,depth:a,width:s,isComponentVisible:d,editMode:c,canEdit:u,setEditMode:p,dashboardId:f}=this.props,m=(s+H.es)/H.cz-H.es,{isResizing:g,rowGuideTop:v}=this.state,y=0===(null==i||null==(e=i.children)?void 0:e.length),C=y&&i.type===h.gn,S=c&&(0,b.tZ)(Yl.XJ,{title:(0,l.t)("Drag and drop components and charts to the dashboard"),description:(0,l.t)("You can create a new chart or use existing ones from the panel on the right"),buttonText:(0,b.tZ)(o.Fragment,null,(0,b.tZ)("i",{className:"fa fa-plus"}),(0,l.t)("Create a new chart")),buttonAction:()=>{window.open(`/chart/add?dashboard_id=${f}`,"_blank","noopener noreferrer")},image:"chart.svg"}),x=c?(0,b.tZ)(Yl.XJ,{title:(0,l.t)("Drag and drop components to this tab"),description:(0,l.t)("You can create a new chart or use existing ones from the panel on the right"),buttonText:(0,b.tZ)(o.Fragment,null,(0,b.tZ)("i",{className:"fa fa-plus"}),(0,l.t)("Create a new chart")),buttonAction:()=>{window.open(`/chart/add?dashboard_id=${f}`,"_blank","noopener noreferrer")},image:"chart.svg"}):(0,b.tZ)(Yl.XJ,{title:(0,l.t)("There are no components added to this tab"),description:u&&(0,l.t)("You can add the components in the edit mode."),buttonText:u&&(0,l.t)("Edit the dashboard"),buttonAction:u&&(()=>{p(!0)}),image:"chart.svg"});return s<100?null:(0,b.tZ)(o.Fragment,null,y&&(0,b.tZ)(ju,null,C?x:S),(0,b.tZ)("div",{className:"dashboard-grid",ref:this.setGridRef},(0,b.tZ)("div",{className:"grid-content"},c&&(0,b.tZ)(De,{component:i,depth:a,parentComponent:null,index:0,orientation:"column",onDrop:this.handleTopDropTargetDrop,className:"empty-droptarget",editMode:!0},Pu),null==i||null==(t=i.children)?void 0:t.map(((e,t)=>(0,b.tZ)(bd,{key:e,id:e,parentId:i.id,depth:a+1,index:t,availableColumnCount:H.cz,columnWidth:m,isComponentVisible:d,onResizeStart:this.handleResizeStart,onResize:this.handleResize,onResizeStop:this.handleResizeStop,onChangeTab:this.handleChangeTab}))),c&&(null==i||null==(n=i.children)?void 0:n.length)>0&&(0,b.tZ)(De,{component:i,depth:a,parentComponent:null,index:i.children.length,orientation:"column",onDrop:r,className:"empty-droptarget",editMode:!0},Nu),g&&Array(H.cz).fill(null).map(((e,t)=>(0,b.tZ)("div",{key:`grid-column-${t}`,className:"grid-column-guide",style:{left:t*H.es+t*m,width:m}}))),g&&v&&(0,b.tZ)("div",{className:"grid-row-guide",style:{top:v,width:s}}))))}}qu.propTypes=Ou,qu.defaultProps={};const zu=qu,Au=(0,r.$j)((function({dashboardState:e,dashboardInfo:t}){return{editMode:e.editMode,canEdit:t.dash_edit_perm,dashboardId:t.id}}),(function(e){return(0,i.DE)({handleComponentDrop:Di._p,resizeComponent:Di.iO,setDirectPathToChild:Lt.E2,setEditMode:Lt.Mb},e)}))(zu),$u=({topLevelTabs:e})=>{const t=(()=>{const e=(0,r.v9)((e=>{var t;return null==(t=e.nativeFilters)?void 0:t.filters}));return(0,o.useMemo)((()=>e?Object.values(e).map((e=>Mu()(e,["id","scope","type"]))):[]),[JSON.stringify(e)])})(),n=(0,r.I0)(),i=(0,r.v9)((e=>e.dashboardLayout.present)),a=(0,r.v9)((e=>e.dashboardState.directPathToChild)),s=(0,r.v9)((e=>e.charts)),l=(0,o.useMemo)((()=>{const e=ad({currentComponent:_u(i),directPathToChild:a});return e>-1?e:((e,t)=>Math.max(0,ad({currentComponent:_u(e),directPathToChild:t})))(i,a)}),[i,a]);(0,o.useEffect)((()=>{if(!(0,d.c)(d.T.DASHBOARD_NATIVE_FILTERS)||0===t.length)return;const e=t.map((e=>{if(e.id.startsWith(Ca.Ky))return{filterId:e.id,tabsInScope:[],chartsInScope:[]};const t=function(e,t,n){const i=Object.values(n);return Object.values(t).filter((t=>{var n,r;return!e.excluded.includes(t.id)&&(null==(n=i.find((e=>{var n;return(null==e?void 0:e.type)===h.dW&&(null==(n=e.meta)?void 0:n.chartId)===t.id})))||null==(r=n.parents)?void 0:r.some((t=>e.rootPath.includes(t))))})).map((e=>e.id))}(e.scope,s,i),n=(0,qi.Rz)(i,t);return{filterId:e.id,tabsInScope:Array.from(n),chartsInScope:t}}));n((0,Zd.xk)(e))}),[t,i,n]);const c=e?e.children:[H.PV],u=Math.min(l,c.length-1),p=0===u?H.PV:u.toString();return(0,b.tZ)("div",{className:"grid-container"},(0,b.tZ)(F,null,(({width:e})=>(0,b.tZ)(C.ZP,{id:H.PV,activeKey:p,renderTabBar:()=>(0,b.tZ)(o.Fragment,null),fullWidth:!1,animated:!1,allowOverflow:!0},c.map(((t,n)=>(0,b.tZ)(C.ZP.TabPane,{key:0===n?H.PV:n.toString()},(0,b.tZ)(Au,{gridComponent:i[t],depth:H.Mu+1,width:e,isComponentVisible:n===l}))))))))};var Uu=n(61337);const Lu=v.iK.div`
  display: grid;
  grid-template-columns: auto 1fr;
  grid-template-rows: auto 1fr;
  flex: 1;
  /* Special cases */

  /* A row within a column has inset hover menu */
  .dragdroppable-column .dragdroppable-row .hover-menu--left {
    left: -12px;
    background: ${({theme:e})=>e.colors.grayscale.light5};
    border: 1px solid ${({theme:e})=>e.colors.grayscale.light2};
  }

  .dashboard-component-tabs {
    position: relative;
  }

  /* A column within a column or tabs has inset hover menu */
  .dragdroppable-column .dragdroppable-column .hover-menu--top,
  .dashboard-component-tabs .dragdroppable-column .hover-menu--top {
    top: -12px;
    background: ${({theme:e})=>e.colors.grayscale.light5};
    border: 1px solid ${({theme:e})=>e.colors.grayscale.light2};
  }

  /* move Tabs hover menu to top near actual Tabs */
  .dashboard-component-tabs > .hover-menu-container > .hover-menu--left {
    top: 0;
    transform: unset;
    background: transparent;
  }

  /* push Chart actions to upper right */
  .dragdroppable-column .dashboard-component-chart-holder .hover-menu--top,
  .dragdroppable .dashboard-component-header .hover-menu--top {
    right: 8px;
    top: 8px;
    background: transparent;
    border: none;
    transform: unset;
    left: unset;
  }
  div:hover > .hover-menu-container .hover-menu,
  .hover-menu-container .hover-menu:hover {
    opacity: 1;
  }
`,Vu=v.iK.div`
  grid-column: 1;
  grid-row: 1 / span 2;
  z-index: 11;
  width: ${({width:e})=>e}px;
`,Ku=v.iK.div`
  position: sticky;
  top: -1px;
  width: ${({width:e})=>e}px;
  flex: 0 0 ${({width:e})=>e}px;
`,Bu=v.iK.div`
  grid-column: 2;
  grid-row: 1;
  position: sticky;
  top: 0;
  z-index: 100;
`,Wu=v.iK.div`
  grid-column: 2;
  grid-row: 2;
  // @z-index-above-dashboard-header (100) + 1 = 101
  ${({fullSizeChartId:e})=>e&&"z-index: 101;"}
`,Hu=v.iK.div`
  display: flex;
  flex-direction: row;
  flex-wrap: nowrap;
  height: auto;
  flex: 1;

  .grid-container .dashboard-component-tabs {
    box-shadow: none;
    padding-left: 0;
  }

  .grid-container {
    /* without this, the grid will not get smaller upon toggling the builder panel on */
    width: 0;
    flex: 1;
    position: relative;
    margin-top: ${({theme:e})=>6*e.gridUnit}px;
    margin-right: ${({theme:e})=>8*e.gridUnit}px;
    margin-bottom: ${({theme:e})=>6*e.gridUnit}px;
    margin-left: ${({theme:e,dashboardFiltersOpen:t,editMode:n,nativeFiltersEnabled:i})=>t||n||!i?8*e.gridUnit:0}px;

    ${({editMode:e,theme:t})=>e&&`\n      max-width: calc(100% - ${Gs.XX+16*t.gridUnit}px);\n    `}
  }

  .dashboard-builder-sidepane {
    width: ${Gs.XX}px;
    z-index: 1;
  }

  .dashboard-component-chart-holder {
    // transitionable traits to show filter relevance
    transition: opacity ${({theme:e})=>e.transitionTiming}s,
      border-color ${({theme:e})=>e.transitionTiming}s,
      box-shadow ${({theme:e})=>e.transitionTiming}s;
    border: 0 solid transparent;
  }
`,Gu=v.iK.div`
  position: absolute;

  :hover .filterbar-resizer::after {
    background-color: ${({theme:e})=>e.colors.primary.base};
  }

  .filterbar-resizer {
    // @z-index-above-sticky-header (100) + 1 = 101
    z-index: 101;
  }

  .filterbar-resizer::after {
    display: block;
    content: '';
    width: 1px;
    height: 100%;
    margin: 0 auto;
  }
`,Yu=()=>{var e,t;const i=(0,r.I0)(),a=(0,Xi.fG)(),s=(0,r.v9)((({dashboardInfo:e})=>`${e.id}`)),c=(0,r.v9)((e=>e.dashboardLayout.present)),h=(0,r.v9)((e=>e.dashboardState.editMode)),p=(0,r.v9)((({dashboardInfo:e})=>e.dash_edit_perm)),f=(0,r.v9)((e=>e.dashboardState.directPathToChild)),v=(0,r.v9)((e=>e.dashboardState.fullSizeChartId)),C=(0,o.useCallback)((({pathToTabIndex:e})=>{i((0,Lt.E2)(e))}),[i]),S=(0,o.useCallback)((()=>{i((0,Di.g3)());const e=sd(_u(c),0);i((0,Lt.E2)(e))}),[c,i]),x=(0,o.useCallback)((e=>i((0,Di._p)(e))),[i]),w=o.useRef(null),k=c[H._4],Z=null==k?void 0:k.children[0],R=Z!==H.PV?c[Z]:void 0,T=(0,yt.eY)(gt.KD.standalone),F=T===H._B.REPORT,D=a.hideTitle||T===H._B.HIDE_NAV_AND_TITLE||F,[_,E]=(0,o.useState)(0);(0,o.useEffect)((()=>{var e,t;let i;return E((null==(e=w.current)||null==(t=e.getBoundingClientRect())?void 0:t.height)||0),void 0!==n.g.ResizeObserver&&w.current&&(i=new ResizeObserver((e=>{E((t=>{var n,i;return(null==e||null==(n=e[0])||null==(i=n.contentRect)?void 0:i.height)||t}))})),i.observe(w.current)),()=>{var e;null==(e=i)||e.disconnect()}}),[]);const{showDashboard:I,dashboardFiltersOpen:M,toggleDashboardFiltersOpen:O,nativeFiltersEnabled:P}=(()=>{const e=(0,o.useContext)(_d.MigrationContext),[t,n]=(0,o.useState)(!1),i=(0,r.v9)((e=>{var t,n;return(null==(t=(0,yt.eY)(gt.KD.showFilters))||t)&&(null==(n=e.dashboardInfo.metadata)?void 0:n.show_native_filters)})),a=(0,r.v9)((({dashboardInfo:e})=>e.dash_edit_perm)),s=Id(),l=Object.values(s),c=(0,yt.eY)(gt.KD.expandFilters),[u,h]=(0,o.useState)(null!=c?c:!!l.length),p=i&&(0,st.cr)(d.T.DASHBOARD_NATIVE_FILTERS)&&(a||!a&&0!==l.length),f=l.filter((e=>e.requiredFirst)),m=Md(),g=t||!p||!(p&&f.length&&f.find((({id:e})=>{var t,n;return void 0===(null==(t=m[e])||null==(n=t.filterState)?void 0:n.value)}))),v=(0,o.useCallback)((e=>{h(null!=e?e:!u)}),[u]);return(0,o.useEffect)((()=>{!1===c||0===l.length&&p&&["CONVERTED","REVIEWING","NOOP"].includes(e)?v(!1):v(!0)}),[l.length,e]),(0,o.useEffect)((()=>{g&&n(!0)}),[g]),{showDashboard:g,dashboardFiltersOpen:u,toggleDashboardFiltersOpen:v,nativeFiltersEnabled:p}})(),[N,j]=function(e){const t=(0,o.useRef)(),[n,i]=(0,o.useState)(Gs.I6);return(0,o.useEffect)((()=>{var n;t.current=null!=(n=t.current)?n:(0,Uu.rV)(Uu.dR.dashboard__custom_filter_bar_widths,{}),t.current[e]&&i(t.current[e])}),[e]),[n,function(n){i(n),(0,Uu.LS)(Uu.dR.dashboard__custom_filter_bar_widths,{...t.current,[e]:n})}]}(s),q=M?N:Gs.gz,[z,A]=function(e){const t=(0,o.useRef)(null),[n,i]=(0,o.useState)(!1),r=e=>{const[t]=e;i(t.intersectionRatio<1)};return(0,o.useEffect)((()=>{const n=new IntersectionObserver(r,e),i=t.current;return i&&n.observe(i),()=>{i&&n.unobserve(i)}}),[t,e]),[t,n]}({threshold:[1]}),$=(0,st.cr)(d.T.DASHBOARD_NATIVE_FILTERS_SET),U=`calc(100vh - ${Gs.UN+(A||T?0:Gs.Ky)+($?Gs.a7:0)}px)`,L=M?0:_+20,V=(0,o.useMemo)((()=>({marginLeft:M||h||!P?0:-32})),[M,h,P]),K=(0,o.useRef)(R);(0,o.useEffect)((()=>{var e,t,n;const r=null==(e=K.current)||null==(t=e.children)?void 0:t.length,o=null==R||null==(n=R.children)?void 0:n.length;if(void 0!==r&&void 0!==o&&o>r){const e=sd(_u(c),o-1);i((0,Lt.E2)(e))}K.current=R}),[R]);const B=(0,o.useCallback)((({dropIndicatorProps:e})=>(0,b.tZ)("div",null,!D&&(0,b.tZ)(Mi,null),e&&(0,b.tZ)("div",e),!F&&R&&!a.hideNav&&(0,b.tZ)(Zl,{shouldFocus:Eu,menuItems:[(0,b.tZ)(Ni,{icon:(0,b.tZ)(W.Z.FallOutlined,{iconSize:"xl"}),label:"Collapse tab content",onClick:S})],editMode:h},(0,b.tZ)(bd,{id:null==R?void 0:R.id,parentId:H._4,depth:H.Mu+1,index:0,renderTabContent:!1,renderHoverMenu:!1,onChangeTab:C})))),[h,C,S,D,F,R,a.hideNav]);return(0,b.tZ)(Lu,null,P&&!h&&(0,b.tZ)(o.Fragment,null,(0,b.tZ)(Gu,null,(0,b.tZ)(g.e,{enable:{right:M},handleClasses:{right:"filterbar-resizer"},size:{width:q,height:"100vh"},minWidth:Gs.I6,maxWidth:Gs.aF,onResizeStop:(e,t,n,i)=>j(q+i.width)})),(0,b.tZ)(Vu,{width:q},(0,b.tZ)(Ku,{ref:z,width:q},(0,b.tZ)(y.Z,null,(0,b.tZ)(Du,{filtersOpen:M,toggleFiltersBar:O,directPathToChild:f,width:q,height:U,offset:L}))))),(0,b.tZ)(Bu,{ref:w},(0,b.tZ)(De,{component:k,parentComponent:null,depth:H.Mu,index:0,orientation:"column",onDrop:x,editMode:h,disableDragDrop:!!R,style:V},B)),(0,b.tZ)(Wu,{fullSizeChartId:v},(0,b.tZ)(b.xB,{styles:b.iv`
            // @z-index-above-dashboard-header (100) + 1 = 101
            ${v&&"div > .filterStatusPopover.ant-popover{z-index: 101}"}
          `}),!h&&!R&&0===(null==(e=c[H.PV])||null==(t=e.children)?void 0:t.length)&&(0,b.tZ)(Yl.XJ,{title:(0,l.t)("There are no charts added to this dashboard"),description:p&&(0,l.t)("Go to the edit mode to configure the dashboard and add charts"),buttonText:p&&(0,l.t)("Edit the dashboard"),buttonAction:()=>i((0,Lt.Mb)(!0)),image:"dashboard.svg"}),(0,b.tZ)("div",{className:m()("dashboard",h&&"dashboard--editing")},(0,b.tZ)(Hu,{className:"dashboard-content",dashboardFiltersOpen:M,editMode:h,nativeFiltersEnabled:P},I?(0,b.tZ)($u,{topLevelTabs:R}):(0,b.tZ)(u.Z,null),h&&(0,b.tZ)(nt,{isStandalone:!!T,topOffset:_})))))},Ju=[h.dW,h.xh,h.t];function Qu(e){return!Object.values(e).some((({type:e})=>e&&Ju.includes(e)))}const Xu={actions:s().shape({addSliceToDashboard:s().func.isRequired,removeSliceFromDashboard:s().func.isRequired,triggerQuery:s().func.isRequired,logEvent:s().func.isRequired,clearDataMaskState:s().func.isRequired}).isRequired,dashboardInfo:G.$X.isRequired,dashboardState:G.DZ.isRequired,charts:s().objectOf(G.$6).isRequired,slices:s().objectOf(G.Rw).isRequired,activeFilters:s().object.isRequired,chartConfiguration:s().object.isRequired,datasources:s().object.isRequired,ownDataCharts:s().object.isRequired,layout:s().object.isRequired,impressionId:s().string.isRequired,initMessages:s().array,timeout:s().number,userId:s().string};class eh extends o.PureComponent{static onBeforeUnload(e){e?window.addEventListener("beforeunload",eh.unload):window.removeEventListener("beforeunload",eh.unload)}static unload(){const e=(0,l.t)("You have unsaved changes.");return window.event.returnValue=e,e}constructor(e){var t,n;super(e),this.appliedFilters=null!=(t=e.activeFilters)?t:{},this.appliedOwnDataCharts=null!=(n=e.ownDataCharts)?n:{},this.onVisibilityChange=this.onVisibilityChange.bind(this)}componentDidMount(){const e=document.getElementById("app"),t=(null==e?void 0:e.getAttribute("data-bootstrap"))||"{}",{dashboardState:n,layout:i}=this.props,r={is_soft_navigation:lt.Yd.timeOriginOffset>0,is_edit_mode:n.editMode,mount_duration:lt.Yd.getTimestamp(),is_empty:Qu(i),is_published:n.isPublished,bootstrap_data_length:t.length},o=(0,el.Z)();o&&(r.target_id=o),this.props.actions.logEvent(lt.Wl,r),"hidden"===document.visibilityState&&(this.visibilityEventData={start_offset:lt.Yd.getTimestamp(),ts:(new Date).getTime()}),window.addEventListener("visibilitychange",this.onVisibilityChange),this.applyCharts()}componentDidUpdate(){this.applyCharts()}UNSAFE_componentWillReceiveProps(e){const t=p(this.props.layout),n=p(e.layout);this.props.dashboardInfo.id===e.dashboardInfo.id&&(t.length<n.length?n.filter((e=>-1===t.indexOf(e))).forEach((t=>{return this.props.actions.addSliceToDashboard(t,(n=e.layout,i=t,Object.values(n).find((e=>e&&e.type===h.dW&&e.meta&&e.meta.chartId===i))));var n,i})):t.length>n.length&&t.filter((e=>-1===n.indexOf(e))).forEach((e=>this.props.actions.removeSliceFromDashboard(e))))}applyCharts(){const{hasUnsavedChanges:e,editMode:t}=this.props.dashboardState,{appliedFilters:n,appliedOwnDataCharts:i}=this,{activeFilters:r,ownDataCharts:o,chartConfiguration:a}=this.props;(0,d.c)(d.T.DASHBOARD_CROSS_FILTERS)&&!a||(t||(0,zi.JB)(i,o,{ignoreUndefined:!0})&&(0,zi.JB)(n,r,{ignoreUndefined:!0})||this.applyFilters(),e?eh.onBeforeUnload(!0):eh.onBeforeUnload(!1))}componentWillUnmount(){window.removeEventListener("visibilitychange",this.onVisibilityChange),this.props.actions.clearDataMaskState()}onVisibilityChange(){if("hidden"===document.visibilityState)this.visibilityEventData={start_offset:lt.Yd.getTimestamp(),ts:(new Date).getTime()};else if("visible"===document.visibilityState){const e=this.visibilityEventData.start_offset;this.props.actions.logEvent(lt.Ev,{...this.visibilityEventData,duration:lt.Yd.getTimestamp()-e})}}getAllCharts(){return Object.values(this.props.charts)}applyFilters(){const{appliedFilters:e}=this,{activeFilters:t,ownDataCharts:n}=this.props,i=Object.keys(t),r=Object.keys(e),o=new Set(i.concat(r)),a=((e,t)=>{const n=Object.keys(e),i=Object.keys(t),r=(o=n,a=i,[...o.filter((e=>!a.includes(e))),...a.filter((e=>!o.includes(e)))]).filter((n=>e[n]||t[n]));var o,a;return new Set([...n,...i]).forEach((n=>{(0,zi.JB)(e[n],t[n])||r.push(n)})),[...new Set(r)]})(n,this.appliedOwnDataCharts);[...o].forEach((n=>{if(!i.includes(n)&&r.includes(n))a.push(...e[n].scope);else if(r.includes(n)){if((0,zi.JB)(e[n].values,t[n].values,{ignoreUndefined:!0})||a.push(...t[n].scope),!(0,zi.JB)(e[n].scope,t[n].scope)){const i=(t[n].scope||[]).concat(e[n].scope||[]);a.push(...i)}}else a.push(...t[n].scope)})),this.refreshCharts([...new Set(a)]),this.appliedFilters=t,this.appliedOwnDataCharts=n}refreshCharts(e){e.forEach((e=>{this.props.actions.triggerQuery(!0,e)}))}render(){return this.context.loading?(0,b.tZ)(u.Z,null):(0,b.tZ)(o.Fragment,null,(0,b.tZ)(Yu,null))}}eh.contextType=c.Zn,eh.propTypes=Xu,eh.defaultProps={initMessages:[],timeout:60,userId:""};const th=eh;var nh=n(50810);const ih=(0,r.$j)((function(e){var t,n,i,r,o;const{datasources:a,sliceEntities:s,charts:l,dataMask:d,dashboardInfo:c,dashboardState:u,dashboardLayout:h,impressionId:p,nativeFilters:f}=e;return{initMessages:null==(t=c.common)?void 0:t.flash_messages,timeout:null==(n=c.common)||null==(i=n.conf)?void 0:i.SUPERSET_WEBSERVER_TIMEOUT,userId:c.userId,dashboardInfo:c,dashboardState:u,charts:l,datasources:a,activeFilters:{...(0,hn.De)(),...Li({chartConfiguration:null==(r=c.metadata)?void 0:r.chart_configuration,nativeFilters:f.filters,dataMask:d,layout:h.present})},chartConfiguration:null==(o=c.metadata)?void 0:o.chart_configuration,ownDataCharts:Ui(d,"ownState"),slices:s.slices,layout:h.present,impressionId:p}}),(function(e){return{actions:(0,i.DE)({setDatasources:nh.Fy,clearDataMaskState:it.sh,addSliceToDashboard:Lt.Pi,removeSliceFromDashboard:Lt.rL,triggerQuery:ji.triggerQuery,logEvent:Ei.logEvent},e)}}))(th)},90057:(e,t,n)=>{"use strict";n.d(t,{x:()=>o,C:()=>a});var i=n(18172),r=n(67294);function o(e){var t=(0,r.useState)((function(){return(0,i.vV)("function"==typeof e?e():e,!0)})),n=t[1];return[t[0],(0,r.useCallback)((function(e){n("function"==typeof e?(0,i.ZP)(e):(0,i.vV)(e))}),[])]}function a(e,t,n){var o=(0,r.useMemo)((function(){return(0,i.ZP)(e)}),[e]);return(0,r.useReducer)(o,t,n)}}}]);
//# sourceMappingURL=b10567920da44e66f67a.chunk.js.map